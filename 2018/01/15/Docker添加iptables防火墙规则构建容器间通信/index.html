<!DOCTYPE html>
<html>







<head>
	<meta charset="UTF-8"/>
	<meta name="HandheldFriendly" content="True" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
	<meta name="theme-color" content="">
	<title>Docker添加iptables防火墙规则构建容器间通信 | </title>
	<meta name="description" content="" />
	<meta name="generator" content="ダイスキでダイキライ">
	
	
	<link rel="shortcut icon" href="https://i.loli.net/2017/11/26/5a19c0b50432e.png">
	
	<link rel="stylesheet" href="/css/screen.min.css">
	<link rel="stylesheet" href="/css/style.css"> 
	
	<script src="/js/jquery.js"></script>
	<script src="/js/highlight.min.js"></script>
	
</head>
<body class="post-template">
    <div class="site-wrapper">
        




<header class="site-header outer" style="z-index: 999">
    <div class="inner">
        

<nav class="site-nav"> 
    <div class="site-nav-left">
        <ul class="nav">
            <li>
                
                <a href="/" title="Home">Home</a>
                
            </li>
            
            
            <li>
                <a href="/about" title="About">About</a>
            </li>
            
            <li>
                <a href="/archives" title="Archives">Archives</a>
            </li>
            
            
        </ul> 
    </div>
    <div class="site-nav-right">
        
<div class="social-links">
    
    
    <a class="social-link" href="https://github.com/xzhih" target="_blank" rel="noopener">
        <svg class="icon" width="32px" height="31.54px" viewBox="0 0 1039 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"><path d="M969.784652 261.533214c-47.108467-81.221495-108.836803-144.574261-188.433869-191.682728C701.753718 22.742019 614.034503 0 519.817569 0c-94.216934 0-181.936149 22.742019-261.533214 69.850486C178.687289 116.958953 116.958953 180.311719 69.850486 261.533214 22.742019 341.13028 0 428.849494 0 524.690859c0 113.710093 32.488598 217.673607 99.090224 308.641681s151.071981 154.320841 256.659925 190.058299c11.371009 1.62443 21.117589 0 27.615308-4.87329 6.49772-4.87329 8.12215-12.995439 8.12215-21.117589v-97.465794l-16.244299 3.24886c-9.746579 1.62443-22.742019 3.24886-37.361888 1.62443-14.619869 0-30.864168-1.62443-47.108467-4.87329-16.244299-3.24886-30.864168-9.746579-45.484038-21.117589-14.619869-11.371009-24.366449-24.366449-29.239738-42.235177l-6.49772-16.244299c-4.87329-9.746579-11.371009-22.742019-21.117588-34.113028-9.746579-12.995439-19.493159-21.117589-29.239739-25.990878l-4.873289-3.24886c-3.24886-1.62443-6.49772-4.87329-8.12215-8.12215-3.24886-3.24886-4.87329-6.49772-6.497719-9.746579-1.62443-3.24886 0-6.49772 3.248859-8.12215 3.24886-1.62443 9.746579-3.24886 19.493159-3.24886l12.99544 1.62443c9.746579 1.62443 19.493159 6.49772 34.113027 16.244299 12.995439 9.746579 24.366449 21.117589 32.488599 35.737458 9.746579 17.868729 22.742019 32.488598 37.361887 42.235178 14.619869 9.746579 29.239738 14.619869 43.859608 14.619869 14.619869 0 27.615308-1.62443 38.986317-3.24886s21.117589-6.49772 30.864168-9.746579c3.24886-30.864168 14.619869-53.606187 32.488599-69.850486-25.990878-3.24886-48.732897-6.49772-69.850486-12.995439-21.117589-4.87329-42.235177-14.619869-63.352766-25.990879-21.117589-12.995439-40.610748-27.615308-55.230617-45.484037-14.619869-17.868729-25.990878-42.235177-35.737458-71.474916-9.746579-29.239738-14.619869-63.352766-14.619869-102.339084 0-55.230617 17.868729-102.339084 53.606187-141.325401-16.244299-40.610748-14.619869-87.719215 4.873289-139.700972 12.995439-4.87329 32.488598-1.62443 58.479477 9.746579 25.990878 9.746579 43.859607 19.493159 56.855046 25.990879 11.371009 6.49772 21.117589 12.995439 29.239739 17.868729 42.235177-11.371009 86.094785-17.868729 129.954392-17.868729s87.719215 6.49772 129.954392 17.868729l25.990879-16.244299c17.868729-11.371009 38.986318-21.117589 61.728336-29.239738 24.366449-9.746579 42.235177-11.371009 55.230617-8.12215 19.493159 51.981757 22.742019 97.465794 4.873289 139.700972 35.737458 38.986318 53.606187 86.094785 53.606187 141.325401 0 38.986318-4.87329 73.099346-14.619869 102.339084-9.746579 29.239738-21.117589 53.606187-35.737458 71.474916-14.619869 17.868729-32.488598 32.488598-55.230617 45.484037-21.117589 12.995439-43.859607 21.117589-63.352766 25.990879-21.117589 4.87329-43.859607 9.746579-69.850486 12.995439 22.742019 21.117589 35.737458 51.981757 35.737458 97.465794v144.574261c0 8.12215 3.24886 14.619869 8.12215 21.117589 4.87329 4.87329 14.619869 6.49772 25.990878 4.87329 103.963514-35.737458 190.058299-97.465794 256.659925-190.058299 66.601626-90.968075 99.090224-193.307158 99.090224-308.641681 1.62443-95.841364-21.117589-183.560579-68.226056-263.157645z" fill="#ffffff" /></svg>
    </a>
    
    
    
</div>
    </div>
</nav>
    </div>
</header>


<main id="site-main" class="site-main outer" role="main">
    <div class="inner">
        <header class="post-full-header">
            <section class="post-full-meta">
                <time  class="post-full-meta-date" datetime="2018-01-14T21:43:04.000Z" itemprop="datePublished">
                    2018-01-15
                </time>
                
                <span class="date-divider">/</span>
                
                <a href="/categories/coding/">coding</a>&nbsp;&nbsp;
                
                
            </section>
            <h1 class="post-full-title">Docker添加iptables防火墙规则构建容器间通信</h1>
        </header>
        <article class="post-full no-image">
            
            <section class="post-full-content">
                <div id="lightgallery" class="markdown-body">
                    <h2 id="一、坑从何来"><a href="#一、坑从何来" class="headerlink" title="一、坑从何来"></a>一、坑从何来</h2><p>最近正好看到解析Docker单主机网络的部分，提到通过link链接容器，于是深入思考了下link的机制，首先如果为容器添加一条链接会发生以下几件事：</p>
<ul>
<li>描述目标容器的环境变量会被创建</li>
<li>链接的别名和对应目标容器的ip地址会被添加到DNS覆盖列表中</li>
<li>如果跨容器通信被禁止，Docker会添加特定的防火墙规则来允许被链接的容器间的通信。</li>
</ul>
<p>重点在于第三点，这里Docker添加的防火墙规则是允许两个容器通信到什么地步呢，大概有以下三种猜想：</p>
<a id="more"></a>
<ol>
<li>两个容器间任意端口自由通信，应该不太可能，达到这种地步接近Joined容器共用同一个网络栈的级别了</li>
<li>容器任意端口都能连上目标容器EXPOSE的端口</li>
<li>容器只有指定的的进程（如pid唯一）、指定的端口号能够连上目标容器EXPOSE的端口，至于这个指定的进程和端口号猜测是在构建的时候指定好并添加到配置中去的？</li>
</ol>
<p>最初的猜想是3，因为如果是2的话，容器被非法入侵岂不是可以新开个进程随意连上数据库往外倒数据？（<em>后来仔细想想，容器都被入侵了，跟权限被提到root了有啥区别……当然是为所欲为啊，不过当时没想清楚就是了</em>）这明显不安全。</p>
<p>这里验证最直观可靠的方式还是看iptables的路由规则，开始实验。</p>
<hr>
<h2 id="二、在踩坑的边缘试探"><a href="#二、在踩坑的边缘试探" class="headerlink" title="二、在踩坑的边缘试探"></a>二、在踩坑的边缘试探</h2><h4 id="1-实验环境"><a href="#1-实验环境" class="headerlink" title="1.实验环境"></a>1.实验环境</h4><ul>
<li>Ubuntu 16.04.2 LTS (GNU/Linux 4.4.0-63-generic x86_64)</li>
<li>Docker version 17.05.0-ce, build 89658be</li>
</ul>
<hr>
<h4 id="2-iptables设置"><a href="#2-iptables设置" class="headerlink" title="2.iptables设置"></a>2.iptables设置</h4><p>查看当前iptables设置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ iptables -nL</div></pre></td></tr></table></figure>
<p>以防万一大家可以先清洗一遍iptables，有配置的同学记得提前<strong>备份</strong>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ iptables -F</div></pre></td></tr></table></figure>
<p>清洗后：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">Chain INPUT (policy ACCEPT)</div><div class="line">target     prot opt source               destination</div><div class="line">Chain FORWARD (policy DROP)</div><div class="line">target     prot opt source               destination</div><div class="line">Chain OUTPUT (policy ACCEPT)</div><div class="line">target     prot opt source               destination</div><div class="line">Chain DOCKER (0 references)</div><div class="line">target     prot opt source               destination</div><div class="line">Chain DOCKER-ISOLATION (0 references)</div><div class="line">target     prot opt source               destination</div></pre></td></tr></table></figure>
<hr>
<h4 id="3-icc、iptables选项与-etc-default-docker"><a href="#3-icc、iptables选项与-etc-default-docker" class="headerlink" title="3.icc、iptables选项与/etc/default/docker"></a>3.icc、iptables选项与/etc/default/docker</h4><p>icc是跨容器通信开关，iptables则是Docker是否应用防火墙规则的开关，于是修改/etc/default/docker文件，禁止跨容器通信，要求Docker使用iptables规则：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">DOCKER_OPTS=&quot;--icc=false --iptables=true&quot;</div></pre></td></tr></table></figure>
<p>同时去掉注释，并重启docker服务：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ service docker restart</div></pre></td></tr></table></figure>
<p>再次查看当前iptables配置，可以看到docker和docker-isolation都被加入到了chain-forward项中：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">Chain FORWARD (policy DROP)</div><div class="line">target     prot opt source               destination </div><div class="line">DOCKER-ISOLATION  all  --  0.0.0.0/0            0.0.0.0/0 </div><div class="line">ACCEPT     all  --  0.0.0.0/0            0.0.0.0/0            ctstate RELATED,ESTABLISHED</div><div class="line">DOCKER     all  --  0.0.0.0/0            0.0.0.0/0 </div><div class="line">ACCEPT     all  --  0.0.0.0/0            0.0.0.0/0 </div><div class="line">DROP       all  --  0.0.0.0/0            0.0.0.0/0 </div><div class="line">Chain DOCKER (1 references)</div><div class="line">target     prot opt source               destination         </div><div class="line">ACCEPT     tcp  --  172.17.0.3           172.17.0.2           tcp dpt:3306</div><div class="line">ACCEPT     tcp  --  172.17.0.2           172.17.0.3           tcp spt:3306</div><div class="line">Chain DOCKER-ISOLATION (1 references)</div><div class="line">target     prot opt source               destination </div><div class="line">RETURN     all  --  0.0.0.0/0            0.0.0.0/0</div></pre></td></tr></table></figure>
<p>此处用本机现有的mysql和redis做实验，redis依赖mysql（mysql密码请自行根据自己的配置修改）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ docker run --rm --name  mysql -e 3306 -e MYSQL_ROOT_PASSWORD=123456 -d mysql</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ docker run --rm --name redis --link mysql:mysql -d redis</div></pre></td></tr></table></figure>
<p>操作完docker ps可以看到两个容器正常运行，但并没有看到iptables有新添加规则。</p>
<hr>
<h4 id="4-docker-network"><a href="#4-docker-network" class="headerlink" title="4.docker network"></a>4.docker network</h4><p>之前的项目没有涉及到多网络配置，因此对network一无所知，加上无脑瞎找资料没思考清楚，误以为是两个容器不在一个网络内，于是查看默认bridge网络配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ docker network inspect bridge</div></pre></td></tr></table></figure>
<p>部分相关配置如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  &quot;Name&quot;: &quot;bridge&quot;,</div><div class="line">  &quot;Id&quot;: &quot;d14d164b2dbc43b33eb298d79e5928fda258129a02f6c2a7c310633a718d356c&quot;,</div><div class="line">  &quot;Created&quot;: &quot;2018-01-15T03:53:42.133885625+08:00&quot;,</div><div class="line">  &quot;Scope&quot;: &quot;local&quot;,</div><div class="line">  &quot;Driver&quot;: &quot;bridge&quot;,</div><div class="line">  &quot;EnableIPv6&quot;: false,</div><div class="line">  &quot;IPAM&quot;: &#123;</div><div class="line">    &quot;Driver&quot;: &quot;default&quot;,</div><div class="line">    &quot;Options&quot;: null,</div><div class="line">    &quot;Config&quot;: [</div><div class="line">      &#123;</div><div class="line">        &quot;Subnet&quot;: &quot;172.17.0.0/16&quot;,</div><div class="line">        &quot;Gateway&quot;: &quot;172.17.0.1&quot;</div><div class="line">      &#125;</div><div class="line">    ]</div><div class="line">  &#125;,</div><div class="line">  &quot;Internal&quot;: false,</div><div class="line">  &quot;Attachable&quot;: false,</div><div class="line">  &quot;Ingress&quot;: false,</div><div class="line">  &quot;Containers&quot;: &#123;</div><div class="line">    &quot;5b81e33ddd5e7e79e6c315bd3889812362d19732e0ce9a0486edc98a26c59e77&quot;: &#123;</div><div class="line">      &quot;Name&quot;: &quot;redis&quot;,</div><div class="line">      &quot;EndpointID&quot;: &quot;df2e9dda0de35c4934a50d33bd23cb9d27301cac3882880ba58acf82713956f4&quot;,</div><div class="line">      &quot;MacAddress&quot;: &quot;02:42:ac:11:00:03&quot;,</div><div class="line">      &quot;IPv4Address&quot;: &quot;172.17.0.3/16&quot;,</div><div class="line">      &quot;IPv6Address&quot;: &quot;&quot;</div><div class="line">    &#125;,</div><div class="line">    &quot;fada6a036ecba16bc1c08ec5b8fced59b51144a949d7c1051b78e88d7a4bb35f&quot;: &#123;</div><div class="line">      &quot;Name&quot;: &quot;mysql&quot;,</div><div class="line">      &quot;EndpointID&quot;: &quot;38a5036088b19daa08e212d947b44f3a94e823d9a2cd060d0fbfc19680591abf&quot;,</div><div class="line">      &quot;MacAddress&quot;: &quot;02:42:ac:11:00:02&quot;,</div><div class="line">      &quot;IPv4Address&quot;: &quot;172.17.0.2/16&quot;,</div><div class="line">      &quot;IPv6Address&quot;: &quot;&quot;</div><div class="line">    &#125;</div><div class="line">  &#125;,</div><div class="line">  &quot;Options&quot;: &#123;</div><div class="line">    &quot;com.docker.network.bridge.default_bridge&quot;: &quot;true&quot;,</div><div class="line">    &quot;com.docker.network.bridge.enable_icc&quot;: &quot;true&quot;,</div><div class="line">    &quot;com.docker.network.bridge.enable_ip_masquerade&quot;: &quot;true&quot;,</div><div class="line">    &quot;com.docker.network.bridge.host_binding_ipv4&quot;: &quot;0.0.0.0&quot;,</div><div class="line">    &quot;com.docker.network.bridge.name&quot;: &quot;docker0&quot;,</div><div class="line">    &quot;com.docker.network.driver.mtu&quot;: &quot;1500&quot;</div><div class="line">  &#125;,</div><div class="line">  &quot;Labels&quot;: &#123;&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>发现两个容器都在默认网络里。顺便这里有个很迷的地方就是Options里的true和false都是字符串类型，但外面的却不是，后面会提到。观察配置发现icc选项还是true，说明刚才修改的/etc/default/docker文件很可能没起作用。此处有两个选择：</p>
<ul>
<li>新建一个bridge网络，icc设为false</li>
<li>继续设法修改docker daemon启动选项</li>
</ul>
<p>其实并没有选择，因为就参数来看只能设置icc，而iptables使用与否必须是docker daemon启动时设置好的。直接百度到的资料杂乱无章，对错参半，于是还是根据官网操作：<br>  <img src="https://s1.ax2x.com/2018/01/15/MBIxe.jpg" alt="图1 docs.docker.com配置说明"><br>新建daemon.json：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ vim /etc/docker/daemon.json</div></pre></td></tr></table></figure>
<p>输入以下内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  &quot;iptables&quot;: &quot;true&quot;,</div><div class="line">  &quot;icc&quot;: &quot;false&quot;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>并重启dockerd服务，发现会重启失败，显示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">unable to configure the Docker daemon with file /etc/docker/daemon.json: json: cannot unmarshal string into Go value of type bool</div></pre></td></tr></table></figure>
<p>这就是刚才提到的很迷的地方，欺负我们不懂go语言系列，参数改为以下内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  &quot;iptables&quot;: true,</div><div class="line">  &quot;icc&quot;: false</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>保存后再重启docker daemon，再次查看bridge网络，options选项中的com.docker.network.bridge.enable_icc应该为false了，说明配置生效了，此时再按上面步骤启动容器link，可以看到iptables多了两条规则：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">Chain DOCKER (1 references)</div><div class="line">target     prot opt source               destination         </div><div class="line">ACCEPT     tcp  --  172.17.0.3           172.17.0.2           tcp dpt:mysql</div><div class="line">ACCEPT     tcp  --  172.17.0.2           172.17.0.3           tcp spt:mysql</div></pre></td></tr></table></figure>
<p>操作成功，可以发现两个容器之间互联的是通过forward链的转发规则，具体规则可阅读iptables forward详解。<br>外面替换一下两个容器的位置，也可以看到同样结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ docker run --rm --name redis -e 6379 -d redis</div><div class="line">$ docker run --rm --name  mysql --link redis:redis -e MYSQL_ROOT_PASSWORD=123456 -d mysql</div></pre></td></tr></table></figure>
<p>端口变成了redis的6379：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">Chain DOCKER (1 references)</div><div class="line">target     prot opt source               destination         </div><div class="line">ACCEPT     tcp  --  172.17.0.3           172.17.0.2           tcp dpt:6379</div><div class="line">ACCEPT     tcp  --  172.17.0.2           172.17.0.3           tcp spt:6379</div></pre></td></tr></table></figure>
<hr>
<h4 id="5-结束"><a href="#5-结束" class="headerlink" title="5.结束"></a>5.结束</h4><p>验证过程中很多地方没想清楚胡乱操作一通，把原本简单的问题都搞复杂了，动手前深思熟虑还是很重要的啊（俗话说得好，真正写代码的时间能有20%不错了）。</p>
<hr>
<h2 id="二、后来"><a href="#二、后来" class="headerlink" title="二、后来"></a>二、后来</h2><h4 id="1-仔细想想"><a href="#1-仔细想想" class="headerlink" title="1.仔细想想"></a>1.仔细想想</h4><ul>
<li><p>其实当时还想顺着猜测3的思路深入思考过如果容器被非法入侵，直接攻击代码搞挂了原本的进程，用原本与目标容器3306连接的端口构建数据库的连接该怎么办……那当然是没办法啦啊哈哈哈，你说你家金库的钥匙密码人家都拿到了你的黄金怎么办，那当然是没办法的，重点应该在怎么防止密码和钥匙失窃上吧hhhhh。</p>
</li>
<li><p>而且退一步想，指定能与目标容器3306连接的端口可以办得到，但是绑定到进程上是没有实现的可能的，作为进程标识的pid是会被复用的，重启后pid会变，不可能每次重启进程都重新设定绑定关系，而且也没有设定的基础。</p>
</li>
<li><p>网络基础还是不扎实，很多东西没真正理解。</p>
</li>
</ul>
<h4 id="2-论如何查资料"><a href="#2-论如何查资料" class="headerlink" title="2.论如何查资料"></a>2.论如何查资料</h4><ul>
<li>珍爱生命，少查csdn，多看官方文档，过脑思考比无脑开车撞墙要好</li>
<li>努力改掉下意识避开英文的习惯</li>
<li>写操作指南不指明各种相关版本号的都是<strong><em>耍流氓</em></strong></li>
<li><strong>基础不牢，地动山摇，我还是太天真了.jpg</strong></li>
</ul>

                </div>
            </section>
        </article>
    </div>
    
<nav class="pagination">
    
    
    <a class="prev-post" href="/2018/01/25/利用heroku实现免费的全平台科学上网/">
        ← 利用heroku实现免费的全平台科学上网
    </a>
    
    <span class="prev-next-post">•</span>
    
    <a class="next-post" href="/2017/10/24/【Philosophical-Dilemmas】上帝、永生与信仰/">
        【Philosophical Dilemmas】上帝、永生与信仰 →
    </a>
    
    
</nav>
</main>

<div class="t-g-control">
    <div class="gotop">
        <svg class="icon" width="32px" height="32px" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"><path d="M793.024 710.272a32 32 0 1 0 45.952-44.544l-310.304-320a32 32 0 0 0-46.4 0.48l-297.696 320a32 32 0 0 0 46.848 43.584l274.752-295.328 286.848 295.808z" fill="#8a8a8a" /></svg>
    </div>
    <div class="toc-control">
        <svg class="icon toc-icon" width="32px" height="32.00px" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"><path d="M779.776 480h-387.2a32 32 0 0 0 0 64h387.2a32 32 0 0 0 0-64M779.776 672h-387.2a32 32 0 0 0 0 64h387.2a32 32 0 0 0 0-64M256 288a32 32 0 1 0 0 64 32 32 0 0 0 0-64M392.576 352h387.2a32 32 0 0 0 0-64h-387.2a32 32 0 0 0 0 64M256 480a32 32 0 1 0 0 64 32 32 0 0 0 0-64M256 672a32 32 0 1 0 0 64 32 32 0 0 0 0-64" fill="#8a8a8a" /></svg>
        <svg class="icon toc-close" style="display: none;" width="32px" height="32.00px" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"><path d="M512 960c-247.039484 0-448-200.960516-448-448S264.960516 64 512 64 960 264.960516 960 512 759.039484 960 512 960zM512 128.287273c-211.584464 0-383.712727 172.128262-383.712727 383.712727 0 211.551781 172.128262 383.712727 383.712727 383.712727 211.551781 0 383.712727-172.159226 383.712727-383.712727C895.712727 300.415536 723.551781 128.287273 512 128.287273z" fill="#8a8a8a" /><path d="M557.05545 513.376159l138.367639-136.864185c12.576374-12.416396 12.672705-32.671738 0.25631-45.248112s-32.704421-12.672705-45.248112-0.25631l-138.560301 137.024163-136.447897-136.864185c-12.512727-12.512727-32.735385-12.576374-45.248112-0.063647-12.512727 12.480043-12.54369 32.735385-0.063647 45.248112l136.255235 136.671523-137.376804 135.904314c-12.576374 12.447359-12.672705 32.671738-0.25631 45.248112 6.271845 6.335493 14.496116 9.504099 22.751351 9.504099 8.12794 0 16.25588-3.103239 22.496761-9.247789l137.567746-136.064292 138.687596 139.136568c6.240882 6.271845 14.432469 9.407768 22.65674 9.407768 8.191587 0 16.352211-3.135923 22.591372-9.34412 12.512727-12.480043 12.54369-32.704421 0.063647-45.248112L557.05545 513.376159z" fill="#8a8a8a" /></svg>
    </div>
    <div class="gobottom">
        <svg class="icon" width="32px" height="32.00px" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"><path d="M231.424 346.208a32 32 0 0 0-46.848 43.584l297.696 320a32 32 0 0 0 46.4 0.48l310.304-320a32 32 0 1 0-45.952-44.544l-286.848 295.808-274.752-295.36z" fill="#8a8a8a" /></svg>
    </div>
</div>
<div class="toc-main" style="right: -100%">
    <div class="post-toc">
        <span>TOC</span>
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#一、坑从何来"><span class="toc-text">一、坑从何来</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#二、在踩坑的边缘试探"><span class="toc-text">二、在踩坑的边缘试探</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-实验环境"><span class="toc-text">1.实验环境</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-iptables设置"><span class="toc-text">2.iptables设置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-icc、iptables选项与-etc-default-docker"><span class="toc-text">3.icc、iptables选项与/etc/default/docker</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-docker-network"><span class="toc-text">4.docker network</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-结束"><span class="toc-text">5.结束</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#二、后来"><span class="toc-text">二、后来</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-仔细想想"><span class="toc-text">1.仔细想想</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-论如何查资料"><span class="toc-text">2.论如何查资料</span></a></li></ol></li></ol></li></ol>
    </div>
</div>



        

<aside class="read-next outer">
    <div class="inner">
        <div class="read-next-feed">
            
            

  <article class="read-next-card"  style="background-image: url(https://i.loli.net/2017/11/26/5a19c56faa29f.jpg)"  >
    <header class="read-next-card-header">
      <small class="read-next-card-header-sitetitle">&mdash; ダイスキでダイキライ &mdash;</small>
      <h3 class="read-next-card-header-title">Recent Posts</h3>
    </header>
    <div class="read-next-divider">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 14.5s2 3 5 3 5.5-2.463 5.5-5.5S21 6.5 18 6.5c-5 0-7 11-12 11C2.962 17.5.5 15.037.5 12S3 6.5 6 6.5s4.5 3.5 4.5 3.5"/>
        </svg>
    </div>
    <div class="read-next-card-content">
      <ul>
        
        
        
        <li>
          <a href="/2018/01/29/test/">test</a>
        </li>
        
        
        
        <li>
          <a href="/2018/01/29/stackedit/">stackeditTest</a>
        </li>
        
        
        
        <li>
          <a href="/2018/01/25/利用heroku实现免费的全平台科学上网/">利用heroku实现免费的全平台科学上网</a>
        </li>
        
        
        
        
        
        
        
        
      </ul>
    </div>
    <footer class="read-next-card-footer">
      <a href="/archives">  MORE  → </a>
    </footer>
  </article>

            
            
            

<article class="read-next-card"  style="background-image: url(https://i.loli.net/2017/11/26/5a19c56faa29f.jpg)"  >
    <header class="read-next-card-header" style="padding-bottom: 20px">
        <h3 class="read-next-card-header-title">Categories</h3>
    </header>
    <div class="read-next-card-content">
        <ul>
            <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/coding/">coding</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/reading/">reading</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/test/">test</a></li></ul>
        </ul>
    </div>
</article>


            
            
            

<article class="read-next-card"  style="background-image: url(https://i.loli.net/2017/11/26/5a19c56faa29f.jpg)"  >
	<header class="read-next-card-header" style="padding-bottom: 20px">
		<h3 class="read-next-card-header-title">Tag Cloud</h3>
	</header>
	<div class="read-next-card-content-ext">
		<a href="/tags/Docker/" style="font-size: 14px;">Docker</a> <a href="/tags/Philosophical-Dilemmas/" style="font-size: 14px;">Philosophical Dilemmas</a> <a href="/tags/c/" style="font-size: 14px;">c#</a> <a href="/tags/heroku/" style="font-size: 14px;">heroku</a> <a href="/tags/iptables/" style="font-size: 14px;">iptables</a> <a href="/tags/java/" style="font-size: 14px;">java</a> <a href="/tags/network/" style="font-size: 24px;">network</a> <a href="/tags/philosophy/" style="font-size: 14px;">philosophy</a> <a href="/tags/python/" style="font-size: 14px;">python</a> <a href="/tags/stackedit/" style="font-size: 14px;">stackedit</a> <a href="/tags/wall/" style="font-size: 14px;">wall</a>
	</div>
</article>

            
        </div>
    </div>
</aside>

<footer class="site-footer outer">
	<div class="site-footer-content inner">
		<section class="copyright">
			<a href="/">ダイスキでダイキライ</a>
			&copy; 2018
		</section>
		<nav class="site-footer-nav">
			
			<a href="//hexo.io/">Powered by Hexo</a>
			<a href="https://github.com/xzhih/hexo-theme-casper">Theme Casper</a>
		</nav>
	</div>
</footer>

<div class="floating-header" >
    <progress class="progress" value="0">
        <div class="progress-container">
            <span class="progress-bar"></span>
        </div>
    </progress>
</div>
<script src="/js/script.js"></script>

<link rel="stylesheet" href="/css/lightgallery.min.css">
<script src="/js/lightgallery.min.js"></script>
<script>
	$(function () {
		var postImg = $('#lightgallery').find('img');
		postImg.addClass('post-img');
		postImg.each(function () {
			var imgSrc = $(this).attr('src');
			$(this).attr('data-src', imgSrc);
		});
		$('#lightgallery').lightGallery({selector: '.post-img'});
	});
</script>


    </div>
</body>
</html>
