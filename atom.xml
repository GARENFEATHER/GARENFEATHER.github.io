<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>変わらないで</title>
  
  <subtitle>ダイスキでダイキライ</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://blog.garenfeather.cn/"/>
  <updated>2018-04-06T07:07:25.467Z</updated>
  <id>http://blog.garenfeather.cn/</id>
  
  <author>
    <name>GarenRhine</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>分布式与高可用（4）——高可用、集群、补充</title>
    <link href="http://blog.garenfeather.cn/2018/04/06/distributed-storage-ha-clusters-4/"/>
    <id>http://blog.garenfeather.cn/2018/04/06/distributed-storage-ha-clusters-4/</id>
    <published>2018-04-06T06:30:02.000Z</published>
    <updated>2018-04-06T07:07:25.467Z</updated>
    
    <content type="html"><![CDATA[<hr><h1 id="高可用集群技术及补充相关"><a class="markdownIt-Anchor" href="#高可用集群技术及补充相关"></a> 高可用集群技术及补充相关</h1><h2 id="bloom-filter"><a class="markdownIt-Anchor" href="#bloom-filter"></a> Bloom Filter</h2><p>用途：一个元素是否在一个集合中</p><h3 id="常规数据结构"><a class="markdownIt-Anchor" href="#常规数据结构"></a> 常规数据结构</h3><ul><li><p>数组：增删</p></li><li><p>链表（局部升级：跳表）：随机访问，顺序，查找</p></li><li><p>哈希表：哈希冲突，利用率低</p></li><li><p>Map（基于红黑树）：数据结构复杂</p></li><li><p>树（B/B+树，平衡二叉树，Trie）</p><p>常规的数据结构组合似乎可以解决大部分查找问题。首先<strong>核心需求</strong>是判断存在，如果<strong>只有</strong>查找需求，则<strong>不一定需要存储</strong>（或者说<strong>不需要直接接触</strong>数据集合层）</p></li></ul><a id="more"></a><h3 id="基础概念"><a class="markdownIt-Anchor" href="#基础概念"></a> 基础概念</h3><ul><li><p>一个很长的二进制位数组</p></li><li><p>一系列哈希函数</p></li><li><p>空间效率和查询效率高</p></li><li><p>查询<strong>结果为正</strong>时有一定的<strong>误判率</strong></p></li></ul><h3 id="原理"><a class="markdownIt-Anchor" href="#原理"></a> 原理</h3><ul><li><p>初始化位数组所有位全为0，集合中每个元素分别经过k个哈希函数计算，得到所有数组编号位的值都置1。</p></li><li><p>查找时，查找对象经过k个哈希函数计算得到编号，只要有一个编号位置值为0，说明对象<strong>一定</strong>不在集合中</p></li><li><p>错判：例如k=3，对象A编号为1/2/3，对象B为3/4/5，查找对象编号为3/4/5的情况</p></li></ul><h3 id="延伸思考"><a class="markdownIt-Anchor" href="#延伸思考"></a> 延伸思考</h3><ul><li><p>减少了<strong>单一表现不良</strong>的哈希函数带来的伤害（单纯的哈希在函数结果相同时会<strong>退化成顺序搜索</strong>）</p></li><li><p>选取的哈希函数之间结果域应当尽量分散，即增加判断点</p></li></ul><hr><h2 id="隧道协议"><a class="markdownIt-Anchor" href="#隧道协议"></a> 隧道协议</h2><ul><li>隧道：源主机和目标主机所在网络类型相同，但是中间却隔着类型不同的网络</li><li>利用隧道优势的VPN就是一个提供简单安全措施的简单覆盖（overlay）网络</li></ul><div class="mermaid"><svg id="mermaid-svg-aad0f51c436d1c69" xmlns="http://www.w3.org/2000/svg" height="100%" viewbox="0 0 514 96" style="max-width:514px;"><style>  .mermaid .label{font-family:trebuchet ms,verdana,arial;color:#333}.node circle,.node ellipse,.node polygon,.node rect{fill:#cde498;stroke:#13540c;stroke-width:1px}.node.clickable{cursor:pointer}.arrowheadPath{fill:green}.edgePath .path{stroke:green;stroke-width:1.5px}.edgeLabel{background-color:#e8e8e8}.cluster rect{fill:#cdffb2!important;rx:4!important;stroke:#6eaa49!important;stroke-width:1px!important}.cluster text{fill:#333}.actor{stroke:#13540c;fill:#cde498}text.actor{fill:#000;stroke:none}.actor-line{stroke:grey}.messageLine0{marker-end:"url(#arrowhead)"}.messageLine0,.messageLine1{stroke-width:1.5;stroke-dasharray:"2 2";stroke:#333}#arrowhead{fill:#333}#crosshead path{fill:#333!important;stroke:#333!important}.messageText{fill:#333;stroke:none}.labelBox{stroke:#326932;fill:#cde498}.labelText,.loopText{fill:#000;stroke:none}.loopLine{stroke-width:2;stroke-dasharray:"2 2";marker-end:"url(#arrowhead)";stroke:#326932}.note{stroke:#6eaa49;fill:#fff5ad}.noteText{fill:#000;stroke:none;font-family:trebuchet ms,verdana,arial;font-size:14px}.section{stroke:none;opacity:.2}.section0,.section2{fill:#6eaa49}.section1,.section3{fill:#fff;opacity:.2}.sectionTitle0,.sectionTitle1,.sectionTitle2,.sectionTitle3{fill:#333}.sectionTitle{text-anchor:start;font-size:11px;text-height:14px}.grid .tick{stroke:#d3d3d3;opacity:.3;shape-rendering:crispEdges}.grid path{stroke-width:0}.today{fill:none;stroke:red;stroke-width:2px}.task{stroke-width:2}.taskText{text-anchor:middle;font-size:11px}.taskTextOutsideRight{fill:#000;text-anchor:start;font-size:11px}.taskTextOutsideLeft{fill:#000;text-anchor:end;font-size:11px}.taskText0,.taskText1,.taskText2,.taskText3{fill:#fff}.task0,.task1,.task2,.task3{fill:#487e3a;stroke:#13540c}.taskTextOutside0,.taskTextOutside1,.taskTextOutside2,.taskTextOutside3{fill:#000}.active0,.active1,.active2,.active3{fill:#cde498;stroke:#13540c}.activeText0,.activeText1,.activeText2,.activeText3{fill:#000!important}.done0,.done1,.done2,.done3{stroke:grey;fill:#d3d3d3;stroke-width:2}.doneText0,.doneText1,.doneText2,.doneText3{fill:#000!important}.crit0,.crit1,.crit2,.crit3{stroke:#f88;fill:red;stroke-width:2}.activeCrit0,.activeCrit1,.activeCrit2,.activeCrit3{stroke:#f88;fill:#cde498;stroke-width:2}.doneCrit0,.doneCrit1,.doneCrit2,.doneCrit3{stroke:#f88;fill:#d3d3d3;stroke-width:2;cursor:pointer;shape-rendering:crispEdges}.activeCritText0,.activeCritText1,.activeCritText2,.activeCritText3,.doneCritText0,.doneCritText1,.doneCritText2,.doneCritText3{fill:#000!important}.titleText{text-anchor:middle;font-size:18px;fill:#000}g.classGroup text{fill:#13540c;stroke:none;font-family:trebuchet ms,verdana,arial;font-size:10px}g.classGroup rect{fill:#cde498;stroke:#13540c}g.classGroup line{stroke:#13540c;stroke-width:1}svg .classLabel .box{stroke:none;stroke-width:0;fill:#cde498;opacity:.5}svg .classLabel .label{fill:#13540c;font-size:10px}.relation{stroke:#13540c;stroke-width:1;fill:none}#compositionEnd,#compositionStart,.composition{fill:#13540c;stroke:#13540c;stroke-width:1}#aggregationEnd,#aggregationStart,.aggregation{fill:#cde498;stroke:#13540c;stroke-width:1}#dependencyEnd,#dependencyStart,#extensionEnd,#extensionStart{fill:#13540c;stroke:#13540c;stroke-width:1}.node text{font-size:14px}.node text,div.mermaidTooltip{font-family:trebuchet ms,verdana,arial}div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-size:12px;background:#cdffb2;border:1px solid #6eaa49;border-radius:2px;pointer-events:none;z-index:100}svg {  color: rgb(0, 0, 0);  font: normal normal 400 normal 16px / normal "Times New Roman";}  </style><g><g class="output"><g class="clusters"/><g class="edgePaths"><g class="edgePath" style="opacity: 1;"><path class="path" d="M88,38L129,38L170,38" marker-end="url(#arrowhead20)" style="fill:none"/><defs><marker id="arrowhead20" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M198,38L239,38L280,38" marker-end="url(#arrowhead21)" style="fill:none"/><defs><marker id="arrowhead21" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M308,38L349,38L390,38" marker-end="url(#arrowhead22)" style="fill:none"/><defs><marker id="arrowhead22" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g></g><g class="edgeLabels"><g class="edgeLabel" transform="translate(129,38)" style="opacity: 1;"><g transform="translate(-16,-8)" class="label"><foreignobject width="32" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">IPV6</span></div></foreignobject></g></g><g class="edgeLabel" transform="translate(239,38)" style="opacity: 1;"><g transform="translate(-16,-8)" class="label"><foreignobject width="32" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">IPV4</span></div></foreignobject></g></g><g class="edgeLabel" transform="translate(349,38)" style="opacity: 1;"><g transform="translate(-16,-8)" class="label"><foreignobject width="32" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">IPV6</span></div></foreignobject></g></g></g><g class="nodes"><g class="node" id="A" transform="translate(54,38)" style="opacity: 1;"><rect rx="5" ry="5" x="-34" y="-18" width="68" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-24,-8)"><foreignobject width="48" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">源主机</div></foreignobject></g></g></g><g class="node" id="B" transform="translate(184,38)" style="opacity: 1;"><rect rx="0" ry="0" x="-14" y="-18" width="28" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-4,-8)"><foreignobject width="8" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">B</div></foreignobject></g></g></g><g class="node" id="C" transform="translate(294,38)" style="opacity: 1;"><rect rx="0" ry="0" x="-14" y="-18" width="28" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-4,-8)"><foreignobject width="8" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">C</div></foreignobject></g></g></g><g class="node" id="D" transform="translate(432,38)" style="opacity: 1;"><rect rx="5" ry="5" x="-42" y="-18" width="84" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-32,-8)"><foreignobject width="64" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">目标主机</div></foreignobject></g></g></g></g></g></g></svg></div><ul><li>隧道协议将其他协议的数据帧或包<strong>重新封装</strong>然后通过隧道发送。<strong>新的帧头提供路由信息</strong>，以便通过网络传递被封装的负载数据</li></ul><h3 id="ip隧道技术"><a class="markdownIt-Anchor" href="#ip隧道技术"></a> IP隧道技术</h3><ul><li><p>用IP协议包裹IP协议</p></li><li><p>original</p></li></ul><div class="mermaid"><svg id="mermaid-svg-3f5b24551ef845fc" xmlns="http://www.w3.org/2000/svg" height="100%" viewbox="0 0 302 96" style="max-width:302px;"><style>  .mermaid .label{font-family:trebuchet ms,verdana,arial;color:#333}.node circle,.node ellipse,.node polygon,.node rect{fill:#cde498;stroke:#13540c;stroke-width:1px}.node.clickable{cursor:pointer}.arrowheadPath{fill:green}.edgePath .path{stroke:green;stroke-width:1.5px}.edgeLabel{background-color:#e8e8e8}.cluster rect{fill:#cdffb2!important;rx:4!important;stroke:#6eaa49!important;stroke-width:1px!important}.cluster text{fill:#333}.actor{stroke:#13540c;fill:#cde498}text.actor{fill:#000;stroke:none}.actor-line{stroke:grey}.messageLine0{marker-end:"url(#arrowhead)"}.messageLine0,.messageLine1{stroke-width:1.5;stroke-dasharray:"2 2";stroke:#333}#arrowhead{fill:#333}#crosshead path{fill:#333!important;stroke:#333!important}.messageText{fill:#333;stroke:none}.labelBox{stroke:#326932;fill:#cde498}.labelText,.loopText{fill:#000;stroke:none}.loopLine{stroke-width:2;stroke-dasharray:"2 2";marker-end:"url(#arrowhead)";stroke:#326932}.note{stroke:#6eaa49;fill:#fff5ad}.noteText{fill:#000;stroke:none;font-family:trebuchet ms,verdana,arial;font-size:14px}.section{stroke:none;opacity:.2}.section0,.section2{fill:#6eaa49}.section1,.section3{fill:#fff;opacity:.2}.sectionTitle0,.sectionTitle1,.sectionTitle2,.sectionTitle3{fill:#333}.sectionTitle{text-anchor:start;font-size:11px;text-height:14px}.grid .tick{stroke:#d3d3d3;opacity:.3;shape-rendering:crispEdges}.grid path{stroke-width:0}.today{fill:none;stroke:red;stroke-width:2px}.task{stroke-width:2}.taskText{text-anchor:middle;font-size:11px}.taskTextOutsideRight{fill:#000;text-anchor:start;font-size:11px}.taskTextOutsideLeft{fill:#000;text-anchor:end;font-size:11px}.taskText0,.taskText1,.taskText2,.taskText3{fill:#fff}.task0,.task1,.task2,.task3{fill:#487e3a;stroke:#13540c}.taskTextOutside0,.taskTextOutside1,.taskTextOutside2,.taskTextOutside3{fill:#000}.active0,.active1,.active2,.active3{fill:#cde498;stroke:#13540c}.activeText0,.activeText1,.activeText2,.activeText3{fill:#000!important}.done0,.done1,.done2,.done3{stroke:grey;fill:#d3d3d3;stroke-width:2}.doneText0,.doneText1,.doneText2,.doneText3{fill:#000!important}.crit0,.crit1,.crit2,.crit3{stroke:#f88;fill:red;stroke-width:2}.activeCrit0,.activeCrit1,.activeCrit2,.activeCrit3{stroke:#f88;fill:#cde498;stroke-width:2}.doneCrit0,.doneCrit1,.doneCrit2,.doneCrit3{stroke:#f88;fill:#d3d3d3;stroke-width:2;cursor:pointer;shape-rendering:crispEdges}.activeCritText0,.activeCritText1,.activeCritText2,.activeCritText3,.doneCritText0,.doneCritText1,.doneCritText2,.doneCritText3{fill:#000!important}.titleText{text-anchor:middle;font-size:18px;fill:#000}g.classGroup text{fill:#13540c;stroke:none;font-family:trebuchet ms,verdana,arial;font-size:10px}g.classGroup rect{fill:#cde498;stroke:#13540c}g.classGroup line{stroke:#13540c;stroke-width:1}svg .classLabel .box{stroke:none;stroke-width:0;fill:#cde498;opacity:.5}svg .classLabel .label{fill:#13540c;font-size:10px}.relation{stroke:#13540c;stroke-width:1;fill:none}#compositionEnd,#compositionStart,.composition{fill:#13540c;stroke:#13540c;stroke-width:1}#aggregationEnd,#aggregationStart,.aggregation{fill:#cde498;stroke:#13540c;stroke-width:1}#dependencyEnd,#dependencyStart,#extensionEnd,#extensionStart{fill:#13540c;stroke:#13540c;stroke-width:1}.node text{font-size:14px}.node text,div.mermaidTooltip{font-family:trebuchet ms,verdana,arial}div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-size:12px;background:#cdffb2;border:1px solid #6eaa49;border-radius:2px;pointer-events:none;z-index:100}svg {  color: rgb(0, 0, 0);  font: normal normal 400 normal 16px / normal "Times New Roman";}  </style><g><g class="output"><g class="clusters"/><g class="edgePaths"/><g class="edgeLabels"/><g class="nodes"><g class="node" id="A" transform="translate(66,38)" style="opacity: 1;"><rect rx="5" ry="5" x="-46" y="-18" width="92" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-36,-8)"><foreignobject width="72" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">IP header</div></foreignobject></g></g></g><g class="node" id="B" transform="translate(212,38)" style="opacity: 1;"><rect rx="5" ry="5" x="-50" y="-18" width="100" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-40,-8)"><foreignobject width="80" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">IP payload</div></foreignobject></g></g></g></g></g></g></svg></div><ul><li>pack</li></ul><div class="mermaid"><svg id="mermaid-svg-d4740178dbdb5fb8" xmlns="http://www.w3.org/2000/svg" height="100%" viewbox="0 0 722 96" style="max-width:722px;"><style>  .mermaid .label{font-family:trebuchet ms,verdana,arial;color:#333}.node circle,.node ellipse,.node polygon,.node rect{fill:#cde498;stroke:#13540c;stroke-width:1px}.node.clickable{cursor:pointer}.arrowheadPath{fill:green}.edgePath .path{stroke:green;stroke-width:1.5px}.edgeLabel{background-color:#e8e8e8}.cluster rect{fill:#cdffb2!important;rx:4!important;stroke:#6eaa49!important;stroke-width:1px!important}.cluster text{fill:#333}.actor{stroke:#13540c;fill:#cde498}text.actor{fill:#000;stroke:none}.actor-line{stroke:grey}.messageLine0{marker-end:"url(#arrowhead)"}.messageLine0,.messageLine1{stroke-width:1.5;stroke-dasharray:"2 2";stroke:#333}#arrowhead{fill:#333}#crosshead path{fill:#333!important;stroke:#333!important}.messageText{fill:#333;stroke:none}.labelBox{stroke:#326932;fill:#cde498}.labelText,.loopText{fill:#000;stroke:none}.loopLine{stroke-width:2;stroke-dasharray:"2 2";marker-end:"url(#arrowhead)";stroke:#326932}.note{stroke:#6eaa49;fill:#fff5ad}.noteText{fill:#000;stroke:none;font-family:trebuchet ms,verdana,arial;font-size:14px}.section{stroke:none;opacity:.2}.section0,.section2{fill:#6eaa49}.section1,.section3{fill:#fff;opacity:.2}.sectionTitle0,.sectionTitle1,.sectionTitle2,.sectionTitle3{fill:#333}.sectionTitle{text-anchor:start;font-size:11px;text-height:14px}.grid .tick{stroke:#d3d3d3;opacity:.3;shape-rendering:crispEdges}.grid path{stroke-width:0}.today{fill:none;stroke:red;stroke-width:2px}.task{stroke-width:2}.taskText{text-anchor:middle;font-size:11px}.taskTextOutsideRight{fill:#000;text-anchor:start;font-size:11px}.taskTextOutsideLeft{fill:#000;text-anchor:end;font-size:11px}.taskText0,.taskText1,.taskText2,.taskText3{fill:#fff}.task0,.task1,.task2,.task3{fill:#487e3a;stroke:#13540c}.taskTextOutside0,.taskTextOutside1,.taskTextOutside2,.taskTextOutside3{fill:#000}.active0,.active1,.active2,.active3{fill:#cde498;stroke:#13540c}.activeText0,.activeText1,.activeText2,.activeText3{fill:#000!important}.done0,.done1,.done2,.done3{stroke:grey;fill:#d3d3d3;stroke-width:2}.doneText0,.doneText1,.doneText2,.doneText3{fill:#000!important}.crit0,.crit1,.crit2,.crit3{stroke:#f88;fill:red;stroke-width:2}.activeCrit0,.activeCrit1,.activeCrit2,.activeCrit3{stroke:#f88;fill:#cde498;stroke-width:2}.doneCrit0,.doneCrit1,.doneCrit2,.doneCrit3{stroke:#f88;fill:#d3d3d3;stroke-width:2;cursor:pointer;shape-rendering:crispEdges}.activeCritText0,.activeCritText1,.activeCritText2,.activeCritText3,.doneCritText0,.doneCritText1,.doneCritText2,.doneCritText3{fill:#000!important}.titleText{text-anchor:middle;font-size:18px;fill:#000}g.classGroup text{fill:#13540c;stroke:none;font-family:trebuchet ms,verdana,arial;font-size:10px}g.classGroup rect{fill:#cde498;stroke:#13540c}g.classGroup line{stroke:#13540c;stroke-width:1}svg .classLabel .box{stroke:none;stroke-width:0;fill:#cde498;opacity:.5}svg .classLabel .label{fill:#13540c;font-size:10px}.relation{stroke:#13540c;stroke-width:1;fill:none}#compositionEnd,#compositionStart,.composition{fill:#13540c;stroke:#13540c;stroke-width:1}#aggregationEnd,#aggregationStart,.aggregation{fill:#cde498;stroke:#13540c;stroke-width:1}#dependencyEnd,#dependencyStart,#extensionEnd,#extensionStart{fill:#13540c;stroke:#13540c;stroke-width:1}.node text{font-size:14px}.node text,div.mermaidTooltip{font-family:trebuchet ms,verdana,arial}div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-size:12px;background:#cdffb2;border:1px solid #6eaa49;border-radius:2px;pointer-events:none;z-index:100}svg {  color: rgb(0, 0, 0);  font: normal normal 400 normal 16px / normal "Times New Roman";}  </style><g><g class="output"><g class="clusters"/><g class="edgePaths"/><g class="edgeLabels"/><g class="nodes"><g class="node" id="C" transform="translate(94,38)" style="opacity: 1;"><rect rx="5" ry="5" x="-74" y="-18" width="148" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-64,-8)"><foreignobject width="128" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">Outter IP header</div></foreignobject></g></g></g><g class="node" id="D" transform="translate(280,38)" style="opacity: 1;"><rect rx="5" ry="5" x="-62" y="-18" width="124" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-52,-8)"><foreignobject width="104" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">Tunnel header</div></foreignobject></g></g></g><g class="node" id="E" transform="translate(462,38)" style="opacity: 1;"><rect rx="5" ry="5" x="-70" y="-18" width="140" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-60,-8)"><foreignobject width="120" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">Inner IP header</div></foreignobject></g></g></g><g class="node" id="F" transform="translate(632,38)" style="opacity: 1;"><rect rx="5" ry="5" x="-50" y="-18" width="100" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-40,-8)"><foreignobject width="80" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">IP payload</div></foreignobject></g></g></g></g></g></g></svg></div><ul><li>TLS封装被移除</li><li>原始数据报文被隐藏了，常用于<strong>绕过简单的防火墙</strong></li></ul><hr><h2 id="负载均衡"><a class="markdownIt-Anchor" href="#负载均衡"></a> 负载均衡</h2><h3 id="负载均衡算法"><a class="markdownIt-Anchor" href="#负载均衡算法"></a> 负载均衡算法</h3><ul><li>（Weighted）Round-Robin：（加权）轮询负载均衡，服务请求会依次被转发到服务器池中的<strong>每一个</strong>服务器上，<strong>不评估</strong>当前<strong>负载</strong>或<strong>配置</strong>能力，加权则参考服务器权重</li><li>（Weighted）Least-Connection：（加权）最少连接，转发服务到连接次数较少的服务器上</li><li>Destination Hash Scheduling：目标地址哈希算法，在静态哈希表中查询<strong>目标地址</strong>来确定请求要转发的</li><li>Source Hash Scheduling：源地址哈希算法，在静态哈希表中查询<strong>源地址</strong>来确定请求要转发的</li><li>Shortest Expected Delay：最小延迟算法</li></ul><h3 id="在openstack高可用集群部署的示范"><a class="markdownIt-Anchor" href="#在openstack高可用集群部署的示范"></a> 在OpenStack高可用集群部署的示范</h3><ul><li><p>基于LVS实现的高伸缩，高可用服务：web，cache，dns，ftp，mail等</p></li><li><p>负载均衡实现方式</p><ul><li>基于<strong>DNS域名轮流解析</strong>方案</li><li>基于<strong>客户端调度访问</strong>方案</li><li>基于<strong>应用层系统负载</strong>的调度方案</li><li>基于<strong>IP地址</strong>的调度方案(执行效率最高：IP负载均衡技术)</li></ul></li><li><p>HAProxy</p><ul><li>实现<strong>基于TCP和HTTP协议</strong>的服务高可用</li><li>适合应用于需要会话保持或七层处理的高负载Web站点</li><li>事件驱动、单一进程的架构模型</li></ul></li><li><p>KeepAlived</p><ul><li><p>主要目标：简化LVS项目配置，增强稳定性</p></li><li><p>功能来源：IPVS(IP Virtual Server)</p></li><li><p>Linux Virtual Server</p><ul><li>为集群服务提供<strong>软件</strong>负载均衡</li><li>IP负载均衡技术</li><li>虚拟服务器的主要任务是监听VIP及相应端口上的请求</li></ul></li><li><p>负载均衡和基于虚拟路由冗余协议实现故障切换转移(Failover)</p></li><li><p>多数功能模块都位于<strong>用户空间</strong></p></li><li><p>一个与LVS Router有关的控制进程</p><ul><li>Active/Master</li><li>Passive/Master</li></ul></li><li><p>架构</p></li></ul></li></ul><div class="mermaid"><svg id="mermaid-svg-02328d8876fae9ac" xmlns="http://www.w3.org/2000/svg" height="100%" viewbox="0 0 358 182" style="max-width:358px;"><style>  .mermaid .label{font-family:trebuchet ms,verdana,arial;color:#333}.node circle,.node ellipse,.node polygon,.node rect{fill:#cde498;stroke:#13540c;stroke-width:1px}.node.clickable{cursor:pointer}.arrowheadPath{fill:green}.edgePath .path{stroke:green;stroke-width:1.5px}.edgeLabel{background-color:#e8e8e8}.cluster rect{fill:#cdffb2!important;rx:4!important;stroke:#6eaa49!important;stroke-width:1px!important}.cluster text{fill:#333}.actor{stroke:#13540c;fill:#cde498}text.actor{fill:#000;stroke:none}.actor-line{stroke:grey}.messageLine0{marker-end:"url(#arrowhead)"}.messageLine0,.messageLine1{stroke-width:1.5;stroke-dasharray:"2 2";stroke:#333}#arrowhead{fill:#333}#crosshead path{fill:#333!important;stroke:#333!important}.messageText{fill:#333;stroke:none}.labelBox{stroke:#326932;fill:#cde498}.labelText,.loopText{fill:#000;stroke:none}.loopLine{stroke-width:2;stroke-dasharray:"2 2";marker-end:"url(#arrowhead)";stroke:#326932}.note{stroke:#6eaa49;fill:#fff5ad}.noteText{fill:#000;stroke:none;font-family:trebuchet ms,verdana,arial;font-size:14px}.section{stroke:none;opacity:.2}.section0,.section2{fill:#6eaa49}.section1,.section3{fill:#fff;opacity:.2}.sectionTitle0,.sectionTitle1,.sectionTitle2,.sectionTitle3{fill:#333}.sectionTitle{text-anchor:start;font-size:11px;text-height:14px}.grid .tick{stroke:#d3d3d3;opacity:.3;shape-rendering:crispEdges}.grid path{stroke-width:0}.today{fill:none;stroke:red;stroke-width:2px}.task{stroke-width:2}.taskText{text-anchor:middle;font-size:11px}.taskTextOutsideRight{fill:#000;text-anchor:start;font-size:11px}.taskTextOutsideLeft{fill:#000;text-anchor:end;font-size:11px}.taskText0,.taskText1,.taskText2,.taskText3{fill:#fff}.task0,.task1,.task2,.task3{fill:#487e3a;stroke:#13540c}.taskTextOutside0,.taskTextOutside1,.taskTextOutside2,.taskTextOutside3{fill:#000}.active0,.active1,.active2,.active3{fill:#cde498;stroke:#13540c}.activeText0,.activeText1,.activeText2,.activeText3{fill:#000!important}.done0,.done1,.done2,.done3{stroke:grey;fill:#d3d3d3;stroke-width:2}.doneText0,.doneText1,.doneText2,.doneText3{fill:#000!important}.crit0,.crit1,.crit2,.crit3{stroke:#f88;fill:red;stroke-width:2}.activeCrit0,.activeCrit1,.activeCrit2,.activeCrit3{stroke:#f88;fill:#cde498;stroke-width:2}.doneCrit0,.doneCrit1,.doneCrit2,.doneCrit3{stroke:#f88;fill:#d3d3d3;stroke-width:2;cursor:pointer;shape-rendering:crispEdges}.activeCritText0,.activeCritText1,.activeCritText2,.activeCritText3,.doneCritText0,.doneCritText1,.doneCritText2,.doneCritText3{fill:#000!important}.titleText{text-anchor:middle;font-size:18px;fill:#000}g.classGroup text{fill:#13540c;stroke:none;font-family:trebuchet ms,verdana,arial;font-size:10px}g.classGroup rect{fill:#cde498;stroke:#13540c}g.classGroup line{stroke:#13540c;stroke-width:1}svg .classLabel .box{stroke:none;stroke-width:0;fill:#cde498;opacity:.5}svg .classLabel .label{fill:#13540c;font-size:10px}.relation{stroke:#13540c;stroke-width:1;fill:none}#compositionEnd,#compositionStart,.composition{fill:#13540c;stroke:#13540c;stroke-width:1}#aggregationEnd,#aggregationStart,.aggregation{fill:#cde498;stroke:#13540c;stroke-width:1}#dependencyEnd,#dependencyStart,#extensionEnd,#extensionStart{fill:#13540c;stroke:#13540c;stroke-width:1}.node text{font-size:14px}.node text,div.mermaidTooltip{font-family:trebuchet ms,verdana,arial}div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-size:12px;background:#cdffb2;border:1px solid #6eaa49;border-radius:2px;pointer-events:none;z-index:100}svg {  color: rgb(0, 0, 0);  font: normal normal 400 normal 16px / normal "Times New Roman";}  </style><g><g class="output"><g class="clusters"/><g class="edgePaths"><g class="edgePath" style="opacity: 1;"><path class="path" d="M76.18604651162791,106L82,81L82,56" marker-end="url(#arrowhead12)" style="fill:none"/><defs><marker id="arrowhead12" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M73.62790697674419,56L62,81L67.81395348837209,106" marker-end="url(#arrowhead13)" style="fill:none"/><defs><marker id="arrowhead13" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M111.72093023255815,56L153,81L188.46511627906978,106" marker-end="url(#arrowhead14)" style="fill:none"/><defs><marker id="arrowhead14" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M218.18604651162792,106L224,81L141.4418604651163,56" marker-end="url(#arrowhead15)" style="fill:none"/><defs><marker id="arrowhead15" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g></g><g class="edgeLabels"><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"/></div></foreignobject></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"/></div></foreignobject></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"/></div></foreignobject></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"/></div></foreignobject></g></g></g><g class="nodes"><g class="node" id="AR" transform="translate(82,38)" style="opacity: 1;"><rect rx="5" ry="5" x="-62" y="-18" width="124" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-52,-8)"><foreignobject width="104" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">Active Record</div></foreignobject></g></g></g><g class="node" id="BR" transform="translate(256,38)" style="opacity: 1;"><rect rx="5" ry="5" x="-62" y="-18" width="124" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-52,-8)"><foreignobject width="104" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">Backup Record</div></foreignobject></g></g></g><g class="node" id="A" transform="translate(72,124)" style="opacity: 1;"><rect rx="5" ry="5" x="-42" y="-18" width="84" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-32,-8)"><foreignobject width="64" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">Internet</div></foreignobject></g></g></g><g class="node" id="RealServer" transform="translate(214,124)" style="opacity: 1;"><rect rx="0" ry="0" x="-50" y="-18" width="100" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-40,-8)"><foreignobject width="80" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">RealServer</div></foreignobject></g></g></g></g></g></g></svg></div><ul><li>IPVS实现负载均衡<ul><li>本质：解决单IP，多服务器问题</li><li>数据路由转发方式实现<ul><li>NAT：<strong>网络地址转换</strong>，调度器处理能力成为性能瓶颈</li><li>TUN：IP隧道技术</li><li>DR(Direct Routing)技术：改写请求报文的<strong>MAC地址</strong>，没有隧道开销，没有转发压力，<strong>综合性能最高</strong></li></ul></li><li>核心技术</li></ul></li></ul><div class="mermaid"><svg id="mermaid-svg-583f59bd0b33ec57" xmlns="http://www.w3.org/2000/svg" height="100%" viewbox="0 0 470 112" style="max-width:470px;"><style>  .mermaid .label{font-family:trebuchet ms,verdana,arial;color:#333}.node circle,.node ellipse,.node polygon,.node rect{fill:#cde498;stroke:#13540c;stroke-width:1px}.node.clickable{cursor:pointer}.arrowheadPath{fill:green}.edgePath .path{stroke:green;stroke-width:1.5px}.edgeLabel{background-color:#e8e8e8}.cluster rect{fill:#cdffb2!important;rx:4!important;stroke:#6eaa49!important;stroke-width:1px!important}.cluster text{fill:#333}.actor{stroke:#13540c;fill:#cde498}text.actor{fill:#000;stroke:none}.actor-line{stroke:grey}.messageLine0{marker-end:"url(#arrowhead)"}.messageLine0,.messageLine1{stroke-width:1.5;stroke-dasharray:"2 2";stroke:#333}#arrowhead{fill:#333}#crosshead path{fill:#333!important;stroke:#333!important}.messageText{fill:#333;stroke:none}.labelBox{stroke:#326932;fill:#cde498}.labelText,.loopText{fill:#000;stroke:none}.loopLine{stroke-width:2;stroke-dasharray:"2 2";marker-end:"url(#arrowhead)";stroke:#326932}.note{stroke:#6eaa49;fill:#fff5ad}.noteText{fill:#000;stroke:none;font-family:trebuchet ms,verdana,arial;font-size:14px}.section{stroke:none;opacity:.2}.section0,.section2{fill:#6eaa49}.section1,.section3{fill:#fff;opacity:.2}.sectionTitle0,.sectionTitle1,.sectionTitle2,.sectionTitle3{fill:#333}.sectionTitle{text-anchor:start;font-size:11px;text-height:14px}.grid .tick{stroke:#d3d3d3;opacity:.3;shape-rendering:crispEdges}.grid path{stroke-width:0}.today{fill:none;stroke:red;stroke-width:2px}.task{stroke-width:2}.taskText{text-anchor:middle;font-size:11px}.taskTextOutsideRight{fill:#000;text-anchor:start;font-size:11px}.taskTextOutsideLeft{fill:#000;text-anchor:end;font-size:11px}.taskText0,.taskText1,.taskText2,.taskText3{fill:#fff}.task0,.task1,.task2,.task3{fill:#487e3a;stroke:#13540c}.taskTextOutside0,.taskTextOutside1,.taskTextOutside2,.taskTextOutside3{fill:#000}.active0,.active1,.active2,.active3{fill:#cde498;stroke:#13540c}.activeText0,.activeText1,.activeText2,.activeText3{fill:#000!important}.done0,.done1,.done2,.done3{stroke:grey;fill:#d3d3d3;stroke-width:2}.doneText0,.doneText1,.doneText2,.doneText3{fill:#000!important}.crit0,.crit1,.crit2,.crit3{stroke:#f88;fill:red;stroke-width:2}.activeCrit0,.activeCrit1,.activeCrit2,.activeCrit3{stroke:#f88;fill:#cde498;stroke-width:2}.doneCrit0,.doneCrit1,.doneCrit2,.doneCrit3{stroke:#f88;fill:#d3d3d3;stroke-width:2;cursor:pointer;shape-rendering:crispEdges}.activeCritText0,.activeCritText1,.activeCritText2,.activeCritText3,.doneCritText0,.doneCritText1,.doneCritText2,.doneCritText3{fill:#000!important}.titleText{text-anchor:middle;font-size:18px;fill:#000}g.classGroup text{fill:#13540c;stroke:none;font-family:trebuchet ms,verdana,arial;font-size:10px}g.classGroup rect{fill:#cde498;stroke:#13540c}g.classGroup line{stroke:#13540c;stroke-width:1}svg .classLabel .box{stroke:none;stroke-width:0;fill:#cde498;opacity:.5}svg .classLabel .label{fill:#13540c;font-size:10px}.relation{stroke:#13540c;stroke-width:1;fill:none}#compositionEnd,#compositionStart,.composition{fill:#13540c;stroke:#13540c;stroke-width:1}#aggregationEnd,#aggregationStart,.aggregation{fill:#cde498;stroke:#13540c;stroke-width:1}#dependencyEnd,#dependencyStart,#extensionEnd,#extensionStart{fill:#13540c;stroke:#13540c;stroke-width:1}.node text{font-size:14px}.node text,div.mermaidTooltip{font-family:trebuchet ms,verdana,arial}div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-size:12px;background:#cdffb2;border:1px solid #6eaa49;border-radius:2px;pointer-events:none;z-index:100}svg {  color: rgb(0, 0, 0);  font: normal normal 400 normal 16px / normal "Times New Roman";}  </style><g><g class="output"><g class="clusters"/><g class="edgePaths"><g class="edgePath" style="opacity: 1;"><path class="path" d="M144,37.733333333333334L217,28L290,37.18881118881119" marker-end="url(#arrowhead11)" style="fill:none"/><defs><marker id="arrowhead11" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M290,54.81118881118881L217,64L144,54.266666666666666" marker-end="url(#arrowhead12)" style="fill:none"/><defs><marker id="arrowhead12" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g></g><g class="edgeLabels"><g class="edgeLabel" transform="translate(217,28)" style="opacity: 1;"><g transform="translate(-48,-8)" class="label"><foreignobject width="96" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">用户请求转发</span></div></foreignobject></g></g><g class="edgeLabel" transform="translate(217,64)" style="opacity: 1;"><g transform="translate(-32,-8)" class="label"><foreignobject width="64" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">数据返回</span></div></foreignobject></g></g></g><g class="nodes"><g class="node" id="A" transform="translate(82,46)" style="opacity: 1;"><rect rx="5" ry="5" x="-62" y="-18" width="124" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-52,-8)"><foreignobject width="104" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">Direct Server</div></foreignobject></g></g></g><g class="node" id="B" transform="translate(360,46)" style="opacity: 1;"><rect rx="5" ry="5" x="-70" y="-18" width="140" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-60,-8)"><foreignobject width="120" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">Real Server节点</div></foreignobject></g></g></g></g></g></g></svg></div><ul><li>VRRP<ul><li>目的：解决局域网中<strong>配置静态网关</strong>出现<strong>单点失效</strong>现象的路由协议</li><li>本质：主备，多组主备路由虚拟为一个路由，屏蔽切换细节</li><li>所有运行在LVS Router下</li></ul></li></ul><hr><h2 id="openstack消息队列技术"><a class="markdownIt-Anchor" href="#openstack消息队列技术"></a> OpenStack消息队列技术</h2><h3 id="高级消息队列协议"><a class="markdownIt-Anchor" href="#高级消息队列协议"></a> 高级消息队列协议</h3><ul><li>AMPQ（Advanced Message Protocol Queue）</li><li>OpenStack是由多个开源组件构成的云计算项目，各组件间通过<code>REST接口</code>通信和调用，而组件间的<code>REST接口</code>调用是建立在<code>AMQP</code>上的RPC通信</li><li>一种<strong>应用层</strong>的<strong>二进制协议</strong>开放标准</li></ul><h4 id="三层划分"><a class="markdownIt-Anchor" href="#三层划分"></a> 三层划分</h4><ul><li>像OSI分层一样，任意一层可独立替换实现不影响与其他层的交互</li><li>Model：决定了<strong>基本域模型</strong>，行为被称为Command</li><li>Session：为模型层的Command提供可靠的传输保障（Peer到Peer）</li><li>Transport：二进制流传输保障</li></ul><h3 id="结构与概念"><a class="markdownIt-Anchor" href="#结构与概念"></a> 结构与概念</h3><ul><li>AMQP Broker：服务器端域模型</li><li>Virtual-Host：虚拟主机，由一组交换机、绑定和队列构成</li></ul><h3 id="具体实现rabbitmq"><a class="markdownIt-Anchor" href="#具体实现rabbitmq"></a> 具体实现RabbitMQ</h3><h4 id="相关结构"><a class="markdownIt-Anchor" href="#相关结构"></a> 相关结构</h4><ul><li>Connection/Channel：同一客户端可有多个Channel(多个连接)</li><li>Queue：一个队列可以有多个Binding，多个队列可以有同一个Binding</li><li>Message/Acknowledgement：Message由Payload和Label组成</li><li>Exchange</li><li>RoutingKey(随消息)/BindingKey(Exchange中)：在绑定多个Queue到同一个Exchange的时候，这些Binding操作允许使用相同的BindingKey。并非所有Binding操作都需要使用BindingKey</li></ul><div class="mermaid"><svg id="mermaid-svg-e17d466a75bd81b8" xmlns="http://www.w3.org/2000/svg" height="100%" viewbox="0 0 310 96" style="max-width:310px;"><style>  .mermaid .label{font-family:trebuchet ms,verdana,arial;color:#333}.node circle,.node ellipse,.node polygon,.node rect{fill:#cde498;stroke:#13540c;stroke-width:1px}.node.clickable{cursor:pointer}.arrowheadPath{fill:green}.edgePath .path{stroke:green;stroke-width:1.5px}.edgeLabel{background-color:#e8e8e8}.cluster rect{fill:#cdffb2!important;rx:4!important;stroke:#6eaa49!important;stroke-width:1px!important}.cluster text{fill:#333}.actor{stroke:#13540c;fill:#cde498}text.actor{fill:#000;stroke:none}.actor-line{stroke:grey}.messageLine0{marker-end:"url(#arrowhead)"}.messageLine0,.messageLine1{stroke-width:1.5;stroke-dasharray:"2 2";stroke:#333}#arrowhead{fill:#333}#crosshead path{fill:#333!important;stroke:#333!important}.messageText{fill:#333;stroke:none}.labelBox{stroke:#326932;fill:#cde498}.labelText,.loopText{fill:#000;stroke:none}.loopLine{stroke-width:2;stroke-dasharray:"2 2";marker-end:"url(#arrowhead)";stroke:#326932}.note{stroke:#6eaa49;fill:#fff5ad}.noteText{fill:#000;stroke:none;font-family:trebuchet ms,verdana,arial;font-size:14px}.section{stroke:none;opacity:.2}.section0,.section2{fill:#6eaa49}.section1,.section3{fill:#fff;opacity:.2}.sectionTitle0,.sectionTitle1,.sectionTitle2,.sectionTitle3{fill:#333}.sectionTitle{text-anchor:start;font-size:11px;text-height:14px}.grid .tick{stroke:#d3d3d3;opacity:.3;shape-rendering:crispEdges}.grid path{stroke-width:0}.today{fill:none;stroke:red;stroke-width:2px}.task{stroke-width:2}.taskText{text-anchor:middle;font-size:11px}.taskTextOutsideRight{fill:#000;text-anchor:start;font-size:11px}.taskTextOutsideLeft{fill:#000;text-anchor:end;font-size:11px}.taskText0,.taskText1,.taskText2,.taskText3{fill:#fff}.task0,.task1,.task2,.task3{fill:#487e3a;stroke:#13540c}.taskTextOutside0,.taskTextOutside1,.taskTextOutside2,.taskTextOutside3{fill:#000}.active0,.active1,.active2,.active3{fill:#cde498;stroke:#13540c}.activeText0,.activeText1,.activeText2,.activeText3{fill:#000!important}.done0,.done1,.done2,.done3{stroke:grey;fill:#d3d3d3;stroke-width:2}.doneText0,.doneText1,.doneText2,.doneText3{fill:#000!important}.crit0,.crit1,.crit2,.crit3{stroke:#f88;fill:red;stroke-width:2}.activeCrit0,.activeCrit1,.activeCrit2,.activeCrit3{stroke:#f88;fill:#cde498;stroke-width:2}.doneCrit0,.doneCrit1,.doneCrit2,.doneCrit3{stroke:#f88;fill:#d3d3d3;stroke-width:2;cursor:pointer;shape-rendering:crispEdges}.activeCritText0,.activeCritText1,.activeCritText2,.activeCritText3,.doneCritText0,.doneCritText1,.doneCritText2,.doneCritText3{fill:#000!important}.titleText{text-anchor:middle;font-size:18px;fill:#000}g.classGroup text{fill:#13540c;stroke:none;font-family:trebuchet ms,verdana,arial;font-size:10px}g.classGroup rect{fill:#cde498;stroke:#13540c}g.classGroup line{stroke:#13540c;stroke-width:1}svg .classLabel .box{stroke:none;stroke-width:0;fill:#cde498;opacity:.5}svg .classLabel .label{fill:#13540c;font-size:10px}.relation{stroke:#13540c;stroke-width:1;fill:none}#compositionEnd,#compositionStart,.composition{fill:#13540c;stroke:#13540c;stroke-width:1}#aggregationEnd,#aggregationStart,.aggregation{fill:#cde498;stroke:#13540c;stroke-width:1}#dependencyEnd,#dependencyStart,#extensionEnd,#extensionStart{fill:#13540c;stroke:#13540c;stroke-width:1}.node text{font-size:14px}.node text,div.mermaidTooltip{font-family:trebuchet ms,verdana,arial}div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-size:12px;background:#cdffb2;border:1px solid #6eaa49;border-radius:2px;pointer-events:none;z-index:100}svg {  color: rgb(0, 0, 0);  font: normal normal 400 normal 16px / normal "Times New Roman";}  </style><g><g class="output"><g class="clusters"/><g class="edgePaths"><g class="edgePath" style="opacity: 1;"><path class="path" d="M104,38L157,38L210,38" marker-end="url(#arrowhead8)" style="fill:none"/><defs><marker id="arrowhead8" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g></g><g class="edgeLabels"><g class="edgeLabel" transform="translate(157,38)" style="opacity: 1;"><g transform="translate(-28,-8)" class="label"><foreignobject width="56" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">Binding</span></div></foreignobject></g></g></g><g class="nodes"><g class="node" id="A" transform="translate(62,38)" style="opacity: 1;"><rect rx="5" ry="5" x="-42" y="-18" width="84" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-32,-8)"><foreignobject width="64" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">Exchange</div></foreignobject></g></g></g><g class="node" id="B" transform="translate(240,38)" style="opacity: 1;"><rect rx="5" ry="5" x="-30" y="-18" width="60" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-20,-8)"><foreignobject width="40" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">Queue</div></foreignobject></g></g></g></g></g></g></svg></div><ul><li>ExchangeType<ul><li>Fanout：生产者与队列<strong>一对多</strong>的关系，发送到Exchange的所有绑定中</li><li>Direct：完全匹配RoutingKey的指定BindingKey中，一对一</li><li>Topic：RoutingKey与BindingKey匹配，规则更灵活，两者都多字段(如：A.Rabbit.Dog)，模糊匹配(单个*或N个#)</li><li>Headers：与两种Key无关，提取消息Headers值(键值对)，与Exchange绑定Queue时预设的对比，一致则发过去，少用</li></ul></li></ul><h4 id="关键操作"><a class="markdownIt-Anchor" href="#关键操作"></a> 关键操作</h4><ul><li>Message Durability</li><li>Prefetch Count</li><li>ReplyTo/CorrelationId：消息由生产者设置，消费者消费完后根据值返回给生产者端，由生产者确认是否成功消费</li><li>RabbitMQ Sever = Broker Server</li><li>功能结构构成<ul><li>发送消息：Producer、Exchange</li><li>Broker Server：Exchange、Queue</li><li>接受消息：Queue、Consumer Client</li></ul></li></ul><div class="mermaid"><svg id="mermaid-svg-cbfd9d12cd2f69d8" xmlns="http://www.w3.org/2000/svg" height="100%" viewbox="0 0 504 163" style="max-width:504px;"><style>  .mermaid .label{font-family:trebuchet ms,verdana,arial;color:#333}.node circle,.node ellipse,.node polygon,.node rect{fill:#cde498;stroke:#13540c;stroke-width:1px}.node.clickable{cursor:pointer}.arrowheadPath{fill:green}.edgePath .path{stroke:green;stroke-width:1.5px}.edgeLabel{background-color:#e8e8e8}.cluster rect{fill:#cdffb2!important;rx:4!important;stroke:#6eaa49!important;stroke-width:1px!important}.cluster text{fill:#333}.actor{stroke:#13540c;fill:#cde498}text.actor{fill:#000;stroke:none}.actor-line{stroke:grey}.messageLine0{marker-end:"url(#arrowhead)"}.messageLine0,.messageLine1{stroke-width:1.5;stroke-dasharray:"2 2";stroke:#333}#arrowhead{fill:#333}#crosshead path{fill:#333!important;stroke:#333!important}.messageText{fill:#333;stroke:none}.labelBox{stroke:#326932;fill:#cde498}.labelText,.loopText{fill:#000;stroke:none}.loopLine{stroke-width:2;stroke-dasharray:"2 2";marker-end:"url(#arrowhead)";stroke:#326932}.note{stroke:#6eaa49;fill:#fff5ad}.noteText{fill:#000;stroke:none;font-family:trebuchet ms,verdana,arial;font-size:14px}.section{stroke:none;opacity:.2}.section0,.section2{fill:#6eaa49}.section1,.section3{fill:#fff;opacity:.2}.sectionTitle0,.sectionTitle1,.sectionTitle2,.sectionTitle3{fill:#333}.sectionTitle{text-anchor:start;font-size:11px;text-height:14px}.grid .tick{stroke:#d3d3d3;opacity:.3;shape-rendering:crispEdges}.grid path{stroke-width:0}.today{fill:none;stroke:red;stroke-width:2px}.task{stroke-width:2}.taskText{text-anchor:middle;font-size:11px}.taskTextOutsideRight{fill:#000;text-anchor:start;font-size:11px}.taskTextOutsideLeft{fill:#000;text-anchor:end;font-size:11px}.taskText0,.taskText1,.taskText2,.taskText3{fill:#fff}.task0,.task1,.task2,.task3{fill:#487e3a;stroke:#13540c}.taskTextOutside0,.taskTextOutside1,.taskTextOutside2,.taskTextOutside3{fill:#000}.active0,.active1,.active2,.active3{fill:#cde498;stroke:#13540c}.activeText0,.activeText1,.activeText2,.activeText3{fill:#000!important}.done0,.done1,.done2,.done3{stroke:grey;fill:#d3d3d3;stroke-width:2}.doneText0,.doneText1,.doneText2,.doneText3{fill:#000!important}.crit0,.crit1,.crit2,.crit3{stroke:#f88;fill:red;stroke-width:2}.activeCrit0,.activeCrit1,.activeCrit2,.activeCrit3{stroke:#f88;fill:#cde498;stroke-width:2}.doneCrit0,.doneCrit1,.doneCrit2,.doneCrit3{stroke:#f88;fill:#d3d3d3;stroke-width:2;cursor:pointer;shape-rendering:crispEdges}.activeCritText0,.activeCritText1,.activeCritText2,.activeCritText3,.doneCritText0,.doneCritText1,.doneCritText2,.doneCritText3{fill:#000!important}.titleText{text-anchor:middle;font-size:18px;fill:#000}g.classGroup text{fill:#13540c;stroke:none;font-family:trebuchet ms,verdana,arial;font-size:10px}g.classGroup rect{fill:#cde498;stroke:#13540c}g.classGroup line{stroke:#13540c;stroke-width:1}svg .classLabel .box{stroke:none;stroke-width:0;fill:#cde498;opacity:.5}svg .classLabel .label{fill:#13540c;font-size:10px}.relation{stroke:#13540c;stroke-width:1;fill:none}#compositionEnd,#compositionStart,.composition{fill:#13540c;stroke:#13540c;stroke-width:1}#aggregationEnd,#aggregationStart,.aggregation{fill:#cde498;stroke:#13540c;stroke-width:1}#dependencyEnd,#dependencyStart,#extensionEnd,#extensionStart{fill:#13540c;stroke:#13540c;stroke-width:1}.node text{font-size:14px}.node text,div.mermaidTooltip{font-family:trebuchet ms,verdana,arial}div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-size:12px;background:#cdffb2;border:1px solid #6eaa49;border-radius:2px;pointer-events:none;z-index:100}svg {  color: rgb(0, 0, 0);  font: normal normal 400 normal 16px / normal "Times New Roman";}  </style><g><g class="output"><g class="clusters"/><g class="edgePaths"><g class="edgePath" style="opacity: 1;"><path class="path" d="M88,61.932432432432435L165,38L264,38" marker-end="url(#arrowhead18)" style="fill:none"/><defs><marker id="arrowhead18" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M324,38L371,38L399.2173913043478,54.5" marker-end="url(#arrowhead19)" style="fill:none"/><defs><marker id="arrowhead19" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M399.2173913043478,90.5L371,107L294,107L165,107L88,83.06756756756756" marker-end="url(#arrowhead20)" style="fill:none"/><defs><marker id="arrowhead20" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g></g><g class="edgeLabels"><g class="edgeLabel" transform="translate(165,38)" style="opacity: 1;"><g transform="translate(-52,-16)" class="label"><foreignobject width="104" height="32"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">ReplyTo<br/>CorrelationId</span></div></foreignobject></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"/></div></foreignobject></g></g><g class="edgeLabel" transform="translate(294,107)" style="opacity: 1;"><g transform="translate(-52,-16)" class="label"><foreignobject width="104" height="32"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">ReplyTo<br/>CorrelationId</span></div></foreignobject></g></g></g><g class="nodes"><g class="node" id="a" transform="translate(54,72.5)" style="opacity: 1;"><rect rx="5" ry="5" x="-34" y="-18" width="68" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-24,-8)"><foreignobject width="48" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">生产者</div></foreignobject></g></g></g><g class="node" id="b" transform="translate(294,38)" style="opacity: 1;"><rect rx="5" ry="5" x="-30" y="-18" width="60" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-20,-8)"><foreignobject width="40" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">Queue</div></foreignobject></g></g></g><g class="node" id="c" transform="translate(430,72.5)" style="opacity: 1;"><rect rx="5" ry="5" x="-34" y="-18" width="68" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-24,-8)"><foreignobject width="48" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">消费者</div></foreignobject></g></g></g></g></g></g></svg></div><h4 id="集群"><a class="markdownIt-Anchor" href="#集群"></a> 集群</h4><ul><li>RabbitMQ集群中，RabbitMQ Broker运行所需的<strong>元数据</strong>和<strong>状态信息</strong>会自动在集群节点间复制，即节点都有集群的元数据</li><li>但<strong>消息队列Queues不会在多个节点之间复制</strong>（需要镜像复制涉及HeightAvailable功能），即集群Queues通常只位于集群中的某一个节点上<ul><li>单点故障 --&gt; 队列镜像模式（Master-Slave，Master提供服务） --&gt; 没有将集群负载均衡 --&gt; Policy动态镜像队列转换（可以部分队列镜像而不用全镜像）</li></ul></li><li>集群节点：磁盘（Disk/Disc）节点、内存（RAM）节点<ul><li>多数情况下默认是磁盘节点</li><li>内存节点主要用于<strong>具有深度队列</strong>和大量Exchanges的集群以提高消息传递性能</li></ul></li></ul><hr><blockquote><p>Written with <a href="https://stackedit.io/" target="_blank" rel="external">StackEdit</a>.</p></blockquote><!--stackedit_data:eyJoaXN0b3J5IjpbMTY0MTAzNjk0OV19--> ]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
&lt;h1 id=&quot;高可用集群技术及补充相关&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#高可用集群技术及补充相关&quot;&gt;&lt;/a&gt; 高可用集群技术及补充相关&lt;/h1&gt;
&lt;h2 id=&quot;bloom-filter&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#bloom-filter&quot;&gt;&lt;/a&gt; Bloom Filter&lt;/h2&gt;
&lt;p&gt;用途：一个元素是否在一个集合中&lt;/p&gt;
&lt;h3 id=&quot;常规数据结构&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#常规数据结构&quot;&gt;&lt;/a&gt; 常规数据结构&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;数组：增删&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;链表（局部升级：跳表）：随机访问，顺序，查找&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;哈希表：哈希冲突，利用率低&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Map（基于红黑树）：数据结构复杂&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;树（B/B+树，平衡二叉树，Trie）&lt;/p&gt;
&lt;p&gt;常规的数据结构组合似乎可以解决大部分查找问题。首先&lt;strong&gt;核心需求&lt;/strong&gt;是判断存在，如果&lt;strong&gt;只有&lt;/strong&gt;查找需求，则&lt;strong&gt;不一定需要存储&lt;/strong&gt;（或者说&lt;strong&gt;不需要直接接触&lt;/strong&gt;数据集合层）&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="coding" scheme="http://blog.garenfeather.cn/categories/coding/"/>
    
    
      <category term="distributed" scheme="http://blog.garenfeather.cn/tags/distributed/"/>
    
      <category term="storage" scheme="http://blog.garenfeather.cn/tags/storage/"/>
    
      <category term="hash" scheme="http://blog.garenfeather.cn/tags/hash/"/>
    
      <category term="bloomfilter" scheme="http://blog.garenfeather.cn/tags/bloomfilter/"/>
    
      <category term="haproxy" scheme="http://blog.garenfeather.cn/tags/haproxy/"/>
    
      <category term="keepalived" scheme="http://blog.garenfeather.cn/tags/keepalived/"/>
    
      <category term="openstack" scheme="http://blog.garenfeather.cn/tags/openstack/"/>
    
      <category term="amqp" scheme="http://blog.garenfeather.cn/tags/amqp/"/>
    
      <category term="rabbitmq" scheme="http://blog.garenfeather.cn/tags/rabbitmq/"/>
    
      <category term="clusters" scheme="http://blog.garenfeather.cn/tags/clusters/"/>
    
  </entry>
  
  <entry>
    <title>设计一个你自己的PaaS（平台即服务）</title>
    <link href="http://blog.garenfeather.cn/2018/03/30/paas-diy-hasura-1/"/>
    <id>http://blog.garenfeather.cn/2018/03/30/paas-diy-hasura-1/</id>
    <published>2018-03-30T08:27:33.000Z</published>
    <updated>2018-03-30T11:01:23.051Z</updated>
    
    <content type="html"><![CDATA[<ul><li>原文：<a href="https://blog.hasura.io/designing-a-paas-platform-as-a-service-add1e3519b5" target="_blank" rel="external">Designing a DIY PaaS</a></li><li>翻译：<a href="http://ghost.garenfeather.cn/author/garenrhine/" target="_blank" rel="external">GarenRhine</a></li><li>未授权，转载请注明出处</li></ul><hr><p>本文面向想要创建一个自定义PaaS来简化部署工作流程的开发者，这是PaaS架构、实现与部署系列的第一篇</p><a id="more"></a><h2 id="paas是什么"><a class="markdownIt-Anchor" href="#paas是什么"></a> PaaS是什么</h2><p>平台即服务（Platform as a Service），或者说PaaS，是指基于底层基础设施架构的平台和环境抽象（这里的公有云提供商被称为基础架构即服务，IaaS，提供商），它能够让开发者更轻松的部署应用和服务。</p><p>PaaS平台通常都托管在云上，作为由提供商负责维护的共享/专有基础设施池的一部分（例：Heroku，Bluemix）或者一系列归属用户、能够部署在基础设施上的平台工具（例：Pivotal Cloud Foundry）。</p><blockquote><p>在Hasura，你可以在托管和自托管版本之间选择，两者之间可以无缝迁移</p></blockquote><p>如今一个新的趋势是大规模组织会构建他们自己的PaaS（即自定义的PaaS）因此他们的工具都是量身定制的。而在这篇文章中，为了想要准备构建自己的PaaS工具的开发者们，我们回顾一下PaaS应致力于解决的问题，解决这些问题的潜在方法以及做出任何技术选择时应有的考虑</p><hr><h2 id="paas需要解决什么问题"><a class="markdownIt-Anchor" href="#paas需要解决什么问题"></a> PaaS需要解决什么问题</h2><p>作为基础设施的抽象层，一个PaaS首先要解决以下问题：</p><ol><li>使代码独立于其运行的机器</li><li>在软件部署和扩容上提供协助开发者的工具</li></ol><p>支撑一个典型的代码-机器交互工作流程需要的一些抽象层：</p><p><img src="https://cdn-images-1.medium.com/max/600/1*8vuFxeKbDqNjtgXDDokfXQ.png" alt="PaaS需要的抽象层"></p><ol><li>预分配设施</li><li>在设施上安装依赖</li><li>机器上安装代码/二进制文件</li><li>编辑配置文件</li><li>在supervisor监控下运行代码</li><li>更新前端服务器/API网关</li></ol><p>让我们看看上面提到的问题和潜在解决方案更多的细节：</p><h3 id="预分配设施"><a class="markdownIt-Anchor" href="#预分配设施"></a> 预分配设施</h3><p><strong>问题：</strong> 需要创建、安装或配置<strong>大量</strong>如下的实体：</p><p><img src="https://cdn-images-1.medium.com/max/800/1*NHZCpZNdM1l_xcEVIWLMng.png" alt=""></p><p><strong>解决方案：</strong> 以下选项组成了该问题的潜在解决方案：</p><ol><li>使用虚拟化的基础设施</li><li>将 CoreOS 用于：<ul><li>完全回滚式更新</li><li>将操作系统与应用程序级别的问题分开</li></ul></li><li>使用基础设施提供商的API来自动化虚拟机的生命周期：<ul><li>创建一个虚拟机</li><li>更新一个虚拟机</li><li>删除一个虚拟机</li><li>将一个虚拟机添加到集群</li><li>从集群中移除一个虚拟机</li></ul></li></ol><h3 id="在设施上安装依赖"><a class="markdownIt-Anchor" href="#在设施上安装依赖"></a> 在设施上安装依赖</h3><p><strong>问题：</strong>  PaaS需要解决系统和应用两方面的依赖问题</p><p><strong>解决方案：</strong> 简单——使用容器就行（<a href="https://www.docker.com/" target="_blank" rel="external"><em>Docker</em></a><em>,</em> <a href="https://containerd.io/" target="_blank" rel="external"><em>Containerd</em></a> <em>或者</em> <a href="https://coreos.com/rkt" target="_blank" rel="external"><em>rkt</em></a>）。容器帮你将所有的依赖跟代码一起打包在一个镜像里，而打包他们的任务被转交给开发者。</p><p><img src="https://cdn-images-1.medium.com/max/800/1*e6k8G58FhyzVc6KDM_LF4Q.png" alt=""></p><h3 id="机器上安装代码二进制"><a class="markdownIt-Anchor" href="#机器上安装代码二进制"></a> 机器上安装代码/二进制</h3><p><strong>问题：</strong>  代码频繁更新。每一次更新最新的代码都需要安装到虚拟机上。</p><p><strong>解决方案：</strong> 容器又一次成为了救星！此问题一个优雅的解决方案是为每次代码更新都创建一个新的容器镜像。 由代码仓库每一次更新引发的一个基于git的管道复制代码到虚拟机上并在其上自动化镜像的构建流程，这大大改善了开发者的体验。</p><p><img src="https://cdn-images-1.medium.com/max/800/1*C7MFyQW9bYic7NYVgqnnVg.png" alt="基于的持续部署管道"></p><h3 id="编辑配置文件"><a class="markdownIt-Anchor" href="#编辑配置文件"></a> 编辑配置文件</h3><p><strong>问题：</strong>  每次部署或运行环境的改变都需要解决以下配置问题：</p><ul><li>配置参数和conf文件</li><li>标识已部署服务地址的IP/端口</li><li>密码和密钥</li></ul><p>解决这些问题的复杂性在集群中变得更糟糕了</p><p><strong>解决方案：</strong> 大部分配置应该是作为容器一部分的。一个能通过内部DNS处理服务发现并提供集群范围配置管理系统的容器编排工具可以将参数注入其中</p><p><img src="https://cdn-images-1.medium.com/max/800/1*DbBsQkoZeXs9H8HD4eCLVw.png" alt="管理配置和服务发现的基于Kubernetes的解决方案"></p><h3 id="在supervisor监控下运行代码"><a class="markdownIt-Anchor" href="#在supervisor监控下运行代码"></a> 在supervisor监控下运行代码</h3><p><strong>问题：</strong>  解决以下问题需要supervisor</p><ul><li>日志，日志的循环使用</li><li>初始化时重启服务/容器</li><li>崩溃情况下重启服务/容器</li></ul><p><strong>解决方案：</strong> 到目前为止，管理日志可能需要定制工具，但容器编排工具可以解决后面两个问题。大多数编排者提供管理底层资源状态的原语。</p><h3 id="更新前端服务器api网关"><a class="markdownIt-Anchor" href="#更新前端服务器api网关"></a> 更新前端服务器/API网关</h3><p><strong>问题：</strong>  API网关在每次系统发生变化时都需要重新配置和部署。比如说每次更新都会导致上游IP/端口的变化的部署</p><p><strong>解决方案：</strong> 一个响应式的API网关需要一个集群操作者代理来监控变化，然后重新配置和部署网关。操作者必须依赖支持监控变化的分布式数据库，并在容器新部署时进行更新</p><p><img src="https://cdn-images-1.medium.com/max/600/1*bfMlVBgq8QeayAONwpllNQ.png" alt="基于分布式key-vaule存储、拥有操作者代理的响应式网关"></p><hr><p>集成上述解决方案，一个完整的PaaS看起来可能是这样的：</p><p><img src="https://cdn-images-1.medium.com/max/1000/1*ZC1Wrt3k5DveHmxtsmkn_g.png" alt="enter image description here"></p><p>话虽如此，PaaS还需要解决一些其他问题，比如拥有标准化的部署方法，确定底层组件的透明度级别（<em>如果走对开发者友好的路线，还要提供一个安全的方法访问他们</em>），管理有状态的服务等等。</p><p>下一篇文章我们来看一看一个使用Docker和Kubernetes 作为容器和容器编排技术选择实现的示例，并解决上面所列出的问题。</p><p>Hasura是一个基于Kubernetes的PaaS和PostgreSQL驱动的BaaS，从这里开始吧：</p><ul><li><a href="https://hasura.io" target="_blank" rel="external">https://hasura.io</a></li></ul><hr><blockquote><p>Written with <a href="https://stackedit.io/" target="_blank" rel="external">StackEdit</a>.</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;ul&gt;
&lt;li&gt;原文：&lt;a href=&quot;https://blog.hasura.io/designing-a-paas-platform-as-a-service-add1e3519b5&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Designing a DIY PaaS&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;翻译：&lt;a href=&quot;http://ghost.garenfeather.cn/author/garenrhine/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;GarenRhine&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;未授权，转载请注明出处&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;本文面向想要创建一个自定义PaaS来简化部署工作流程的开发者，这是PaaS架构、实现与部署系列的第一篇&lt;/p&gt;
    
    </summary>
    
      <category term="translation" scheme="http://blog.garenfeather.cn/categories/translation/"/>
    
    
      <category term="hasura" scheme="http://blog.garenfeather.cn/tags/hasura/"/>
    
      <category term="git" scheme="http://blog.garenfeather.cn/tags/git/"/>
    
      <category term="paas" scheme="http://blog.garenfeather.cn/tags/paas/"/>
    
      <category term="docker" scheme="http://blog.garenfeather.cn/tags/docker/"/>
    
      <category term="supervisor" scheme="http://blog.garenfeather.cn/tags/supervisor/"/>
    
      <category term="kubernetes" scheme="http://blog.garenfeather.cn/tags/kubernetes/"/>
    
  </entry>
  
  <entry>
    <title>OpenShift搭建免费Ghost博客及Hexo博客全站HTTPS</title>
    <link href="http://blog.garenfeather.cn/2018/03/25/openshift-ghost-blog-docker-https/"/>
    <id>http://blog.garenfeather.cn/2018/03/25/openshift-ghost-blog-docker-https/</id>
    <published>2018-03-25T07:14:48.000Z</published>
    <updated>2018-03-25T07:27:54.395Z</updated>
    
    <content type="html"><![CDATA[<ul><li><s>本文又名论没钱且懒的选手如何一点一点艰难的的死蹭资源</s></li><li>Kubernetes的知识部分为参考官网文档结合自己理解所写，发现错误请指正</li></ul><a id="more"></a><hr><h1 id="openshift"><a class="markdownIt-Anchor" href="#openshift"></a> OpenShift</h1><h2 id="前言"><a class="markdownIt-Anchor" href="#前言"></a> 前言</h2><ul><li>使用OpenShift的starter tier，即免费版。自行注册账号、创建项目等，最后打开web console来到管理界面</li><li>这里提醒一下，注册完要尽快创建项目开始使用集群，不然预分配的空间会被回收，下一次再来用要重新申请分配，会等很久（我等了好几天）</li><li>整体上看项目基于<code>Kubernetes</code>搭建集群环境，Kubernetes又是Docker的集群编排工具，是以<strong>容器为中心的基础架构</strong>，所以我们可以看到<code>Kubernetes</code>的各种名词如Deployment、Pod，也能看到Docker相关的Persistent Volume等名词</li></ul><h3 id="deployment"><a class="markdownIt-Anchor" href="#deployment"></a> Deployment</h3><ul><li><p>字面含义，一个“部署实体”，可以粗浅的认为是一个配置结构，决定一定数量的Pod的结构，引用官网原文↓</p><blockquote><p>Deployment为Pod和Replica Set提供声明式更新。你只需要在 Deployment 中描述您想要的目标状态是什么，Deployment controller 就会帮您将 Pod 和ReplicaSet 的实际状态改变到您的目标状态。</p></blockquote></li><li><p>通过后文提及的配置流程也可以看出作为运行实例的Pod的环境变量、存储挂载等运行配置参数都在Deployment控制面板中完成</p></li><li><p>根据以下文档原文以及几种结构实体之间的关系，可以理解诸如手动删除Pod（错误行为）、修改Deployment引发Pod自动升级等现象的本质。在后文的操作环境下默认一个Deployment应该是对应至少一个Pod的，因此删除Pod集群会自动补上一个相同的Pod</p><blockquote><p>您不该手动管理由 Deployment 创建的 Replica Set，否则您就篡越了 Deployment controller 的职责！</p></blockquote></li></ul><div class="mermaid"><svg id="mermaid-svg-3c04051ca2fa3ecd" xmlns="http://www.w3.org/2000/svg" height="100%" viewbox="0 0 714 268" style="max-width:714px;"><style>  .mermaid .label{font-family:trebuchet ms,verdana,arial;color:#333}.node circle,.node ellipse,.node polygon,.node rect{fill:#cde498;stroke:#13540c;stroke-width:1px}.node.clickable{cursor:pointer}.arrowheadPath{fill:green}.edgePath .path{stroke:green;stroke-width:1.5px}.edgeLabel{background-color:#e8e8e8}.cluster rect{fill:#cdffb2!important;rx:4!important;stroke:#6eaa49!important;stroke-width:1px!important}.cluster text{fill:#333}.actor{stroke:#13540c;fill:#cde498}text.actor{fill:#000;stroke:none}.actor-line{stroke:grey}.messageLine0{marker-end:"url(#arrowhead)"}.messageLine0,.messageLine1{stroke-width:1.5;stroke-dasharray:"2 2";stroke:#333}#arrowhead{fill:#333}#crosshead path{fill:#333!important;stroke:#333!important}.messageText{fill:#333;stroke:none}.labelBox{stroke:#326932;fill:#cde498}.labelText,.loopText{fill:#000;stroke:none}.loopLine{stroke-width:2;stroke-dasharray:"2 2";marker-end:"url(#arrowhead)";stroke:#326932}.note{stroke:#6eaa49;fill:#fff5ad}.noteText{fill:#000;stroke:none;font-family:trebuchet ms,verdana,arial;font-size:14px}.section{stroke:none;opacity:.2}.section0,.section2{fill:#6eaa49}.section1,.section3{fill:#fff;opacity:.2}.sectionTitle0,.sectionTitle1,.sectionTitle2,.sectionTitle3{fill:#333}.sectionTitle{text-anchor:start;font-size:11px;text-height:14px}.grid .tick{stroke:#d3d3d3;opacity:.3;shape-rendering:crispEdges}.grid path{stroke-width:0}.today{fill:none;stroke:red;stroke-width:2px}.task{stroke-width:2}.taskText{text-anchor:middle;font-size:11px}.taskTextOutsideRight{fill:#000;text-anchor:start;font-size:11px}.taskTextOutsideLeft{fill:#000;text-anchor:end;font-size:11px}.taskText0,.taskText1,.taskText2,.taskText3{fill:#fff}.task0,.task1,.task2,.task3{fill:#487e3a;stroke:#13540c}.taskTextOutside0,.taskTextOutside1,.taskTextOutside2,.taskTextOutside3{fill:#000}.active0,.active1,.active2,.active3{fill:#cde498;stroke:#13540c}.activeText0,.activeText1,.activeText2,.activeText3{fill:#000!important}.done0,.done1,.done2,.done3{stroke:grey;fill:#d3d3d3;stroke-width:2}.doneText0,.doneText1,.doneText2,.doneText3{fill:#000!important}.crit0,.crit1,.crit2,.crit3{stroke:#f88;fill:red;stroke-width:2}.activeCrit0,.activeCrit1,.activeCrit2,.activeCrit3{stroke:#f88;fill:#cde498;stroke-width:2}.doneCrit0,.doneCrit1,.doneCrit2,.doneCrit3{stroke:#f88;fill:#d3d3d3;stroke-width:2;cursor:pointer;shape-rendering:crispEdges}.activeCritText0,.activeCritText1,.activeCritText2,.activeCritText3,.doneCritText0,.doneCritText1,.doneCritText2,.doneCritText3{fill:#000!important}.titleText{text-anchor:middle;font-size:18px;fill:#000}g.classGroup text{fill:#13540c;stroke:none;font-family:trebuchet ms,verdana,arial;font-size:10px}g.classGroup rect{fill:#cde498;stroke:#13540c}g.classGroup line{stroke:#13540c;stroke-width:1}svg .classLabel .box{stroke:none;stroke-width:0;fill:#cde498;opacity:.5}svg .classLabel .label{fill:#13540c;font-size:10px}.relation{stroke:#13540c;stroke-width:1;fill:none}#compositionEnd,#compositionStart,.composition{fill:#13540c;stroke:#13540c;stroke-width:1}#aggregationEnd,#aggregationStart,.aggregation{fill:#cde498;stroke:#13540c;stroke-width:1}#dependencyEnd,#dependencyStart,#extensionEnd,#extensionStart{fill:#13540c;stroke:#13540c;stroke-width:1}.node text{font-size:14px}.node text,div.mermaidTooltip{font-family:trebuchet ms,verdana,arial}div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-size:12px;background:#cdffb2;border:1px solid #6eaa49;border-radius:2px;pointer-events:none;z-index:100}svg {  color: rgb(0, 0, 0);  font: normal normal 400 normal 16px / normal "Times New Roman";}  </style><g><g class="output"><g class="clusters"/><g class="edgePaths"><g class="edgePath" style="opacity: 1;"><path class="path" d="M120,124L161,124L202,124" marker-end="url(#arrowhead21)" style="fill:none"/><defs><marker id="arrowhead21" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M302,124L367,124L432,124" marker-end="url(#arrowhead22)" style="fill:none"/><defs><marker id="arrowhead22" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M463.83720930232556,106L501,38L526,38" marker-end="url(#arrowhead23)" style="fill:none"/><defs><marker id="arrowhead23" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M476,124L501,124L526,124" marker-end="url(#arrowhead24)" style="fill:none"/><defs><marker id="arrowhead24" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M463.83720930232556,142L501,210L526,210" marker-end="url(#arrowhead25)" style="fill:none"/><defs><marker id="arrowhead25" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g></g><g class="edgeLabels"><g class="edgeLabel" transform="translate(161,124)" style="opacity: 1;"><g transform="translate(-16,-8)" class="label"><foreignobject width="32" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">创建</span></div></foreignobject></g></g><g class="edgeLabel" transform="translate(367,124)" style="opacity: 1;"><g transform="translate(-40,-8)" class="label"><foreignobject width="80" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">在后台创建</span></div></foreignobject></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"/></div></foreignobject></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"/></div></foreignobject></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"/></div></foreignobject></g></g></g><g class="nodes"><g class="node" id="A" transform="translate(70,124)" style="opacity: 1;"><rect rx="5" ry="5" x="-50" y="-18" width="100" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-40,-8)"><foreignobject width="80" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">Deployment</div></foreignobject></g></g></g><g class="node" id="B" transform="translate(252,124)" style="opacity: 1;"><rect rx="5" ry="5" x="-50" y="-18" width="100" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-40,-8)"><foreignobject width="80" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">ReplicaSet</div></foreignobject></g></g></g><g class="node" id="C" transform="translate(454,124)" style="opacity: 1;"><rect rx="5" ry="5" x="-22" y="-18" width="44" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-12,-8)"><foreignobject width="24" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">Pod</div></foreignobject></g></g></g><g class="node" id="D" transform="translate(600,38)" style="opacity: 1;"><rect rx="5" ry="5" x="-74" y="-18" width="148" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-64,-8)"><foreignobject width="128" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">容器/其他Runtime</div></foreignobject></g></g></g><g class="node" id="E" transform="translate(600,124)" style="opacity: 1;"><rect rx="5" ry="5" x="-74" y="-18" width="148" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-64,-8)"><foreignobject width="128" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">容器/其他Runtime</div></foreignobject></g></g></g><g class="node" id="F" transform="translate(600,210)" style="opacity: 1;"><rect rx="5" ry="5" x="-74" y="-18" width="148" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-64,-8)"><foreignobject width="128" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">容器/其他Runtime</div></foreignobject></g></g></g></g></g></g></svg></div><ul><li><p>同样是参照以下文档说明，可以看到在即使重新Deploy失败，集群也不会瘫痪，可以直接选择取消操作自动回滚</p><blockquote><p>如果当前状态不稳定，回滚到之前的Deployment revision。每次回滚都会更新</p></blockquote></li><li><p>理论上对Deployment的修改会发出rollout，这不一定是我们期望的，例如下文会提到的替换存储卷和修改环境变量等都会引发不必要的rollout，因此需要暂停整个Deployment再恢复</p><blockquote><p>您可以在发出一次或多次更新前暂停一个 Deployment，然后再恢复它。这样您就能多次暂停和恢复 Deployment，在此期间进行一些修复工作，而不会发出不必要的 rollout。</p></blockquote><blockquote><p>Paused和没有paused的Deployment之间的唯一区别就是，所有对paused deployment中的PodTemplateSpec的修改都不会触发新的rollout。Deployment被创建之后默认是非paused。</p></blockquote></li></ul><h3 id="pod"><a class="markdownIt-Anchor" href="#pod"></a> Pod</h3><ul><li><p>Kubernetes对象模型中可部署的最小对象，基本单位，<strong>一个Pod</strong>代表集群上正在运行的<strong>一个进程</strong>，Pod封装<strong>一个或多个</strong>容器。</p><blockquote><p>Docker是Kubernetes Pod中最常见的runtime ，Pods也支持其他容器runtimes。</p></blockquote></li><li><p>如果需要水平扩展应用（例如，运行多个实例），则应该使用多个Pods，每个实例一个Pod。在Kubernetes中，这样通常称为Replication。</p></li><li><p>每个Pod被分配一个<strong>独立的IP地址</strong>，Pod中的每个容器<strong>共享网络命名空间</strong>，包括IP地址和网络端口。Pod内的容器可以使用localhost相互通信。当Pod中的容器与Pod 外部通信时，他们必须协调如何使用共享网络资源（如端口）。</p></li><li><p>重启<strong>Pod中的容器</strong>跟重启<strong>Pod</strong>不是一回事。Pod<strong>只提供容器的运行环境</strong>并<strong>保持</strong>容器的<strong>运行状态</strong>，重启容器不会造成Pod重启。</p></li><li><p>Pod提供两种资源：<strong>网络</strong>和<strong>存储</strong></p></li></ul><h3 id="persistent-volume"><a class="markdownIt-Anchor" href="#persistent-volume"></a> Persistent Volume</h3><ul><li>持久化卷</li><li>字面意义，Docker默认情况下数据在容器中产生，而容器删除后内容也会一并丢失，因此有必要将数据提取出来</li><li>Docker本身有两种存储卷操作方式，一种是<strong>绑定挂载存储卷</strong>，另一种是<strong>管理存储卷</strong></li><li>绑定挂载存储卷直接使用用户提供的主机目录或文件（–volume A:B），管理存储卷的Cassandra和Progres示例如下</li></ul><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">$ docker run -d \</div><div class="line">--volume /var/lib/cassandra/data \</div><div class="line">--name cass-shared \</div><div class="line">alpine <span class="built_in">echo</span> Data Container</div><div class="line"></div><div class="line">$ docker run -d \</div><div class="line">--volume-from cass-shared\</div><div class="line">--name cass1 \</div><div class="line">cassandra:2.2</div></pre></td></tr></table></figure></div><div class="mermaid"><svg id="mermaid-svg-f76972d91ec15ecb" xmlns="http://www.w3.org/2000/svg" height="100%" viewbox="0 0 786 232.5" style="max-width:786px;"><style>  .mermaid .label{font-family:trebuchet ms,verdana,arial;color:#333}.node circle,.node ellipse,.node polygon,.node rect{fill:#cde498;stroke:#13540c;stroke-width:1px}.node.clickable{cursor:pointer}.arrowheadPath{fill:green}.edgePath .path{stroke:green;stroke-width:1.5px}.edgeLabel{background-color:#e8e8e8}.cluster rect{fill:#cdffb2!important;rx:4!important;stroke:#6eaa49!important;stroke-width:1px!important}.cluster text{fill:#333}.actor{stroke:#13540c;fill:#cde498}text.actor{fill:#000;stroke:none}.actor-line{stroke:grey}.messageLine0{marker-end:"url(#arrowhead)"}.messageLine0,.messageLine1{stroke-width:1.5;stroke-dasharray:"2 2";stroke:#333}#arrowhead{fill:#333}#crosshead path{fill:#333!important;stroke:#333!important}.messageText{fill:#333;stroke:none}.labelBox{stroke:#326932;fill:#cde498}.labelText,.loopText{fill:#000;stroke:none}.loopLine{stroke-width:2;stroke-dasharray:"2 2";marker-end:"url(#arrowhead)";stroke:#326932}.note{stroke:#6eaa49;fill:#fff5ad}.noteText{fill:#000;stroke:none;font-family:trebuchet ms,verdana,arial;font-size:14px}.section{stroke:none;opacity:.2}.section0,.section2{fill:#6eaa49}.section1,.section3{fill:#fff;opacity:.2}.sectionTitle0,.sectionTitle1,.sectionTitle2,.sectionTitle3{fill:#333}.sectionTitle{text-anchor:start;font-size:11px;text-height:14px}.grid .tick{stroke:#d3d3d3;opacity:.3;shape-rendering:crispEdges}.grid path{stroke-width:0}.today{fill:none;stroke:red;stroke-width:2px}.task{stroke-width:2}.taskText{text-anchor:middle;font-size:11px}.taskTextOutsideRight{fill:#000;text-anchor:start;font-size:11px}.taskTextOutsideLeft{fill:#000;text-anchor:end;font-size:11px}.taskText0,.taskText1,.taskText2,.taskText3{fill:#fff}.task0,.task1,.task2,.task3{fill:#487e3a;stroke:#13540c}.taskTextOutside0,.taskTextOutside1,.taskTextOutside2,.taskTextOutside3{fill:#000}.active0,.active1,.active2,.active3{fill:#cde498;stroke:#13540c}.activeText0,.activeText1,.activeText2,.activeText3{fill:#000!important}.done0,.done1,.done2,.done3{stroke:grey;fill:#d3d3d3;stroke-width:2}.doneText0,.doneText1,.doneText2,.doneText3{fill:#000!important}.crit0,.crit1,.crit2,.crit3{stroke:#f88;fill:red;stroke-width:2}.activeCrit0,.activeCrit1,.activeCrit2,.activeCrit3{stroke:#f88;fill:#cde498;stroke-width:2}.doneCrit0,.doneCrit1,.doneCrit2,.doneCrit3{stroke:#f88;fill:#d3d3d3;stroke-width:2;cursor:pointer;shape-rendering:crispEdges}.activeCritText0,.activeCritText1,.activeCritText2,.activeCritText3,.doneCritText0,.doneCritText1,.doneCritText2,.doneCritText3{fill:#000!important}.titleText{text-anchor:middle;font-size:18px;fill:#000}g.classGroup text{fill:#13540c;stroke:none;font-family:trebuchet ms,verdana,arial;font-size:10px}g.classGroup rect{fill:#cde498;stroke:#13540c}g.classGroup line{stroke:#13540c;stroke-width:1}svg .classLabel .box{stroke:none;stroke-width:0;fill:#cde498;opacity:.5}svg .classLabel .label{fill:#13540c;font-size:10px}.relation{stroke:#13540c;stroke-width:1;fill:none}#compositionEnd,#compositionStart,.composition{fill:#13540c;stroke:#13540c;stroke-width:1}#aggregationEnd,#aggregationStart,.aggregation{fill:#cde498;stroke:#13540c;stroke-width:1}#dependencyEnd,#dependencyStart,#extensionEnd,#extensionStart{fill:#13540c;stroke:#13540c;stroke-width:1}.node text{font-size:14px}.node text,div.mermaidTooltip{font-family:trebuchet ms,verdana,arial}div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-size:12px;background:#cdffb2;border:1px solid #6eaa49;border-radius:2px;pointer-events:none;z-index:100}svg {  color: rgb(0, 0, 0);  font: normal normal 400 normal 16px / normal "Times New Roman";}  </style><g><g class="output"><g class="clusters"/><g class="edgePaths"><g class="edgePath" style="opacity: 1;"><path class="path" d="M80,88.5L105,88.5L130,88.5" marker-end="url(#arrowhead27)" style="fill:none"/><defs><marker id="arrowhead27" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M80,174.5L105,174.5L130,174.5" marker-end="url(#arrowhead28)" style="fill:none"/><defs><marker id="arrowhead28" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M190,76.0984251968504L287,36L384,52.70198675496689" marker-end="url(#arrowhead29)" style="fill:none"/><defs><marker id="arrowhead29" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M190,158.08267716535434L287,105L384,77.37748344370861" marker-end="url(#arrowhead30)" style="fill:none"/><defs><marker id="arrowhead30" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M492,62L517,62L606.2628571428571,123.5" marker-end="url(#arrowhead31)" style="fill:none"/><defs><marker id="arrowhead31" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M190,102.90944881889763L287,149.5L438,149.5L517,149.5L542,149.5" marker-end="url(#arrowhead32)" style="stroke: #333; fill:none;stroke-width:2px;stroke-dasharray:3;"/><defs><marker id="arrowhead32" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M190,181.11417322834646L287,202.5L438,202.5L517,202.5L581.6981132075472,175.5" marker-end="url(#arrowhead33)" style="stroke: #333; fill:none;stroke-width:2px;stroke-dasharray:3;"/><defs><marker id="arrowhead33" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g></g><g class="edgeLabels"><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"/></div></foreignobject></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"/></div></foreignobject></g></g><g class="edgeLabel" transform="translate(287,36)" style="opacity: 1;"><g transform="translate(-64,-16)" class="label"><foreignobject width="128" height="32"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">从cass-shared<br/>复制存储卷的定义</span></div></foreignobject></g></g><g class="edgeLabel" transform="translate(287,105)" style="opacity: 1;"><g transform="translate(-72,-16)" class="label"><foreignobject width="144" height="32"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">将存储卷的定义复制<br/>到新的Cassandra</span></div></foreignobject></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"/></div></foreignobject></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"/></div></foreignobject></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"/></div></foreignobject></g></g></g><g class="nodes"><g class="node" id="A" transform="translate(50,88.5)" style="opacity: 1;"><rect rx="0" ry="0" x="-30" y="-18" width="60" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-20,-8)"><foreignobject width="40" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">CQLSH</div></foreignobject></g></g></g><g class="node" id="B" transform="translate(160,88.5)" style="opacity: 1;"><rect rx="0" ry="0" x="-30" y="-18" width="60" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-20,-8)"><foreignobject width="40" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">cass1</div></foreignobject></g></g></g><g class="node" id="C" transform="translate(50,174.5)" style="opacity: 1;"><rect rx="0" ry="0" x="-30" y="-18" width="60" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-20,-8)"><foreignobject width="40" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">CQLSH</div></foreignobject></g></g></g><g class="node" id="D" transform="translate(160,174.5)" style="opacity: 1;"><rect rx="0" ry="0" x="-30" y="-18" width="60" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-20,-8)"><foreignobject width="40" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">cass2</div></foreignobject></g></g></g><g class="node" id="E" transform="translate(438,62)" style="opacity: 1;"><rect rx="0" ry="0" x="-54" y="-18" width="108" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-44,-8)"><foreignobject width="88" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">cass-shared</div></foreignobject></g></g></g><g class="node" id="F" transform="translate(644,149.5)" style="opacity: 1;"><rect rx="5" ry="5" x="-102" y="-26" width="204" height="52"/><g class="label" transform="translate(0,0)"><g transform="translate(-92,-16)"><foreignobject width="184" height="32"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">存储卷<br/>/var/lib/cassandra/data</div></foreignobject></g></g></g></g></g></g></svg></div><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ docker create -v /dbdata --name dbstore training/postgres /bin/<span class="literal">true</span></div><div class="line"></div><div class="line">$ docker run -d --volumes-from dbstore --name db1 training/postgres</div></pre></td></tr></table></figure></div><ul><li><s>上面这部分解释说明其实跟本文关系不大，我们此处知道是把数据持久化需要的部分就行</s></li></ul><hr><h2 id="部署app"><a class="markdownIt-Anchor" href="#部署app"></a> 部署APP</h2><h3 id="过程"><a class="markdownIt-Anchor" href="#过程"></a> 过程</h3><p>部署之前先在Storage面板中创建好Persistent Volume Claim，配置保持默认，读写模式注意一定要设置为<code>Read-Write-Once</code>，创建好后信息大概如下↓</p><p><img src="https://media.discordapp.net/attachments/420095259125743637/427352064327155722/op-08.png" alt="持久化存储卷"></p><p>使用Ghost现成的Docker镜像部署，web console界面点击右上角<code>Add To Project</code>的<code>Deploy Image</code></p><p><img src="https://media.discordapp.net/attachments/420095259125743637/427352051635191818/op-01.png" alt="Deploy Image"></p><p>Image Name模式，输入ghost，点击搜索键，没有特殊要求全部保持默认设置</p><p><img src="https://media.discordapp.net/attachments/420095259125743637/427352059268956161/op-04.png" alt="Default"></p><p>部署完成后在Overview界面展开详细，可以看到表示正常的蓝色状态Pod</p><p><img src="https://media.discordapp.net/attachments/420095259125743637/427354096672964608/H05BIEB7KUKTRKMM.png" alt="Pod Deploy"></p><p>在下方Networking右边点击Create Route，设置保持默认，创建成功后可以看到你公开的路径，复制下来等会有用。此时点开路径，可以看到博客的默认界面</p><p><img src="https://media.discordapp.net/attachments/420095259125743637/427352061571760128/op-06.png" alt="Route"></p><p>点击到边栏Applications的的Deployments，点击刚才的部署，进入Environment内，添加环境变量<code>url</code>，值为刚才的<strong>完整路径</strong>，如：</p><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Name:url</div><div class="line">Value:http://iron-rhine.1d35.starter-us-east-1.openshiftapps.com</div></pre></td></tr></table></figure></div><p>点击保存后会自动开始Deploy，等Overview界面板中的Pod恢复蓝色，再次回到刚才Applications的的Deployments内，先点击右上角如图的<code>Pause Rollouts</code>，暂停Pod的活动，看到相应的暂停提示后切换到Configuration界面</p><p><img src="https://media.discordapp.net/attachments/420095259125743637/427352062724931587/op-07.png" alt="Pause Rollouts"></p><p>在Volumes处选择Remove，移除掉默认分配的存储卷，再点击Add Storage，默认选中了刚才创建的存储卷，Mount Path设置为<code>/var/lib/ghost/content</code>。Add完成后回到原本界面解除<code>Pause Rollouts</code>，会自动重新Deploy</p><p>Deploy完成之后基本设置就完成了，即使删除Pod或Deployment博客内容也不会丢失。接下来就可以愉快的注册写博客了！</p><h3 id="注意"><a class="markdownIt-Anchor" href="#注意"></a> 注意</h3><ul><li><p>Ghost博客这个项目比较大，初次编译会有点久，有时候管理界面显示pod准备好了但项目可能还没准备好，耐心等一会再重启，或者看看日志显示，一两次超时很正常</p></li><li><p><strong>替换了存储卷后绝对不能直接修改配置</strong>， 默认设置下只要config有所变化就会自动重新Deploy，所以若要修改配置，在修改配置前一定要选择<code>Pause Rollouts</code></p></li><li><p><strong>替换了存储卷后也绝对不能直接Deploy</strong>如果单纯想重启可以直接删除pod，默认设置下会自动生成新的pod。也可以删除Deployment重新部署，最后再接回存储卷，<strong>总之不能在有一个Deployment存在的情况下执行Deploy</strong></p></li><li><p>如果觉得存储卷设置麻烦，也可以使用Ghost后台自带的导出导入文章机制，重启前将使用主题下载备份好等等，没有试过不细说了</p></li></ul><h3 id="部分原理说明"><a class="markdownIt-Anchor" href="#部分原理说明"></a> 部分原理说明</h3><ul><li><p>关于直接Deploy一个新版本会失败这一点，个人认为是存储卷读写模式的原因。</p></li><li><p>通过上面的配置可以确认存储卷只允许一个读写（Access Modes：RWO （Read-Write-Once）），而重新Deploy的过程应该是先创建一个新的Deployment再删除原本的Deployment，在这个过程中由于单一读写的原因，存储卷会挂载失败，因此直接重新Deploy一定会失败</p></li></ul><hr><h2 id="why-not"><a class="markdownIt-Anchor" href="#why-not"></a> why not</h2><h3 id="heroku"><a class="markdownIt-Anchor" href="#heroku"></a> heroku</h3><p>原本计划了一个完美的操作，用heroku自带的免费数据库Postgre，结合七牛云10G存储，博客挂起来稳稳的</p><p>然而第一次部署的Ghost是0.x版的，现在的<a href="https://dev.ghost.org/dropping-support-for-postgresql/amp/" target="_blank" rel="external">1.x版已经去掉了Postgre支持</a>（天打雷劈五雷轰顶我的内心几乎是崩溃的），只能MySQL，而heroku的MySQL免费但容量极小，据说只有5M，而且一定要填写信用卡信息……</p><p>遂放弃。【难过</p><h3 id="hasura"><a class="markdownIt-Anchor" href="#hasura"></a> hasura</h3><p>hasura部署起来也很方便，而且自带的存储为2G，最重要的是实现了全自动的HTTPS，但遗憾的是目前免费版暂时不支持持久化存储……（PS对方开发表示文档还没写完，写完了发你一份诶嘿。我：……）</p><p>虽然免费版也不提供custom domain，但对方开发表示可以给个优惠，emmmmmmm再深入考虑下……</p><p>还没放弃.jpg</p><h1 id="cloudflare"><a class="markdownIt-Anchor" href="#cloudflare"></a> CloudFlare</h1><h2 id="自定义域名复杂"><a class="markdownIt-Anchor" href="#自定义域名复杂"></a> 自定义域名（复杂）</h2><h3 id="为何如此复杂"><a class="markdownIt-Anchor" href="#为何如此复杂"></a> 为何如此复杂</h3><p>首先我们按照常规的两种思路：</p><ul><li>解析出地址指向的IP，直接添加一条A记录指向同样IP</li><li>一条CNAME记录解析</li></ul><p>两种方案差不多，然而都不行，因为<strong>OpenShift的start tier禁止自定义域名解析设置</strong></p><p>换个思路，举例，在腾讯云域名解析台可以看到<strong>隐式URL</strong>这一选项<br><img src="https://media.discordapp.net/attachments/420095259125743637/427359818030907402/8769EBHPNGA_GQ_ZVP.png" alt="隐式URL"></p><p>然而隐式转发需要备案，太麻烦，目前买的域名都没有备案emmmm……</p><h3 id="nameserver替换"><a class="markdownIt-Anchor" href="#nameserver替换"></a> NameServer替换</h3><p>首先按惯例注册CloudFlare账号，信息随便填填，我们还是使用免费计划</p><p>Add Site添加你想要使用的域名，按照要求到你购买域名的服务商处修改NameServer为CloudFlare提供的</p><p>举例如我在腾讯云购买的，参考<a href="https://cloud.tencent.com/document/product/302/5518" target="_blank" rel="external">相关文档</a>自行修改</p><p>在Overview中显示如下说明设置已经生效</p><p><img src="https://media.discordapp.net/attachments/420095259125743637/427352068919918593/op-10.png" alt="Active"></p><h3 id="较搓的操作"><a class="markdownIt-Anchor" href="#较搓的操作"></a> 较搓的操作</h3><p>只能说是无奈之举，因为CloudFlare也不支持隐式URL一类的操作，所以目前选择是先redirect过去，到域名控制台打开Page Rules设置</p><p><img src="https://media.discordapp.net/attachments/420095259125743637/427355029683568660/op-09.png" alt="Page Rules"></p><p>添加一条新规则，分别填入你的自定义域名和刚才建好的博客的地址</p><p><img src="https://media.discordapp.net/attachments/420095259125743637/427360435382255618/84KTR4LA13OC06KZK7Z6.png" alt="Rule"></p><p>保存后要稍等一会才能看到结果（据说有人等了几小时，我只等了几分钟就看到了……）</p><h3 id="看起来比较酷炫的操作复杂"><a class="markdownIt-Anchor" href="#看起来比较酷炫的操作复杂"></a> 看起来比较酷炫的操作（复杂）</h3><p>只是个个人的思路，没有实践过，仅供参考，架构大致如图</p><div class="mermaid"><svg id="mermaid-svg-10b91ea3ad8e2dfd" xmlns="http://www.w3.org/2000/svg" height="100%" viewbox="0 0 326 418" style="max-width:326px;"><style>  .mermaid .label{font-family:trebuchet ms,verdana,arial;color:#333}.node circle,.node ellipse,.node polygon,.node rect{fill:#cde498;stroke:#13540c;stroke-width:1px}.node.clickable{cursor:pointer}.arrowheadPath{fill:green}.edgePath .path{stroke:green;stroke-width:1.5px}.edgeLabel{background-color:#e8e8e8}.cluster rect{fill:#cdffb2!important;rx:4!important;stroke:#6eaa49!important;stroke-width:1px!important}.cluster text{fill:#333}.actor{stroke:#13540c;fill:#cde498}text.actor{fill:#000;stroke:none}.actor-line{stroke:grey}.messageLine0{marker-end:"url(#arrowhead)"}.messageLine0,.messageLine1{stroke-width:1.5;stroke-dasharray:"2 2";stroke:#333}#arrowhead{fill:#333}#crosshead path{fill:#333!important;stroke:#333!important}.messageText{fill:#333;stroke:none}.labelBox{stroke:#326932;fill:#cde498}.labelText,.loopText{fill:#000;stroke:none}.loopLine{stroke-width:2;stroke-dasharray:"2 2";marker-end:"url(#arrowhead)";stroke:#326932}.note{stroke:#6eaa49;fill:#fff5ad}.noteText{fill:#000;stroke:none;font-family:trebuchet ms,verdana,arial;font-size:14px}.section{stroke:none;opacity:.2}.section0,.section2{fill:#6eaa49}.section1,.section3{fill:#fff;opacity:.2}.sectionTitle0,.sectionTitle1,.sectionTitle2,.sectionTitle3{fill:#333}.sectionTitle{text-anchor:start;font-size:11px;text-height:14px}.grid .tick{stroke:#d3d3d3;opacity:.3;shape-rendering:crispEdges}.grid path{stroke-width:0}.today{fill:none;stroke:red;stroke-width:2px}.task{stroke-width:2}.taskText{text-anchor:middle;font-size:11px}.taskTextOutsideRight{fill:#000;text-anchor:start;font-size:11px}.taskTextOutsideLeft{fill:#000;text-anchor:end;font-size:11px}.taskText0,.taskText1,.taskText2,.taskText3{fill:#fff}.task0,.task1,.task2,.task3{fill:#487e3a;stroke:#13540c}.taskTextOutside0,.taskTextOutside1,.taskTextOutside2,.taskTextOutside3{fill:#000}.active0,.active1,.active2,.active3{fill:#cde498;stroke:#13540c}.activeText0,.activeText1,.activeText2,.activeText3{fill:#000!important}.done0,.done1,.done2,.done3{stroke:grey;fill:#d3d3d3;stroke-width:2}.doneText0,.doneText1,.doneText2,.doneText3{fill:#000!important}.crit0,.crit1,.crit2,.crit3{stroke:#f88;fill:red;stroke-width:2}.activeCrit0,.activeCrit1,.activeCrit2,.activeCrit3{stroke:#f88;fill:#cde498;stroke-width:2}.doneCrit0,.doneCrit1,.doneCrit2,.doneCrit3{stroke:#f88;fill:#d3d3d3;stroke-width:2;cursor:pointer;shape-rendering:crispEdges}.activeCritText0,.activeCritText1,.activeCritText2,.activeCritText3,.doneCritText0,.doneCritText1,.doneCritText2,.doneCritText3{fill:#000!important}.titleText{text-anchor:middle;font-size:18px;fill:#000}g.classGroup text{fill:#13540c;stroke:none;font-family:trebuchet ms,verdana,arial;font-size:10px}g.classGroup rect{fill:#cde498;stroke:#13540c}g.classGroup line{stroke:#13540c;stroke-width:1}svg .classLabel .box{stroke:none;stroke-width:0;fill:#cde498;opacity:.5}svg .classLabel .label{fill:#13540c;font-size:10px}.relation{stroke:#13540c;stroke-width:1;fill:none}#compositionEnd,#compositionStart,.composition{fill:#13540c;stroke:#13540c;stroke-width:1}#aggregationEnd,#aggregationStart,.aggregation{fill:#cde498;stroke:#13540c;stroke-width:1}#dependencyEnd,#dependencyStart,#extensionEnd,#extensionStart{fill:#13540c;stroke:#13540c;stroke-width:1}.node text{font-size:14px}.node text,div.mermaidTooltip{font-family:trebuchet ms,verdana,arial}div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-size:12px;background:#cdffb2;border:1px solid #6eaa49;border-radius:2px;pointer-events:none;z-index:100}svg {  color: rgb(0, 0, 0);  font: normal normal 400 normal 16px / normal "Times New Roman";}  </style><g><g class="output"><g class="clusters"/><g class="edgePaths"><g class="edgePath" style="opacity: 1;"><path class="path" d="M145,56L145,89L145,122" marker-end="url(#arrowhead21)" style="fill:none"/><defs><marker id="arrowhead21" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M145,158L145,191L145,224" marker-end="url(#arrowhead22)" style="fill:none"/><defs><marker id="arrowhead22" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M117.11764705882354,260L66,293L66,326" marker-end="url(#arrowhead23)" style="fill:none"/><defs><marker id="arrowhead23" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M172.88235294117646,260L224,293L224,334" marker-end="url(#arrowhead24)" style="fill:none"/><defs><marker id="arrowhead24" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g></g><g class="edgeLabels"><g class="edgeLabel" transform="translate(145,89)" style="opacity: 1;"><g transform="translate(-20,-8)" class="label"><foreignobject width="40" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">HTTPS</span></div></foreignobject></g></g><g class="edgeLabel" transform="translate(145,191)" style="opacity: 1;"><g transform="translate(-52,-8)" class="label"><foreignobject width="104" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">HTTP or HTTPS</span></div></foreignobject></g></g><g class="edgeLabel" transform="translate(66,293)" style="opacity: 1;"><g transform="translate(-16,-8)" class="label"><foreignobject width="32" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">HTTP</span></div></foreignobject></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"/></div></foreignobject></g></g></g><g class="nodes"><g class="node" id="A" transform="translate(145,38)" style="opacity: 1;"><rect rx="5" ry="5" x="-26" y="-18" width="52" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-16,-8)"><foreignobject width="32" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">访问</div></foreignobject></g></g></g><g class="node" id="B" transform="translate(145,140)" style="opacity: 1;"><rect rx="5" ry="5" x="-50" y="-18" width="100" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-40,-8)"><foreignobject width="80" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">CloudFlare</div></foreignobject></g></g></g><g class="node" id="C" transform="translate(145,242)" style="opacity: 1;"><rect rx="5" ry="5" x="-30" y="-18" width="60" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-20,-8)"><foreignobject width="40" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">Proxy</div></foreignobject></g></g></g><g class="node" id="D" transform="translate(66,352)" style="opacity: 1;"><rect rx="5" ry="5" x="-46" y="-26" width="92" height="52"/><g class="label" transform="translate(0,0)"><g transform="translate(-36,-16)"><foreignobject width="72" height="32"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">OpenShift<br/>GhostBlog</div></foreignobject></g></g></g><g class="node" id="E" transform="translate(224,352)" style="opacity: 1;"><rect rx="5" ry="5" x="-62" y="-18" width="124" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-52,-8)"><foreignobject width="104" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">Other Site...</div></foreignobject></g></g></g></g></g></g></svg></div><p>这里的关键是需要一个代理服务器，满足以下要求</p><ul><li>支持自定义域名</li><li>对外暴露出代理访问接口</li><li>如果是基于Docker部署，要支持各种自定义启动参数等（自定义转发规则文件替换）</li></ul><p>支持自定义域名是为了HTTPS加密，CloudFlare上的HTTPS设置只能针对自己的域名，别的如OpenShift的地址智能301跳转过去，不能加密也不能在隐式跳转</p><p>如果不在自己服务器上建，还是考虑云的话，最好能一键部署，如Docker Nginx、打包好的Heroku Template工程等。</p><p>不过Heroku自定义域名也需要绑定信用卡，目前暂时找不到满足所有条件的免费平台，只好先搁置了╮(╯▽╰)╭</p><hr><h2 id="https加密hexo博客"><a class="markdownIt-Anchor" href="#https加密hexo博客"></a> HTTPS加密Hexo博客</h2><p>CloudFlare提供了免费HTTPS，<s>不加白不加</s>，顺手给加上</p><p>理论上在将域名服务器设置为CloudFlare提供的之后，你就可以对你这个域名下的所有站点、子域名等为所欲为了！</p><p>理论上Let‘s Encrypt也可以免费提供HTTPS证书，但需要在域名指向的主机上自己操作验证，而且90天证书过期后得自己更新，CloudFlare能提供一劳永逸操作当然是极好的</p><h3 id="原理注意"><a class="markdownIt-Anchor" href="#原理注意"></a> 原理（注意）</h3><p>这里强调下，CloudFlare默认的这波操作严格来说其实并不算真正的加密。如下图，在我们默认没有自签名证书的情况下，<strong>加密的只是从访问开始到CloudFlare的部分</strong>，CloudFlare访问你的站点还是明文的</p><p><img src="https://nickjanetakis.com/assets/blog/cloudflare-flexible-ssl-8c7689ef93f143ea0581056af892e1e54473eb0aea79ad80f4dce15a474a6a77.png" alt="路径"></p><p>某种意义上说相当于我们信赖CloudFlare的访问，<strong>将数据访问安全部分的托管给他们</strong>，所以理论上如果他们遭到了攻击那我们的数据就……</p><p><s>那还能怎么办，当然是选择原谅他啊</s></p><h3 id="操作"><a class="markdownIt-Anchor" href="#操作"></a> 操作</h3><p>我的hexo博客布置在blog.domain，因此简单的到Page Rules处添加两条规则</p><p><img src="https://media.discordapp.net/attachments/420095259125743637/427352178387189770/op-13.png" alt="rule1"></p><p><img src="https://media.discordapp.net/attachments/420095259125743637/427352171529502741/op-12.png" alt="rule2"></p><p>再打开Hexo博客全站都是强制HTTPS打开的啦</p><hr><h1 id="后记"><a class="markdownIt-Anchor" href="#后记"></a> 后记</h1><h2 id="碎碎念"><a class="markdownIt-Anchor" href="#碎碎念"></a> 碎碎念</h2><ul><li><p>OpenShift集群部署是基于Kubernetes的，很早以前就说过想学k8s，结果一直没动手，拖到现在连Deployment和Pod都分不清，一通乱搞，反复了很多无用操作</p></li><li><p>Docker也没学扎实，反复操作把脑子搞爆炸后，一时竟然连Docker持久卷挂上去时内覆盖外还是外覆盖内都不记得了。。。（Host机的目录会覆盖挂载的容器内的目录）</p></li><li><p>需求还是要明确，过程还是要想清楚。比如我的博客现在没有内容，<strong>不需要备份</strong>（如果需要备份的话就得在自己主机上安装oc命令行工具，NFS挂载，再同步回去，具体见<a href="https://hk.saowen.com/a/7fd18fc641e0f0abc5c228c4322ab1372e8ee7ad7ac6b13a33611ada034c72fa" target="_blank" rel="external">这里</a>或官方文档。而这一系列操作需要<strong>管理员权限</strong>，管理员权限操作起来就麻烦了。。。），但部署好了后要确保数据不会随着Docker重启而消失</p></li><li><p>英文水平还是不行，很多操作用英文Google还是不太抓得住关键，比如Docker持久卷这波就该直接搜<code>persistence volume</code>，想了半天居然想到个Durability。。。</p></li><li><p>本来在骂OpenShift不提供custom domain，后来发现heroku也不提供，再后来发现hasura也不提供，嗯……果然custom domain是标准的付费服务吗</p></li></ul><hr><h2 id="参考"><a class="markdownIt-Anchor" href="#参考"></a> 参考</h2><ul><li><a href="https://blog.patricktriest.com/host-webapps-free/" target="_blank" rel="external">10 TIPS TO HOST YOUR WEB APPS FOR FREE</a></li><li><a href="https://zczc.cz/2017/10/11/Hexo-Github-Pages-Cloudflare%E6%90%AD%E5%BB%BA%E8%87%AA%E5%AE%9A%E4%B9%89%E5%9F%9F%E5%90%8DHTTPS%E5%8D%9A%E5%AE%A2/" target="_blank" rel="external">Hexo-Github-Pages-Cloudflare搭建自定义域名HTTPS博客</a></li><li><a href="https://steffan.cn/2017/03/22/use-cloudflare-to-implement-HTTPS-for-GithubPages-with-custom-domain-names/" target="_blank" rel="external">使用Cloudflare为自定义域名的GithubPages实现HTTPS化</a></li><li><a href="https://docs.clickfunnels.com/other/how-to-add-your-cname-record-to-cloudflare" target="_blank" rel="external">how-to-add-your-cname-record-to-cloudflare</a></li><li><a href="https://segmentfault.com/a/1190000011668131" target="_blank" rel="external">容器化应用: Openshift 部署 MySQL数据库服务: 上篇</a></li><li><a href="http://docs.kubernetes.org.cn" target="_blank" rel="external">Kubernetes中文文档</a></li><li>Docker In Action中文版：Docker实战</li></ul><hr><blockquote><p>Written with <a href="https://stackedit.io/" target="_blank" rel="external">StackEdit</a>.</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;ul&gt;
&lt;li&gt;&lt;s&gt;本文又名论没钱且懒的选手如何一点一点艰难的的死蹭资源&lt;/s&gt;&lt;/li&gt;
&lt;li&gt;Kubernetes的知识部分为参考官网文档结合自己理解所写，发现错误请指正&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="coding" scheme="http://blog.garenfeather.cn/categories/coding/"/>
    
    
      <category term="ghost" scheme="http://blog.garenfeather.cn/tags/ghost/"/>
    
      <category term="docker" scheme="http://blog.garenfeather.cn/tags/docker/"/>
    
      <category term="kubernetes" scheme="http://blog.garenfeather.cn/tags/kubernetes/"/>
    
      <category term="hexo" scheme="http://blog.garenfeather.cn/tags/hexo/"/>
    
      <category term="openshift" scheme="http://blog.garenfeather.cn/tags/openshift/"/>
    
      <category term="cloudflare" scheme="http://blog.garenfeather.cn/tags/cloudflare/"/>
    
      <category term="https" scheme="http://blog.garenfeather.cn/tags/https/"/>
    
  </entry>
  
  <entry>
    <title>Hexo博客NexT主题代码高亮MacPanel特效配置</title>
    <link href="http://blog.garenfeather.cn/2018/03/16/hexo-next-macpanel-improved/"/>
    <id>http://blog.garenfeather.cn/2018/03/16/hexo-next-macpanel-improved/</id>
    <published>2018-03-15T18:04:26.000Z</published>
    <updated>2018-03-15T18:25:51.761Z</updated>
    
    <content type="html"><![CDATA[<h2 id="macpanel代码高亮配置"><a class="markdownIt-Anchor" href="#macpanel代码高亮配置"></a> MacPanel代码高亮配置</h2><ul><li><p>原作：<a href="https://www.w3ctrain.com/2017/12/11/hexo-code-block" target="_blank" rel="external">hexo-code-block</a></p></li><li><p>推荐这个MacPanel代码样式的原因：</p><ul><li>漂亮精致，苹果家Mac相关设计一直还是比较得我心的ヾ(o◕∀◕)ﾉヾ</li><li>顶部栏可以<strong>展示代码所使用语言</strong>，有助于阅读者更好的阅读代码(≧▽≦)/</li></ul></li><li><p>直接按照原文操作无法正常展示，因此本文基于原作，针对NexT主题做了微小的修改使之正常显示</p></li></ul><a id="more"></a><h3 id="版本"><a class="markdownIt-Anchor" href="#版本"></a> 版本</h3><ul><li>hexo: 3.3.7</li><li>hexo-cli: 1.0.3</li><li><a href="https://github.com/iissnan/hexo-theme-next" target="_blank" rel="external">NexT.Pisces</a>: v5.1.4</li><li>highlights theme: night bright</li></ul><h3 id="效果展示"><a class="markdownIt-Anchor" href="#效果展示"></a> 效果展示</h3><p>原作者博客效果：<br><img src="https://media.discordapp.net/attachments/420095259125743637/423898599148093451/yuan.png" alt="原作者博客"></p><p>NexT.Pisces主题下适配成功效果：<br><img src="https://media.discordapp.net/attachments/420095259125743637/423898597080301608/original.png" alt="NexT.Pisces适配"></p><h3 id="适配修改过程"><a class="markdownIt-Anchor" href="#适配修改过程"></a> 适配修改过程</h3><p>原本默认的，加上行号的代码展示效果是这样的：<br><img src="https://media.discordapp.net/attachments/420095259125743637/423898599378780170/before.png" alt="两列颜色不一"></p><p>现在我们来一步步修改：，首先照原博所说创建<code>codeblock.js</code>，并将css样式加入全局，这里我放在全局的<code>custom.styl</code>中</p><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ vim themes/next/scripts/codeblock.js </div><div class="line">//粘贴内容</div><div class="line">$ vim themes/next/<span class="built_in">source</span>/css/_custom/custom.styl </div><div class="line">//style标签包裹后粘贴</div></pre></td></tr></table></figure></div><p>然而重新部署后得到的结果却是这样的○|￣|_：<br><img src="https://media.discordapp.net/attachments/420095259125743637/423899876787486720/QQ20180316014830.png" alt="效果不佳"></p><p>底部白边，上面部分挡字且行号列颜色与代码主题颜色不一显得不好看，所以我们首先使行列的底色与代码一致：</p><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ vim themes/next/<span class="built_in">source</span>/css/_common/components/highlight/highlight.styl</div></pre></td></tr></table></figure></div><p>找到如下部分：</p><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="CSS"><figure class="iseeu highlight /css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.gutter</span> <span class="selector-tag">pre</span> &#123;</div><div class="line">  <span class="attribute">padding-left</span>: <span class="number">10px</span></div><div class="line">  padding-right: <span class="number">10px</span></div><div class="line">  color: $highlight-gutter.color</div><div class="line">  text-align: right</div><div class="line">  background-color: $highlight-gutter.bg-color</div><div class="line">&#125;</div></pre></td></tr></table></figure></div><p>删除最后一行配置<code>background-color: $highlight-gutter.bg-color</code>，此时我们可以看见行号列底色与代码已经一致了</p><p><img src="https://media.discordapp.net/attachments/420095259125743637/423898603497586698/blackdisappear.png" alt="行号列底色与代码一致"></p><p>接下来处理白边和顶部。以<s>我多年踩坑不倦的</s>经验来看，不是margin就是padding出了问题，寻找测试一波后get正确参数。此时再次打开这个文件</p><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ vim themes/next/<span class="built_in">source</span>/css/_common/components/highlight/highlight.styl</div></pre></td></tr></table></figure></div><p>找到如下部分代码，修改margin为<code>36px 0 0 0</code>：</p><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="STYL"><figure class="iseeu highlight /styl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$code</span>-block &#123;</div><div class="line">  <span class="attribute">overflow</span>: auto;</div><div class="line">  <span class="attribute">margin</span>: <span class="number">20px</span> <span class="number">0</span>;</div><div class="line">  <span class="attribute">padding</span>: <span class="number">0</span>;</div><div class="line">  <span class="attribute">font-size</span> <span class="variable">$code</span>-font-size;</div><div class="line">  <span class="attribute">color</span>: <span class="variable">$highlight</span>-foreground;</div><div class="line">  <span class="attribute">background</span>: <span class="variable">$highlight</span>-background;</div><div class="line">  <span class="attribute">line-height</span>: <span class="variable">$line</span>-height-code-block;</div><div class="line">&#125;</div></pre></td></tr></table></figure></div><p>到此结束，get正确展示结果如下：</p><p><img src="https://media.discordapp.net/attachments/420095259125743637/423898597080301608/original.png" alt="NexT.Pisces适配"></p><p>这里顺便推荐一个样式相似的代码生成图片项目：<a href="https://carbon.now.sh" target="_blank" rel="external">https://carbon.now.sh</a>，生成代码格式非常漂亮，有一键发送到Twitter的功能，可调节参数很多</p><p><img src="https://media.discordapp.net/attachments/420095259125743637/423898176903315458/carbon_1.png" alt="enter image description here"></p><p><img src="https://media.discordapp.net/attachments/420095259125743637/423901633978826764/carbon_3.png" alt="enter image description here"></p><p><img src="https://media.discordapp.net/attachments/420095259125743637/423898186101293094/carbon.png" alt="enter image description here"></p><p>P.S 会不会原作者就是受该项目启发的？</p><h2 id="有感而发"><a class="markdownIt-Anchor" href="#有感而发"></a> 有感而发</h2><h3 id="持续折腾"><a class="markdownIt-Anchor" href="#持续折腾"></a> 持续折腾</h3><ul><li><p>作为一个明明不想写前端但又总是会被漂亮的东西吸引进而控制不住自己开始动手的后端选手，我能怎么办，我也很绝望啊</p></li><li><p>自己动手而又对前端不熟悉的结果就是往往会花费大量的时间。然而毕竟已经决定了基本发展方向，折腾着折腾着总觉得自己没把时间用在刀刃上，也不是天才，将来的发展也许会很受限吧</p></li></ul><h3 id="复制粘贴也不是容易的工作"><a class="markdownIt-Anchor" href="#复制粘贴也不是容易的工作"></a> 复制粘贴也不是容易的工作</h3><ul><li><p>俗话说开源大法好，shut up and show me your code. 开源意味着高度的自由，而<strong>高度的自由在局部必然是存在着混乱的</strong></p></li><li><p>用人话来说就是代码当然有，能不跑完全是另一回事。万能的gayhub上多得是看起来漂亮实际上自带吨级bug的代码，好好的项目下下来demo都跑不动，复制粘贴真不是万能的，<strong>深入了解结构原理永远是条正解之路</strong></p></li><li><p>开源作者不受约束天涯海角，挂了你都不知去哪找，所以说自己造轮子也真的是有意义的，自己写的代码好歹架构了然于心，关键时刻你还能抢救下自己</p></li><li><p>代码文档是一个问题，另一个问题我认为在于环境配置：<strong>所有正经写教程不交代清相关运行环境、版本信息的一概算耍流氓</strong></p></li><li><p><s>说了这么多还不如赶紧保存一份能跑的代码，以后再也别动它了</s></p></li></ul><blockquote><p>Written with <a href="https://stackedit.io/" target="_blank" rel="external">StackEdit</a>.</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;macpanel代码高亮配置&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#macpanel代码高亮配置&quot;&gt;&lt;/a&gt; MacPanel代码高亮配置&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;原作：&lt;a href=&quot;https://www.w3ctrain.com/2017/12/11/hexo-code-block&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;hexo-code-block&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;推荐这个MacPanel代码样式的原因：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;漂亮精致，苹果家Mac相关设计一直还是比较得我心的ヾ(o◕∀◕)ﾉヾ&lt;/li&gt;
&lt;li&gt;顶部栏可以&lt;strong&gt;展示代码所使用语言&lt;/strong&gt;，有助于阅读者更好的阅读代码(≧▽≦)/&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;直接按照原文操作无法正常展示，因此本文基于原作，针对NexT主题做了微小的修改使之正常显示&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="coding" scheme="http://blog.garenfeather.cn/categories/coding/"/>
    
    
      <category term="theme-next" scheme="http://blog.garenfeather.cn/tags/theme-next/"/>
    
      <category term="css" scheme="http://blog.garenfeather.cn/tags/css/"/>
    
  </entry>
  
  <entry>
    <title>my-mermaid-please</title>
    <link href="http://blog.garenfeather.cn/2018/03/07/my-mermaid-please/"/>
    <id>http://blog.garenfeather.cn/2018/03/07/my-mermaid-please/</id>
    <published>2018-03-07T13:43:22.000Z</published>
    <updated>2018-03-22T21:42:24.746Z</updated>
    
    <content type="html"><![CDATA[<ul><li>test</li></ul><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JAVASCRIPT"><figure class="iseeu highlight /javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> exec = <span class="built_in">require</span>(<span class="string">'child_process'</span>).exec;</div><div class="line"></div><div class="line">hexo.on(<span class="string">'new'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</div><div class="line">    exec(<span class="string">'open -a MacDown '</span> + data.path);</div><div class="line">&#125;);</div></pre></td></tr></table></figure></div><a id="more"></a><div class="mermaid"><svg id="mermaid-svg-5f07c1f4a5156658" width="100%" xmlns="http://www.w3.org/2000/svg" height="150"><style>  .mermaid .label{font-family:trebuchet ms,verdana,arial;color:#333}.node circle,.node ellipse,.node polygon,.node rect{fill:#cde498;stroke:#13540c;stroke-width:1px}.node.clickable{cursor:pointer}.arrowheadPath{fill:green}.edgePath .path{stroke:green;stroke-width:1.5px}.edgeLabel{background-color:#e8e8e8}.cluster rect{fill:#cdffb2!important;rx:4!important;stroke:#6eaa49!important;stroke-width:1px!important}.cluster text{fill:#333}.actor{stroke:#13540c;fill:#cde498}text.actor{fill:#000;stroke:none}.actor-line{stroke:grey}.messageLine0{marker-end:"url(#arrowhead)"}.messageLine0,.messageLine1{stroke-width:1.5;stroke-dasharray:"2 2";stroke:#333}#arrowhead{fill:#333}#crosshead path{fill:#333!important;stroke:#333!important}.messageText{fill:#333;stroke:none}.labelBox{stroke:#326932;fill:#cde498}.labelText,.loopText{fill:#000;stroke:none}.loopLine{stroke-width:2;stroke-dasharray:"2 2";marker-end:"url(#arrowhead)";stroke:#326932}.note{stroke:#6eaa49;fill:#fff5ad}.noteText{fill:#000;stroke:none;font-family:trebuchet ms,verdana,arial;font-size:14px}.section{stroke:none;opacity:.2}.section0,.section2{fill:#6eaa49}.section1,.section3{fill:#fff;opacity:.2}.sectionTitle0,.sectionTitle1,.sectionTitle2,.sectionTitle3{fill:#333}.sectionTitle{text-anchor:start;font-size:11px;text-height:14px}.grid .tick{stroke:#d3d3d3;opacity:.3;shape-rendering:crispEdges}.grid path{stroke-width:0}.today{fill:none;stroke:red;stroke-width:2px}.task{stroke-width:2}.taskText{text-anchor:middle;font-size:11px}.taskTextOutsideRight{fill:#000;text-anchor:start;font-size:11px}.taskTextOutsideLeft{fill:#000;text-anchor:end;font-size:11px}.taskText0,.taskText1,.taskText2,.taskText3{fill:#fff}.task0,.task1,.task2,.task3{fill:#487e3a;stroke:#13540c}.taskTextOutside0,.taskTextOutside1,.taskTextOutside2,.taskTextOutside3{fill:#000}.active0,.active1,.active2,.active3{fill:#cde498;stroke:#13540c}.activeText0,.activeText1,.activeText2,.activeText3{fill:#000!important}.done0,.done1,.done2,.done3{stroke:grey;fill:#d3d3d3;stroke-width:2}.doneText0,.doneText1,.doneText2,.doneText3{fill:#000!important}.crit0,.crit1,.crit2,.crit3{stroke:#f88;fill:red;stroke-width:2}.activeCrit0,.activeCrit1,.activeCrit2,.activeCrit3{stroke:#f88;fill:#cde498;stroke-width:2}.doneCrit0,.doneCrit1,.doneCrit2,.doneCrit3{stroke:#f88;fill:#d3d3d3;stroke-width:2;cursor:pointer;shape-rendering:crispEdges}.activeCritText0,.activeCritText1,.activeCritText2,.activeCritText3,.doneCritText0,.doneCritText1,.doneCritText2,.doneCritText3{fill:#000!important}.titleText{text-anchor:middle;font-size:18px;fill:#000}g.classGroup text{fill:#13540c;stroke:none;font-family:trebuchet ms,verdana,arial;font-size:10px}g.classGroup rect{fill:#cde498;stroke:#13540c}g.classGroup line{stroke:#13540c;stroke-width:1}svg .classLabel .box{stroke:none;stroke-width:0;fill:#cde498;opacity:.5}svg .classLabel .label{fill:#13540c;font-size:10px}.relation{stroke:#13540c;stroke-width:1;fill:none}#compositionEnd,#compositionStart,.composition{fill:#13540c;stroke:#13540c;stroke-width:1}#aggregationEnd,#aggregationStart,.aggregation{fill:#cde498;stroke:#13540c;stroke-width:1}#dependencyEnd,#dependencyStart,#extensionEnd,#extensionStart{fill:#13540c;stroke:#13540c;stroke-width:1}.node text{font-size:14px}.node text,div.mermaidTooltip{font-family:trebuchet ms,verdana,arial}div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-size:12px;background:#cdffb2;border:1px solid #6eaa49;border-radius:2px;pointer-events:none;z-index:100}svg {  color: rgb(0, 0, 0);  font: normal normal 400 normal 16px / normal "Times New Roman";}  </style><g/><defs><g id="def-commit"><circle r="10" cx="0" cy="0"/><foreignobject width="75" height="100" x="-25" y="0" class="node-label" requiredfeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><p/></foreignobject></g></defs><g id="node-66bcf05" class="commit" transform="translate(800, 50)" fill="yellow" stroke="grey" stroke-width="2"><circle r="10" cx="0" cy="0"/><foreignobject width="75" height="100" x="-25" y="0" class="node-label" requiredfeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><p><span class="branch-label">master, </span><span class="commit-id">66bcf05</span></p></foreignobject></g><g id="node-58eb3f0" class="commit" transform="translate(650, 50)" fill="yellow" stroke="grey" stroke-width="2"><circle r="10" cx="0" cy="0"/><foreignobject width="75" height="100" x="-25" y="0" class="node-label" requiredfeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><p><span class="commit-id">58eb3f0</span></p></foreignobject></g><g id="node-4c0841d" class="commit" transform="translate(500, 50)" fill="yellow" stroke="grey" stroke-width="2"><circle r="10" cx="0" cy="0"/><foreignobject width="75" height="100" x="-25" y="0" class="node-label" requiredfeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><p><span class="commit-id">4c0841d</span></p></foreignobject></g><g id="node-9c56e7d" class="commit" transform="translate(50, 50)" fill="yellow" stroke="grey" stroke-width="2"><circle r="10" cx="0" cy="0"/><foreignobject width="75" height="100" x="-25" y="0" class="node-label" requiredfeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><p><span class="commit-id">9c56e7d</span></p></foreignobject></g><g id="node-bc821fe" class="commit" transform="translate(350, 100)" fill="yellow" stroke="grey" stroke-width="2"><circle r="10" cx="0" cy="0"/><foreignobject width="75" height="100" x="-25" y="0" class="node-label" requiredfeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><p><span class="branch-label">newbranch, </span><span class="commit-id">bc821fe</span></p></foreignobject></g><g id="node-272c6e5" class="commit" transform="translate(200, 100)" fill="yellow" stroke="grey" stroke-width="2"><circle r="10" cx="0" cy="0"/><foreignobject width="75" height="100" x="-25" y="0" class="node-label" requiredfeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><p><span class="commit-id">272c6e5</span></p></foreignobject></g><path d="M790,50L777.4999999999999,49.999999999999986C765,49.99999999999999,740,49.99999999999999,727.4999999999999,49.999999999999986C715,49.99999999999999,715,49.99999999999999,705.8333333333333,49.999999999999986C696.6666666666666,49.99999999999999,678.3333333333333,49.99999999999999,669.1666666666666,49.999999999999986L660,50" style="stroke: rgb(68, 47, 116); stroke-width: 4; fill: none;"/><path d="M640,100L360,100" style="stroke: rgb(152, 51, 81); stroke-width: 4; fill: none;"/><path d="M790,50L777.4999999999999,49.999999999999986C765,49.99999999999999,740,49.99999999999999,727.4999999999999,58.33333333333332C715,66.66666666666666,715,83.33333333333331,702.4999999999999,91.66666666666666C690,99.99999999999999,665,99.99999999999999,652.4999999999999,99.99999999999997L640,100" style="stroke: rgb(152, 51, 81); stroke-width: 4; fill: none;"/><path d="M340,100L327.5,99.99999999999997C315,99.99999999999999,290,99.99999999999999,277.5,99.99999999999997C265,99.99999999999999,265,99.99999999999999,255.83333333333331,99.99999999999997C246.66666666666666,99.99999999999999,228.33333333333331,99.99999999999999,219.16666666666666,99.99999999999997L210,100" style="stroke: rgb(152, 51, 81); stroke-width: 4; fill: none;"/><path d="M190,100L177.49999999999997,99.99999999999997C165,99.99999999999999,140,99.99999999999999,127.49999999999997,91.66666666666664C114.99999999999999,83.33333333333331,114.99999999999999,66.66666666666666,105.83333333333331,58.33333333333333C96.66666666666666,49.99999999999999,78.33333333333333,49.99999999999999,69.16666666666666,49.999999999999986L60,50" style="stroke: rgb(152, 51, 81); stroke-width: 4; fill: none;"/><path d="M640,50L627.4999999999999,49.999999999999986C615,49.99999999999999,590,49.99999999999999,577.4999999999999,49.999999999999986C565,49.99999999999999,565,49.99999999999999,555.8333333333333,49.999999999999986C546.6666666666666,49.99999999999999,528.3333333333333,49.99999999999999,519.1666666666666,49.999999999999986L510,50" style="stroke: rgb(68, 47, 116); stroke-width: 4; fill: none;"/><path d="M340,50L60,50" style="stroke: rgb(68, 47, 116); stroke-width: 4; fill: none;"/><path d="M490,50L477.4999999999999,49.999999999999986C464.99999999999994,49.99999999999999,439.99999999999994,49.99999999999999,427.4999999999999,49.999999999999986C414.99999999999994,49.99999999999999,414.99999999999994,49.99999999999999,402.49999999999994,49.999999999999986C389.99999999999994,49.99999999999999,365,49.99999999999999,352.5,49.999999999999986L340,50" style="stroke: rgb(68, 47, 116); stroke-width: 4; fill: none;"/></svg></div><div class="mermaid"><svg id="mermaid-svg-6229348fe779036d" xmlns="http://www.w3.org/2000/svg" height="100%" viewbox="0 0 711.5999984741211 268" style="max-width:711.5999984741211px;"><style>  .mermaid .label{font-family:trebuchet ms,verdana,arial;color:#333}.node circle,.node ellipse,.node polygon,.node rect{fill:#cde498;stroke:#13540c;stroke-width:1px}.node.clickable{cursor:pointer}.arrowheadPath{fill:green}.edgePath .path{stroke:green;stroke-width:1.5px}.edgeLabel{background-color:#e8e8e8}.cluster rect{fill:#cdffb2!important;rx:4!important;stroke:#6eaa49!important;stroke-width:1px!important}.cluster text{fill:#333}.actor{stroke:#13540c;fill:#cde498}text.actor{fill:#000;stroke:none}.actor-line{stroke:grey}.messageLine0{marker-end:"url(#arrowhead)"}.messageLine0,.messageLine1{stroke-width:1.5;stroke-dasharray:"2 2";stroke:#333}#arrowhead{fill:#333}#crosshead path{fill:#333!important;stroke:#333!important}.messageText{fill:#333;stroke:none}.labelBox{stroke:#326932;fill:#cde498}.labelText,.loopText{fill:#000;stroke:none}.loopLine{stroke-width:2;stroke-dasharray:"2 2";marker-end:"url(#arrowhead)";stroke:#326932}.note{stroke:#6eaa49;fill:#fff5ad}.noteText{fill:#000;stroke:none;font-family:trebuchet ms,verdana,arial;font-size:14px}.section{stroke:none;opacity:.2}.section0,.section2{fill:#6eaa49}.section1,.section3{fill:#fff;opacity:.2}.sectionTitle0,.sectionTitle1,.sectionTitle2,.sectionTitle3{fill:#333}.sectionTitle{text-anchor:start;font-size:11px;text-height:14px}.grid .tick{stroke:#d3d3d3;opacity:.3;shape-rendering:crispEdges}.grid path{stroke-width:0}.today{fill:none;stroke:red;stroke-width:2px}.task{stroke-width:2}.taskText{text-anchor:middle;font-size:11px}.taskTextOutsideRight{fill:#000;text-anchor:start;font-size:11px}.taskTextOutsideLeft{fill:#000;text-anchor:end;font-size:11px}.taskText0,.taskText1,.taskText2,.taskText3{fill:#fff}.task0,.task1,.task2,.task3{fill:#487e3a;stroke:#13540c}.taskTextOutside0,.taskTextOutside1,.taskTextOutside2,.taskTextOutside3{fill:#000}.active0,.active1,.active2,.active3{fill:#cde498;stroke:#13540c}.activeText0,.activeText1,.activeText2,.activeText3{fill:#000!important}.done0,.done1,.done2,.done3{stroke:grey;fill:#d3d3d3;stroke-width:2}.doneText0,.doneText1,.doneText2,.doneText3{fill:#000!important}.crit0,.crit1,.crit2,.crit3{stroke:#f88;fill:red;stroke-width:2}.activeCrit0,.activeCrit1,.activeCrit2,.activeCrit3{stroke:#f88;fill:#cde498;stroke-width:2}.doneCrit0,.doneCrit1,.doneCrit2,.doneCrit3{stroke:#f88;fill:#d3d3d3;stroke-width:2;cursor:pointer;shape-rendering:crispEdges}.activeCritText0,.activeCritText1,.activeCritText2,.activeCritText3,.doneCritText0,.doneCritText1,.doneCritText2,.doneCritText3{fill:#000!important}.titleText{text-anchor:middle;font-size:18px;fill:#000}g.classGroup text{fill:#13540c;stroke:none;font-family:trebuchet ms,verdana,arial;font-size:10px}g.classGroup rect{fill:#cde498;stroke:#13540c}g.classGroup line{stroke:#13540c;stroke-width:1}svg .classLabel .box{stroke:none;stroke-width:0;fill:#cde498;opacity:.5}svg .classLabel .label{fill:#13540c;font-size:10px}.relation{stroke:#13540c;stroke-width:1;fill:none}#compositionEnd,#compositionStart,.composition{fill:#13540c;stroke:#13540c;stroke-width:1}#aggregationEnd,#aggregationStart,.aggregation{fill:#cde498;stroke:#13540c;stroke-width:1}#dependencyEnd,#dependencyStart,#extensionEnd,#extensionStart{fill:#13540c;stroke:#13540c;stroke-width:1}.node text{font-size:14px}.node text,div.mermaidTooltip{font-family:trebuchet ms,verdana,arial}div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-size:12px;background:#cdffb2;border:1px solid #6eaa49;border-radius:2px;pointer-events:none;z-index:100}svg {  color: rgb(0, 0, 0);  font: normal normal 400 normal 16px / normal "Times New Roman";}  </style><g><g class="output"><g class="clusters"/><g class="edgePaths"><g class="edgePath" style="opacity: 1;"><path class="path" d="M579.5999984741211,124L518.5999984741211,124L457.5999984741211,124" marker-end="url(#arrowhead23)" style="fill:none"/><defs><marker id="arrowhead23" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M349.5999984741211,124L324.5999984741211,124L300.09999923706056,124.5" marker-end="url(#arrowhead24)" style="fill:none"/><defs><marker id="arrowhead24" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M205.76173115696173,97.23826960597779L133,38L88,38" marker-end="url(#arrowhead25)" style="fill:none"/><defs><marker id="arrowhead25" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M178.5000007629395,124.5L133,124L88,124" marker-end="url(#arrowhead26)" style="fill:none"/><defs><marker id="arrowhead26" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M205.761730315262,151.76173107820154L133,210L76,210" marker-end="url(#arrowhead27)" style="fill:none"/><defs><marker id="arrowhead27" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g></g><g class="edgeLabels"><g class="edgeLabel" transform="translate(518.5999984741211,124)" style="opacity: 1;"><g transform="translate(-36,-8)" class="label"><foreignobject width="72" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">Get money</span></div></foreignobject></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"/></div></foreignobject></g></g><g class="edgeLabel" transform="translate(133,38)" style="opacity: 1;"><g transform="translate(-12,-8)" class="label"><foreignobject width="24" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">One</span></div></foreignobject></g></g><g class="edgeLabel" transform="translate(133,124)" style="opacity: 1;"><g transform="translate(-12,-8)" class="label"><foreignobject width="24" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">Two</span></div></foreignobject></g></g><g class="edgeLabel" transform="translate(133,210)" style="opacity: 1;"><g transform="translate(-20,-8)" class="label"><foreignobject width="40" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">Three</span></div></foreignobject></g></g></g><g class="nodes"><g class="node" id="A" transform="translate(625.5999984741211,124)" style="opacity: 1;"><rect rx="0" ry="0" x="-46" y="-18" width="92" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-36,-8)"><foreignobject width="72" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">Christmas</div></foreignobject></g></g></g><g class="node" id="B" transform="translate(403.5999984741211,124)" style="opacity: 1;"><rect rx="5" ry="5" x="-54" y="-18" width="108" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-44,-8)"><foreignobject width="88" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">Go shopping</div></foreignobject></g></g></g><g class="node" id="C" transform="translate(238.79999923706055,124)" style="opacity: 1;"><polygon points="60.800000000000004,0 121.60000000000001,-60.800000000000004 60.800000000000004,-121.60000000000001 0,-60.800000000000004" rx="5" ry="5" transform="translate(-60.800000000000004,60.800000000000004)"/><g class="label" transform="translate(0,0)"><g transform="translate(-48,-8)"><foreignobject width="96" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">Let me think</div></foreignobject></g></g></g><g class="node" id="D" transform="translate(54,38)" style="opacity: 1;"><rect rx="0" ry="0" x="-34" y="-18" width="68" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-24,-8)"><foreignobject width="48" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">Laptop</div></foreignobject></g></g></g><g class="node" id="E" transform="translate(54,124)" style="opacity: 1;"><rect rx="0" ry="0" x="-34" y="-18" width="68" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-24,-8)"><foreignobject width="48" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">iPhone</div></foreignobject></g></g></g><g class="node" id="F" transform="translate(54,210)" style="opacity: 1;"><rect rx="0" ry="0" x="-22" y="-18" width="44" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-12,-8)"><foreignobject width="24" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">Car</div></foreignobject></g></g></g></g></g></g></svg></div><div class="mermaid"><svg id="mermaid-svg-fb9aa8bafd46d19d" xmlns="http://www.w3.org/2000/svg" height="100%" viewbox="0 0 166 268" style="max-width:166px;"><style>  .mermaid .label{font-family:trebuchet ms,verdana,arial;color:#333}.node circle,.node ellipse,.node polygon,.node rect{fill:#cde498;stroke:#13540c;stroke-width:1px}.node.clickable{cursor:pointer}.arrowheadPath{fill:green}.edgePath .path{stroke:green;stroke-width:1.5px}.edgeLabel{background-color:#e8e8e8}.cluster rect{fill:#cdffb2!important;rx:4!important;stroke:#6eaa49!important;stroke-width:1px!important}.cluster text{fill:#333}.actor{stroke:#13540c;fill:#cde498}text.actor{fill:#000;stroke:none}.actor-line{stroke:grey}.messageLine0{marker-end:"url(#arrowhead)"}.messageLine0,.messageLine1{stroke-width:1.5;stroke-dasharray:"2 2";stroke:#333}#arrowhead{fill:#333}#crosshead path{fill:#333!important;stroke:#333!important}.messageText{fill:#333;stroke:none}.labelBox{stroke:#326932;fill:#cde498}.labelText,.loopText{fill:#000;stroke:none}.loopLine{stroke-width:2;stroke-dasharray:"2 2";marker-end:"url(#arrowhead)";stroke:#326932}.note{stroke:#6eaa49;fill:#fff5ad}.noteText{fill:#000;stroke:none;font-family:trebuchet ms,verdana,arial;font-size:14px}.section{stroke:none;opacity:.2}.section0,.section2{fill:#6eaa49}.section1,.section3{fill:#fff;opacity:.2}.sectionTitle0,.sectionTitle1,.sectionTitle2,.sectionTitle3{fill:#333}.sectionTitle{text-anchor:start;font-size:11px;text-height:14px}.grid .tick{stroke:#d3d3d3;opacity:.3;shape-rendering:crispEdges}.grid path{stroke-width:0}.today{fill:none;stroke:red;stroke-width:2px}.task{stroke-width:2}.taskText{text-anchor:middle;font-size:11px}.taskTextOutsideRight{fill:#000;text-anchor:start;font-size:11px}.taskTextOutsideLeft{fill:#000;text-anchor:end;font-size:11px}.taskText0,.taskText1,.taskText2,.taskText3{fill:#fff}.task0,.task1,.task2,.task3{fill:#487e3a;stroke:#13540c}.taskTextOutside0,.taskTextOutside1,.taskTextOutside2,.taskTextOutside3{fill:#000}.active0,.active1,.active2,.active3{fill:#cde498;stroke:#13540c}.activeText0,.activeText1,.activeText2,.activeText3{fill:#000!important}.done0,.done1,.done2,.done3{stroke:grey;fill:#d3d3d3;stroke-width:2}.doneText0,.doneText1,.doneText2,.doneText3{fill:#000!important}.crit0,.crit1,.crit2,.crit3{stroke:#f88;fill:red;stroke-width:2}.activeCrit0,.activeCrit1,.activeCrit2,.activeCrit3{stroke:#f88;fill:#cde498;stroke-width:2}.doneCrit0,.doneCrit1,.doneCrit2,.doneCrit3{stroke:#f88;fill:#d3d3d3;stroke-width:2;cursor:pointer;shape-rendering:crispEdges}.activeCritText0,.activeCritText1,.activeCritText2,.activeCritText3,.doneCritText0,.doneCritText1,.doneCritText2,.doneCritText3{fill:#000!important}.titleText{text-anchor:middle;font-size:18px;fill:#000}g.classGroup text{fill:#13540c;stroke:none;font-family:trebuchet ms,verdana,arial;font-size:10px}g.classGroup rect{fill:#cde498;stroke:#13540c}g.classGroup line{stroke:#13540c;stroke-width:1}svg .classLabel .box{stroke:none;stroke-width:0;fill:#cde498;opacity:.5}svg .classLabel .label{fill:#13540c;font-size:10px}.relation{stroke:#13540c;stroke-width:1;fill:none}#compositionEnd,#compositionStart,.composition{fill:#13540c;stroke:#13540c;stroke-width:1}#aggregationEnd,#aggregationStart,.aggregation{fill:#cde498;stroke:#13540c;stroke-width:1}#dependencyEnd,#dependencyStart,#extensionEnd,#extensionStart{fill:#13540c;stroke:#13540c;stroke-width:1}.node text{font-size:14px}.node text,div.mermaidTooltip{font-family:trebuchet ms,verdana,arial}div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-size:12px;background:#cdffb2;border:1px solid #6eaa49;border-radius:2px;pointer-events:none;z-index:100}svg {  color: rgb(0, 0, 0);  font: normal normal 400 normal 16px / normal "Times New Roman";}  </style><g><g class="output"><g class="clusters"/><g class="edgePaths"><g class="edgePath" style="opacity: 1;"><path class="path" d="M59,53.43589743589744L34,81L34,106" marker-end="url(#arrowhead14)" style="fill:none"/><defs><marker id="arrowhead14" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M87,53.43589743589744L112,81L112,106" marker-end="url(#arrowhead15)" style="fill:none"/><defs><marker id="arrowhead15" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M34,142L34,167L59,194.56410256410257" marker-end="url(#arrowhead16)" style="fill:none"/><defs><marker id="arrowhead16" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M112,142L112,167L87,194.56410256410257" marker-end="url(#arrowhead17)" style="fill:none"/><defs><marker id="arrowhead17" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g></g><g class="edgeLabels"><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"/></div></foreignobject></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"/></div></foreignobject></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"/></div></foreignobject></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"/></div></foreignobject></g></g></g><g class="nodes"><g class="node" id="A" transform="translate(73,38)" style="opacity: 1;"><rect rx="0" ry="0" x="-14" y="-18" width="28" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-4,-8)"><foreignobject width="8" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">A</div></foreignobject></g></g></g><g class="node" id="B" transform="translate(34,124)" style="opacity: 1;"><rect rx="0" ry="0" x="-14" y="-18" width="28" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-4,-8)"><foreignobject width="8" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">B</div></foreignobject></g></g></g><g class="node" id="C" transform="translate(112,124)" style="opacity: 1;"><rect rx="0" ry="0" x="-14" y="-18" width="28" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-4,-8)"><foreignobject width="8" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">C</div></foreignobject></g></g></g><g class="node" id="D" transform="translate(73,210)" style="opacity: 1;"><rect rx="0" ry="0" x="-14" y="-18" width="28" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-4,-8)"><foreignobject width="8" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">D</div></foreignobject></g></g></g></g></g></g></svg></div><div class="mermaid"><svg id="mermaid-svg-e76a0e8cbf200018" width="100%" xmlns="http://www.w3.org/2000/svg" height="100%" viewbox="0 0 715 406"><style>  .mermaid .label{font-family:trebuchet ms,verdana,arial;color:#333}.node circle,.node ellipse,.node polygon,.node rect{fill:#cde498;stroke:#13540c;stroke-width:1px}.node.clickable{cursor:pointer}.arrowheadPath{fill:green}.edgePath .path{stroke:green;stroke-width:1.5px}.edgeLabel{background-color:#e8e8e8}.cluster rect{fill:#cdffb2!important;rx:4!important;stroke:#6eaa49!important;stroke-width:1px!important}.cluster text{fill:#333}.actor{stroke:#13540c;fill:#cde498}text.actor{fill:#000;stroke:none}.actor-line{stroke:grey}.messageLine0{marker-end:"url(#arrowhead)"}.messageLine0,.messageLine1{stroke-width:1.5;stroke-dasharray:"2 2";stroke:#333}#arrowhead{fill:#333}#crosshead path{fill:#333!important;stroke:#333!important}.messageText{fill:#333;stroke:none}.labelBox{stroke:#326932;fill:#cde498}.labelText,.loopText{fill:#000;stroke:none}.loopLine{stroke-width:2;stroke-dasharray:"2 2";marker-end:"url(#arrowhead)";stroke:#326932}.note{stroke:#6eaa49;fill:#fff5ad}.noteText{fill:#000;stroke:none;font-family:trebuchet ms,verdana,arial;font-size:14px}.section{stroke:none;opacity:.2}.section0,.section2{fill:#6eaa49}.section1,.section3{fill:#fff;opacity:.2}.sectionTitle0,.sectionTitle1,.sectionTitle2,.sectionTitle3{fill:#333}.sectionTitle{text-anchor:start;font-size:11px;text-height:14px}.grid .tick{stroke:#d3d3d3;opacity:.3;shape-rendering:crispEdges}.grid path{stroke-width:0}.today{fill:none;stroke:red;stroke-width:2px}.task{stroke-width:2}.taskText{text-anchor:middle;font-size:11px}.taskTextOutsideRight{fill:#000;text-anchor:start;font-size:11px}.taskTextOutsideLeft{fill:#000;text-anchor:end;font-size:11px}.taskText0,.taskText1,.taskText2,.taskText3{fill:#fff}.task0,.task1,.task2,.task3{fill:#487e3a;stroke:#13540c}.taskTextOutside0,.taskTextOutside1,.taskTextOutside2,.taskTextOutside3{fill:#000}.active0,.active1,.active2,.active3{fill:#cde498;stroke:#13540c}.activeText0,.activeText1,.activeText2,.activeText3{fill:#000!important}.done0,.done1,.done2,.done3{stroke:grey;fill:#d3d3d3;stroke-width:2}.doneText0,.doneText1,.doneText2,.doneText3{fill:#000!important}.crit0,.crit1,.crit2,.crit3{stroke:#f88;fill:red;stroke-width:2}.activeCrit0,.activeCrit1,.activeCrit2,.activeCrit3{stroke:#f88;fill:#cde498;stroke-width:2}.doneCrit0,.doneCrit1,.doneCrit2,.doneCrit3{stroke:#f88;fill:#d3d3d3;stroke-width:2;cursor:pointer;shape-rendering:crispEdges}.activeCritText0,.activeCritText1,.activeCritText2,.activeCritText3,.doneCritText0,.doneCritText1,.doneCritText2,.doneCritText3{fill:#000!important}.titleText{text-anchor:middle;font-size:18px;fill:#000}g.classGroup text{fill:#13540c;stroke:none;font-family:trebuchet ms,verdana,arial;font-size:10px}g.classGroup rect{fill:#cde498;stroke:#13540c}g.classGroup line{stroke:#13540c;stroke-width:1}svg .classLabel .box{stroke:none;stroke-width:0;fill:#cde498;opacity:.5}svg .classLabel .label{fill:#13540c;font-size:10px}.relation{stroke:#13540c;stroke-width:1;fill:none}#compositionEnd,#compositionStart,.composition{fill:#13540c;stroke:#13540c;stroke-width:1}#aggregationEnd,#aggregationStart,.aggregation{fill:#cde498;stroke:#13540c;stroke-width:1}#dependencyEnd,#dependencyStart,#extensionEnd,#extensionStart{fill:#13540c;stroke:#13540c;stroke-width:1}.node text{font-size:14px}.node text,div.mermaidTooltip{font-family:trebuchet ms,verdana,arial}div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-size:12px;background:#cdffb2;border:1px solid #6eaa49;border-radius:2px;pointer-events:none;z-index:100}svg {  color: rgb(0, 0, 0);  font: normal normal 400 normal 16px / normal "Times New Roman";}  </style><g/><defs><marker id="extensionStart" class="extension" refx="0" refy="7" markerwidth="190" markerheight="240" orient="auto"><path d="M 1,7 L18,13 V 1 Z"/></marker></defs><defs><marker id="extensionEnd" refx="19" refy="7" markerwidth="20" markerheight="28" orient="auto"><path d="M 1,1 V 13 L18,7 Z"/></marker></defs><defs><marker id="compositionStart" class="extension" refx="0" refy="7" markerwidth="190" markerheight="240" orient="auto"><path d="M 18,7 L9,13 L1,7 L9,1 Z"/></marker></defs><defs><marker id="compositionEnd" refx="19" refy="7" markerwidth="20" markerheight="28" orient="auto"><path d="M 18,7 L9,13 L1,7 L9,1 Z"/></marker></defs><defs><marker id="aggregationStart" class="extension" refx="0" refy="7" markerwidth="190" markerheight="240" orient="auto"><path d="M 18,7 L9,13 L1,7 L9,1 Z"/></marker></defs><defs><marker id="aggregationEnd" refx="19" refy="7" markerwidth="20" markerheight="28" orient="auto"><path d="M 18,7 L9,13 L1,7 L9,1 Z"/></marker></defs><defs><marker id="dependencyStart" class="extension" refx="0" refy="7" markerwidth="190" markerheight="240" orient="auto"><path d="M 5,7 L9,13 L1,7 L9,1 Z"/></marker></defs><defs><marker id="dependencyEnd" refx="19" refy="7" markerwidth="20" markerheight="28" orient="auto"><path d="M 18,7 L9,13 L14,7 L9,1 Z"/></marker></defs><g id="classId0" class="classGroup" transform="translate(12,0 )"><rect x="0" y="0" width="103" height="83"/><text x="5" y="15">Class01</text><line x1="0" y1="26" y2="26" x2="103"/><text x="5" y="36" fill="white" class="classText"><tspan x="5">int chimp</tspan><tspan x="5" dy="10">int gorilla</tspan></text><line x1="0" y1="57" y2="57" x2="103"/><text x="5" y="72" fill="white" class="classText"><tspan x="5">size()</tspan></text></g><g id="classId1" class="classGroup" transform="translate(0,149.5 )"><rect x="0" y="0" width="127" height="40"/><text x="5" y="15">AveryLongClass</text><line x1="0" y1="26" y2="26" x2="127"/><text x="5" y="36" fill="white" class="classText"/><line x1="0" y1="31" y2="31" x2="127"/><text x="5" y="46" fill="white" class="classText"/></g><g id="classId2" class="classGroup" transform="translate(177,21.5 )"><rect x="0" y="0" width="71" height="40"/><text x="5" y="15">Class03</text><line x1="0" y1="26" y2="26" x2="71"/><text x="5" y="36" fill="white" class="classText"/><line x1="0" y1="31" y2="31" x2="71"/><text x="5" y="46" fill="white" class="classText"/></g><g id="classId3" class="classGroup" transform="translate(177,149.5 )"><rect x="0" y="0" width="71" height="40"/><text x="5" y="15">Class04</text><line x1="0" y1="26" y2="26" x2="71"/><text x="5" y="36" fill="white" class="classText"/><line x1="0" y1="31" y2="31" x2="71"/><text x="5" y="46" fill="white" class="classText"/></g><g id="classId4" class="classGroup" transform="translate(298,21.5 )"><rect x="0" y="0" width="71" height="40"/><text x="5" y="15">Class05</text><line x1="0" y1="26" y2="26" x2="71"/><text x="5" y="36" fill="white" class="classText"/><line x1="0" y1="31" y2="31" x2="71"/><text x="5" y="46" fill="white" class="classText"/></g><g id="classId5" class="classGroup" transform="translate(298,149.5 )"><rect x="0" y="0" width="71" height="40"/><text x="5" y="15">Class06</text><line x1="0" y1="26" y2="26" x2="71"/><text x="5" y="36" fill="white" class="classText"/><line x1="0" y1="31" y2="31" x2="71"/><text x="5" y="46" fill="white" class="classText"/></g><g id="classId6" class="classGroup" transform="translate(520,133 )"><rect x="0" y="0" width="175" height="73"/><text x="5" y="15">Class07</text><line x1="0" y1="26" y2="26" x2="175"/><text x="5" y="36" fill="white" class="classText"><tspan x="5">Object[] elementData</tspan></text><line x1="0" y1="47" y2="47" x2="175"/><text x="5" y="62" fill="white" class="classText"><tspan x="5">equals()</tspan></text></g><g id="classId7" class="classGroup" transform="translate(572,256 )"><rect x="0" y="0" width="71" height="40"/><text x="5" y="15">Class08</text><line x1="0" y1="26" y2="26" x2="71"/><text x="5" y="36" fill="white" class="classText"/><line x1="0" y1="31" y2="31" x2="71"/><text x="5" y="46" fill="white" class="classText"/></g><g id="classId8" class="classGroup" transform="translate(419,21.5 )"><rect x="0" y="0" width="71" height="40"/><text x="5" y="15">Class09</text><line x1="0" y1="26" y2="26" x2="71"/><text x="5" y="36" fill="white" class="classText"/><line x1="0" y1="31" y2="31" x2="71"/><text x="5" y="46" fill="white" class="classText"/></g><g id="classId9" class="classGroup" transform="translate(515.5,346 )"><rect x="0" y="0" width="31" height="40"/><text x="5" y="15">C2</text><line x1="0" y1="26" y2="26" x2="31"/><text x="5" y="36" fill="white" class="classText"/><line x1="0" y1="31" y2="31" x2="31"/><text x="5" y="46" fill="white" class="classText"/></g><g id="classId10" class="classGroup" transform="translate(439,149.5 )"><rect x="0" y="0" width="31" height="40"/><text x="5" y="15">C3</text><line x1="0" y1="26" y2="26" x2="31"/><text x="5" y="36" fill="white" class="classText"/><line x1="0" y1="31" y2="31" x2="31"/><text x="5" y="46" fill="white" class="classText"/></g><path d="M63.5,83L63.499999999999986,87.16666666666666C63.49999999999999,91.33333333333333,63.49999999999999,99.66666666666666,63.499999999999986,110.75C63.49999999999999,121.83333333333333,63.49999999999999,135.66666666666666,63.499999999999986,142.58333333333331L63.5,149.5" id="edge0" class="relation" marker-start="url(#extensionStart)"/><g class="classLabel"><rect class="box" x="45" y="112.25" width="37" height="21"/><text class="label" x="63.5" y="128.75" fill="red" text-anchor="middle">Cool</text></g><path d="M212.5,61.5L212.49999999999997,69.25C212.5,77,212.5,92.5,212.49999999999997,107.16666666666666C212.5,121.83333333333333,212.5,135.66666666666666,212.49999999999997,142.58333333333331L212.5,149.5" id="edge1" class="relation" marker-start="url(#compositionStart)"/><path d="M333.5,61.5L333.49999999999994,69.25C333.5,77,333.5,92.5,333.49999999999994,107.16666666666666C333.5,121.83333333333333,333.5,135.66666666666666,333.49999999999994,142.58333333333331L333.5,149.5" id="edge2" class="relation" marker-start="url(#aggregationStart)"/><path d="M607.5,206L607.5,210.16666666666663C607.5,214.33333333333331,607.5,222.66666666666666,607.5,230.99999999999997C607.5,239.33333333333331,607.5,247.66666666666666,607.5,251.83333333333331L607.5,256" id="edge3" class="relation"/><path d="M439.312030075188,61.5L433.4266917293233,69.25C427.5413533834586,77,415.7706766917293,92.5,409.8853383458646,110.5C404,128.5,404,149,403.99999999999994,169.5C404,190,404,210.5,403.99999999999994,228.25C404,246,404,261,403.99999999999994,276C404,291,404,306,422.58333333333326,320.0846456692913C441.16666666666663,334.16929133858264,478.33333333333326,347.33858267716533,496.91666666666663,353.92322834645665L515.5,360.50787401574803" id="edge4" class="relation" marker-end="url(#dependencyEnd)"/><g class="classLabel"><rect class="box" x="357.5" y="237" width="93" height="21"/><text class="label" x="404" y="253.5" fill="red" text-anchor="middle">Where am i?</text></g><path d="M454.5,61.5L454.5,69.25C454.5,77,454.5,92.5,454.5,107.16666666666666C454.5,121.83333333333333,454.5,135.66666666666666,454.5,142.58333333333331L454.5,149.5" id="edge5" class="relation" marker-end="url(#compositionEnd)"/><path d="M490,56.9297385620915L509.58333333333326,65.44144880174291C529.1666666666666,73.95315904139433,568.3333333333333,90.97657952069716,587.9166666666666,103.65495642701524C607.5,116.33333333333333,607.5,124.66666666666666,607.5,128.83333333333331L607.5,133" id="edge6" class="relation" marker-end="url(#extensionEnd)"/><path d="M607.5,296L607.5,300.16666666666663C607.5,304.3333333333333,607.5,312.66666666666663,597.3333333333334,322.8137254901961C587.1666666666666,332.96078431372547,566.8333333333333,344.92156862745094,556.6666666666666,350.9019607843137L546.5,356.88235294117646" id="edge7" class="relation" marker-start="url(#dependencyStart)" marker-end="url(#dependencyEnd)"/><g class="classLabel"><rect class="box" x="534.5" y="322.4375" width="85" height="21"/><text class="label" x="577" y="338.94117647058823" fill="red" text-anchor="middle">Cool label</text></g></svg></div><div class="mermaid">undefined</div><div class="mermaid"><svg id="mermaid-svg-318a6c10d73109b4" width="100%" xmlns="http://www.w3.org/2000/svg" height="100%" style="max-width:750px;" viewbox="-50 -10 750 479"><style>  .mermaid .label{font-family:trebuchet ms,verdana,arial;color:#333}.node circle,.node ellipse,.node polygon,.node rect{fill:#cde498;stroke:#13540c;stroke-width:1px}.node.clickable{cursor:pointer}.arrowheadPath{fill:green}.edgePath .path{stroke:green;stroke-width:1.5px}.edgeLabel{background-color:#e8e8e8}.cluster rect{fill:#cdffb2!important;rx:4!important;stroke:#6eaa49!important;stroke-width:1px!important}.cluster text{fill:#333}.actor{stroke:#13540c;fill:#cde498}text.actor{fill:#000;stroke:none}.actor-line{stroke:grey}.messageLine0{marker-end:"url(#arrowhead)"}.messageLine0,.messageLine1{stroke-width:1.5;stroke-dasharray:"2 2";stroke:#333}#arrowhead{fill:#333}#crosshead path{fill:#333!important;stroke:#333!important}.messageText{fill:#333;stroke:none}.labelBox{stroke:#326932;fill:#cde498}.labelText,.loopText{fill:#000;stroke:none}.loopLine{stroke-width:2;stroke-dasharray:"2 2";marker-end:"url(#arrowhead)";stroke:#326932}.note{stroke:#6eaa49;fill:#fff5ad}.noteText{fill:#000;stroke:none;font-family:trebuchet ms,verdana,arial;font-size:14px}.section{stroke:none;opacity:.2}.section0,.section2{fill:#6eaa49}.section1,.section3{fill:#fff;opacity:.2}.sectionTitle0,.sectionTitle1,.sectionTitle2,.sectionTitle3{fill:#333}.sectionTitle{text-anchor:start;font-size:11px;text-height:14px}.grid .tick{stroke:#d3d3d3;opacity:.3;shape-rendering:crispEdges}.grid path{stroke-width:0}.today{fill:none;stroke:red;stroke-width:2px}.task{stroke-width:2}.taskText{text-anchor:middle;font-size:11px}.taskTextOutsideRight{fill:#000;text-anchor:start;font-size:11px}.taskTextOutsideLeft{fill:#000;text-anchor:end;font-size:11px}.taskText0,.taskText1,.taskText2,.taskText3{fill:#fff}.task0,.task1,.task2,.task3{fill:#487e3a;stroke:#13540c}.taskTextOutside0,.taskTextOutside1,.taskTextOutside2,.taskTextOutside3{fill:#000}.active0,.active1,.active2,.active3{fill:#cde498;stroke:#13540c}.activeText0,.activeText1,.activeText2,.activeText3{fill:#000!important}.done0,.done1,.done2,.done3{stroke:grey;fill:#d3d3d3;stroke-width:2}.doneText0,.doneText1,.doneText2,.doneText3{fill:#000!important}.crit0,.crit1,.crit2,.crit3{stroke:#f88;fill:red;stroke-width:2}.activeCrit0,.activeCrit1,.activeCrit2,.activeCrit3{stroke:#f88;fill:#cde498;stroke-width:2}.doneCrit0,.doneCrit1,.doneCrit2,.doneCrit3{stroke:#f88;fill:#d3d3d3;stroke-width:2;cursor:pointer;shape-rendering:crispEdges}.activeCritText0,.activeCritText1,.activeCritText2,.activeCritText3,.doneCritText0,.doneCritText1,.doneCritText2,.doneCritText3{fill:#000!important}.titleText{text-anchor:middle;font-size:18px;fill:#000}g.classGroup text{fill:#13540c;stroke:none;font-family:trebuchet ms,verdana,arial;font-size:10px}g.classGroup rect{fill:#cde498;stroke:#13540c}g.classGroup line{stroke:#13540c;stroke-width:1}svg .classLabel .box{stroke:none;stroke-width:0;fill:#cde498;opacity:.5}svg .classLabel .label{fill:#13540c;font-size:10px}.relation{stroke:#13540c;stroke-width:1;fill:none}#compositionEnd,#compositionStart,.composition{fill:#13540c;stroke:#13540c;stroke-width:1}#aggregationEnd,#aggregationStart,.aggregation{fill:#cde498;stroke:#13540c;stroke-width:1}#dependencyEnd,#dependencyStart,#extensionEnd,#extensionStart{fill:#13540c;stroke:#13540c;stroke-width:1}.node text{font-size:14px}.node text,div.mermaidTooltip{font-family:trebuchet ms,verdana,arial}div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-size:12px;background:#cdffb2;border:1px solid #6eaa49;border-radius:2px;pointer-events:none;z-index:100}svg {  color: rgb(0, 0, 0);  font: normal normal 400 normal 16px / normal "Times New Roman";}  </style><g/><g><line id="actor0" x1="75" y1="5" x2="75" y2="468" class="actor-line" stroke-width="0.5px" stroke="#999"/><rect x="0" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"/><text x="75" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="75" dy="0">Alice</tspan></text></g><g><line id="actor1" x1="275" y1="5" x2="275" y2="468" class="actor-line" stroke-width="0.5px" stroke="#999"/><rect x="200" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"/><text x="275" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="275" dy="0">Bob</tspan></text></g><g><line id="actor2" x1="475" y1="5" x2="475" y2="468" class="actor-line" stroke-width="0.5px" stroke="#999"/><rect x="400" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"/><text x="475" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="475" dy="0">John</tspan></text></g><defs><marker id="arrowhead" refx="5" refy="2" markerwidth="6" markerheight="4" orient="auto"><path d="M 0,0 V 4 L6,2 Z"/></marker></defs><defs><marker id="crosshead" markerwidth="15" markerheight="8" orient="auto" refx="16" refy="4"><path fill="black" stroke="#000000" stroke-width="1px" d="M 9,2 V 6 L16,4 Z" style="stroke-dasharray: 0, 0;"/><path fill="none" stroke="#000000" stroke-width="1px" d="M 0,1 L 6,7 M 6,1 L 0,7" style="stroke-dasharray: 0, 0;"/></marker></defs><g><text x="275" y="93" class="messageText" style="text-anchor: middle;">Hello John, how are you?</text><line x1="75" y1="100" x2="475" y2="100" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"/></g><g><text x="475" y="153" class="messageText" style="text-anchor: middle;">Fight against hypochondria</text><path d="M 475,160 C 535,150 535,190 475,180" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"/></g><g><line x1="361" y1="110" x2="589" y2="110" class="loopLine"/><line x1="589" y1="110" x2="589" y2="200" class="loopLine"/><line x1="361" y1="200" x2="589" y2="200" class="loopLine"/><line x1="361" y1="110" x2="361" y2="200" class="loopLine"/><polygon points="361,110 411,110 411,123 402.6,130 361,130" class="labelBox"/><text x="368.5" y="125" fill="black" class="labelText"><tspan x="368.5" fill="black">loop</tspan></text><text x="475" y="125" fill="black" class="loopText" style="text-anchor: middle;"><tspan x="475" fill="black">[ Healthcheck ]</tspan></text></g><g><rect x="500" y="210" fill="#EDF2AE" stroke="#666" width="150" height="68" rx="0" ry="0" class="note"/><text x="516" y="233" fill="black" class="noteText"><tspan x="516">Rational</tspan><tspan dy="16" x="516">thoughts </tspan><tspan dy="16" x="516">prevail...</tspan></text></g><g><text x="275" y="306" class="messageText" style="text-anchor: middle;">Great!</text><line x1="475" y1="313" x2="75" y2="313" class="messageLine1" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"/></g><g><text x="375" y="341" class="messageText" style="text-anchor: middle;">How about you?</text><line x1="475" y1="348" x2="275" y2="348" class="messageLine0" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="fill: none;"/></g><g><text x="375" y="376" class="messageText" style="text-anchor: middle;">Jolly good!</text><line x1="275" y1="383" x2="475" y2="383" class="messageLine1" stroke-width="2" stroke="black" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"/></g><g><rect x="0" y="403" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"/><text x="75" y="435.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="75" dy="0">Alice</tspan></text></g><g><rect x="200" y="403" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"/><text x="275" y="435.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="275" dy="0">Bob</tspan></text></g><g><rect x="400" y="403" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"/><text x="475" y="435.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="475" dy="0">John</tspan></text></g></svg></div>]]></content>
    
    <summary type="html">
    
      &lt;ul&gt;
&lt;li&gt;test&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; exec = &lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;child_process&#39;&lt;/span&gt;).exec;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;hexo.on(&lt;span class=&quot;string&quot;&gt;&#39;new&#39;&lt;/span&gt;, &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;data&lt;/span&gt;)&lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    exec(&lt;span class=&quot;string&quot;&gt;&#39;open -a MacDown &#39;&lt;/span&gt; + data.path);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;);&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="test" scheme="http://blog.garenfeather.cn/categories/test/"/>
    
    
      <category term="test" scheme="http://blog.garenfeather.cn/tags/test/"/>
    
  </entry>
  
  <entry>
    <title>在印度的工程师朋友说，Let&#39;s debug this together!</title>
    <link href="http://blog.garenfeather.cn/2018/03/02/let&#39;s-debug-this-together/"/>
    <id>http://blog.garenfeather.cn/2018/03/02/let&#39;s-debug-this-together/</id>
    <published>2018-03-02T07:23:20.000Z</published>
    <updated>2018-03-22T23:11:55.734Z</updated>
    
    <content type="html"><![CDATA[<h2 id="我是谁我在哪我在干嘛"><a class="markdownIt-Anchor" href="#我是谁我在哪我在干嘛"></a> 我是谁我在哪我在干嘛</h2><p>首先简单的区分下这三个概念↓</p><h3 id="paas-iaas-saas"><a class="markdownIt-Anchor" href="#paas-iaas-saas"></a> PaaS、IaaS、SaaS</h3><p>谷歌随便找了一张图，感觉三者的区别还是很明显的↓</p><p><img src="https://media.discordapp.net/attachments/420095259125743637/426379667562561536/xaas-gartner-definitions.png" alt="Traditional、Colocation、Hosting、IaaS、PaaS、SaaS"></p><a id="more"></a><p>图上IaaS和PaaS的区别在于Operating System和Database，不过实际上感觉通常被我们认为是IaaS的AWS还有GCP等都有提供OS级别的管理。不过OS的创建是用户自行选择的，认为平台本身不提供似乎也合理？</p><h3 id="我想干嘛"><a class="markdownIt-Anchor" href="#我想干嘛"></a> 我想干嘛</h3><p>最近对由于对网络的特♂殊♂需♂求升级（国内旁友们应该都懂哈），<s>再加上没钱（其实是为了省钱买糖）</s>，开始钻研起了歪门邪道，经过对各种方案的对比整理、原理用法钻研、踩坑跳坑出坑，终于将技术上的需求明确下来了：</p><ul><li><strong>自带基础设施</strong>的云平台（Platform as a Service）</li><li>有至少一个免费、不限时的配额</li><li>支持基于docker/nodejs部署app</li><li>操作流程可理解、相对简洁</li></ul><p>要求自带基础设施是因为在找的过程中发现有的平台虽然自称是PaaS，但实际上可以认为是只提供一套基于IaaS的部署工具——或者说应用管理方案。这种平台他们自己的部署工具大多有一套架构、对应的CLI，但<strong>基础设施还是别人的</strong>。具体表现在看doc你会发现他们要求你有Digitalocean、GCP或者AWS等IaaS才能部署</p><p><s>……emmmm这要都有一台自己的VPS了还要你们何用</s>，参照上一条的定义，这样的平台并不能算作PaaS</p><h3 id="我在干嘛"><a class="markdownIt-Anchor" href="#我在干嘛"></a> 我在干嘛</h3><p>晚上吃饭的时候一时兴起翻到了一个<a href="https://github.com/ripienaar/free-for-dev" target="_blank" rel="external">free for dev</a>列表，理所当然就顺着列表的PaaS、IaaS还有Docker related项翻了起来，最后翻来覆去的试了十几个，加上前几天的浏览整合了下，感觉大概符合要求能用的也就几个：</p><ul><li>Bluemix：乍看上去不复杂，有自己的CLI工具也有配合Pivotal Cloud Foundry的CLI插件，列入考虑</li><li>Openshift：因为是基于Kubernetes架构，一个pod一个app过程极其简单，然而用了不到两天就被ban了……</li><li>Hasura：微服务同样基于Kubernetes架构，<strong>本回的主角</strong></li><li>Pivotal Cloud Foundry：流程复杂了点（要部署docker app要设置diego_docker项，设置该项要admin用户，admin用户要自己创建，自己创建admin又要通过自行部署他们的UAA服务来创建，而这个服务无论是本地还是线上都部署失败），在Github提了issue，后面有空再慢慢跟进吧</li><li>Arukas：还没试就在当晚被告知注册要排队很久，还要绑定银行卡，而且部署的<s>非法</s>app很快就会被ban，遂放弃</li></ul><p>综上所述，当晚摸鱼就决定试试hasura了！</p><h3 id="lets-debug-this-together"><a class="markdownIt-Anchor" href="#lets-debug-this-together"></a> Let’s debug this together</h3><h4 id="大致过程"><a class="markdownIt-Anchor" href="#大致过程"></a> 大致过程</h4><p>先总结下印度工程师朋友的debug思路：</p><ul><li>hasura setup确保工程整体初始化</li><li>怀疑git状态，确认<code>git status</code>与<code>git remote</code>正常，</li><li>确认他们的CLI版本最新</li><li>打开hasura debug，后台源代码查看错误</li><li>中途我怀疑可能是墙还是user的问题所以擅自切到了root账号上了代理<ul><li>root账号多报了个credentials的错误，<code>hasura cluster get-credentials -c hasura</code>执行也有返回错误</li><li>被发现切了账号，<code>hasura user-info</code>确认了原本的user正常工作后切回了普通用户</li></ul></li><li>发现我是在VM里操作的，怀疑我弄混了VM和本机设置（……）</li><li>进一步确认<code>git status</code>正常</li><li>确认$HOME变量正常</li><li>后台发现错误是在 <em><strong>git library</strong></em> 里抛出来的，怀疑到 <em><strong>git版本</strong></em> 问题上了</li><li>检查发现我还在使用古老的1.8.xx版本，遂试试升级git</li><li>It works！That’s awesome!</li></ul><h4 id="报错细节"><a class="markdownIt-Anchor" href="#报错细节"></a> 报错细节</h4><p>参照<a href="https://docs.hasura.io/0.15/manual/getting-started/index.html" target="_blank" rel="external">doc</a>，安装CLI，注册好账号，建好project和cluster以及microservice节点，到了<code>git push hasura master</code>这一步的时候出现了问题</p><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">The authenticity of host &apos;xx.hasura-app.io (xx.xx.58.177)&apos; can&apos;t be established.</div><div class="line">ECDSA key fingerprint is b5:xx:09:72:xx:xx:1e:67:d4:e6:e7:xx:76:xx:0f:xx.</div><div class="line">Are you sure you want to continue connecting (yes/no)? yes</div><div class="line">Warning: Permanently added &apos;xx.hasura-app.io,xx.xx.58.177&apos; (ECDSA) to the list of known hosts.</div><div class="line">Permission denied (publickey).</div><div class="line">fatal: Could not read from remote repository.</div><div class="line"></div><div class="line">Please make sure you have the correct access rights</div><div class="line">and the repository exists.</div></pre></td></tr></table></figure></div><p>起初以为是网络的问题，挂了代理试了一下，还是报错</p><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">ssh_exchange_identification: Connection closed by remote host</div><div class="line">fatal: Could not read from remote repository.</div><div class="line"></div><div class="line">Please make sure you have the correct access rights</div><div class="line">and the repository exists.</div></pre></td></tr></table></figure></div><p>束手无策，点击了右下角的webim图标将自己的问题发了过去，没期待能得到回复</p><p><img src="https://media.discordapp.net/attachments/420095259125743637/420146990928756736/001.png?width=346&amp;height=300" alt="发送问题"></p><p>意外的是很快就有人回复了我，看了下信息，似乎是个在印度的工程师朋友（妈呀还是k8s相关开发）</p><p><img src="https://media.discordapp.net/attachments/420095259125743637/420148821792784384/working.png" alt="Works on K8S and Cloud Infrastructure"></p><p>意外的是很快就有人回复了我，看了下信息，似乎是个在印度的工程师朋友</p><p>根据指示设置好其他一切漏的设置后接下来<code>git push hasura master</code>基本上都固定报一个错了</p><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ git push hasura master</div><div class="line">× Pushing project failed error=reference not found</div><div class="line">error: failed to push some refs to &apos;ssh://hasura@xxx.hasura-app.io:22/~/git/xxx&apos;</div></pre></td></tr></table></figure></div><p>于是开始一起debug……</p><p><img src="https://media.discordapp.net/attachments/420095259125743637/420146030290665472/009.png" alt="因为习惯Linux敲命令行了哈哈哈"><br>因为习惯Linux敲命令行了哈哈哈</p><p><img src="https://media.discordapp.net/attachments/420095259125743637/420145406035623936/011.png?width=298&amp;height=300" alt="git版本太老"><br>git版本太老</p><p><img src="https://media.discordapp.net/attachments/420095259125743637/420145655407968256/012.png?width=279&amp;height=300" alt="为什么是ssh不是常规git协议"><br>为什么是ssh不是常规git协议</p><p><img src="https://media.discordapp.net/attachments/420095259125743637/420145659643953162/014.png?width=285&amp;height=300" alt="为什么用虚拟机操作"><br>为什么用虚拟机操作</p><p><img src="https://media.discordapp.net/attachments/420095259125743637/420145662366056448/016.png?" alt="通过他们的Gateway设置http准备好自动跳转https"><br>通过他们的Gateway设置http准备好自动跳转https</p><p><img src="https://media.discordapp.net/attachments/420095259125743637/423923738703298560/012.png?width=279&amp;height=300" alt="为什么是ssh不是常规git协议"></p><p><img src="https://media.discordapp.net/attachments/420095259125743637/423923739776778250/014.png" alt="为什么用虚拟机操作"></p><p><img src="https://media.discordapp.net/attachments/420095259125743637/423923744122339343/016.png" alt="通过他们的Gateway设置http准备好自动跳转https"></p><h4 id="问题分析"><a class="markdownIt-Anchor" href="#问题分析"></a> 问题分析</h4><p>普通Github工程remote显示如下：</p><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ git remote -v</div><div class="line">origingit@github.com:youusername/yourreponame.git (fetch)</div><div class="line">origingit@github.com:youusername/yourreponame.git (push)</div></pre></td></tr></table></figure></div><p>该工程的remote显示如下</p><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ git remote -v</div><div class="line">hasurassh://hasura@xxx.hasura-app.io:22/~/git/xxx (fetch)</div><div class="line">hasurassh://hasura@xxx.hasura-app.io:22/~/git/xxx (push)</div></pre></td></tr></table></figure></div><p>通过remote可以明显看出他们的服务器不是一般的git server，问了下了解到他们确实是用的ssh server代替常规的git server，而低版本的git在解析ssh的时候似乎会出现问题，所以才一直报的error</p><p>实话说这个问题确实不好发现，如果没有后台查代码辅助，我应该是无论如何不会想到git的问题上的，云平台连接报错我总是会怀疑到国内神奇的网络环境上……</p><p>思维还是局限了点，也不知道是受限于经验还是知识了，<s>不过这锅还是甩到墙上吧哈哈哈╮(╯▽╰)╭</s></p><hr><h2 id="后fei记hua"><a class="markdownIt-Anchor" href="#后fei记hua"></a> 后（fei）记（hua）</h2><h3 id="为何如此高兴"><a class="markdownIt-Anchor" href="#为何如此高兴"></a> 为何如此高兴</h3><p>最近沉迷云平台，到处试用，用过的大部分平台虽说有人工求助接口，但很少能回复，更别说是及时回复，更更不用说一直跟着你手把手debug指导问题解决了。当然相信这里面原因复杂，时差、平台规模、bug本身都是阻碍，也不能一味的就说平台的服务不好吧</p><p>不管是时差正好对上了，还是他们的服务就是如此及时，快速的响应、耐心的帮助总是很让人感动的。</p><p>从他们的CLI版本还在0.15.x来看，估计平台建好还不久，用户群体没那么庞大，所以人工服务才如此及时吧，不知道将来规模大了还能不能如此快准稳哈哈哈</p><p>这次debug体验就像一次<strong>远程的结对编程</strong>，解决问题的那一瞬间非常开心，还顺便加了他们的discord讨论群，顺便问了下why not slack，顺便一起作为扩展阅读参考吧</p><ul><li><a href="https://blog.hasura.io/we-are-moving-to-discord-d01e4e6d31b0" target="_blank" rel="external">hasura：为什么讨论平台从slack迁移到了discord</a></li><li><a href="https://reactjs.org/blog/2015/10/19/reactiflux-is-moving-to-discord.html" target="_blank" rel="external">react：为什么讨论平台从slack迁移到了discord</a></li></ul><h3 id="英语表达与知识体系"><a class="markdownIt-Anchor" href="#英语表达与知识体系"></a> 英语表达与知识体系</h3><p>记得以前看过一篇公众号文章，大意是我们获得的大部分知识都停留在某个浅薄的级别上，没有深入理解，不能实际应用，更无法举一反三</p><p>从自己的英文水平上深刻的感受到了这一点</p><p>平常也会看小说，看技术文章，阅读量能勉强维持住，读到复杂颠倒的语句也能理解其意思，但真到了说的时候蹦出来的还是那几句小学英语（I wil、Can I、I should、how…），语序也基本还是中文思考的语序。大概就是只能说出I really feel disappointed而说不出It clearly a bummer的水平吧。</p><p>扎心了，好几次交流途中都感觉无法完整表达出自己的意思，只能拐个弯。句式词汇单一反倒不是最难过的，毕竟交流只要能传达出意思就是胜利，然而事实上就是<strong>传达不出</strong>自己原本想表达的意思……╮(╯_╰)╭很难过了</p><p>慢慢来吧，希望工作后还能有时间精力加强英文水平</p><h3 id="最后"><a class="markdownIt-Anchor" href="#最后"></a> 最后</h3><p><em><strong>Let’s debug this together！</strong></em></p><blockquote><p>Written with <a href="https://stackedit.io/" target="_blank" rel="external">StackEdit</a>.</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;我是谁我在哪我在干嘛&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#我是谁我在哪我在干嘛&quot;&gt;&lt;/a&gt; 我是谁我在哪我在干嘛&lt;/h2&gt;
&lt;p&gt;首先简单的区分下这三个概念↓&lt;/p&gt;
&lt;h3 id=&quot;paas-iaas-saas&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#paas-iaas-saas&quot;&gt;&lt;/a&gt; PaaS、IaaS、SaaS&lt;/h3&gt;
&lt;p&gt;谷歌随便找了一张图，感觉三者的区别还是很明显的↓&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://media.discordapp.net/attachments/420095259125743637/426379667562561536/xaas-gartner-definitions.png&quot; alt=&quot;Traditional、Colocation、Hosting、IaaS、PaaS、SaaS&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="coding" scheme="http://blog.garenfeather.cn/categories/coding/"/>
    
    
      <category term="wall" scheme="http://blog.garenfeather.cn/tags/wall/"/>
    
      <category term="hasura" scheme="http://blog.garenfeather.cn/tags/hasura/"/>
    
      <category term="git" scheme="http://blog.garenfeather.cn/tags/git/"/>
    
      <category term="paas" scheme="http://blog.garenfeather.cn/tags/paas/"/>
    
      <category term="docker" scheme="http://blog.garenfeather.cn/tags/docker/"/>
    
  </entry>
  
  <entry>
    <title>去中心化系统说明</title>
    <link href="http://blog.garenfeather.cn/2018/02/25/decentralization-system-analysis/"/>
    <id>http://blog.garenfeather.cn/2018/02/25/decentralization-system-analysis/</id>
    <published>2018-02-25T04:03:21.000Z</published>
    <updated>2018-03-23T19:04:29.646Z</updated>
    
    <content type="html"><![CDATA[<hr><ul><li><p><a href="https://medium.com/@VitalikButerin/the-meaning-of-decentralization-a0c92b76a274" target="_blank" rel="external">Original</a></p></li><li><p><a href="https://media.weibo.cn/article?id=2309404214118084135438&amp;jumpfrom=weibocom" target="_blank" rel="external">Translation</a></p></li><li><p>一篇比较好的去中心化叙述，特此笔记</p></li></ul><h3 id="如何判断去中心化"><a class="markdownIt-Anchor" href="#如何判断去中心化"></a> 如何判断去中心化</h3><a id="more"></a><ul><li><strong>总体</strong>来说，<strong>相互独立</strong>，缺一不可的三个层次</li></ul><h4 id="架构层"><a class="markdownIt-Anchor" href="#架构层"></a> 架构层</h4><ul><li>物理世界里系统由多少台计算机组成？</li><li>运行过程中，能忍受多少台计算机崩溃而不受影响</li></ul><h4 id="政治层"><a class="markdownIt-Anchor" href="#政治层"></a> 政治层</h4><ul><li>组成系统的计算机集群的所有权</li><li>个人？组织？多少个人或组织？</li></ul><h4 id="逻辑层"><a class="markdownIt-Anchor" href="#逻辑层"></a> 逻辑层</h4><ul><li>设计接口和数据结构来看，更像哪种？<ul><li>一台完整的单一设备（如：分布式数据库）</li><li>一个由无数单位组成的集群</li></ul></li><li>如果把这个系统<strong>分成两半</strong>，两部分里同时包含<strong>生产者</strong>和<strong>消费者</strong>，这两部分能作为<strong>独立单元</strong>，<strong>完整</strong>的运行下去吗</li></ul><h4 id="示例"><a class="markdownIt-Anchor" href="#示例"></a> 示例</h4><table><thead><tr><th style="text-align:left">去中心化</th><th style="text-align:center">架构层</th><th style="text-align:center">政治层</th><th style="text-align:center">逻辑层</th></tr></thead><tbody><tr><td style="text-align:left">传统公司</td><td style="text-align:center">×</td><td style="text-align:center">×</td><td style="text-align:center">×</td></tr><tr><td style="text-align:left">直接民主政治</td><td style="text-align:center">×</td><td style="text-align:center">×</td><td style="text-align:center">√</td></tr><tr><td style="text-align:left">大陆法</td><td style="text-align:center">×√(之间)</td><td style="text-align:center">×</td><td style="text-align:center">×</td></tr><tr><td style="text-align:left">区块链、普通法</td><td style="text-align:center">√</td><td style="text-align:center">√</td><td style="text-align:center">×</td></tr><tr><td style="text-align:left">CDN内容分发网络</td><td style="text-align:center">√</td><td style="text-align:center">×</td><td style="text-align:center">√</td></tr><tr><td style="text-align:left">BitTorrent、英语语言</td><td style="text-align:center">√</td><td style="text-align:center">√</td><td style="text-align:center">√</td></tr><tr><td style="text-align:left">？</td><td style="text-align:center">×</td><td style="text-align:center">×</td><td style="text-align:center">√</td></tr><tr><td style="text-align:left">？</td><td style="text-align:center">×</td><td style="text-align:center">√</td><td style="text-align:center">√</td></tr><tr><td style="text-align:left">？</td><td style="text-align:center">√</td><td style="text-align:center">×</td><td style="text-align:center">×</td></tr></tbody></table><ul><li>大陆法依赖一个中心立法机构</li><li>普通法是由很多法官作为个人做出的许多先例构成的（？）</li><li>然而法律就是法律，因此逻辑层中心化</li></ul><h4 id="叙述"><a class="markdownIt-Anchor" href="#叙述"></a> 叙述</h4><ul><li>大多数情况下逻辑层的中心化代表了比较好的选择<ul><li>区块链的中央数据库，即公共账本，<strong>逻辑层上是中心化的</strong></li></ul></li><li>有人认为逻辑层也要尽可能的去中心化，理由是其<strong>往往在网络分区上更有生存能力</strong>，即在<strong>连接性</strong>比较差的世界里运行情况会更好</li></ul><h3 id="为什么很重要好处在哪"><a class="markdownIt-Anchor" href="#为什么很重要好处在哪"></a> 为什么很重要/好处在哪</h3><ul><li>三个优点：容错性、抗攻击性、抗勾结性（某种程度上也是一般分布式系统所具有的优势？尤其是前两个条件）</li></ul><h4 id="容错性"><a class="markdownIt-Anchor" href="#容错性"></a> 容错性</h4><div class="mermaid"><svg id="mermaid-svg-b078774ab0c4d75d" xmlns="http://www.w3.org/2000/svg" height="100%" viewbox="0 0 676 386" style="max-width:676px;"><style>  .mermaid .label{font-family:trebuchet ms,verdana,arial;color:#333}.node circle,.node ellipse,.node polygon,.node rect{fill:#cde498;stroke:#13540c;stroke-width:1px}.node.clickable{cursor:pointer}.arrowheadPath{fill:green}.edgePath .path{stroke:green;stroke-width:1.5px}.edgeLabel{background-color:#e8e8e8}.cluster rect{fill:#cdffb2!important;rx:4!important;stroke:#6eaa49!important;stroke-width:1px!important}.cluster text{fill:#333}.actor{stroke:#13540c;fill:#cde498}text.actor{fill:#000;stroke:none}.actor-line{stroke:grey}.messageLine0{marker-end:"url(#arrowhead)"}.messageLine0,.messageLine1{stroke-width:1.5;stroke-dasharray:"2 2";stroke:#333}#arrowhead{fill:#333}#crosshead path{fill:#333!important;stroke:#333!important}.messageText{fill:#333;stroke:none}.labelBox{stroke:#326932;fill:#cde498}.labelText,.loopText{fill:#000;stroke:none}.loopLine{stroke-width:2;stroke-dasharray:"2 2";marker-end:"url(#arrowhead)";stroke:#326932}.note{stroke:#6eaa49;fill:#fff5ad}.noteText{fill:#000;stroke:none;font-family:trebuchet ms,verdana,arial;font-size:14px}.section{stroke:none;opacity:.2}.section0,.section2{fill:#6eaa49}.section1,.section3{fill:#fff;opacity:.2}.sectionTitle0,.sectionTitle1,.sectionTitle2,.sectionTitle3{fill:#333}.sectionTitle{text-anchor:start;font-size:11px;text-height:14px}.grid .tick{stroke:#d3d3d3;opacity:.3;shape-rendering:crispEdges}.grid path{stroke-width:0}.today{fill:none;stroke:red;stroke-width:2px}.task{stroke-width:2}.taskText{text-anchor:middle;font-size:11px}.taskTextOutsideRight{fill:#000;text-anchor:start;font-size:11px}.taskTextOutsideLeft{fill:#000;text-anchor:end;font-size:11px}.taskText0,.taskText1,.taskText2,.taskText3{fill:#fff}.task0,.task1,.task2,.task3{fill:#487e3a;stroke:#13540c}.taskTextOutside0,.taskTextOutside1,.taskTextOutside2,.taskTextOutside3{fill:#000}.active0,.active1,.active2,.active3{fill:#cde498;stroke:#13540c}.activeText0,.activeText1,.activeText2,.activeText3{fill:#000!important}.done0,.done1,.done2,.done3{stroke:grey;fill:#d3d3d3;stroke-width:2}.doneText0,.doneText1,.doneText2,.doneText3{fill:#000!important}.crit0,.crit1,.crit2,.crit3{stroke:#f88;fill:red;stroke-width:2}.activeCrit0,.activeCrit1,.activeCrit2,.activeCrit3{stroke:#f88;fill:#cde498;stroke-width:2}.doneCrit0,.doneCrit1,.doneCrit2,.doneCrit3{stroke:#f88;fill:#d3d3d3;stroke-width:2;cursor:pointer;shape-rendering:crispEdges}.activeCritText0,.activeCritText1,.activeCritText2,.activeCritText3,.doneCritText0,.doneCritText1,.doneCritText2,.doneCritText3{fill:#000!important}.titleText{text-anchor:middle;font-size:18px;fill:#000}g.classGroup text{fill:#13540c;stroke:none;font-family:trebuchet ms,verdana,arial;font-size:10px}g.classGroup rect{fill:#cde498;stroke:#13540c}g.classGroup line{stroke:#13540c;stroke-width:1}svg .classLabel .box{stroke:none;stroke-width:0;fill:#cde498;opacity:.5}svg .classLabel .label{fill:#13540c;font-size:10px}.relation{stroke:#13540c;stroke-width:1;fill:none}#compositionEnd,#compositionStart,.composition{fill:#13540c;stroke:#13540c;stroke-width:1}#aggregationEnd,#aggregationStart,.aggregation{fill:#cde498;stroke:#13540c;stroke-width:1}#dependencyEnd,#dependencyStart,#extensionEnd,#extensionStart{fill:#13540c;stroke:#13540c;stroke-width:1}.node text{font-size:14px}.node text,div.mermaidTooltip{font-family:trebuchet ms,verdana,arial}div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-size:12px;background:#cdffb2;border:1px solid #6eaa49;border-radius:2px;pointer-events:none;z-index:100}svg {  color: rgb(0, 0, 0);  font: normal normal 400 normal 16px / normal "Times New Roman";}  </style><g><g class="output"><g class="clusters"/><g class="edgePaths"><g class="edgePath" style="opacity: 1;"><path class="path" d="M192,183L233,183L274,183" marker-end="url(#arrowhead20)" style="fill:none"/><defs><marker id="arrowhead20" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M326.9051094890511,165L399,46L480,46" marker-end="url(#arrowhead21)" style="fill:none"/><defs><marker id="arrowhead21" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M350.74418604651163,165L399,140L440,140" marker-end="url(#arrowhead22)" style="fill:none"/><defs><marker id="arrowhead22" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M350.74418604651163,201L399,226L480,226" marker-end="url(#arrowhead23)" style="fill:none"/><defs><marker id="arrowhead23" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M326.9051094890511,201L399,320L440,320" marker-end="url(#arrowhead24)" style="fill:none"/><defs><marker id="arrowhead24" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g></g><g class="edgeLabels"><g class="edgeLabel" transform="translate(233,183)" style="opacity: 1;"><g transform="translate(-16,-8)" class="label"><foreignobject width="32" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">然而</span></div></foreignobject></g></g><g class="edgeLabel" transform="translate(399,46)" style="opacity: 1;"><g transform="translate(-16,-8)" class="label"><foreignobject width="32" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">组织</span></div></foreignobject></g></g><g class="edgeLabel" transform="translate(399,140)" style="opacity: 1;"><g transform="translate(-16,-8)" class="label"><foreignobject width="32" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">组织</span></div></foreignobject></g></g><g class="edgeLabel" transform="translate(399,226)" style="opacity: 1;"><g transform="translate(-16,-8)" class="label"><foreignobject width="32" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">国家</span></div></foreignobject></g></g><g class="edgeLabel" transform="translate(399,320)" style="opacity: 1;"><g transform="translate(-16,-8)" class="label"><foreignobject width="32" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">集团</span></div></foreignobject></g></g></g><g class="nodes"><g class="node" id="A" transform="translate(106,183)" style="opacity: 1;"><rect rx="5" ry="5" x="-86" y="-26" width="172" height="52"/><g class="label" transform="translate(0,0)"><g transform="translate(-76,-16)"><foreignobject width="152" height="32"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">一台计算机故障概率&gt;<br/>十台计算机五台故障</div></foreignobject></g></g></g><g class="node" id="B" transform="translate(316,183)" style="opacity: 1;"><rect rx="5" ry="5" x="-42" y="-18" width="84" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-32,-8)"><foreignobject width="64" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">共模故障</div></foreignobject></g></g></g><g class="node" id="C" transform="translate(538,46)" style="opacity: 1;"><rect rx="0" ry="0" x="-58" y="-26" width="116" height="52"/><g class="label" transform="translate(0,0)"><g transform="translate(-48,-16)"><foreignobject width="96" height="32"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">同代码客户端<br/>同个bug</div></foreignobject></g></g></g><g class="node" id="D" transform="translate(538,140)" style="opacity: 1;"><rect rx="0" ry="0" x="-98" y="-18" width="196" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-88,-8)"><foreignobject width="176" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">内部勾结影响协议, 团队</div></foreignobject></g></g></g><g class="node" id="E" transform="translate(538,226)" style="opacity: 1;"><rect rx="0" ry="0" x="-58" y="-18" width="116" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-48,-8)"><foreignobject width="96" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">国家接管矿场</div></foreignobject></g></g></g><g class="node" id="F" transform="translate(538,320)" style="opacity: 1;"><rect rx="0" ry="0" x="-98" y="-26" width="196" height="52"/><g class="label" transform="translate(0,0)"><g transform="translate(-88,-16)"><foreignobject width="176" height="32"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">一个权益证明的区块链中<br/>70%币由一个交易所持有</div></foreignobject></g></g></g></g></g></g></svg></div><ul><li>初级容错能力：关注架构层上的去中心化设计</li><li>系统长远升级和发展时的容错性：重视政治层上的去中心化</li></ul><h4 id="抗攻击性"><a class="markdownIt-Anchor" href="#抗攻击性"></a> 抗攻击性</h4><ul><li>攻防特点：攻防具有不对称性，<strong>攻击者往往更占优势</strong></li><li>示例：一个人的生命受到威胁，他的5000万很容易被抢走，但如果这5000万是十个人分散持有的，必须<strong>同一时间威胁勒索的人数瞬间放大十倍</strong></li></ul><p>得到的部分结论（未完全理解）：</p><ul><li>工作量证明机制（POW）不如权益证明机制（POS）更安全。POW需要<strong>挖矿计算机</strong>，POS针对权益证明即<strong>代币</strong>，币相对计算机更容易隐藏</li><li>开发区块链的团队分布的越广泛（包括地理位置）越有利</li><li>设计共识协议时需要同时考虑经济和容错模型</li></ul><h4 id="扛勾结性"><a class="markdownIt-Anchor" href="#扛勾结性"></a> 扛勾结性</h4><ul><li>定义：勾结就是<strong>我们所不喜欢的协调方式</strong><ul><li>理想状态下，每个人之间都有完美的协调</li><li>一部分人能完美协调，另一部分无法协调时情况就会变得危险</li></ul></li><li>反勾结就是<strong>尽可能避免节点之间相互协调</strong>，即假设一个区块链网络是由许多独立决策的节点组成的</li><li>很多社区（包括以太坊）之所以存在，是因为有一个强大的社区精神呢，在执行、发布和激活硬分叉上拥有快速协调的优势</li></ul><p>需要改善和培育良好的协调关系，防范糟糕的协调关系，防止“互相勾结”的演变，因此要做到以下三点：</p><ul><li>用协议的方式彻底消灭勾结</li><li>找到能更好发展且不足以勾结平衡点</li><li>让好的协调关系更容易，坏的协调关系更难（社会学挑战）</li></ul><p><strong>抗勾结性</strong>的<strong>去中心化</strong>可能是目前最<strong>难</strong>实现的</p><h3 id="感想与疑问"><a class="markdownIt-Anchor" href="#感想与疑问"></a> 感想与疑问</h3><h4 id="感想"><a class="markdownIt-Anchor" href="#感想"></a> 感想</h4><ul><li>三权分立之类的基本思想内容是不是包含了很接近去中心化的概念（……）</li><li>这篇感觉更多是社会学、经济学，而不是技术学的领域了</li></ul><h4 id="疑问"><a class="markdownIt-Anchor" href="#疑问"></a> 疑问</h4><ul><li>Multi-Master形式部署的话，架构上Master也有多个节点，可以忍受一定数量的破坏，政治层不谈，逻辑层上看起来也更像一个集群（注：系统分成两半问题可以用network partitions的方式来回答，如果两半都有主备节点，理论上可以继续运行），但这种部署我们还是说是中心化部署，为何？<s>因为他是你的Master吗？</s></li></ul><blockquote><p>Written with <a href="https://stackedit.io/" target="_blank" rel="external">StackEdit</a>.</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https://medium.com/@VitalikButerin/the-meaning-of-decentralization-a0c92b76a274&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Original&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https://media.weibo.cn/article?id=2309404214118084135438&amp;amp;jumpfrom=weibocom&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Translation&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;一篇比较好的去中心化叙述，特此笔记&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;如何判断去中心化&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#如何判断去中心化&quot;&gt;&lt;/a&gt; 如何判断去中心化&lt;/h3&gt;
    
    </summary>
    
      <category term="coding" scheme="http://blog.garenfeather.cn/categories/coding/"/>
    
    
      <category term="decentralization" scheme="http://blog.garenfeather.cn/tags/decentralization/"/>
    
      <category term="concept" scheme="http://blog.garenfeather.cn/tags/concept/"/>
    
      <category term="blockchain" scheme="http://blog.garenfeather.cn/tags/blockchain/"/>
    
  </entry>
  
  <entry>
    <title>nodejs开发环境下使用jsdom插件关于textContent的小bug</title>
    <link href="http://blog.garenfeather.cn/2018/02/22/nodejs-jsdom-plugin/"/>
    <id>http://blog.garenfeather.cn/2018/02/22/nodejs-jsdom-plugin/</id>
    <published>2018-02-22T12:11:18.000Z</published>
    <updated>2018-03-22T13:55:34.474Z</updated>
    
    <content type="html"><![CDATA[<h2 id="背景"><a class="markdownIt-Anchor" href="#背景"></a> 背景</h2><h3 id="我在干啥"><a class="markdownIt-Anchor" href="#我在干啥"></a> 我在干啥</h3><ul><li>markdown渲染引擎的markdown-it的mermaid插件开发中</li><li>开发中插件markdown-it-mermaid-x、插件依赖项目mermaid，测试项目testProject</li><li>项目A最终是在浏览器环境下运行的所以用到了document、window等js的DOM对象</li><li>为了优先验证B的代码正确与否（暂不考虑webpack打包等带来的bug），选择了个workaround的方案，在C中使用jsdom伪造一个DOM提供window和document</li></ul><a id="more"></a><h3 id="开发环境版本"><a class="markdownIt-Anchor" href="#开发环境版本"></a> 开发环境版本</h3><ul><li>node：v6.9.0</li><li>npm：3.10.8</li><li>jsdom：^11.6.2</li></ul><hr><h2 id="开发中"><a class="markdownIt-Anchor" href="#开发中"></a> 开发中</h2><h3 id="具体表现"><a class="markdownIt-Anchor" href="#具体表现"></a> 具体表现</h3><ul><li>通过<code>document.createElement('div')</code>新建一个div对象elt，给elt内容赋值部分：</li></ul><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JAVASCRIPT"><figure class="iseeu highlight /javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> elt = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>)</div><div class="line">elt.className = <span class="string">'mermaid'</span></div><div class="line">elt.innerText = code</div></pre></td></tr></table></figure></div><ul><li>取出值使用</li></ul><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JAVASCRIPT"><figure class="iseeu highlight /javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> txt = elt.textContent;</div></pre></td></tr></table></figure></div><ul><li>而经过验证，<code>console.log(txt)</code>输出的值为空</li><li>使用对应的如下写法值能正常输出</li></ul><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JAVASCRIPT"><figure class="iseeu highlight /javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> txt = elt.innerText;</div></pre></td></tr></table></figure></div><h3 id="分析"><a class="markdownIt-Anchor" href="#分析"></a> 分析</h3><ul><li><p>这部分的代码基本上是参考了同样使用了mermaid作为扩展的StackEdit的<a href="https://github.com/benweet/stackedit/blob/master/src/extensions/mermaidExtension.js" target="_blank" rel="external">mermaid扩展部分代码</a>的写法，</p></li><li><p>对比了一下我的代码部分与其区别应该只是使用了jsdom建了一个伪造的DOM</p></li><li><p>同时根据浏览器console里运行的结果<code>elt.innerText</code>与<code>elt.textContent</code>都能输出正确的结果</p></li><li><p>目前暂且记录下这个小bug，将来有机会深入研究再考虑提issue</p></li><li><p>后来进一步踩坑，<strong>大致上可以确定这个bug本身没有什么特别的</strong>，基本上是jsdom、d3、svg支持之间的问题了</p></li><li><p>d3项目似乎要求必须在浏览器环境下执行，而jsdom所模拟的浏览器环境缺乏对svg的相关支持（见jsdom的issue部分），因此一切基于jsdom模拟浏览器环境的插件皆不可用<br>，不再深入研究**</p></li></ul><h3 id="吐槽"><a class="markdownIt-Anchor" href="#吐槽"></a> 吐槽</h3><ul><li>╮(╯▽╰)╭找了半天才发现这里变空了，完全没想到</li><li>beyond compare都开了对比半天愣是没明白，一句一句对着改了半天才发现</li></ul><blockquote><p>Written with <a href="https://stackedit.io/" target="_blank" rel="external">StackEdit</a>.</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;背景&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#背景&quot;&gt;&lt;/a&gt; 背景&lt;/h2&gt;
&lt;h3 id=&quot;我在干啥&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#我在干啥&quot;&gt;&lt;/a&gt; 我在干啥&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;markdown渲染引擎的markdown-it的mermaid插件开发中&lt;/li&gt;
&lt;li&gt;开发中插件markdown-it-mermaid-x、插件依赖项目mermaid，测试项目testProject&lt;/li&gt;
&lt;li&gt;项目A最终是在浏览器环境下运行的所以用到了document、window等js的DOM对象&lt;/li&gt;
&lt;li&gt;为了优先验证B的代码正确与否（暂不考虑webpack打包等带来的bug），选择了个workaround的方案，在C中使用jsdom伪造一个DOM提供window和document&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="coding" scheme="http://blog.garenfeather.cn/categories/coding/"/>
    
    
      <category term="mermaid" scheme="http://blog.garenfeather.cn/tags/mermaid/"/>
    
      <category term="nodejs" scheme="http://blog.garenfeather.cn/tags/nodejs/"/>
    
      <category term="opensource" scheme="http://blog.garenfeather.cn/tags/opensource/"/>
    
      <category term="jsdom" scheme="http://blog.garenfeather.cn/tags/jsdom/"/>
    
  </entry>
  
  <entry>
    <title>Google家开源的puppeteer使用bug修复</title>
    <link href="http://blog.garenfeather.cn/2018/02/21/google-puppeteer-plugin-develop/"/>
    <id>http://blog.garenfeather.cn/2018/02/21/google-puppeteer-plugin-develop/</id>
    <published>2018-02-21T11:10:18.000Z</published>
    <updated>2018-03-22T14:04:35.254Z</updated>
    
    <content type="html"><![CDATA[<h2 id="使用及故障"><a class="markdownIt-Anchor" href="#使用及故障"></a> 使用及故障</h2><h3 id="在干啥"><a class="markdownIt-Anchor" href="#在干啥"></a> 在干啥</h3><ul><li>在开发mermaid插件（没错我还在持之以恒的死磕）过程中确认到mermaid渲染必须在有浏览器的情况下才能正确渲染，考虑了以下两种headless browser<ul><li>phantom，node插件为phantom，先考虑这个是因为用过PhantomJS，本机和服务器上也都有装。然而据说已经没人维护了（两年没出新版本？），跑起来也有很多迷之bug（API都找不全），遂放弃</li><li>puppeteer，mermaid的开发者有提供官方的cli工具行就是基于此开发的，至少可以确认可运行</li></ul></li></ul><a id="more"></a><h3 id="天坑故障系列集合"><a class="markdownIt-Anchor" href="#天坑故障系列集合"></a> 天坑故障系列集合</h3><h4 id="缺包"><a class="markdownIt-Anchor" href="#缺包"></a> 缺包</h4><p>首先项目里正常安装</p><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ npm i puppeteer --save</div></pre></td></tr></table></figure></div><p>安装过程没报错，运行demo的时候就开始爆炸了</p><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">Promise &#123;</div><div class="line">  &lt;pending&gt;,</div><div class="line">  domain: </div><div class="line">   Domain &#123;</div><div class="line">     domain: null,</div><div class="line">     _events: &#123; error: [Function: debugDomainError] &#125;,</div><div class="line">     _eventsCount: 1,</div><div class="line">     _maxListeners: undefined,</div><div class="line">     members: [] &#125; &#125;</div><div class="line">&gt; (node:65773) UnhandledPromiseRejectionWarning: Unhandled promise rejection (rejection id: 3): Error: Failed to launch chrome!</div><div class="line">/home/garen/Desktop/testProject/node_modules/puppeteer/.local-chromium/linux-536395/chrome-linux/chrome: error while loading shared libraries: libXss.so.1: cannot open shared object file: No such file or directory</div><div class="line"></div><div class="line"></div><div class="line">TROUBLESHOOTING: https://github.com/GoogleChrome/puppeteer/blob/master/docs/troubleshooting.md</div></pre></td></tr></table></figure></div><p>进入安装目录查看：</p><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ cd node_modules/puppeteer/.local-chromium/linux-536395/chrome-linux/</div></pre></td></tr></table></figure></div><p>检查bug的时候有小伙伴说可能是内核的原因，不过个人感觉更新内核还是要谨慎，顺便检查了下内核版本</p><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">$ cat /etc/*-release</div><div class="line">CentOS Linux release 7.2.1511 (Core) </div><div class="line">NAME=&quot;CentOS Linux&quot;</div><div class="line">VERSION=&quot;7 (Core)&quot;</div><div class="line">ID=&quot;centos&quot;</div><div class="line">ID_LIKE=&quot;rhel fedora&quot;</div><div class="line">VERSION_ID=&quot;7&quot;</div><div class="line">PRETTY_NAME=&quot;CentOS Linux 7 (Core)&quot;</div><div class="line">ANSI_COLOR=&quot;0;31&quot;</div><div class="line">CPE_NAME=&quot;cpe:/o:centos:centos:7&quot;</div><div class="line">HOME_URL=&quot;https://www.centos.org/&quot;</div><div class="line">BUG_REPORT_URL=&quot;https://bugs.centos.org/&quot;</div><div class="line"></div><div class="line">CENTOS_MANTISBT_PROJECT=&quot;CentOS-7&quot;</div><div class="line">CENTOS_MANTISBT_PROJECT_VERSION=&quot;7&quot;</div><div class="line">REDHAT_SUPPORT_PRODUCT=&quot;centos&quot;</div><div class="line">REDHAT_SUPPORT_PRODUCT_VERSION=&quot;7&quot;</div><div class="line"></div><div class="line">CentOS Linux release 7.2.1511 (Core) </div><div class="line">CentOS Linux release 7.2.1511 (Core)</div></pre></td></tr></table></figure></div><p>应该不需要……继续检查</p><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ ldd chrome | grep not</div><div class="line">./chrome: /lib64/libnss3.so: version `NSS_3.22&apos; not found (required by ./chrome)</div><div class="line">libXss.so.1 =&gt; not found</div></pre></td></tr></table></figure></div><p>可以发现有两个<code>not found</code>，一个个解决。重新运行了下上面的命令，定位一下</p><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">$ ldd chrome</div><div class="line">...</div><div class="line">linux-vdso.so.1 =&gt;  (0x00007ffcbbf62000)</div><div class="line">libpthread.so.0 =&gt; /lib64/libpthread.so.0 (0x00007f94b90a8000)</div><div class="line">libdl.so.2 =&gt; /lib64/libdl.so.2 (0x00007f94b8ea4000)</div><div class="line">librt.so.1 =&gt; /lib64/librt.so.1 (0x00007f94b8c9b000)</div><div class="line">libX11.so.6 =&gt; /lib64/libX11.so.6 (0x00007f94b895d000)</div><div class="line">...</div></pre></td></tr></table></figure></div><p>发现能够正常找到的so文件基本都在<code>/usr/lib</code>目录下，然后查找缺失的so文件：</p><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$ locate libXss.so.1</div><div class="line">/usr/lib/vmware-tools/lib32/libXss.so.1</div><div class="line">/usr/lib/vmware-tools/lib32/libXss.so.1/libXss.so.1</div><div class="line">/usr/lib/vmware-tools/lib64/libXss.so.1</div><div class="line">/usr/lib/vmware-tools/lib64/libXss.so.1/libXss.so.1</div></pre></td></tr></table></figure></div><p>……所以其实文件是有的，只是不在对的目录？试着把<code>vmware-tools</code>目录下的<code>libXss.so.1</code>移到<code>/usr/lib</code>目录下，并没有用。重新搜索，以下方案在我的虚拟机上成功：</p><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># yum install libXScrnSaver-1.2.2-6.1.el7.x86_64</div></pre></td></tr></table></figure></div><p>装完后再执行相同的命令，报错变成了：</p><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ ldd chrome | grep not</div><div class="line">./chrome: /lib64/libnss3.so: version `NSS_3.22&apos; not found (required by ./chrome)</div></pre></td></tr></table></figure></div><p>少了一个，继续试试……按照上面的<a href="https://github.com/GoogleChrome/puppeteer/blob/master/docs/troubleshooting.md" target="_blank" rel="external">troubleshooting</a>文件，一口气先确保安装了所有CentOS需要的依赖</p><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum install pango.x86_64 libXcomposite.x86_64 libXcursor.x86_64 libXdamage.x86_64 libXext.x86_64 libXi.x86_64 libXtst.x86_64 cups-libs.x86_64 libXScrnSaver.x86_64 libXrandr.x86_64 GConf2.x86_64 alsa-lib.x86_64 atk.x86_64 gtk3.x86_64 ipa-gothic-fonts xorg-x11-fonts-100dpi xorg-x11-fonts-75dpi xorg-x11-utils xorg-x11-fonts-cyrillic xorg-x11-fonts-Type1 xorg-x11-fonts-misc</div></pre></td></tr></table></figure></div><p>安装完还是老样子并没有回复╮(╯▽╰)╭，果然不会这么简单就解决的。看起来问题出在安装的<code>chromium</code>（从目录上看序号大概是***536395***？）上，试着换个puppeteer看看安装的版本会不会变化。查看<code>package.json</code>确认当前版本为<code>1.1.1</code>最新版，试着降到<code>1.1.0</code>、<code>1.0.0</code>版本</p><p>1.1.0版本安装过程部分如下：</p><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt; node install.js</div><div class="line"></div><div class="line">Downloading Chromium r536395 - 96.2 Mb [====================] 100% 0.0s</div></pre></td></tr></table></figure></div><p>从序号上可以发现还是同一款的chromium，降到1.0.0发现序号开始不同了：</p><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt; node install.js</div><div class="line"></div><div class="line">Downloading Chromium r526987 - 97.1 Mb [====================] 100% 0.0s</div></pre></td></tr></table></figure></div><p>安装好后再试一试，当然还是没什么卵用啦【微笑渐渐消失.jpg</p><p>继续艰苦的Google搜索，最后发现了看起来可靠的操作（跪谢这位大佬，好人一生平安）</p><p><img src="https://cdn.discordapp.com/attachments/420095259125743637/422016225879785487/QQ20180310210325.png" alt="enter image description here"></p><p>于是尝试了这个方法，这里国内的小伙伴们注意下，这个操作<strong>似乎需要挂代理</strong>（但是直接ping mirror.webtatic.com显示又正常，不太明白这里），不然会超时阻塞，报类似的错如下：</p><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Could not retrieve mirrorlist https://mirror.webtatic.com/yum/el7/x86_64/mirrorlist error was</div><div class="line">12: Timeout on https://mirror.webtatic.com/yum/el7/x86_64/mirrorlist: (28, &apos;Operation timed out after 30000 milliseconds with 0 out of 0 bytes received&apos;)</div></pre></td></tr></table></figure></div><p>我这里挂了proxychains4设置好的代理执行操作：</p><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"># proxychains4 yum provides */libnss3.so</div><div class="line">......</div><div class="line">nss-3.28.4-12.el7_4.x86_64 : Network Security Services</div><div class="line">Repo        : updates</div><div class="line">Matched from:</div><div class="line">Filename    : /usr/lib64/libnss3.so</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">nss-3.28.4-15.el7_4.i686 : Network Security Services</div><div class="line">Repo        : updates</div><div class="line">Matched from:</div><div class="line">Filename    : /usr/lib/libnss3.so</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">nss-3.28.4-15.el7_4.x86_64 : Network Security Services</div><div class="line">Repo        : updates</div><div class="line">Matched from:</div><div class="line">Filename    : /usr/lib64/libnss3.so</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">nss-3.28.4-15.el7_4.x86_64 : Network Security Services</div><div class="line">Repo        : @updates</div><div class="line">Matched from:</div><div class="line">Filename    : /usr/lib64/libnss3.so</div><div class="line">......</div></pre></td></tr></table></figure></div><p>选择了最新的一个match目录<code>/usr/lib64/libnss3.so</code>的版本，yum安装</p><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># yum install nss-3.28.4-15.el7_4.x86_64</div></pre></td></tr></table></figure></div><p>安装完后再执行操作检查，没有缺包了！哦也！(<sup>o</sup>)/</p><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ ldd chrome | grep not</div><div class="line">$</div></pre></td></tr></table></figure></div><h4 id="沙盒环境存在问题"><a class="markdownIt-Anchor" href="#沙盒环境存在问题"></a> 沙盒环境存在问题</h4><p>上面解决完后新的bug立刻就来：</p><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">(node:72791) UnhandledPromiseRejectionWarning: Unhandled promise rejection (rejection id: 1): Error: Failed to launch chrome!</div><div class="line">[0310/051527.838287:FATAL:zygote_host_impl_linux.cc(126)] No usable sandbox! Update your kernel or see https://chromium.googlesource.com/chromium/src/+/master/docs/linux_suid_sandbox_development.md for more information on developing with the SUID sandbox. If you want to live dangerously and need an immediate workaround, you can try using --no-sandbox.</div></pre></td></tr></table></figure></div><p>这个解决方案很清晰了，直接修改launch的参数</p><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JAVASCRIPT"><figure class="iseeu highlight /javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> browser = <span class="keyword">await</span> puppeteer.launch(&#123; <span class="attr">args</span>: [<span class="string">'--no-sandbox'</span>, <span class="string">'--disable-setuid-sandbox'</span>] &#125;);</div></pre></td></tr></table></figure></div><hr><h2 id="后记"><a class="markdownIt-Anchor" href="#后记"></a> 后记</h2><ul><li>都是一把辛酸泪啊……开源皆天坑果然是真理○|￣|_</li><li>要……有……耐……心</li><li>有时候是ZhenJiang不知道为这种乱七八糟的坑花费时间到底值不值啊Orz</li></ul><blockquote><p>Written with <a href="https://stackedit.io/" target="_blank" rel="external">StackEdit</a>.</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;使用及故障&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#使用及故障&quot;&gt;&lt;/a&gt; 使用及故障&lt;/h2&gt;
&lt;h3 id=&quot;在干啥&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#在干啥&quot;&gt;&lt;/a&gt; 在干啥&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;在开发mermaid插件（没错我还在持之以恒的死磕）过程中确认到mermaid渲染必须在有浏览器的情况下才能正确渲染，考虑了以下两种headless browser
&lt;ul&gt;
&lt;li&gt;phantom，node插件为phantom，先考虑这个是因为用过PhantomJS，本机和服务器上也都有装。然而据说已经没人维护了（两年没出新版本？），跑起来也有很多迷之bug（API都找不全），遂放弃&lt;/li&gt;
&lt;li&gt;puppeteer，mermaid的开发者有提供官方的cli工具行就是基于此开发的，至少可以确认可运行&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="coding" scheme="http://blog.garenfeather.cn/categories/coding/"/>
    
    
      <category term="puppeteer" scheme="http://blog.garenfeather.cn/tags/puppeteer/"/>
    
      <category term="google" scheme="http://blog.garenfeather.cn/tags/google/"/>
    
      <category term="mermaid" scheme="http://blog.garenfeather.cn/tags/mermaid/"/>
    
      <category term="nodejs" scheme="http://blog.garenfeather.cn/tags/nodejs/"/>
    
      <category term="opensource" scheme="http://blog.garenfeather.cn/tags/opensource/"/>
    
  </entry>
  
  <entry>
    <title>Paxos核心思想、流程、扩展与思考学习记录</title>
    <link href="http://blog.garenfeather.cn/2018/02/18/paxos-learn-extension/"/>
    <id>http://blog.garenfeather.cn/2018/02/18/paxos-learn-extension/</id>
    <published>2018-02-17T18:27:34.000Z</published>
    <updated>2018-03-23T02:23:45.564Z</updated>
    
    <content type="html"><![CDATA[<hr><ul><li>参考：<a href="https://www.zhihu.com/question/19787937/answer/82340987" target="_blank" rel="external">如何浅显易懂地解说 Paxos 的算法？</a></li></ul><h2 id="一致性基本内容"><a class="markdownIt-Anchor" href="#一致性基本内容"></a> 一致性基本内容</h2><h4 id="基础概念"><a class="markdownIt-Anchor" href="#基础概念"></a> 基础概念</h4><ul><li>允许一定数量进程挂掉</li><li>达成一致性是指<strong>半数以上同意</strong></li></ul><a id="more"></a><h3 id="三大核心要求"><a class="markdownIt-Anchor" href="#三大核心要求"></a> 三大核心要求</h3><ul><li>合法性（Validity）：达成一致性值value必须是由某个进程提出的</li><li>共识性（Consensus）：一旦就value值达成一致，不能再对另一个value达成一致</li><li>可终止性（Termination）：一致性总是能达成（非理论定义上，详见FLP问题，简而言之异步环境下任何一致性算法都存在永不终止的可能）</li></ul><h2 id="理解本质"><a class="markdownIt-Anchor" href="#理解本质"></a> 理解本质</h2><ul><li>一旦提案I达成一致性，<strong>任何比该提案ID更大的提案内容都会被“渲染”成提案I的内容</strong>，从而实际意义上结束流程。因为任意两个多数集合必然有交集，而达成一致的提案ID一定最大，在下一个提案中选取已回复的最大ID提案就必然会选中已达成一致的提案</li><li>从概念上看，对acceptor来说第一个提案无法拒绝，任意ID大于当前已接受提案的新提案也<strong>没有理由被拒绝</strong>，必须接受</li><li>注意一下<strong>提案ID与提案的值分离</strong>，提案ID是取决于proposer通过某种方式（例如已经得到实现的全局自增id）获得的ID，但其提案值取决于预提案阶段收到的acceptor们的返回值</li></ul><h2 id="流程"><a class="markdownIt-Anchor" href="#流程"></a> 流程</h2><ul><li><p>阶段一 预提案阶段：</p><ul><li><p>提议者Proposer：向接受者Acceptor广播预提案，附带接下来提案Proposal的proposal_id</p></li><li><p>接受者Acceptor：收到预提案后更新a_proposal_id = max(proposal_id,a_proposal_id)，如果预提案的proposal_id&gt;a_proposal_id，Acceptor回复记录的接受过的proposal_id最大的提案，并<strong>承诺</strong>不再接受比预提案中附带的proposal_id更小的提案</p></li></ul></li><li><p>阶段二 提案阶段：</p><ul><li><p>提议者Proposer：等待直到收到大多数接受者对预提案的回复，从所有回复的提案组成的法定数目的提案集合K中挑选proposal_id最大的提案，以该提案的值作为本次提案的值。如果K是空集，那么可以给提案任意赋值。然后把该提案广播给接受者们，<strong>提案和预提案共享同一个proposal_id</strong></p></li><li><p>接受者Acceptor：如果收到的提案的proposal_id&gt;= a.proposal_id，那么接受这个提案，更新a_proposal_id = max(proposal_id,a_proposal_id)，更新记录的提案</p></li></ul></li></ul><h2 id="扩展"><a class="markdownIt-Anchor" href="#扩展"></a> 扩展</h2><h3 id="理解误区"><a class="markdownIt-Anchor" href="#理解误区"></a> 理解误区</h3><ul><li>分清<strong>提案</strong>和<strong>预提案</strong>两个不同的阶段，<strong>预提案阶段不会接受提案</strong>，不同的proposer处于不同的阶段，一个proposer<strong>获得多数acceptor的响应后</strong>结束其预提案阶段</li><li>当前整个环境中不同proposer两个阶段混杂进行，而信息是进程间沟通的唯一手段，预提案<strong>本质</strong>上起了<strong>消息传递扩散</strong>的作用</li><li>算法结果不唯一，时间顺序对结果有很大的影响，一定程度上取决于<strong>谁能更快的走完整个流程</strong>，即最快争取到半数同意</li></ul><h3 id="活锁"><a class="markdownIt-Anchor" href="#活锁"></a> 活锁</h3><ul><li>流程</li></ul><div class="mermaid"><svg id="mermaid-svg-6845a148ba91f720" xmlns="http://www.w3.org/2000/svg" height="100%" viewbox="0 0 436 122.5" style="max-width:436px;"><style>  .mermaid .label{font-family:trebuchet ms,verdana,arial;color:#333}.node circle,.node ellipse,.node polygon,.node rect{fill:#cde498;stroke:#13540c;stroke-width:1px}.node.clickable{cursor:pointer}.arrowheadPath{fill:green}.edgePath .path{stroke:green;stroke-width:1.5px}.edgeLabel{background-color:#e8e8e8}.cluster rect{fill:#cdffb2!important;rx:4!important;stroke:#6eaa49!important;stroke-width:1px!important}.cluster text{fill:#333}.actor{stroke:#13540c;fill:#cde498}text.actor{fill:#000;stroke:none}.actor-line{stroke:grey}.messageLine0{marker-end:"url(#arrowhead)"}.messageLine0,.messageLine1{stroke-width:1.5;stroke-dasharray:"2 2";stroke:#333}#arrowhead{fill:#333}#crosshead path{fill:#333!important;stroke:#333!important}.messageText{fill:#333;stroke:none}.labelBox{stroke:#326932;fill:#cde498}.labelText,.loopText{fill:#000;stroke:none}.loopLine{stroke-width:2;stroke-dasharray:"2 2";marker-end:"url(#arrowhead)";stroke:#326932}.note{stroke:#6eaa49;fill:#fff5ad}.noteText{fill:#000;stroke:none;font-family:trebuchet ms,verdana,arial;font-size:14px}.section{stroke:none;opacity:.2}.section0,.section2{fill:#6eaa49}.section1,.section3{fill:#fff;opacity:.2}.sectionTitle0,.sectionTitle1,.sectionTitle2,.sectionTitle3{fill:#333}.sectionTitle{text-anchor:start;font-size:11px;text-height:14px}.grid .tick{stroke:#d3d3d3;opacity:.3;shape-rendering:crispEdges}.grid path{stroke-width:0}.today{fill:none;stroke:red;stroke-width:2px}.task{stroke-width:2}.taskText{text-anchor:middle;font-size:11px}.taskTextOutsideRight{fill:#000;text-anchor:start;font-size:11px}.taskTextOutsideLeft{fill:#000;text-anchor:end;font-size:11px}.taskText0,.taskText1,.taskText2,.taskText3{fill:#fff}.task0,.task1,.task2,.task3{fill:#487e3a;stroke:#13540c}.taskTextOutside0,.taskTextOutside1,.taskTextOutside2,.taskTextOutside3{fill:#000}.active0,.active1,.active2,.active3{fill:#cde498;stroke:#13540c}.activeText0,.activeText1,.activeText2,.activeText3{fill:#000!important}.done0,.done1,.done2,.done3{stroke:grey;fill:#d3d3d3;stroke-width:2}.doneText0,.doneText1,.doneText2,.doneText3{fill:#000!important}.crit0,.crit1,.crit2,.crit3{stroke:#f88;fill:red;stroke-width:2}.activeCrit0,.activeCrit1,.activeCrit2,.activeCrit3{stroke:#f88;fill:#cde498;stroke-width:2}.doneCrit0,.doneCrit1,.doneCrit2,.doneCrit3{stroke:#f88;fill:#d3d3d3;stroke-width:2;cursor:pointer;shape-rendering:crispEdges}.activeCritText0,.activeCritText1,.activeCritText2,.activeCritText3,.doneCritText0,.doneCritText1,.doneCritText2,.doneCritText3{fill:#000!important}.titleText{text-anchor:middle;font-size:18px;fill:#000}g.classGroup text{fill:#13540c;stroke:none;font-family:trebuchet ms,verdana,arial;font-size:10px}g.classGroup rect{fill:#cde498;stroke:#13540c}g.classGroup line{stroke:#13540c;stroke-width:1}svg .classLabel .box{stroke:none;stroke-width:0;fill:#cde498;opacity:.5}svg .classLabel .label{fill:#13540c;font-size:10px}.relation{stroke:#13540c;stroke-width:1;fill:none}#compositionEnd,#compositionStart,.composition{fill:#13540c;stroke:#13540c;stroke-width:1}#aggregationEnd,#aggregationStart,.aggregation{fill:#cde498;stroke:#13540c;stroke-width:1}#dependencyEnd,#dependencyStart,#extensionEnd,#extensionStart{fill:#13540c;stroke:#13540c;stroke-width:1}.node text{font-size:14px}.node text,div.mermaidTooltip{font-family:trebuchet ms,verdana,arial}div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-size:12px;background:#cdffb2;border:1px solid #6eaa49;border-radius:2px;pointer-events:none;z-index:100}svg {  color: rgb(0, 0, 0);  font: normal normal 400 normal 16px / normal "Times New Roman";}  </style><g><g class="output"><g class="clusters"/><g class="edgePaths"><g class="edgePath" style="opacity: 1;"><path class="path" d="M112,47.33098591549296L137,38L162,38" marker-end="url(#arrowhead16)" style="fill:none"/><defs><marker id="arrowhead16" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M286,38L311,38L336,50.04545454545455" marker-end="url(#arrowhead17)" style="fill:none"/><defs><marker id="arrowhead17" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M336,78.95454545454545L311,91L224,91L137,91L112,81.66901408450704" marker-end="url(#arrowhead18)" style="fill:none"/><defs><marker id="arrowhead18" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g></g><g class="edgeLabels"><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"/></div></foreignobject></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"/></div></foreignobject></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"/></div></foreignobject></g></g></g><g class="nodes"><g class="node" id="提案i提出" transform="translate(66,64.5)" style="opacity: 1;"><rect rx="0" ry="0" x="-46" y="-18" width="92" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-36,-8)"><foreignobject width="72" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">提案i提出</div></foreignobject></g></g></g><g class="node" id="预提案i+1截胡" transform="translate(224,38)" style="opacity: 1;"><rect rx="0" ry="0" x="-62" y="-18" width="124" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-52,-8)"><foreignobject width="104" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">预提案i+1截胡</div></foreignobject></g></g></g><g class="node" id="i=i+1" transform="translate(366,64.5)" style="opacity: 1;"><rect rx="0" ry="0" x="-30" y="-18" width="60" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-20,-8)"><foreignobject width="40" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">i=i+1</div></foreignobject></g></g></g></g></g></g></svg></div><ul><li>这一般是纯理论上的问题，实际工程应用上分布式系统应该并不会出现如此“有序”的场景（一环扣一环，卡死提案的通过提交），而且若进程数总量一定，最终递归还是会被停止的？</li></ul><h3 id="其他工程实现细节待补充"><a class="markdownIt-Anchor" href="#其他工程实现细节待补充"></a> 其他工程实现细节（待补充）</h3><ul><li><p>全局唯一自增ID</p></li></ul><blockquote><p>Written with <a href="https://stackedit.io/" target="_blank" rel="external">StackEdit</a>.</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
&lt;ul&gt;
&lt;li&gt;参考：&lt;a href=&quot;https://www.zhihu.com/question/19787937/answer/82340987&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;如何浅显易懂地解说 Paxos 的算法？&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;一致性基本内容&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#一致性基本内容&quot;&gt;&lt;/a&gt; 一致性基本内容&lt;/h2&gt;
&lt;h4 id=&quot;基础概念&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#基础概念&quot;&gt;&lt;/a&gt; 基础概念&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;允许一定数量进程挂掉&lt;/li&gt;
&lt;li&gt;达成一致性是指&lt;strong&gt;半数以上同意&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="coding" scheme="http://blog.garenfeather.cn/categories/coding/"/>
    
    
      <category term="distributed" scheme="http://blog.garenfeather.cn/tags/distributed/"/>
    
      <category term="paxos" scheme="http://blog.garenfeather.cn/tags/paxos/"/>
    
      <category term="algorithm" scheme="http://blog.garenfeather.cn/tags/algorithm/"/>
    
      <category term="consistency" scheme="http://blog.garenfeather.cn/tags/consistency/"/>
    
  </entry>
  
  <entry>
    <title>开放后端答题（2）——语言、堆栈、工作流、溢出与泄漏</title>
    <link href="http://blog.garenfeather.cn/2018/02/15/backend-schedule-02/"/>
    <id>http://blog.garenfeather.cn/2018/02/15/backend-schedule-02/</id>
    <published>2018-02-15T10:12:44.000Z</published>
    <updated>2018-03-23T18:58:38.146Z</updated>
    
    <content type="html"><![CDATA[<h3 id="五-语言相关问题"><a class="markdownIt-Anchor" href="#五-语言相关问题"></a> 五、语言相关问题</h3><h4 id="告诉我你的首选语言的三个最坏的缺陷"><a class="markdownIt-Anchor" href="#告诉我你的首选语言的三个最坏的缺陷"></a> 告诉我你的首选语言的三个最坏的缺陷</h4><ul><li>Python语言<ul><li>动态</li><li>弱类型</li><li>运行速度限制</li></ul></li></ul><a id="more"></a><h4 id="什么是栈什么是堆"><a class="markdownIt-Anchor" href="#什么是栈什么是堆"></a> 什么是栈？什么是堆？</h4><ul><li>栈（Stack）在中文中又被称为堆栈，但其实堆和栈是两个数据结构，中文语境下要注意区分，同时也要注意在讨论***数据结构***和***计算机内存***时的堆与栈有一定的区别，堆的区别比较明显</li><li>栈为标准的LIFO后进先出，经典操作即push和pop</li><li>堆（Heap）通常是一个<strong>可以被看做一棵树</strong>的<strong>数组</strong>对象，堆总是一棵完全树（其节点序号能与相应的最大满二叉树完全对应）。通常说的堆是指二叉堆，属于二叉树的一种。所有节点都比后续节点大/小的堆叫最大/小堆<ul><li>结构（完全树二叉树示例，节点序号为数组下标）</li></ul></li></ul><div class="mermaid"><svg id="mermaid-svg-8e545ae7c5dc4afc" xmlns="http://www.w3.org/2000/svg" height="100%" viewbox="0 0 322 354" style="max-width:322px;"><style>  .mermaid .label{font-family:trebuchet ms,verdana,arial;color:#333}.node circle,.node ellipse,.node polygon,.node rect{fill:#cde498;stroke:#13540c;stroke-width:1px}.node.clickable{cursor:pointer}.arrowheadPath{fill:green}.edgePath .path{stroke:green;stroke-width:1.5px}.edgeLabel{background-color:#e8e8e8}.cluster rect{fill:#cdffb2!important;rx:4!important;stroke:#6eaa49!important;stroke-width:1px!important}.cluster text{fill:#333}.actor{stroke:#13540c;fill:#cde498}text.actor{fill:#000;stroke:none}.actor-line{stroke:grey}.messageLine0{marker-end:"url(#arrowhead)"}.messageLine0,.messageLine1{stroke-width:1.5;stroke-dasharray:"2 2";stroke:#333}#arrowhead{fill:#333}#crosshead path{fill:#333!important;stroke:#333!important}.messageText{fill:#333;stroke:none}.labelBox{stroke:#326932;fill:#cde498}.labelText,.loopText{fill:#000;stroke:none}.loopLine{stroke-width:2;stroke-dasharray:"2 2";marker-end:"url(#arrowhead)";stroke:#326932}.note{stroke:#6eaa49;fill:#fff5ad}.noteText{fill:#000;stroke:none;font-family:trebuchet ms,verdana,arial;font-size:14px}.section{stroke:none;opacity:.2}.section0,.section2{fill:#6eaa49}.section1,.section3{fill:#fff;opacity:.2}.sectionTitle0,.sectionTitle1,.sectionTitle2,.sectionTitle3{fill:#333}.sectionTitle{text-anchor:start;font-size:11px;text-height:14px}.grid .tick{stroke:#d3d3d3;opacity:.3;shape-rendering:crispEdges}.grid path{stroke-width:0}.today{fill:none;stroke:red;stroke-width:2px}.task{stroke-width:2}.taskText{text-anchor:middle;font-size:11px}.taskTextOutsideRight{fill:#000;text-anchor:start;font-size:11px}.taskTextOutsideLeft{fill:#000;text-anchor:end;font-size:11px}.taskText0,.taskText1,.taskText2,.taskText3{fill:#fff}.task0,.task1,.task2,.task3{fill:#487e3a;stroke:#13540c}.taskTextOutside0,.taskTextOutside1,.taskTextOutside2,.taskTextOutside3{fill:#000}.active0,.active1,.active2,.active3{fill:#cde498;stroke:#13540c}.activeText0,.activeText1,.activeText2,.activeText3{fill:#000!important}.done0,.done1,.done2,.done3{stroke:grey;fill:#d3d3d3;stroke-width:2}.doneText0,.doneText1,.doneText2,.doneText3{fill:#000!important}.crit0,.crit1,.crit2,.crit3{stroke:#f88;fill:red;stroke-width:2}.activeCrit0,.activeCrit1,.activeCrit2,.activeCrit3{stroke:#f88;fill:#cde498;stroke-width:2}.doneCrit0,.doneCrit1,.doneCrit2,.doneCrit3{stroke:#f88;fill:#d3d3d3;stroke-width:2;cursor:pointer;shape-rendering:crispEdges}.activeCritText0,.activeCritText1,.activeCritText2,.activeCritText3,.doneCritText0,.doneCritText1,.doneCritText2,.doneCritText3{fill:#000!important}.titleText{text-anchor:middle;font-size:18px;fill:#000}g.classGroup text{fill:#13540c;stroke:none;font-family:trebuchet ms,verdana,arial;font-size:10px}g.classGroup rect{fill:#cde498;stroke:#13540c}g.classGroup line{stroke:#13540c;stroke-width:1}svg .classLabel .box{stroke:none;stroke-width:0;fill:#cde498;opacity:.5}svg .classLabel .label{fill:#13540c;font-size:10px}.relation{stroke:#13540c;stroke-width:1;fill:none}#compositionEnd,#compositionStart,.composition{fill:#13540c;stroke:#13540c;stroke-width:1}#aggregationEnd,#aggregationStart,.aggregation{fill:#cde498;stroke:#13540c;stroke-width:1}#dependencyEnd,#dependencyStart,#extensionEnd,#extensionStart{fill:#13540c;stroke:#13540c;stroke-width:1}.node text{font-size:14px}.node text,div.mermaidTooltip{font-family:trebuchet ms,verdana,arial}div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-size:12px;background:#cdffb2;border:1px solid #6eaa49;border-radius:2px;pointer-events:none;z-index:100}svg {  color: rgb(0, 0, 0);  font: normal normal 400 normal 16px / normal "Times New Roman";}  </style><g><g class="output"><g class="clusters"/><g class="edgePaths"><g class="edgePath" style="opacity: 1;"><path class="path" d="M137,45.717948717948715L73,81L73,106" marker-end="url(#arrowhead21)" style="fill:none"/><defs><marker id="arrowhead21" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M165,45.717948717948715L229,81L229,106" marker-end="url(#arrowhead22)" style="fill:none"/><defs><marker id="arrowhead22" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M59,139.43589743589743L34,167L34,192" marker-end="url(#arrowhead23)" style="fill:none"/><defs><marker id="arrowhead23" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M87,139.43589743589743L112,167L112,192" marker-end="url(#arrowhead24)" style="fill:none"/><defs><marker id="arrowhead24" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M215,139.43589743589743L190,167L190,192" marker-end="url(#arrowhead25)" style="fill:none"/><defs><marker id="arrowhead25" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M243,139.43589743589743L268,167L268,192" marker-end="url(#arrowhead26)" style="fill:none"/><defs><marker id="arrowhead26" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M34,228L34,253L34,278" marker-end="url(#arrowhead27)" style="fill:none"/><defs><marker id="arrowhead27" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g></g><g class="edgeLabels"><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"/></div></foreignobject></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"/></div></foreignobject></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"/></div></foreignobject></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"/></div></foreignobject></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"/></div></foreignobject></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"/></div></foreignobject></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"/></div></foreignobject></g></g></g><g class="nodes"><g class="node" id="0" transform="translate(151,38)" style="opacity: 1;"><rect rx="0" ry="0" x="-14" y="-18" width="28" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-4,-8)"><foreignobject width="8" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">0</div></foreignobject></g></g></g><g class="node" id="1" transform="translate(73,124)" style="opacity: 1;"><rect rx="0" ry="0" x="-14" y="-18" width="28" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-4,-8)"><foreignobject width="8" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">1</div></foreignobject></g></g></g><g class="node" id="2" transform="translate(229,124)" style="opacity: 1;"><rect rx="0" ry="0" x="-14" y="-18" width="28" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-4,-8)"><foreignobject width="8" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">2</div></foreignobject></g></g></g><g class="node" id="3" transform="translate(34,210)" style="opacity: 1;"><rect rx="0" ry="0" x="-14" y="-18" width="28" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-4,-8)"><foreignobject width="8" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">3</div></foreignobject></g></g></g><g class="node" id="4" transform="translate(112,210)" style="opacity: 1;"><rect rx="0" ry="0" x="-14" y="-18" width="28" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-4,-8)"><foreignobject width="8" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">4</div></foreignobject></g></g></g><g class="node" id="5" transform="translate(190,210)" style="opacity: 1;"><rect rx="0" ry="0" x="-14" y="-18" width="28" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-4,-8)"><foreignobject width="8" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">5</div></foreignobject></g></g></g><g class="node" id="6" transform="translate(268,210)" style="opacity: 1;"><rect rx="0" ry="0" x="-14" y="-18" width="28" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-4,-8)"><foreignobject width="8" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">6</div></foreignobject></g></g></g><g class="node" id="7" transform="translate(34,296)" style="opacity: 1;"><rect rx="0" ry="0" x="-14" y="-18" width="28" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-4,-8)"><foreignobject width="8" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">7</div></foreignobject></g></g></g></g></g></g></svg></div><pre><code>* 堆操作</code></pre><table><thead><tr><th style="text-align:center">操作</th><th style="text-align:center">说明</th></tr></thead><tbody><tr><td style="text-align:center">build</td><td style="text-align:center">创建一个空堆</td></tr><tr><td style="text-align:center">insert</td><td style="text-align:center">向堆中插入一个新的元素</td></tr><tr><td style="text-align:center">update</td><td style="text-align:center">将新元素提升使其匹配堆的性质</td></tr><tr><td style="text-align:center">delete</td><td style="text-align:center">删除堆顶元素</td></tr><tr><td style="text-align:center">get</td><td style="text-align:center">获取堆顶元素</td></tr><tr><td style="text-align:center">heapify</td><td style="text-align:center">删除堆顶元素后使之再次符合堆的数据结构关系</td></tr></tbody></table><ul><li><p>堆与栈都是可以被认为是一种特殊结构的数组，即是说可以通过数组配合相应的限制可以实现这两数据结构（当然还有链表的部分性质）</p></li><li><p>对一般的运行程序来说，<strong>堆</strong>通常都是用来<strong>存储对象</strong>的，而<strong>栈</strong>通常用于<strong>运行程序</strong></p><ul><li>栈本身后进先出的数据结构与函数调用，嵌套运行的结构相符，因此用于运行程序，而通常局部的、临时的变量分配也都在栈上</li><li>注意堆在计算机内存中的结构与数据结构的堆有很大区别。以C++为例，<strong>堆空间</strong>通常是<strong>不连续</strong>的，结构更接近链表而不是数组，受物理内存限制，<strong>效率</strong>要比栈<strong>低</strong>得多</li><li>基于两者特性，再综合一下程序运行所需内容：编译好的二进制代码、对象、（静态）变量、常量等，就不难理解Java（程序计数器，方法区，虚拟机栈，本地方法栈，Java堆）或C++（堆区，栈区，全局静态区，常量区，程序代码区）中的内存划分依据了</li></ul></li><li><p>协议栈（Protocol Stack）的“栈”的概念与上述的基本没有太大关系，不做详细介绍</p></li></ul><hr><h3 id="七-代码版本管理相关问题"><a class="markdownIt-Anchor" href="#七-代码版本管理相关问题"></a> 七、代码版本管理相关问题</h3><h4 id="能描述下什么是githubflow和gitflow工作流吗"><a class="markdownIt-Anchor" href="#能描述下什么是githubflow和gitflow工作流吗"></a> 能描述下什么是GithubFlow和GitFlow工作流吗？</h4><ul><li><p>这两种都是基于分支，为协同开发而创造的工作流。除了主干分支，其他分支主要用于功能开发、修复bug等等，基本上新分支完成其任务后会合并到主干分支，主干分支的核心目的是发布与部署</p></li><li><p>GitFlow的特性适用于<strong>版本发布</strong>，一般来说有master和develop两个主要分支，辅助分支包括hotfix、feature、release等等，develop分支是主要开发分支，开发完成后合并到此分支，发布成功后合并到master分支</p></li><li><p>GithubFlow的特征则适用于“敏捷开发”等，即随时<strong>修改完代码随时发布</strong>的流程模式，<strong>没有develop分支</strong>，但是若考虑到代码合并进master分支与线上发布未必在同一时间（例如对master主干代码的大规模回归测试，到指定日期才发布等）</p></li><li><p>各处常见的资料介绍经常将Pull Request放到GithubFlow中介绍，但实际上Pull Request可以跟包括这两者在内的其他各种诸如ForKing工作流一起协作</p></li><li><p>PS:there is no difference in the GitHub flow between a hotfix and a very small feature.</p></li><li><p>这两种工作流模式都是<strong>针对单一仓库</strong>的，而ForKing工作流在于其<strong>分布式</strong>工作的特性，即每个开发者在<strong>自己的仓库</strong>、自己的分支上完成相应开发，其明显的优势是项目维护者<strong>可以接受任何开发者的提交</strong>，但<strong>无需给他正式代码库的写权限</strong></p></li></ul><hr><h3 id="九-逻辑和算法相关问题"><a class="markdownIt-Anchor" href="#九-逻辑和算法相关问题"></a> 九、逻辑和算法相关问题？</h3><h4 id="写一段有栈溢出的代码"><a class="markdownIt-Anchor" href="#写一段有栈溢出的代码"></a> 写一段有栈溢出的代码</h4><ul><li><p>内存溢出（参考java）：栈溢出（StackOverFlow）、堆溢出（OutOfMemoryError）。结合堆与栈通常在程序中的用法，堆用于分配对象，那么只要永不停息的分配新对象不回收自然会堆溢出；而栈如果作为函数调用栈则深度有限，那么只要不断深入调用（最经典操作：无限递归），自然会栈溢出</p></li><li><p>栈溢出：</p></li></ul><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JAVA"><figure class="iseeu highlight /java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sofMethod</span><span class="params">()</span></span>&#123;</div><div class="line">    depth ++ ;</div><div class="line">    sofMethod();</div><div class="line">&#125;</div></pre></td></tr></table></figure></div><ul><li>堆溢出：</li></ul><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JAVA"><figure class="iseeu highlight /java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sofMethod</span><span class="params">()</span></span>&#123;</div><div class="line">    List&lt;<span class="keyword">byte</span>[]&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">    <span class="keyword">int</span> i=<span class="number">0</span>;</div><div class="line">    <span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</div><div class="line">        list.add(<span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">5</span>*<span class="number">1024</span>*<span class="number">1024</span>]);</div><div class="line">        System.out.println(<span class="string">"分配次数："</span>+(++i));</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></div><h4 id="写一段有内存泄漏memory-leak的示例代码"><a class="markdownIt-Anchor" href="#写一段有内存泄漏memory-leak的示例代码"></a> 写一段有内存泄漏（Memory Leak）的示例代码</h4><ul><li>注意区分内存溢出和内存泄漏，关键在于<strong>溢出（Overflow）</strong> 和 <strong>泄漏（Leak）</strong> 两个概念要区别开来，同样概念适用于栈/堆溢出等</li></ul><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="C"><figure class="iseeu highlight /c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">char</span> *c;</div><div class="line">    c=(<span class="keyword">char</span>*)<span class="built_in">malloc</span>(<span class="number">256</span>*<span class="keyword">sizeof</span>(<span class="keyword">char</span>));</div><div class="line">    <span class="comment">//这里分配的内存没有回收，且后续无法控制，虽然程序不会崩溃，但符合定义</span></div><div class="line">    c=(<span class="keyword">char</span>*)<span class="built_in">malloc</span>(<span class="number">256</span>*<span class="keyword">sizeof</span>(<span class="keyword">char</span>));</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></div><blockquote><p>Written with <a href="https://stackedit.io/" target="_blank" rel="external">StackEdit</a>.</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;五-语言相关问题&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#五-语言相关问题&quot;&gt;&lt;/a&gt; 五、语言相关问题&lt;/h3&gt;
&lt;h4 id=&quot;告诉我你的首选语言的三个最坏的缺陷&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#告诉我你的首选语言的三个最坏的缺陷&quot;&gt;&lt;/a&gt; 告诉我你的首选语言的三个最坏的缺陷&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;Python语言
&lt;ul&gt;
&lt;li&gt;动态&lt;/li&gt;
&lt;li&gt;弱类型&lt;/li&gt;
&lt;li&gt;运行速度限制&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="coding" scheme="http://blog.garenfeather.cn/categories/coding/"/>
    
    
      <category term="backend" scheme="http://blog.garenfeather.cn/tags/backend/"/>
    
      <category term="language" scheme="http://blog.garenfeather.cn/tags/language/"/>
    
      <category term="workflow" scheme="http://blog.garenfeather.cn/tags/workflow/"/>
    
      <category term="overflow" scheme="http://blog.garenfeather.cn/tags/overflow/"/>
    
      <category term="leak" scheme="http://blog.garenfeather.cn/tags/leak/"/>
    
  </entry>
  
  <entry>
    <title>Ghost文档翻译——开发模式启动命令对比</title>
    <link href="http://blog.garenfeather.cn/2018/02/03/ghost-docs-partly-translation/"/>
    <id>http://blog.garenfeather.cn/2018/02/03/ghost-docs-partly-translation/</id>
    <published>2018-02-03T15:35:29.000Z</published>
    <updated>2018-02-03T16:55:43.249Z</updated>
    
    <content type="html"><![CDATA[<hr><p>原文：<a href="https://docs.ghost.org/docs/working-with-ghost" target="_blank" rel="external">working-with-ghost</a><br>翻译部分：</p><ul><li>Day-to-day Development Commands<ul><li>Running Ghost</li></ul></li></ul><h3 id="日常频繁使用的开发命令"><a class="markdownIt-Anchor" href="#日常频繁使用的开发命令"></a> 日常频繁使用的开发命令</h3><h4 id="运行ghost"><a class="markdownIt-Anchor" href="#运行ghost"></a> 运行Ghost</h4><p>Ghost有多种启动方式，每种都各有利弊，这些方式在默认条件下都会从http://localhost:2368./启动Ghost服务</p><a id="more"></a><ul><li><p>grunt dev</p><ul><li>开发模式下最常见的Ghost启动方式</li><li>服务启动时编译构建client文件</li><li>监听server文件，有变化自动重启</li><li>监听client文件，文件变化时敏捷重建，变化包括文件的实时重载</li></ul></li><li><p>grunt dev --server</p><ul><li>启动时不编译client文件，也不监听其变化，其他与上一条命令</li><li>请确保client文件已编译，或者保证其内容为最新（见 <a href="https://docs.ghost.org/docs/working-with-ghost#grunt-build" target="_blank" rel="external">grunt build</a>）</li><li>在确保你不修改client文件的情况下这样有利于最小化启动时间，保存系统资源</li></ul></li><li><p>grunt prod</p><ul><li>生产模式下启动，启动时编译client文件</li><li>既不监听server文件也不监听client文件</li><li>相当于以npm start --production命令启动Ghost</li></ul></li><li><p>node index.js</p><ul><li>单纯的启动Ghost服务器，不构建client，不监听文件变化也不自动重启服务</li><li>当你只想快速启动服务，且不介意手动修改文件要重启服务时适合此命令</li><li><strong>不构建client文件</strong> &amp; 可能会导致后台系统一片空白（见 <a href="https://docs.ghost.org/docs/working-with-ghost#grunt-build" target="_blank" rel="external">grunt build</a>）</li></ul></li></ul><blockquote><p>Written with <a href="https://stackedit.io/" target="_blank" rel="external">StackEdit</a>.</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
&lt;p&gt;原文：&lt;a href=&quot;https://docs.ghost.org/docs/working-with-ghost&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;working-with-ghost&lt;/a&gt;&lt;br&gt;
翻译部分：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Day-to-day Development Commands
&lt;ul&gt;
&lt;li&gt;Running Ghost&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;日常频繁使用的开发命令&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#日常频繁使用的开发命令&quot;&gt;&lt;/a&gt; 日常频繁使用的开发命令&lt;/h3&gt;
&lt;h4 id=&quot;运行ghost&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#运行ghost&quot;&gt;&lt;/a&gt; 运行Ghost&lt;/h4&gt;
&lt;p&gt;Ghost有多种启动方式，每种都各有利弊，这些方式在默认条件下都会从http://localhost:2368./启动Ghost服务&lt;/p&gt;
    
    </summary>
    
      <category term="translation" scheme="http://blog.garenfeather.cn/categories/translation/"/>
    
    
      <category term="ghost" scheme="http://blog.garenfeather.cn/tags/ghost/"/>
    
      <category term="blog" scheme="http://blog.garenfeather.cn/tags/blog/"/>
    
      <category term="grunt" scheme="http://blog.garenfeather.cn/tags/grunt/"/>
    
      <category term="npm" scheme="http://blog.garenfeather.cn/tags/npm/"/>
    
      <category term="node" scheme="http://blog.garenfeather.cn/tags/node/"/>
    
  </entry>
  
  <entry>
    <title>开放后端答题（1）——流、自动化、事务、单例</title>
    <link href="http://blog.garenfeather.cn/2018/02/01/backend-schedule-01/"/>
    <id>http://blog.garenfeather.cn/2018/02/01/backend-schedule-01/</id>
    <published>2018-02-01T03:12:36.000Z</published>
    <updated>2018-03-22T21:34:11.899Z</updated>
    
    <content type="html"><![CDATA[<h3 id="二-开放式问题"><a class="markdownIt-Anchor" href="#二-开放式问题"></a> 二、开放式问题</h3><h4 id="解释什么是流streaming和如何实现一个流"><a class="markdownIt-Anchor" href="#解释什么是流streaming和如何实现一个流"></a> 解释什么是流(streaming)和如何实现一个流？</h4><a id="more"></a><ul><li><p>解释</p><ul><li><p>这里注意一下这个概念是Stream，而不是Flow，Flow一般常见于网络流（Network Flow）。两者中文翻译都是“流”，但概念不同</p></li><li><p>根据维基百科，流的一般概念是一个包含资料的序列，理论上具有<strong>无限</strong>、一个接一个（“个”可以是一个字节，一个bit等各种基本数据单元）的特质，区别于将资料包作一整个来进行处理的输送带</p></li><li><p>在计算机里是顺序读取或写入的字节序列，能<strong>统一描述</strong>所有常见输入输出类型的模型，而统一描述之后，相同的程序就可以通过输入输出重定向来处理不同的对象（多态思想）。原本基于分组交换的网络IO在经典的TCP协议设计出来后，大部分也都能用流的模型来描述</p></li><li><p>能体现出流的经典的几种常见应用概念包括过滤器（filters）、重定向（redirect）管道（pipeline）以及懒加载（lazy loading）等</p></li></ul></li><li><p>实现</p><ul><li>一个流实现需要包含容器、来源以及数据等</li><li>对外暴露接口</li></ul></li></ul><h4 id="在你当前的工作流中什么事情是你计划下一步需要自动化的"><a class="markdownIt-Anchor" href="#在你当前的工作流中什么事情是你计划下一步需要自动化的"></a> 在你当前的工作流中，什么事情是你计划下一步需要自动化的？</h4><ul><li><p>我们有一个产品的功能是发送消息，消息发送设置项多且复杂，目前开发过程中都是手动在点击设置发送，频繁重复同样的操作非常浪费时间，希望一个脚本启动就能设置完所有然后发送</p></li><li><p>初步设想的技术栈是 Python+PhantomJS+Selenium 模拟点击过程，以win下exe的形式运行，如果选项className或idName有规律可以考虑做成命令行形式？</p></li><li><p>缺点是根据之前使用的经验selenium控制不好有一定的崩溃几率，暂时不知道解决方式</p></li></ul><hr><h3 id="三-设计模式相关问题"><a class="markdownIt-Anchor" href="#三-设计模式相关问题"></a> 三、设计模式相关问题</h3><h4 id="假设你工作的系统不支持事务性你会如何从头开始实现它"><a class="markdownIt-Anchor" href="#假设你工作的系统不支持事务性你会如何从头开始实现它"></a> 假设你工作的系统不支持事务性，你会如何从头开始实现它？</h4><ul><li><p>事务性本质上可以认为是<strong>原子操作的进一步原子封装</strong>，因此实现的关键还是在于系统当前拥有的原子操作级别（理论上最基础至少在Linux支持基本C的相关库），需要封装的原子操作级别（例如：参考MySQL的数据库事务级别包括Read Uncommitted、Read Committed、Repeatable Read、Serializable等）</p></li><li><p>从事务角度来说若要保证最强一致性，当然可以把数据都锁起来，但这样势必会严重影响并发性能。而除了<strong>一致性强度要求</strong>问题，还有另一个考量是<strong>分段锁数据</strong>，这就对<strong>锁的类型、范围</strong>有要求</p></li><li><p>首先一个<strong>最基本的锁单元</strong>实现方式：（具体代码见代码小全的锁实现），实现了一个基本的锁模块，就可以针对几种常见事务问题来进一步升级锁（例如：解决脏读，不可重复读，幻读等），参考InnoDB引擎，解决幻读可以使用<strong>区间锁</strong>，锁住一部分行范围，不允许其中插入新的数据，在此期间，其它冲突事务会被阻塞</p></li><li><p>涉及重要概念：读、写、计算、一致性、锁、原子操作、数据分段锁</p></li></ul><h4 id="写一个线程安全的单例类"><a class="markdownIt-Anchor" href="#写一个线程安全的单例类"></a> 写一个线程安全的单例类</h4><ul><li><p>此处使用java代码作为实例</p></li><li><p>懒汉式（线程安全，<strong>低效率</strong>）</p></li></ul><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JAVA"><figure class="iseeu highlight /java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">static</span> Singleton instance;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> Singleton <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span>(instance == <span class="keyword">null</span>) &#123;</div><div class="line">            instance = <span class="keyword">new</span> Singleton();</div><div class="line">            <span class="comment">//这一句并不是一个原子操作，因此需要volatile禁止重排序</span></div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> instance;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></div><p>instance = new Singleton();这一句在内存中有一个指令顺序问题*：1.分配内存。2.调用构造函数给instance初始化。3.instance对象指向分配的内存空间。*若顺序为132的话，2之前instance已经<strong>非空了但并没有初始化完成</strong>，被别的线程抢占，就会直接返回未初始化完成的对象引用导致报错</p><ul><li>饿汉式（饥饿，请求前初始化，<strong>非懒加载</strong>）</li></ul><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JAVA"><figure class="iseeu highlight /java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Singleton instance = <span class="keyword">new</span> Singleton();</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span></span>&#123;&#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> instance;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></div><ul><li>双重检验锁</li></ul><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JAVA"><figure class="iseeu highlight /java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Singleton instance;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span>(instance == <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="keyword">synchronized</span> (Singleton.class) &#123;</div><div class="line">                <span class="keyword">if</span>(instance == <span class="keyword">null</span>) instance = <span class="keyword">new</span> Singleton();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> instance;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></div><ul><li>静态内部类（懒加载）</li></ul><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JAVA"><figure class="iseeu highlight /java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">SingleHolder</span> </span>&#123;</div><div class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> SingleHolder instance = <span class="keyword">new</span> SingleHolder();</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span></span>&#123;&#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SingleHolder <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> SingleHolder.instance;</div><div class="line">        <span class="comment">//由于instance是静态内部类的静态成员，虽然是私有的也可以直接访问？</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></div><ul><li>枚举（创建枚举<strong>默认</strong>就是<strong>线程安全</strong>的）（<strong>最优</strong>）</li></ul><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JAVA"><figure class="iseeu highlight /java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">enum</span> EasySingleton&#123;</div><div class="line">    INSTANCE;</div><div class="line">&#125;</div><div class="line">EasySingleton.INSTANCE</div></pre></td></tr></table></figure></div><blockquote><p>Written with <a href="https://stackedit.io/" target="_blank" rel="external">StackEdit</a>.</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;二-开放式问题&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#二-开放式问题&quot;&gt;&lt;/a&gt; 二、开放式问题&lt;/h3&gt;
&lt;h4 id=&quot;解释什么是流streaming和如何实现一个流&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#解释什么是流streaming和如何实现一个流&quot;&gt;&lt;/a&gt; 解释什么是流(streaming)和如何实现一个流？&lt;/h4&gt;
    
    </summary>
    
      <category term="coding" scheme="http://blog.garenfeather.cn/categories/coding/"/>
    
    
      <category term="backend" scheme="http://blog.garenfeather.cn/tags/backend/"/>
    
      <category term="streaming" scheme="http://blog.garenfeather.cn/tags/streaming/"/>
    
      <category term="transaction" scheme="http://blog.garenfeather.cn/tags/transaction/"/>
    
      <category term="singleton" scheme="http://blog.garenfeather.cn/tags/singleton/"/>
    
  </entry>
  
  <entry>
    <title>利用heroku实现免费的全平台科学上网</title>
    <link href="http://blog.garenfeather.cn/2018/01/25/heroku-wall-free/"/>
    <id>http://blog.garenfeather.cn/2018/01/25/heroku-wall-free/</id>
    <published>2018-01-25T14:03:23.000Z</published>
    <updated>2018-03-15T18:59:25.925Z</updated>
    
    <content type="html"><![CDATA[<h2 id="一-前言"><a class="markdownIt-Anchor" href="#一-前言"></a> 一、前言</h2><h3 id="准备"><a class="markdownIt-Anchor" href="#准备"></a> 准备</h3><ul><li><p>一台连得上Google的服务器（测试用，可选）</p><ul><li>这里用的是腾讯云买的CentOS 7.2，新加坡节点</li></ul></li><li><p>一个heroku账号</p><ul><li>heroku平台<strong>注册需要翻墙</strong>，但登录和部署均不需要</li><li>账号还有免费app余额</li></ul></li><li><p>一台<s>便宜且容易搞到手的</s>国内服务器（可选）</p><ul><li>仅作为中转服务器，不需要多平台共用可以不备</li></ul></li><li><p>需要梯子服务的平台对应的客户端（Android、Win、Mac、Linux）</p></li></ul><a id="more"></a><hr><h2 id="二-搭建梯子"><a class="markdownIt-Anchor" href="#二-搭建梯子"></a> 二、搭建梯子</h2><h3 id="国外服务器手动部署测试"><a class="markdownIt-Anchor" href="#国外服务器手动部署测试"></a> 国外服务器手动部署测试</h3><p>首先测试下git上的项目能否正常部署运行服务器程序，这里用的是<a href="https://github.com/shadowsocksr-backup/shadowsocks-rss" target="_blank" rel="external">shadowsocksr</a>，首先登陆服务器</p><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ git <span class="built_in">clone</span> -b manyuser https://github.com/shadowsocksr-backup/shadowsocksr.git</div></pre></td></tr></table></figure></div><p>进入到目录，并初始化配置</p><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ <span class="built_in">cd</span> shadowsocksr/</div><div class="line">$ ./initcfg.sh</div></pre></td></tr></table></figure></div><p>根据wiki说明如果是多用户的话接下来修改config.json，单用户的话修改user-config.json，我们这里是单用户，修改user-config.json，其他参数默认，只修改密码。同时这里要记住下面几个参数，与后面客户端<strong>保持一致</strong>，参数的具体含义见<a href="https://github.com/shadowsocksr-backup/shadowsocks-rss/wiki/config.json" target="_blank" rel="external">wiki</a></p><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    "server_port": 8388,</div><div class="line">    "password": "12333333",//你修改的密码</div><div class="line">    "method": "aes-128-ctr",</div><div class="line">    "protocol": "auth_aes128_md5",</div><div class="line">    "protocol_param": "",</div><div class="line">    "obfs": "tls1.2_ticket_auth_compatible",</div><div class="line">    "obfs_param": ""</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>修改完毕保存后进入子目录，启动后台进程</p><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ <span class="built_in">cd</span> shadowsocks/</div><div class="line">$ python server.py -d start</div></pre></td></tr></table></figure></div><p>查看日志</p><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ tail -f /var/<span class="built_in">log</span>/shadowsocksr.log</div></pre></td></tr></table></figure></div><p>正常输出说明启动成功↓</p><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">2018-01-24 16:46:42 INFO     server.py:46 current process RLIMIT_NOFILE resource: soft 100001 hard 100002</div><div class="line">2018-01-24 16:46:42 INFO     asyncdns.py:324 dns server: [(&apos;100.78.90.8&apos;, 53), (&apos;100.78.90.19&apos;, 53)]</div><div class="line">2018-01-24 16:46:42 INFO     server.py:106 server start with protocol[auth_aes128_md5] password [12333333] method [aes-128-ctr] obfs [tls1.2_ticket_auth_compatible] obfs_param []</div><div class="line">2018-01-24 16:46:42 INFO     server.py:122 starting server at [::]:8388</div><div class="line">2018-01-24 16:46:42 INFO     server.py:142 starting server at 0.0.0.0:8388</div></pre></td></tr></table></figure></div><p>保持日志窗口观察连接情况</p><hr><p>接下来使用客户端，注意要使用shadowsocksR的客户端，原生的shadowsocks客户端不支持协议混淆，无法直接使用shadowsocksR服务端，几个平台的下载也顺便给出来一下，Assets下有最新版稳定版等</p><ul><li><a href="https://github.com/shadowsocksr-backup/shadowsocksr-csharp/releases" target="_blank" rel="external">Windows</a></li><li><a href="https://github.com/shadowsocksr-backup/shadowsocksr-android/releases" target="_blank" rel="external">Android</a></li><li>苹果选手请自行解决</li></ul><p>这里以Windows客户端为例，下载解压后进入目录，启动ShadowsocksR-dotnet.exe，这里用的是4.0版<br><img src="https://media.discordapp.net/attachments/420095259125743637/423913127202127872/QQ20180316024108.png" alt="此处输入图片的描述"></p><p>输入服务器ip，上面修改过的密码，以及协议和混淆等参数与上面保持一致，上面没有修改这里也照默认</p><p>保存启动后可以试着登录Google了，访问正常情况下日志会持续输出，如果没有任何输出说明很可能没连上，可以检查一下服务器端口是否开放了（<em>腾讯云、阿里云等服务器默认的安全组都只打开22、443等几个标准端口，需要自行开放设置</em>）</p><hr><h3 id="一键部署上heroku重点"><a class="markdownIt-Anchor" href="#一键部署上heroku重点"></a> 一键部署上heroku（重点）</h3><p>经过上面的测试我们确认服务程序能正常运行，现在可以着手布置上云平台了，本来还在思考ssr怎么转换成web服务的形式部署上云平台，然后就发现了<a href="https://github.com/onplus/shadowsocks-heroku" target="_blank" rel="external">这个</a>，一键部署，异常简单，跟着下面作者贴图说明服务端很快就能部署好</p><p>这里注意一点，这个是shadowsocks-heroku，<strong>不是shadowsocksR</strong>，协议不同，是不能直接用刚才的ShadowsocksR客户端来连接的，这点作者在issue里面也提到了</p><p>接原作者的“启动本地 Client”说明，启动后相当于将本地当成一个代理服务器，要走代理则流量都从本地1080端口走：</p><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">server listening at &#123; address: &apos;127.0.0.1&apos;, family: &apos;IPv4&apos;, port: 1080 &#125;</div></pre></td></tr></table></figure></div><p>简而言之，若要浏览器翻墙还得手动给浏览器做配置，如果有多个浏览器要一一配置，需要修改代理服务器时也要一一修改，比较麻烦，而且只能在PC端应用，要应用到移动端需要另装客户端<a href="https://github.com/onplus/v2hero" target="_blank" rel="external">v2ray</a><br>总结下我们对这个梯子的需求大概是：</p><ul><li>一个梯子，多平台通用</li><li>集成到唯一的ShadowsocksR客户端里</li></ul><hr><h3 id="全平台通用化重点"><a class="markdownIt-Anchor" href="#全平台通用化重点"></a> 全平台通用化（重点）</h3><p>为了解决上面两个需求我们需要对协议进行转换，这里涉及到一个转换工具<a href="https://github.com/nadoo/glider" target="_blank" rel="external">glider</a>，可以转换包括socks5、http、ss/ssr内的多种协议，这里我们将socks5转为ssr就可以为客户端所用，glider规则示例说明如下，详细见wiki：</p><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">listen=ss://AES-128-CFB:password@:8449</div></pre></td></tr></table></figure></div><p>↑ 表示监听8449端口，协议为ss混淆，即ssr</p><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">forward=socks5://127.0.0.1:1080</div></pre></td></tr></table></figure></div><p>↑ 表示<strong>转发</strong>协议为socks5的本地1080端口的流量到监听的端口上</p><p>按照原本作者说明的操作整体架构如下，A为本机：</p><div class="mermaid"><svg id="mermaid-svg-e3904745b9f076fd" width="100%" xmlns="http://www.w3.org/2000/svg" height="100%" style="max-width:650px;" viewbox="-50 -10 650 393"><style>  .mermaid .label{font-family:trebuchet ms,verdana,arial;color:#333}.node circle,.node ellipse,.node polygon,.node rect{fill:#cde498;stroke:#13540c;stroke-width:1px}.node.clickable{cursor:pointer}.arrowheadPath{fill:green}.edgePath .path{stroke:green;stroke-width:1.5px}.edgeLabel{background-color:#e8e8e8}.cluster rect{fill:#cdffb2!important;rx:4!important;stroke:#6eaa49!important;stroke-width:1px!important}.cluster text{fill:#333}.actor{stroke:#13540c;fill:#cde498}text.actor{fill:#000;stroke:none}.actor-line{stroke:grey}.messageLine0{marker-end:"url(#arrowhead)"}.messageLine0,.messageLine1{stroke-width:1.5;stroke-dasharray:"2 2";stroke:#333}#arrowhead{fill:#333}#crosshead path{fill:#333!important;stroke:#333!important}.messageText{fill:#333;stroke:none}.labelBox{stroke:#326932;fill:#cde498}.labelText,.loopText{fill:#000;stroke:none}.loopLine{stroke-width:2;stroke-dasharray:"2 2";marker-end:"url(#arrowhead)";stroke:#326932}.note{stroke:#6eaa49;fill:#fff5ad}.noteText{fill:#000;stroke:none;font-family:trebuchet ms,verdana,arial;font-size:14px}.section{stroke:none;opacity:.2}.section0,.section2{fill:#6eaa49}.section1,.section3{fill:#fff;opacity:.2}.sectionTitle0,.sectionTitle1,.sectionTitle2,.sectionTitle3{fill:#333}.sectionTitle{text-anchor:start;font-size:11px;text-height:14px}.grid .tick{stroke:#d3d3d3;opacity:.3;shape-rendering:crispEdges}.grid path{stroke-width:0}.today{fill:none;stroke:red;stroke-width:2px}.task{stroke-width:2}.taskText{text-anchor:middle;font-size:11px}.taskTextOutsideRight{fill:#000;text-anchor:start;font-size:11px}.taskTextOutsideLeft{fill:#000;text-anchor:end;font-size:11px}.taskText0,.taskText1,.taskText2,.taskText3{fill:#fff}.task0,.task1,.task2,.task3{fill:#487e3a;stroke:#13540c}.taskTextOutside0,.taskTextOutside1,.taskTextOutside2,.taskTextOutside3{fill:#000}.active0,.active1,.active2,.active3{fill:#cde498;stroke:#13540c}.activeText0,.activeText1,.activeText2,.activeText3{fill:#000!important}.done0,.done1,.done2,.done3{stroke:grey;fill:#d3d3d3;stroke-width:2}.doneText0,.doneText1,.doneText2,.doneText3{fill:#000!important}.crit0,.crit1,.crit2,.crit3{stroke:#f88;fill:red;stroke-width:2}.activeCrit0,.activeCrit1,.activeCrit2,.activeCrit3{stroke:#f88;fill:#cde498;stroke-width:2}.doneCrit0,.doneCrit1,.doneCrit2,.doneCrit3{stroke:#f88;fill:#d3d3d3;stroke-width:2;cursor:pointer;shape-rendering:crispEdges}.activeCritText0,.activeCritText1,.activeCritText2,.activeCritText3,.doneCritText0,.doneCritText1,.doneCritText2,.doneCritText3{fill:#000!important}.titleText{text-anchor:middle;font-size:18px;fill:#000}g.classGroup text{fill:#13540c;stroke:none;font-family:trebuchet ms,verdana,arial;font-size:10px}g.classGroup rect{fill:#cde498;stroke:#13540c}g.classGroup line{stroke:#13540c;stroke-width:1}svg .classLabel .box{stroke:none;stroke-width:0;fill:#cde498;opacity:.5}svg .classLabel .label{fill:#13540c;font-size:10px}.relation{stroke:#13540c;stroke-width:1;fill:none}#compositionEnd,#compositionStart,.composition{fill:#13540c;stroke:#13540c;stroke-width:1}#aggregationEnd,#aggregationStart,.aggregation{fill:#cde498;stroke:#13540c;stroke-width:1}#dependencyEnd,#dependencyStart,#extensionEnd,#extensionStart{fill:#13540c;stroke:#13540c;stroke-width:1}.node text{font-size:14px}.node text,div.mermaidTooltip{font-family:trebuchet ms,verdana,arial}div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-size:12px;background:#cdffb2;border:1px solid #6eaa49;border-radius:2px;pointer-events:none;z-index:100}svg {  color: rgb(0, 0, 0);  font: normal normal 400 normal 16px / normal "Times New Roman";}  </style><g/><g><line id="actor0" x1="75" y1="5" x2="75" y2="382" class="actor-line" stroke-width="0.5px" stroke="#999"/><rect x="0" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"/><text x="75" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="75" dy="0">A 其他client/代理</tspan></text></g><g><line id="actor1" x1="275" y1="5" x2="275" y2="382" class="actor-line" stroke-width="0.5px" stroke="#999"/><rect x="200" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"/><text x="275" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="275" dy="0">A ssHerokuRe</tspan></text></g><g><line id="actor2" x1="475" y1="5" x2="475" y2="382" class="actor-line" stroke-width="0.5px" stroke="#999"/><rect x="400" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"/><text x="475" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="475" dy="0">B heroku</tspan></text></g><defs><marker id="arrowhead" refx="5" refy="2" markerwidth="6" markerheight="4" orient="auto"><path d="M 0,0 V 4 L6,2 Z"/></marker></defs><defs><marker id="crosshead" markerwidth="15" markerheight="8" orient="auto" refx="16" refy="4"><path fill="black" stroke="#000000" stroke-width="1px" d="M 9,2 V 6 L16,4 Z" style="stroke-dasharray: 0, 0;"/><path fill="none" stroke="#000000" stroke-width="1px" d="M 0,1 L 6,7 M 6,1 L 0,7" style="stroke-dasharray: 0, 0;"/></marker></defs><g><text x="175" y="93" class="messageText" style="text-anchor: middle;">connect local 1080</text><line x1="75" y1="100" x2="275" y2="100" class="messageLine0" stroke-width="2" stroke="black" style="fill: none;"/></g><g><text x="375" y="128" class="messageText" style="text-anchor: middle;">connect remote 80</text><line x1="275" y1="135" x2="475" y2="135" class="messageLine0" stroke-width="2" stroke="black" style="fill: none;"/></g><g><rect x="400" y="145" fill="#EDF2AE" stroke="#666" width="150" height="36" rx="0" ry="0" class="note"/><text x="416" y="168" fill="black" class="noteText"><tspan x="416" fill="black">websocket</tspan></text></g><g><rect x="200" y="191" fill="#EDF2AE" stroke="#666" width="150" height="36" rx="0" ry="0" class="note"/><text x="216" y="214" fill="black" class="noteText"><tspan x="216" fill="black">socks5://:1080</tspan></text></g><g><text x="375" y="255" class="messageText" style="text-anchor: middle;">return data</text><line x1="475" y1="262" x2="275" y2="262" class="messageLine0" stroke-width="2" stroke="black" style="fill: none;"/></g><g><text x="175" y="290" class="messageText" style="text-anchor: middle;">return data</text><line x1="275" y1="297" x2="75" y2="297" class="messageLine0" stroke-width="2" stroke="black" style="fill: none;"/></g><g><rect x="0" y="317" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"/><text x="75" y="349.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="75" dy="0">A 其他client/代理</tspan></text></g><g><rect x="200" y="317" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"/><text x="275" y="349.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="275" dy="0">A ssHerokuRe</tspan></text></g><g><rect x="400" y="317" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"/><text x="475" y="349.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="475" dy="0">B heroku</tspan></text></g></svg></div><p>我们修改以适应ShadowsocksR客户端的架构如下，A为本机，B为中间服务器：</p><div class="mermaid"><svg id="mermaid-svg-9f55c40bcf317217" width="100%" xmlns="http://www.w3.org/2000/svg" height="100%" style="max-width:850px;" viewbox="-50 -10 850 485"><style>  .mermaid .label{font-family:trebuchet ms,verdana,arial;color:#333}.node circle,.node ellipse,.node polygon,.node rect{fill:#cde498;stroke:#13540c;stroke-width:1px}.node.clickable{cursor:pointer}.arrowheadPath{fill:green}.edgePath .path{stroke:green;stroke-width:1.5px}.edgeLabel{background-color:#e8e8e8}.cluster rect{fill:#cdffb2!important;rx:4!important;stroke:#6eaa49!important;stroke-width:1px!important}.cluster text{fill:#333}.actor{stroke:#13540c;fill:#cde498}text.actor{fill:#000;stroke:none}.actor-line{stroke:grey}.messageLine0{marker-end:"url(#arrowhead)"}.messageLine0,.messageLine1{stroke-width:1.5;stroke-dasharray:"2 2";stroke:#333}#arrowhead{fill:#333}#crosshead path{fill:#333!important;stroke:#333!important}.messageText{fill:#333;stroke:none}.labelBox{stroke:#326932;fill:#cde498}.labelText,.loopText{fill:#000;stroke:none}.loopLine{stroke-width:2;stroke-dasharray:"2 2";marker-end:"url(#arrowhead)";stroke:#326932}.note{stroke:#6eaa49;fill:#fff5ad}.noteText{fill:#000;stroke:none;font-family:trebuchet ms,verdana,arial;font-size:14px}.section{stroke:none;opacity:.2}.section0,.section2{fill:#6eaa49}.section1,.section3{fill:#fff;opacity:.2}.sectionTitle0,.sectionTitle1,.sectionTitle2,.sectionTitle3{fill:#333}.sectionTitle{text-anchor:start;font-size:11px;text-height:14px}.grid .tick{stroke:#d3d3d3;opacity:.3;shape-rendering:crispEdges}.grid path{stroke-width:0}.today{fill:none;stroke:red;stroke-width:2px}.task{stroke-width:2}.taskText{text-anchor:middle;font-size:11px}.taskTextOutsideRight{fill:#000;text-anchor:start;font-size:11px}.taskTextOutsideLeft{fill:#000;text-anchor:end;font-size:11px}.taskText0,.taskText1,.taskText2,.taskText3{fill:#fff}.task0,.task1,.task2,.task3{fill:#487e3a;stroke:#13540c}.taskTextOutside0,.taskTextOutside1,.taskTextOutside2,.taskTextOutside3{fill:#000}.active0,.active1,.active2,.active3{fill:#cde498;stroke:#13540c}.activeText0,.activeText1,.activeText2,.activeText3{fill:#000!important}.done0,.done1,.done2,.done3{stroke:grey;fill:#d3d3d3;stroke-width:2}.doneText0,.doneText1,.doneText2,.doneText3{fill:#000!important}.crit0,.crit1,.crit2,.crit3{stroke:#f88;fill:red;stroke-width:2}.activeCrit0,.activeCrit1,.activeCrit2,.activeCrit3{stroke:#f88;fill:#cde498;stroke-width:2}.doneCrit0,.doneCrit1,.doneCrit2,.doneCrit3{stroke:#f88;fill:#d3d3d3;stroke-width:2;cursor:pointer;shape-rendering:crispEdges}.activeCritText0,.activeCritText1,.activeCritText2,.activeCritText3,.doneCritText0,.doneCritText1,.doneCritText2,.doneCritText3{fill:#000!important}.titleText{text-anchor:middle;font-size:18px;fill:#000}g.classGroup text{fill:#13540c;stroke:none;font-family:trebuchet ms,verdana,arial;font-size:10px}g.classGroup rect{fill:#cde498;stroke:#13540c}g.classGroup line{stroke:#13540c;stroke-width:1}svg .classLabel .box{stroke:none;stroke-width:0;fill:#cde498;opacity:.5}svg .classLabel .label{fill:#13540c;font-size:10px}.relation{stroke:#13540c;stroke-width:1;fill:none}#compositionEnd,#compositionStart,.composition{fill:#13540c;stroke:#13540c;stroke-width:1}#aggregationEnd,#aggregationStart,.aggregation{fill:#cde498;stroke:#13540c;stroke-width:1}#dependencyEnd,#dependencyStart,#extensionEnd,#extensionStart{fill:#13540c;stroke:#13540c;stroke-width:1}.node text{font-size:14px}.node text,div.mermaidTooltip{font-family:trebuchet ms,verdana,arial}div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-size:12px;background:#cdffb2;border:1px solid #6eaa49;border-radius:2px;pointer-events:none;z-index:100}svg {  color: rgb(0, 0, 0);  font: normal normal 400 normal 16px / normal "Times New Roman";}  </style><g/><g><line id="actor0" x1="75" y1="5" x2="75" y2="474" class="actor-line" stroke-width="0.5px" stroke="#999"/><rect x="0" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"/><text x="75" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="75" dy="0">A client</tspan></text></g><g><line id="actor1" x1="275" y1="5" x2="275" y2="474" class="actor-line" stroke-width="0.5px" stroke="#999"/><rect x="200" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"/><text x="275" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="275" dy="0">B glider</tspan></text></g><g><line id="actor2" x1="475" y1="5" x2="475" y2="474" class="actor-line" stroke-width="0.5px" stroke="#999"/><rect x="400" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"/><text x="475" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="475" dy="0">B ssHerokuRe</tspan></text></g><g><line id="actor3" x1="675" y1="5" x2="675" y2="474" class="actor-line" stroke-width="0.5px" stroke="#999"/><rect x="600" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"/><text x="675" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="675" dy="0">C heroku</tspan></text></g><defs><marker id="arrowhead" refx="5" refy="2" markerwidth="6" markerheight="4" orient="auto"><path d="M 0,0 V 4 L6,2 Z"/></marker></defs><defs><marker id="crosshead" markerwidth="15" markerheight="8" orient="auto" refx="16" refy="4"><path fill="black" stroke="#000000" stroke-width="1px" d="M 9,2 V 6 L16,4 Z" style="stroke-dasharray: 0, 0;"/><path fill="none" stroke="#000000" stroke-width="1px" d="M 0,1 L 6,7 M 6,1 L 0,7" style="stroke-dasharray: 0, 0;"/></marker></defs><g><text x="175" y="93" class="messageText" style="text-anchor: middle;">connect remote 8449</text><line x1="75" y1="100" x2="275" y2="100" class="messageLine0" stroke-width="2" stroke="black" style="fill: none;"/></g><g><rect x="200" y="110" fill="#EDF2AE" stroke="#666" width="150" height="36" rx="0" ry="0" class="note"/><text x="216" y="133" fill="black" class="noteText"><tspan x="216" fill="black">ss://:8449</tspan></text></g><g><text x="575" y="174" class="messageText" style="text-anchor: middle;">connect remote 80</text><line x1="475" y1="181" x2="675" y2="181" class="messageLine0" stroke-width="2" stroke="black" style="fill: none;"/></g><g><rect x="600" y="191" fill="#EDF2AE" stroke="#666" width="150" height="36" rx="0" ry="0" class="note"/><text x="616" y="214" fill="black" class="noteText"><tspan x="616" fill="black">websocket</tspan></text></g><g><rect x="250" y="237" fill="#EDF2AE" stroke="#666" width="250" height="36" rx="0" ry="0" class="note"/><text x="266" y="260" fill="black" class="noteText"><tspan x="266" fill="black">forward 1080 to 8449</tspan></text></g><g><rect x="400" y="283" fill="#EDF2AE" stroke="#666" width="150" height="36" rx="0" ry="0" class="note"/><text x="416" y="306" fill="black" class="noteText"><tspan x="416" fill="black">socks5://:1080</tspan></text></g><g><text x="575" y="347" class="messageText" style="text-anchor: middle;">return data</text><line x1="675" y1="354" x2="475" y2="354" class="messageLine0" stroke-width="2" stroke="black" style="fill: none;"/></g><g><text x="175" y="382" class="messageText" style="text-anchor: middle;">ssr protocol</text><line x1="275" y1="389" x2="75" y2="389" class="messageLine0" stroke-width="2" stroke="black" style="fill: none;"/></g><g><rect x="0" y="409" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"/><text x="75" y="441.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="75" dy="0">A client</tspan></text></g><g><rect x="200" y="409" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"/><text x="275" y="441.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="275" dy="0">B glider</tspan></text></g><g><rect x="400" y="409" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"/><text x="475" y="441.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="475" dy="0">B ssHerokuRe</tspan></text></g><g><rect x="600" y="409" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"/><text x="675" y="441.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="675" dy="0">C heroku</tspan></text></g></svg></div><p>架构稍微复杂了点，但实际操作起来难度并不大</p><hr><p>首先登入我们的中间服务器，没有服务器的同学直接A机器与B机器用一台也可以，那样就只有局域网内的设备能用了。这里B机器是Linux，因此不能直接用ss-heroku的win客户端，我们在之前项目的issue里找到了作者提供的Linux客户端下载<a href="https://github.com/onplus/shadowsocks-heroku/archive/re.zip" target="_blank" rel="external">re.zip</a>，下载后解压，进入主目录：</p><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ npm install</div></pre></td></tr></table></figure></div><p>没有npm与node请自行安装，操作完后修改config.json:</p><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    "server": "xxxx.herokuapp.com",//你的app</div><div class="line">    "local_address": "127.0.0.1",</div><div class="line">    "scheme": "ws",</div><div class="line">    "local_port": 1080,</div><div class="line">    "remote_port": 80,</div><div class="line">    "password": "pwd",//你的密码</div><div class="line">    "timeout": 600,</div><div class="line">    "method": "aes-256-cfb"</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>修改完保存后，运行命令，以后台进程形式运行：</p><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ nohup node local.js -c config.json &amp;</div></pre></td></tr></table></figure></div><p>退出目录，下载glider的Linux版，解压后进入主目录下的config目录，参照example：</p><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ vim glider.conf</div></pre></td></tr></table></figure></div><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">listen=:8443</div><div class="line">listen=ss://AES-128-CFB:password@:8449</div><div class="line">forward=socks5://127.0.0.1:1080</div><div class="line"></div><div class="line">verbose=True</div><div class="line">strategy=rr</div><div class="line">checkwebsite=www.microsoft.com</div><div class="line">checkduration=30</div></pre></td></tr></table></figure></div><p>8443为http/socks5代理端口，8449为ss混淆代理端口，也就是我们等会客户端需要使用的远程端口。保存后退出config目录，运行命令启动后台进程：</p><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ nohup ./glider -config config/glider.conf &amp;</div></pre></td></tr></table></figure></div><p>启动后可分别查看两个目录的nohup.out查看日志，此时为客户端新添加一个服务器，参数规则照之前一一对应，，<strong>协议改为origin，混淆改为plain</strong>，保存后使用该服务器代理应该可以正常访问了，日志流水上也可看得到</p><p>因为多走了一轮代理的原因，访问的延时会比较大（自测在几百ms左右），因此不适合游戏等对时延要求比较严格情况，简单的试了下youtube视频基本流畅，720p左右体验还行，最大的优势在于<strong>免费，不限量，基本不计时</strong></p><hr><h2 id="三-扩展思路"><a class="markdownIt-Anchor" href="#三-扩展思路"></a> 三、扩展思路</h2><h3 id="相关思考"><a class="markdownIt-Anchor" href="#相关思考"></a> 相关思考</h3><ul><li>Shadowsocks-heroku是用websocket代替了原本的socket发起的连接，除了项目的nodejs版之外还有python语言版的链接在项目中可自取</li></ul><h3 id="相关用途及扩展"><a class="markdownIt-Anchor" href="#相关用途及扩展"></a> 相关用途及扩展</h3><ul><li><p>说道代理就自然能想到爬虫，爬虫总怕不小心就被封了ip，而这里heroku平台提供创建50个免费的app，据测试每个app的ip都不同，代理ip什么的自然可以自由的切换。</p></li><li><p>后端云平台是个很好的思路，除了heroku，应该也还存在其他免费的云平台，我们可以将自己的app部署上去，只要国内能正常访问就说明可以作为代理来使用，大致上找的时候符合以下条件都有可用性：</p><ul><li><p>账户提供一定量免费限额</p></li><li><p>服务试用不限制时长（免费试用一个月什么的没太大意义）</p></li><li><p>服务试用不限制流量，限制流量基本难以操作了</p></li></ul></li><li><p>paas支持的语言零散不全，他们常支持的Ruby On Rails对国内开发者来说较陌生，因此若要搞出其他Shadowsocks-XX平台 服务端部署项目可能需要自行用ruby等语言重写，较麻烦</p></li></ul><hr><p><strong>有很多地方认识不完整，知识水平有限，抛砖引玉，望大佬们指正。</strong></p><p>参考：</p><ul><li><p><a href="https://rookiefly.cn/detail/128" target="_blank" rel="external">使用heroku+shadowsocks-heroku进行科学上网</a></p></li></ul><hr><blockquote><p>Written with <a href="https://stackedit.io/" target="_blank" rel="external">StackEdit</a>.</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;一-前言&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#一-前言&quot;&gt;&lt;/a&gt; 一、前言&lt;/h2&gt;
&lt;h3 id=&quot;准备&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#准备&quot;&gt;&lt;/a&gt; 准备&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;一台连得上Google的服务器（测试用，可选）&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;这里用的是腾讯云买的CentOS 7.2，新加坡节点&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;一个heroku账号&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;heroku平台&lt;strong&gt;注册需要翻墙&lt;/strong&gt;，但登录和部署均不需要&lt;/li&gt;
&lt;li&gt;账号还有免费app余额&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;一台&lt;s&gt;便宜且容易搞到手的&lt;/s&gt;国内服务器（可选）&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;仅作为中转服务器，不需要多平台共用可以不备&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;需要梯子服务的平台对应的客户端（Android、Win、Mac、Linux）&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="coding" scheme="http://blog.garenfeather.cn/categories/coding/"/>
    
    
      <category term="network" scheme="http://blog.garenfeather.cn/tags/network/"/>
    
      <category term="heroku" scheme="http://blog.garenfeather.cn/tags/heroku/"/>
    
      <category term="wall" scheme="http://blog.garenfeather.cn/tags/wall/"/>
    
  </entry>
  
  <entry>
    <title>日志：每个软件工程师都应该知道的有关实时数据的统一概念——阅读笔记</title>
    <link href="http://blog.garenfeather.cn/2018/01/20/log-you-should-know/"/>
    <id>http://blog.garenfeather.cn/2018/01/20/log-you-should-know/</id>
    <published>2018-01-20T12:21:28.000Z</published>
    <updated>2018-03-22T13:59:11.925Z</updated>
    
    <content type="html"><![CDATA[<h4 id="日志的用途"><a class="markdownIt-Anchor" href="#日志的用途"></a> 日志的用途</h4><ul><li>实现ACID细节</li><li>数据库间复制数据的一种方法</li><li>数据库视角：物理日志（记录具体内容）和逻辑日志（记录引起改变的操作）<ul><li>个人看法：物理日志在<strong>空间占用</strong>上会<strong>优于</strong>逻辑日志（以一个值为例，物理日志每一条都是一个数据单位，但要表示对一个数据单位的操作一般来说需要不止一个单位），但相对来说若出错<strong>恢复更加不易</strong></li></ul></li></ul><a id="more"></a><h4 id="状态机复制原理"><a class="markdownIt-Anchor" href="#状态机复制原理"></a> 状态机复制原理</h4><ul><li><p>如果两个相同的、确定性的进程从同一状态开始，并且以相同的顺序获得相同的输入，那么这两个进程将会生成相同的输出，并且结束在相同的状态。</p></li><li><p>确定性的处理过程就是确定性的</p></li></ul><h4 id="处理和复制方案"><a class="markdownIt-Anchor" href="#处理和复制方案"></a> 处理和复制方案</h4><ul><li><p>示意图<br><img src="https://github.com/oldratlee/translations/raw/master/log-what-every-software-engineer-should-know-about-real-time-datas-unifying/images/active_and_passive_arch.png" alt="主备模型、状态机模型（又称主-主模型）"></p><p>PS：文中叙述的<strong>主备模型应用物理日志</strong>，而<strong>状态机模型应用逻辑日志</strong></p></li></ul><h4 id="日志结构化数据流与消息队列"><a class="markdownIt-Anchor" href="#日志结构化数据流与消息队列"></a> 日志结构化数据流与消息队列</h4><ul><li>消息系统中的数据管道设计成日志的样子<ul><li>个人看法：消息生产消费系统还涉及到更复杂的控制需求如优先级、公平性等，也并不一定是像FIFO一样有时间顺序要求的队列，但一般叙述的日志结构特征重要的一点就是其顺序性？</li></ul></li></ul><h4 id="elt与数据仓库"><a class="markdownIt-Anchor" href="#elt与数据仓库"></a> ELT与数据仓库</h4><ul><li>ELT：Extraction-Transformation-Loading，数据提取、转换、加载</li><li>数据仓库包含了<strong>规整</strong>的数据，是个<strong>批处理查询基础设施</strong></li><li>对于数据集中分析和处理，拥有<strong>高度集中的位置</strong>存放<strong>全部</strong>数据的规整副本对于<strong>数据密集</strong>的分析和处理是非常宝贵的资产</li><li>把日志用作统一集成机制</li><li>数据规整化和转换：<ul><li>只有<strong>针对目标系统</strong>的<strong>聚合</strong>操作才应该加到加载过程中</li></ul></li></ul><h4 id="构建可伸缩的日志"><a class="markdownIt-Anchor" href="#构建可伸缩的日志"></a> 构建可伸缩的日志</h4><ul><li>人们普遍认为分布式日志是缓慢的、重量级的抽象</li><li>只把它与『元数据』类的使用方式联系在一起，可能用<code>Zookeeper</code>才合适</li><li>对于顺序读写可以方便地优化。日志可以把小的读写合成大的高吞吐量的操作</li></ul><blockquote><p>Written with <a href="https://stackedit.io/" target="_blank" rel="external">StackEdit</a>.</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;日志的用途&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#日志的用途&quot;&gt;&lt;/a&gt; 日志的用途&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;实现ACID细节&lt;/li&gt;
&lt;li&gt;数据库间复制数据的一种方法&lt;/li&gt;
&lt;li&gt;数据库视角：物理日志（记录具体内容）和逻辑日志（记录引起改变的操作）
&lt;ul&gt;
&lt;li&gt;个人看法：物理日志在&lt;strong&gt;空间占用&lt;/strong&gt;上会&lt;strong&gt;优于&lt;/strong&gt;逻辑日志（以一个值为例，物理日志每一条都是一个数据单位，但要表示对一个数据单位的操作一般来说需要不止一个单位），但相对来说若出错&lt;strong&gt;恢复更加不易&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="coding" scheme="http://blog.garenfeather.cn/categories/coding/"/>
    
    
      <category term="lock" scheme="http://blog.garenfeather.cn/tags/lock/"/>
    
      <category term="log" scheme="http://blog.garenfeather.cn/tags/log/"/>
    
      <category term="system" scheme="http://blog.garenfeather.cn/tags/system/"/>
    
      <category term="data" scheme="http://blog.garenfeather.cn/tags/data/"/>
    
  </entry>
  
  <entry>
    <title>从内容分发到去中心化架构（补充Dynamo部分，与OceanBase比较未添加）</title>
    <link href="http://blog.garenfeather.cn/2018/01/20/cdn-p2p-decentralization/"/>
    <id>http://blog.garenfeather.cn/2018/01/20/cdn-p2p-decentralization/</id>
    <published>2018-01-20T12:21:28.000Z</published>
    <updated>2018-04-01T15:49:13.880Z</updated>
    
    <content type="html"><![CDATA[<hr><h1 id="内容分发"><a class="markdownIt-Anchor" href="#内容分发"></a> 内容分发</h1><h2 id="内容分发网络cdn"><a class="markdownIt-Anchor" href="#内容分发网络cdn"></a> 内容分发网络（CDN）</h2><h3 id="分发树"><a class="markdownIt-Anchor" href="#分发树"></a> 分发树</h3><a id="more"></a><h4 id="基本思路"><a class="markdownIt-Anchor" href="#基本思路"></a> 基本思路</h4><div class="mermaid"><svg id="mermaid-svg-dfe7a63f67ce2a3a" xmlns="http://www.w3.org/2000/svg" height="100%" viewbox="0 0 524 784" style="max-width:524px;"><style>  .mermaid .label{font-family:trebuchet ms,verdana,arial;color:#333}.node circle,.node ellipse,.node polygon,.node rect{fill:#cde498;stroke:#13540c;stroke-width:1px}.node.clickable{cursor:pointer}.arrowheadPath{fill:green}.edgePath .path{stroke:green;stroke-width:1.5px}.edgeLabel{background-color:#e8e8e8}.cluster rect{fill:#cdffb2!important;rx:4!important;stroke:#6eaa49!important;stroke-width:1px!important}.cluster text{fill:#333}.actor{stroke:#13540c;fill:#cde498}text.actor{fill:#000;stroke:none}.actor-line{stroke:grey}.messageLine0{marker-end:"url(#arrowhead)"}.messageLine0,.messageLine1{stroke-width:1.5;stroke-dasharray:"2 2";stroke:#333}#arrowhead{fill:#333}#crosshead path{fill:#333!important;stroke:#333!important}.messageText{fill:#333;stroke:none}.labelBox{stroke:#326932;fill:#cde498}.labelText,.loopText{fill:#000;stroke:none}.loopLine{stroke-width:2;stroke-dasharray:"2 2";marker-end:"url(#arrowhead)";stroke:#326932}.note{stroke:#6eaa49;fill:#fff5ad}.noteText{fill:#000;stroke:none;font-family:trebuchet ms,verdana,arial;font-size:14px}.section{stroke:none;opacity:.2}.section0,.section2{fill:#6eaa49}.section1,.section3{fill:#fff;opacity:.2}.sectionTitle0,.sectionTitle1,.sectionTitle2,.sectionTitle3{fill:#333}.sectionTitle{text-anchor:start;font-size:11px;text-height:14px}.grid .tick{stroke:#d3d3d3;opacity:.3;shape-rendering:crispEdges}.grid path{stroke-width:0}.today{fill:none;stroke:red;stroke-width:2px}.task{stroke-width:2}.taskText{text-anchor:middle;font-size:11px}.taskTextOutsideRight{fill:#000;text-anchor:start;font-size:11px}.taskTextOutsideLeft{fill:#000;text-anchor:end;font-size:11px}.taskText0,.taskText1,.taskText2,.taskText3{fill:#fff}.task0,.task1,.task2,.task3{fill:#487e3a;stroke:#13540c}.taskTextOutside0,.taskTextOutside1,.taskTextOutside2,.taskTextOutside3{fill:#000}.active0,.active1,.active2,.active3{fill:#cde498;stroke:#13540c}.activeText0,.activeText1,.activeText2,.activeText3{fill:#000!important}.done0,.done1,.done2,.done3{stroke:grey;fill:#d3d3d3;stroke-width:2}.doneText0,.doneText1,.doneText2,.doneText3{fill:#000!important}.crit0,.crit1,.crit2,.crit3{stroke:#f88;fill:red;stroke-width:2}.activeCrit0,.activeCrit1,.activeCrit2,.activeCrit3{stroke:#f88;fill:#cde498;stroke-width:2}.doneCrit0,.doneCrit1,.doneCrit2,.doneCrit3{stroke:#f88;fill:#d3d3d3;stroke-width:2;cursor:pointer;shape-rendering:crispEdges}.activeCritText0,.activeCritText1,.activeCritText2,.activeCritText3,.doneCritText0,.doneCritText1,.doneCritText2,.doneCritText3{fill:#000!important}.titleText{text-anchor:middle;font-size:18px;fill:#000}g.classGroup text{fill:#13540c;stroke:none;font-family:trebuchet ms,verdana,arial;font-size:10px}g.classGroup rect{fill:#cde498;stroke:#13540c}g.classGroup line{stroke:#13540c;stroke-width:1}svg .classLabel .box{stroke:none;stroke-width:0;fill:#cde498;opacity:.5}svg .classLabel .label{fill:#13540c;font-size:10px}.relation{stroke:#13540c;stroke-width:1;fill:none}#compositionEnd,#compositionStart,.composition{fill:#13540c;stroke:#13540c;stroke-width:1}#aggregationEnd,#aggregationStart,.aggregation{fill:#cde498;stroke:#13540c;stroke-width:1}#dependencyEnd,#dependencyStart,#extensionEnd,#extensionStart{fill:#13540c;stroke:#13540c;stroke-width:1}.node text{font-size:14px}.node text,div.mermaidTooltip{font-family:trebuchet ms,verdana,arial}div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-size:12px;background:#cdffb2;border:1px solid #6eaa49;border-radius:2px;pointer-events:none;z-index:100}svg {  color: rgb(0, 0, 0);  font: normal normal 400 normal 16px / normal "Times New Roman";}  </style><g><g class="output"><g class="clusters"/><g class="edgePaths"><g class="edgePath" style="opacity: 1;"><path class="path" d="M81.46511627906976,321L181,81L258,81" marker-end="url(#arrowhead34)" style="stroke: #333; fill:none;stroke-width:2px;stroke-dasharray:3;"/><defs><marker id="arrowhead34" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M128,339L181,339L250,339" marker-end="url(#arrowhead35)" style="stroke: #333; fill:none;stroke-width:2px;stroke-dasharray:3;"/><defs><marker id="arrowhead35" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M80.39867109634551,357L181,640L234,640" marker-end="url(#arrowhead36)" style="stroke: #333; fill:none;stroke-width:2px;stroke-dasharray:3;"/><defs><marker id="arrowhead36" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M310,70.55140186915888L391,38L448,38" marker-end="url(#arrowhead37)" style="fill:none"/><defs><marker id="arrowhead37" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M310,91.44859813084112L391,124L448,124" marker-end="url(#arrowhead38)" style="fill:none"/><defs><marker id="arrowhead38" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M298.93023255813955,321L391,210L448,210" marker-end="url(#arrowhead39)" style="fill:none"/><defs><marker id="arrowhead39" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M318,325.33644859813086L391,296L448,296" marker-end="url(#arrowhead40)" style="fill:none"/><defs><marker id="arrowhead40" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M318,352.66355140186914L391,382L448,382" marker-end="url(#arrowhead41)" style="fill:none"/><defs><marker id="arrowhead41" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M298.93023255813955,357L391,468L448,468" marker-end="url(#arrowhead42)" style="fill:none"/><defs><marker id="arrowhead42" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M306.3953488372093,622L391,554L448,554" marker-end="url(#arrowhead43)" style="fill:none"/><defs><marker id="arrowhead43" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M334,640L391,640L448,640" marker-end="url(#arrowhead44)" style="fill:none"/><defs><marker id="arrowhead44" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M306.3953488372093,658L391,726L448,726" marker-end="url(#arrowhead45)" style="fill:none"/><defs><marker id="arrowhead45" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g></g><g class="edgeLabels"><g class="edgeLabel" transform="translate(181,81)" style="opacity: 1;"><g transform="translate(-28,-8)" class="label"><foreignobject width="56" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">CDN节点</span></div></foreignobject></g></g><g class="edgeLabel" transform="translate(181,339)" style="opacity: 1;"><g transform="translate(-28,-8)" class="label"><foreignobject width="56" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">CDN节点</span></div></foreignobject></g></g><g class="edgeLabel" transform="translate(181,640)" style="opacity: 1;"><g transform="translate(-28,-8)" class="label"><foreignobject width="56" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">CDN节点</span></div></foreignobject></g></g><g class="edgeLabel" transform="translate(391,38)" style="opacity: 1;"><g transform="translate(-32,-8)" class="label"><foreignobject width="64" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">全球客户</span></div></foreignobject></g></g><g class="edgeLabel" transform="translate(391,124)" style="opacity: 1;"><g transform="translate(-32,-8)" class="label"><foreignobject width="64" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">全球客户</span></div></foreignobject></g></g><g class="edgeLabel" transform="translate(391,210)" style="opacity: 1;"><g transform="translate(-32,-8)" class="label"><foreignobject width="64" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">全球客户</span></div></foreignobject></g></g><g class="edgeLabel" transform="translate(391,296)" style="opacity: 1;"><g transform="translate(-32,-8)" class="label"><foreignobject width="64" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">全球客户</span></div></foreignobject></g></g><g class="edgeLabel" transform="translate(391,382)" style="opacity: 1;"><g transform="translate(-32,-8)" class="label"><foreignobject width="64" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">全球客户</span></div></foreignobject></g></g><g class="edgeLabel" transform="translate(391,468)" style="opacity: 1;"><g transform="translate(-32,-8)" class="label"><foreignobject width="64" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">全球客户</span></div></foreignobject></g></g><g class="edgeLabel" transform="translate(391,554)" style="opacity: 1;"><g transform="translate(-32,-8)" class="label"><foreignobject width="64" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">全球客户</span></div></foreignobject></g></g><g class="edgeLabel" transform="translate(391,640)" style="opacity: 1;"><g transform="translate(-32,-8)" class="label"><foreignobject width="64" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">全球客户</span></div></foreignobject></g></g><g class="edgeLabel" transform="translate(391,726)" style="opacity: 1;"><g transform="translate(-32,-8)" class="label"><foreignobject width="64" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">全球客户</span></div></foreignobject></g></g></g><g class="nodes"><g class="node" id="A" transform="translate(74,339)" style="opacity: 1;"><rect rx="5" ry="5" x="-54" y="-18" width="108" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-44,-8)"><foreignobject width="88" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">CDN源服务器</div></foreignobject></g></g></g><g class="node" id="B" transform="translate(284,81)" style="opacity: 1;"><rect rx="5" ry="5" x="-26" y="-18" width="52" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-16,-8)"><foreignobject width="32" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">悉尼</div></foreignobject></g></g></g><g class="node" id="C" transform="translate(284,339)" style="opacity: 1;"><rect rx="5" ry="5" x="-34" y="-18" width="68" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-24,-8)"><foreignobject width="48" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">波士顿</div></foreignobject></g></g></g><g class="node" id="D" transform="translate(284,640)" style="opacity: 1;"><rect rx="5" ry="5" x="-50" y="-18" width="100" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-40,-8)"><foreignobject width="80" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">阿姆斯特丹</div></foreignobject></g></g></g><g class="node" id="C1" transform="translate(466,38)" style="opacity: 1;"><rect rx="0" ry="0" x="-18" y="-18" width="36" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-8,-8)"><foreignobject width="16" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">C1</div></foreignobject></g></g></g><g class="node" id="C2" transform="translate(466,124)" style="opacity: 1;"><rect rx="0" ry="0" x="-18" y="-18" width="36" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-8,-8)"><foreignobject width="16" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">C2</div></foreignobject></g></g></g><g class="node" id="C3" transform="translate(466,210)" style="opacity: 1;"><rect rx="0" ry="0" x="-18" y="-18" width="36" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-8,-8)"><foreignobject width="16" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">C3</div></foreignobject></g></g></g><g class="node" id="C4" transform="translate(466,296)" style="opacity: 1;"><rect rx="0" ry="0" x="-18" y="-18" width="36" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-8,-8)"><foreignobject width="16" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">C4</div></foreignobject></g></g></g><g class="node" id="C5" transform="translate(466,382)" style="opacity: 1;"><rect rx="0" ry="0" x="-18" y="-18" width="36" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-8,-8)"><foreignobject width="16" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">C5</div></foreignobject></g></g></g><g class="node" id="C6" transform="translate(466,468)" style="opacity: 1;"><rect rx="0" ry="0" x="-18" y="-18" width="36" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-8,-8)"><foreignobject width="16" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">C6</div></foreignobject></g></g></g><g class="node" id="C7" transform="translate(466,554)" style="opacity: 1;"><rect rx="0" ry="0" x="-18" y="-18" width="36" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-8,-8)"><foreignobject width="16" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">C7</div></foreignobject></g></g></g><g class="node" id="C8" transform="translate(466,640)" style="opacity: 1;"><rect rx="0" ry="0" x="-18" y="-18" width="36" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-8,-8)"><foreignobject width="16" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">C8</div></foreignobject></g></g></g><g class="node" id="C9" transform="translate(466,726)" style="opacity: 1;"><rect rx="0" ry="0" x="-18" y="-18" width="36" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-8,-8)"><foreignobject width="16" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">C9</div></foreignobject></g></g></g></g></g></g></svg></div><h4 id="设置cdn节点为web代理实际不奏效"><a class="markdownIt-Anchor" href="#设置cdn节点为web代理实际不奏效"></a> 设置CDN节点为web代理（实际不奏效）</h4><ul><li>不同客户可能会使用不同代理</li><li>从安全角度考虑，缓存机制通常不能跨组织共享</li><li>可能存在多个CDN，客户端只能使用一个代理缓存，如何选择？</li><li>客户端本身已经使用了代理，不会再自行配置web代理用于CDN用途</li></ul><h4 id="镜像久经考验"><a class="markdownIt-Anchor" href="#镜像久经考验"></a> 镜像（久经考验）</h4><ul><li>源服务器网页上包含了指向不同镜像点的显式链接，通常<strong>告诉用户</strong>这些镜像点的位置</li><li>典型应用是把一个大的软件包放在不同位置的镜像点上</li><li>缺点：还是依靠用户做内容的分发（因为镜像点实际上是不同的web站点）</li></ul><h3 id="dns重定向"><a class="markdownIt-Anchor" href="#dns重定向"></a> DNS重定向</h3><ul><li>客服了上述两种方法的困难</li><li>核心设计：<strong>域名服务器同时作为CDN节点运行</strong></li></ul><h4 id="流程"><a class="markdownIt-Anchor" href="#流程"></a> 流程</h4><ul><li>DNS将<code>www.google.com</code>解析为一个IP地址，DNS查找过程不变</li><li>请求域名服务器解析解析<code>www.google.com</code>时，域名服务器<strong>不是为每个请求返回相同的IP地址，而是根据发出请求的客户端IP地址返回最靠近客户端的CDN节点的IP地址</strong></li></ul><hr><h2 id="对等网络p2p"><a class="markdownIt-Anchor" href="#对等网络p2p"></a> 对等网络（P2P）</h2><ul><li>核心技术：BitTorrent（最著名的协议）、DHT算法（分布式）</li><li>P2P网络的一个重大挑战在于当前面临各种各样的用户，而且用户具有不同的下载和上传容量，如何更好的使用带宽</li><li>P2P系统中，不可能有单个提供商具有监测整个系统的能力，但并<strong>不意味着P2P系统提供隐私保护</strong>，因为用户在一定程度上相互信任 <s>（这不就是传说中的去中心化区块链核心技术吗！原来早就有了！）</s></li></ul><h3 id="bittorrent"><a class="markdownIt-Anchor" href="#bittorrent"></a> BitTorrent</h3><h4 id="问题"><a class="markdownIt-Anchor" href="#问题"></a> 问题</h4><ol><li>一个对等用户如何<strong>找到</strong>具有自己想<strong>下载内容</strong>的<strong>其他</strong>对等<strong>用户</strong></li><li>对等用户们如何<strong>复制（上传）内容</strong>以便为大家提供高速下载</li><li>对等用户们如何相互<strong>鼓励上传</strong>内容给他人同时为自己下载内容</li></ol><h4 id="种子文件"><a class="markdownIt-Anchor" href="#种子文件"></a> 种子文件</h4><ul><li><p>包含内容</p><ul><li><strong>跟踪器</strong>，是一个服务器，将对等用户引导到种子文件内容</li><li>大小相等片或**块（chunk）**清单，给出内容哈希</li></ul></li><li><p>种子文件维护着主动上传和下载该内容的所有其他对等用户列表（用户集群）</p></li><li><p>当一个群首次形成时，有些用户必须拥有组成内容的所有块，这些对等用户就是所谓的种子（seeder）</p></li></ul><h4 id="集群维持"><a class="markdownIt-Anchor" href="#集群维持"></a> 集群维持</h4><ul><li>CDN节点是专门为用户提供内容而设置的，<strong>P2P节点不是</strong>。只下载不提供上传帮助的节点过多，系统将无法正常工作</li><li>当前正在与一个节点交换块的对等节点称为<strong>非阻塞</strong></li><li>BitTorrent奖励表现出良好上传行为的对等节点</li><li>每个对等节点<strong>随机采样</strong>其他对等节点，给他们上传块同时检索他们的块，只与少数最高下载性能的对等节点们继续交易块。同时随机尝试其他对等节点，给新加入节点获得初始块的机会</li></ul><h4 id="核心难题"><a class="markdownIt-Anchor" href="#核心难题"></a> 核心难题</h4><ul><li>跟踪器<strong>必须是分布式</strong>的，而传统思路下是集中式的</li><li>需要一个<strong>完全分布式且表现良好的P2P索引</strong></li><li>由此引入Chord、CAN、Pastry、Tapestry、Kademlia（已被实际使用，称为分布式哈希表）等解决方案</li></ul><h3 id="dht"><a class="markdownIt-Anchor" href="#dht"></a> DHT</h3><h4 id="结构"><a class="markdownIt-Anchor" href="#结构"></a> 结构</h4><ul><li>DHT需要在节点之间的通信采用一个正规结构。传统P2P系统中对等节点之间可以使用任意连接</li><li>DHT称为结构化的P2P网络</li></ul><h4 id="完全分布式且表现良好的p2p索引"><a class="markdownIt-Anchor" href="#完全分布式且表现良好的p2p索引"></a> 完全分布式且表现良好的P2P索引</h4><ul><li>每个节点只需保留<strong>少量</strong>有关<strong>其他节点的信息</strong>（即保持最新索引代价不昂贵）</li><li>每个节点可<strong>快速查看索引</strong>中表现</li><li>每个节点可以<strong>同时使用索引</strong></li></ul><h4 id="chord"><a class="markdownIt-Anchor" href="#chord"></a> Chord</h4><ul><li>总索引是所有用户集群的列表，计算机加入用户集群下载</li><li>查询索引的<strong>关键字</strong>是内容的<strong>种子文件描述</strong></li><li>总索引被广播到DHT的n个参与节点上</li><li>关键：在一个虚拟空间中使用标识符来导航索引而不是使用节点的IP或内容名称</li><li>基本概念：哈希环、一致性哈希</li></ul><h4 id="哈希环"><a class="markdownIt-Anchor" href="#哈希环"></a> 哈希环</h4><ul><li>由于不知节点标识符是否指向实际存在节点，只能线性查找，而线性查找效率低，故考虑维持一定的<strong>跳跃性查找数据结构</strong>（此处原则：每个节点保持足够的路由信息，以便它可以在常数跳数下从本地路由请求(到要访问的数据项)到适当的节点）</li><li>Chord解决方案是维持一个<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>s</mi><mi>t</mi><mi>a</mi><mi>r</mi><mi>t</mi><mo>=</mo><mi>k</mi><mo>+</mo><msup><mn>2</mn><mi>m</mi></msup></mrow><annotation encoding="application/x-tex">start = k+2^m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.77777em;vertical-align:-0.08333em;"></span><span class="base textstyle uncramped"><span class="mord mathit">s</span><span class="mord mathit">t</span><span class="mord mathit">a</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathit">t</span><span class="mrel">=</span><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="mbin">+</span><span class="mord"><span class="mord mathrm">2</span><span class="vlist"><span style="top:-0.363em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathit">m</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span>的指取表数据结构，start为标识符，start=&gt;value为该指向的实际节点</li><li>Redis的基础数据结构中包括有<strong>跳表</strong>，也有类似<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mn>2</mn><mi>m</mi></msup></mrow><annotation encoding="application/x-tex">2^m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.664392em;"></span><span class="strut bottom" style="height:0.664392em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathrm">2</span><span class="vlist"><span style="top:-0.363em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathit">m</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span>的跳跃概念，但可以设定的更加随机一些</li></ul><h4 id="其他"><a class="markdownIt-Anchor" href="#其他"></a> 其他</h4><ul><li>DHT在其他分布式技术中也有广泛的应用</li></ul><hr><h1 id="amazon-dynamo"><a class="markdownIt-Anchor" href="#amazon-dynamo"></a> Amazon Dynamo</h1><h2 id="前置操作"><a class="markdownIt-Anchor" href="#前置操作"></a> 前置操作</h2><h3 id="背景"><a class="markdownIt-Anchor" href="#背景"></a> 背景</h3><ul><li>需要存储对象较小（通常小于1MB）</li><li>Dynamo不提供任何数据隔离(Isolation)保证，只允许单一的关键更新</li><li>许多服务只需要<strong>主键</strong>访问数据存储</li><li>没有横跨多个数据项的操作，（大部分）也不需要关系方案</li><li>理论基础：<strong>当网络故障时，强一致性和高可用性不可能性同时实现</strong></li></ul><h3 id="原则目标"><a class="markdownIt-Anchor" href="#原则目标"></a> 原则目标</h3><ul><li>与其不能确定答案的正确性与否，不如让该数据一直不可用直到它绝对正确时</li><li>Dynamo的目标是一个**“永远可写”(always writable)<strong>的数据存储(即数据存储的</strong>“写”是高可用**)</li><li>设计原则：增量可扩展性、对称性、去中心化（<strong>对称性的延伸</strong>）、异质性（负载分配与服务器性能有关）</li><li>零跳(zero-hop)的DHT，每个节点维护足够的路由信息从而直接从本地将请求路由到相应的节点</li><li>提供最终一致性，从而允许更新操作可以<strong>异步</strong>地<strong>传播</strong>到所有副本</li></ul><h3 id="其他系统"><a class="markdownIt-Anchor" href="#其他系统"></a> 其他系统</h3><h4 id="oceanstore"><a class="markdownIt-Anchor" href="#oceanstore"></a> OceanStore</h4><ul><li>允许并发更新的同时避免广域锁定(wide-area locking)固有的许多问题</li><li>对于并发更新，经过一系列处理<strong>决定一个最终的更新顺序</strong>，并原子化的进行更新操作</li></ul><h2 id="技术点"><a class="markdownIt-Anchor" href="#技术点"></a> 技术点</h2><ul><li>种子节点： 防止逻辑分裂（刚加入的节点A、B彼此都不知道彼此的存在，需要“初始化”信息）</li><li>所有的节点，最终都会和种子节点协调成员关系</li></ul><h3 id="协调"><a class="markdownIt-Anchor" href="#协调"></a> 协调</h3><ul><li>何时协调冲突：将<strong>协调冲突的复杂性推给“读”</strong>，以确保“写”永远不会拒绝。</li><li>谁协调冲突：交给客户端基于最适合的客户体验决定（不通过数据存储来解决，因为数据存储能使用的策略通常较简单）</li><li>为保证永远可写，在最新版本数据不可用时，<strong>操作可能会被加到旧版本之上</strong>，修改后结果当作一个新的且不可改变的数据版本，协调得到新版本</li><li>版本分支可能发生在<strong>同一对象</strong>并发更新成功与失败的同时出现的情况，这种情况下系统<strong>没有凭据</strong>决定哪个版本，所以客户端必须执行协调，将多个分支演化后的<strong>数据崩塌(collapse)成一个合并的版本(语义协调)</strong>，因此会出现类似“购物车删除了又出现”的情况</li><li>单一地点序列化所有的写的做法会导致负荷分配不均</li></ul><h4 id="向量钟"><a class="markdownIt-Anchor" href="#向量钟"></a> 向量钟</h4><ul><li>捕捉同一对象不同版本的因果关系</li><li>因为将处理一致问题的复杂性推给了写操作，所以由read操作发现的发现向量钟描述不同版本存在冲突</li><li>当向量时钟中(节点，计数器)对的数目达到一个阈值(如10)，最早的一对将从时钟中删除</li></ul><h4 id="负载均衡方案"><a class="markdownIt-Anchor" href="#负载均衡方案"></a> 负载均衡方案</h4><ul><li>服务端自带一个节点作为负载节点</li><li>√ 由客户端完成负载功能，客户端在先前的读操作中获得了集群一个节点包含的集群状态信息，根据信息直接路由请求到适当的协调程序节点<ul><li>优点是消除了<strong>负载平衡器额外的开销</strong>以及<strong>网络一跳</strong></li><li>缺点：客户端需要<strong>状态机</strong>（服务端集群节点相关信息），且需要<strong>实时更新</strong>状态机，由此又带来额外的网络通信开销</li></ul></li><li></li></ul><h4 id="merkle树"><a class="markdownIt-Anchor" href="#merkle树"></a> Merkle树</h4><ul><li>每个节点为它承载的<strong>每个key</strong>范围(由一个虚拟节点覆盖 key 集合)维护一个<strong>单独的MerkleTree</strong></li><li>多个节点有一个key的信息，因此节点间交换key的Merkle树信息以检测是否发生变化</li></ul><h4 id="故障检测"><a class="markdownIt-Anchor" href="#故障检测"></a> 故障检测</h4><ul><li>某种程度上说明了<strong>为什么不需要中心控制节点</strong>（按常规思路，需要有一个控制中心负责故障节点的处理）：在没有客户端请求推动两个节点之间流量的情况下，节点双方<strong>并不真正需要知道</strong>对方是否可以访问或可以响应。</li><li><strong>显式</strong>的节点加入和离开的方法<strong>排除了对一个失败状态的全局性视图的需要</strong>。这是因为节点是是可以通过节点的显式加入和离开的方法知道节点永久性(permanent)增加和删除，而短暂的(temporary)节点失效是由独立的节点在他们<strong>不能</strong>与其他节点<strong>通信</strong>时发现的(当转发请求时)</li></ul><hr><h2 id="实现具体"><a class="markdownIt-Anchor" href="#实现具体"></a> 实现具体</h2><ul><li>组件：请求协调、成员、故障检测、本地持久化引擎</li></ul><h3 id="nwr模型"><a class="markdownIt-Anchor" href="#nwr模型"></a> NWR模型</h3><ul><li>低的W和R值会增加不一致性的风险，因为写请求被视为成功并返回到客户端，即使他们还未被大多数副本处理。</li><li>N的值决定了每个对象的耐久性。低的W和R值会增加不一致性的风险，因为写请求被视为成功并返回到客户端，即使他们还未被大多数副本处理。</li><li>为了减少耐用性风险，一些方案中更细化的写操作要求协调员选择N个副本中的一个执行“持久写”，写操作的性能不会因为单一副本持久化写而受到影响（因为协调员不需要等待他）</li></ul><h3 id="客户端服务端处理"><a class="markdownIt-Anchor" href="#客户端服务端处理"></a> 客户端/服务端处理</h3><ul><li>一个<strong>客户端</strong>驱动的协调方式的重要<strong>优势</strong>是不再需要一个负载平衡器来均匀分布客户的负载。公平的负载分布隐含地由近乎平均的分配key到存储节点的方式来保证的。</li></ul><hr><h1 id="参考"><a class="markdownIt-Anchor" href="#参考"></a> 参考</h1><ul><li>《计算机网络》</li><li><a href="https://cdn.discordapp.com/attachments/420095259125743637/426806877859610624/DynamoAmazon-.docx" target="_blank" rel="external">译文Dynamo：Amazon的高可用性的键-值存储系统</a></li></ul><blockquote><p>Written with <a href="https://stackedit.io/" target="_blank" rel="external">StackEdit</a>.</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
&lt;h1 id=&quot;内容分发&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#内容分发&quot;&gt;&lt;/a&gt; 内容分发&lt;/h1&gt;
&lt;h2 id=&quot;内容分发网络cdn&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#内容分发网络cdn&quot;&gt;&lt;/a&gt; 内容分发网络（CDN）&lt;/h2&gt;
&lt;h3 id=&quot;分发树&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#分发树&quot;&gt;&lt;/a&gt; 分发树&lt;/h3&gt;
    
    </summary>
    
      <category term="coding" scheme="http://blog.garenfeather.cn/categories/coding/"/>
    
    
      <category term="cdn" scheme="http://blog.garenfeather.cn/tags/cdn/"/>
    
      <category term="p2p" scheme="http://blog.garenfeather.cn/tags/p2p/"/>
    
      <category term="decentralization" scheme="http://blog.garenfeather.cn/tags/decentralization/"/>
    
      <category term="network" scheme="http://blog.garenfeather.cn/tags/network/"/>
    
  </entry>
  
  <entry>
    <title>Docker添加iptables防火墙规则构建容器间通信</title>
    <link href="http://blog.garenfeather.cn/2018/01/15/docker-iptables-containers-conmunication/"/>
    <id>http://blog.garenfeather.cn/2018/01/15/docker-iptables-containers-conmunication/</id>
    <published>2018-01-14T21:43:04.000Z</published>
    <updated>2018-01-16T14:37:47.210Z</updated>
    
    <content type="html"><![CDATA[<h2 id="一-坑从何来"><a class="markdownIt-Anchor" href="#一-坑从何来"></a> 一、坑从何来</h2><p>最近正好看到解析Docker单主机网络的部分，提到通过link链接容器，于是深入思考了下link的机制，首先如果为容器添加一条链接会发生以下几件事：</p><ul><li>描述目标容器的环境变量会被创建</li><li>链接的别名和对应目标容器的ip地址会被添加到DNS覆盖列表中</li><li>如果跨容器通信被禁止，Docker会添加特定的防火墙规则来允许被链接的容器间的通信。</li></ul><p>重点在于第三点，这里Docker添加的防火墙规则是允许两个容器通信到什么地步呢，大概有以下三种猜想：</p><a id="more"></a><ol><li>两个容器间任意端口自由通信，应该不太可能，达到这种地步接近Joined容器共用同一个网络栈的级别了</li><li>容器任意端口都能连上目标容器EXPOSE的端口</li><li>容器只有指定的的进程（如pid唯一）、指定的端口号能够连上目标容器EXPOSE的端口，至于这个指定的进程和端口号猜测是在构建的时候指定好并添加到配置中去的？</li></ol><p>最初的猜想是3，因为如果是2的话，容器被非法入侵岂不是可以新开个进程随意连上数据库往外倒数据？（<em>后来仔细想想，容器都被入侵了，跟权限被提到root了有啥区别……当然是为所欲为啊，不过当时没想清楚就是了</em>）这明显不安全。</p><p>这里验证最直观可靠的方式还是看iptables的路由规则，开始实验。</p><hr><h2 id="二-在踩坑的边缘试探"><a class="markdownIt-Anchor" href="#二-在踩坑的边缘试探"></a> 二、在踩坑的边缘试探</h2><h4 id="1实验环境"><a class="markdownIt-Anchor" href="#1实验环境"></a> 1.实验环境</h4><ul><li>Ubuntu 16.04.2 LTS (GNU/Linux 4.4.0-63-generic x86_64)</li><li>Docker version 17.05.0-ce, build 89658be</li></ul><hr><h4 id="2iptables设置"><a class="markdownIt-Anchor" href="#2iptables设置"></a> 2.iptables设置</h4><p>查看当前iptables设置：</p><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ iptables -nL</div></pre></td></tr></table></figure></div><p>以防万一大家可以先清洗一遍iptables，有配置的同学记得提前<strong>备份</strong>：</p><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ iptables -F</div></pre></td></tr></table></figure></div><p>清洗后：</p><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">Chain INPUT (policy ACCEPT)</div><div class="line">target     prot opt source               destination</div><div class="line">Chain FORWARD (policy DROP)</div><div class="line">target     prot opt source               destination</div><div class="line">Chain OUTPUT (policy ACCEPT)</div><div class="line">target     prot opt source               destination</div><div class="line">Chain DOCKER (0 references)</div><div class="line">target     prot opt source               destination</div><div class="line">Chain DOCKER-ISOLATION (0 references)</div><div class="line">target     prot opt source               destination</div></pre></td></tr></table></figure></div><hr><h4 id="3icc-iptables选项与etcdefaultdocker"><a class="markdownIt-Anchor" href="#3icc-iptables选项与etcdefaultdocker"></a> 3.icc、iptables选项与/etc/default/docker</h4><p>icc是跨容器通信开关，iptables则是Docker是否应用防火墙规则的开关，于是修改/etc/default/docker文件，禁止跨容器通信，要求Docker使用iptables规则：</p><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">DOCKER_OPTS=&quot;--icc=false --iptables=true&quot;</div></pre></td></tr></table></figure></div><p>同时去掉注释，并重启docker服务：</p><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ service docker restart</div></pre></td></tr></table></figure></div><p>再次查看当前iptables配置，可以看到docker和docker-isolation都被加入到了chain-forward项中：</p><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">Chain FORWARD (policy DROP)</div><div class="line">target     prot opt source               destination </div><div class="line">DOCKER-ISOLATION  all  --  0.0.0.0/0            0.0.0.0/0 </div><div class="line">ACCEPT     all  --  0.0.0.0/0            0.0.0.0/0            ctstate RELATED,ESTABLISHED</div><div class="line">DOCKER     all  --  0.0.0.0/0            0.0.0.0/0 </div><div class="line">ACCEPT     all  --  0.0.0.0/0            0.0.0.0/0 </div><div class="line">DROP       all  --  0.0.0.0/0            0.0.0.0/0 </div><div class="line">Chain DOCKER (1 references)</div><div class="line">target     prot opt source               destination         </div><div class="line">ACCEPT     tcp  --  172.17.0.3           172.17.0.2           tcp dpt:3306</div><div class="line">ACCEPT     tcp  --  172.17.0.2           172.17.0.3           tcp spt:3306</div><div class="line">Chain DOCKER-ISOLATION (1 references)</div><div class="line">target     prot opt source               destination </div><div class="line">RETURN     all  --  0.0.0.0/0            0.0.0.0/0</div></pre></td></tr></table></figure></div><p>此处用本机现有的mysql和redis做实验，redis依赖mysql（mysql密码请自行根据自己的配置修改）：</p><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ docker run --rm --name  mysql -e 3306 -e MYSQL_ROOT_PASSWORD=123456 -d mysql</div></pre></td></tr></table></figure></div><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ docker run --rm --name redis --link mysql:mysql -d redis</div></pre></td></tr></table></figure></div><p>操作完docker ps可以看到两个容器正常运行，但并没有看到iptables有新添加规则。</p><hr><h4 id="4docker-network"><a class="markdownIt-Anchor" href="#4docker-network"></a> 4.docker network</h4><p>之前的项目没有涉及到多网络配置，因此对network一无所知，加上无脑瞎找资料没思考清楚，误以为是两个容器不在一个网络内，于是查看默认bridge网络配置：</p><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ docker network inspect bridge</div></pre></td></tr></table></figure></div><p>部分相关配置如下：</p><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  &quot;Name&quot;: &quot;bridge&quot;,</div><div class="line">  &quot;Id&quot;: &quot;d14d164b2dbc43b33eb298d79e5928fda258129a02f6c2a7c310633a718d356c&quot;,</div><div class="line">  &quot;Created&quot;: &quot;2018-01-15T03:53:42.133885625+08:00&quot;,</div><div class="line">  &quot;Scope&quot;: &quot;local&quot;,</div><div class="line">  &quot;Driver&quot;: &quot;bridge&quot;,</div><div class="line">  &quot;EnableIPv6&quot;: false,</div><div class="line">  &quot;IPAM&quot;: &#123;</div><div class="line">    &quot;Driver&quot;: &quot;default&quot;,</div><div class="line">    &quot;Options&quot;: null,</div><div class="line">    &quot;Config&quot;: [</div><div class="line">      &#123;</div><div class="line">        &quot;Subnet&quot;: &quot;172.17.0.0/16&quot;,</div><div class="line">        &quot;Gateway&quot;: &quot;172.17.0.1&quot;</div><div class="line">      &#125;</div><div class="line">    ]</div><div class="line">  &#125;,</div><div class="line">  &quot;Internal&quot;: false,</div><div class="line">  &quot;Attachable&quot;: false,</div><div class="line">  &quot;Ingress&quot;: false,</div><div class="line">  &quot;Containers&quot;: &#123;</div><div class="line">    &quot;5b81e33ddd5e7e79e6c315bd3889812362d19732e0ce9a0486edc98a26c59e77&quot;: &#123;</div><div class="line">      &quot;Name&quot;: &quot;redis&quot;,</div><div class="line">      &quot;EndpointID&quot;: &quot;df2e9dda0de35c4934a50d33bd23cb9d27301cac3882880ba58acf82713956f4&quot;,</div><div class="line">      &quot;MacAddress&quot;: &quot;02:42:ac:11:00:03&quot;,</div><div class="line">      &quot;IPv4Address&quot;: &quot;172.17.0.3/16&quot;,</div><div class="line">      &quot;IPv6Address&quot;: &quot;&quot;</div><div class="line">    &#125;,</div><div class="line">    &quot;fada6a036ecba16bc1c08ec5b8fced59b51144a949d7c1051b78e88d7a4bb35f&quot;: &#123;</div><div class="line">      &quot;Name&quot;: &quot;mysql&quot;,</div><div class="line">      &quot;EndpointID&quot;: &quot;38a5036088b19daa08e212d947b44f3a94e823d9a2cd060d0fbfc19680591abf&quot;,</div><div class="line">      &quot;MacAddress&quot;: &quot;02:42:ac:11:00:02&quot;,</div><div class="line">      &quot;IPv4Address&quot;: &quot;172.17.0.2/16&quot;,</div><div class="line">      &quot;IPv6Address&quot;: &quot;&quot;</div><div class="line">    &#125;</div><div class="line">  &#125;,</div><div class="line">  &quot;Options&quot;: &#123;</div><div class="line">    &quot;com.docker.network.bridge.default_bridge&quot;: &quot;true&quot;,</div><div class="line">    &quot;com.docker.network.bridge.enable_icc&quot;: &quot;true&quot;,</div><div class="line">    &quot;com.docker.network.bridge.enable_ip_masquerade&quot;: &quot;true&quot;,</div><div class="line">    &quot;com.docker.network.bridge.host_binding_ipv4&quot;: &quot;0.0.0.0&quot;,</div><div class="line">    &quot;com.docker.network.bridge.name&quot;: &quot;docker0&quot;,</div><div class="line">    &quot;com.docker.network.driver.mtu&quot;: &quot;1500&quot;</div><div class="line">  &#125;,</div><div class="line">  &quot;Labels&quot;: &#123;&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></div><p>发现两个容器都在默认网络里。顺便这里有个很迷的地方就是Options里的true和false都是字符串类型，但外面的却不是，后面会提到。观察配置发现icc选项还是true，说明刚才修改的/etc/default/docker文件很可能没起作用。此处有两个选择：</p><ul><li>新建一个bridge网络，icc设为false</li><li>继续设法修改docker daemon启动选项</li></ul><p>其实并没有选择，因为就参数来看只能设置icc，而iptables使用与否必须是docker daemon启动时设置好的。直接百度到的资料杂乱无章，对错参半，于是还是根据官网操作：<br><img src="https://s1.ax2x.com/2018/01/15/MBIxe.jpg" alt="图1 docs.docker.com配置说明"><br>新建daemon.json：</p><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ vim /etc/docker/daemon.json</div></pre></td></tr></table></figure></div><p>输入以下内容</p><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  &quot;iptables&quot;: &quot;true&quot;,</div><div class="line">  &quot;icc&quot;: &quot;false&quot;</div><div class="line">&#125;</div></pre></td></tr></table></figure></div><p>并重启dockerd服务，发现会重启失败，显示：</p><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">unable to configure the Docker daemon with file /etc/docker/daemon.json: json: cannot unmarshal string into Go value of type bool</div></pre></td></tr></table></figure></div><p>这就是刚才提到的很迷的地方，欺负我们不懂go语言系列，参数改为以下内容：</p><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  &quot;iptables&quot;: true,</div><div class="line">  &quot;icc&quot;: false</div><div class="line">&#125;</div></pre></td></tr></table></figure></div><p>保存后再重启docker daemon，再次查看bridge网络，options选项中的com.docker.network.bridge.enable_icc应该为false了，说明配置生效了，此时再按上面步骤启动容器link，可以看到iptables多了两条规则：</p><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">Chain DOCKER (1 references)</div><div class="line">target     prot opt source               destination         </div><div class="line">ACCEPT     tcp  --  172.17.0.3           172.17.0.2           tcp dpt:mysql</div><div class="line">ACCEPT     tcp  --  172.17.0.2           172.17.0.3           tcp spt:mysql</div></pre></td></tr></table></figure></div><p>操作成功，可以发现两个容器之间互联的是通过forward链的转发规则，具体规则可阅读iptables forward详解。<br>外面替换一下两个容器的位置，也可以看到同样结果：</p><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ docker run --rm --name redis -e 6379 -d redis</div><div class="line">$ docker run --rm --name  mysql --link redis:redis -e MYSQL_ROOT_PASSWORD=123456 -d mysql</div></pre></td></tr></table></figure></div><p>端口变成了redis的6379：</p><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">Chain DOCKER (1 references)</div><div class="line">target     prot opt source               destination         </div><div class="line">ACCEPT     tcp  --  172.17.0.3           172.17.0.2           tcp dpt:6379</div><div class="line">ACCEPT     tcp  --  172.17.0.2           172.17.0.3           tcp spt:6379</div></pre></td></tr></table></figure></div><hr><h4 id="5结束"><a class="markdownIt-Anchor" href="#5结束"></a> 5.结束</h4><p>验证过程中很多地方没想清楚胡乱操作一通，把原本简单的问题都搞复杂了，动手前深思熟虑还是很重要的啊（俗话说得好，真正写代码的时间能有20%不错了）。</p><hr><h2 id="二-后来"><a class="markdownIt-Anchor" href="#二-后来"></a> 二、后来</h2><h4 id="1仔细想想"><a class="markdownIt-Anchor" href="#1仔细想想"></a> 1.仔细想想</h4><ul><li><p>其实当时还想顺着猜测3的思路深入思考过如果容器被非法入侵，直接攻击代码搞挂了原本的进程，用原本与目标容器3306连接的端口构建数据库的连接该怎么办……那当然是没办法啦啊哈哈哈，你说你家金库的钥匙密码人家都拿到了你的黄金怎么办，那当然是没办法的，重点应该在怎么防止密码和钥匙失窃上吧hhhhh。</p></li><li><p>而且退一步想，指定能与目标容器3306连接的端口可以办得到，但是绑定到进程上是没有实现的可能的，作为进程标识的pid是会被复用的，重启后pid会变，不可能每次重启进程都重新设定绑定关系，而且也没有设定的基础。</p></li><li><p>网络基础还是不扎实，很多东西没真正理解。</p></li></ul><h4 id="2论如何查资料"><a class="markdownIt-Anchor" href="#2论如何查资料"></a> 2.论如何查资料</h4><ul><li>珍爱生命，少查csdn，多看官方文档，过脑思考比无脑开车撞墙要好</li><li>努力改掉下意识避开英文的习惯</li><li>写操作指南不指明各种相关版本号的都是***耍流氓***</li><li><strong>基础不牢，地动山摇，我还是太天真了.jpg</strong></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;一-坑从何来&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#一-坑从何来&quot;&gt;&lt;/a&gt; 一、坑从何来&lt;/h2&gt;
&lt;p&gt;最近正好看到解析Docker单主机网络的部分，提到通过link链接容器，于是深入思考了下link的机制，首先如果为容器添加一条链接会发生以下几件事：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;描述目标容器的环境变量会被创建&lt;/li&gt;
&lt;li&gt;链接的别名和对应目标容器的ip地址会被添加到DNS覆盖列表中&lt;/li&gt;
&lt;li&gt;如果跨容器通信被禁止，Docker会添加特定的防火墙规则来允许被链接的容器间的通信。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;重点在于第三点，这里Docker添加的防火墙规则是允许两个容器通信到什么地步呢，大概有以下三种猜想：&lt;/p&gt;
    
    </summary>
    
      <category term="coding" scheme="http://blog.garenfeather.cn/categories/coding/"/>
    
    
      <category term="network" scheme="http://blog.garenfeather.cn/tags/network/"/>
    
      <category term="Docker" scheme="http://blog.garenfeather.cn/tags/Docker/"/>
    
      <category term="iptables" scheme="http://blog.garenfeather.cn/tags/iptables/"/>
    
  </entry>
  
  <entry>
    <title>进度：开放型后端开发随机聊天话题大全（误）</title>
    <link href="http://blog.garenfeather.cn/2018/01/12/backend-questions-schedule/"/>
    <id>http://blog.garenfeather.cn/2018/01/12/backend-questions-schedule/</id>
    <published>2018-01-12T03:20:35.000Z</published>
    <updated>2018-03-22T21:14:01.882Z</updated>
    
    <content type="html"><![CDATA[<h2 id="这是啥"><a class="markdownIt-Anchor" href="#这是啥"></a> 这是啥</h2><p>是一系列经典的、<strong>开放式</strong>的后端开发题目，不是具体的问题，而是以点带面、适合抛砖引玉，再逐步深入考察，源于Github工程↓</p><a id="more"></a><ul><li>英文源工程：<a href="https://github.com/arialdomartini/Back-End-Developer-Interview-Questions" target="_blank" rel="external">Back-End Developer Interview Questions</a></li><li>中文翻译（提的pr被merge了开心 ~(≧▽≦)/~）：<a href="https://github.com/monklof/Back-End-Developer-Interview-Questions" target="_blank" rel="external">后端开发面试题</a></li></ul><p>问题分为通用基础、设计、语言等多个方面，这里挑出了我自己感兴趣的部分准备慢慢深入回答，记录进度。强烈推荐各位后端开发同学们也来思考一波，<s>来啊学习啊快活啊答完你就成仙了</s></p><hr><h2 id="列表完成度10569"><a class="markdownIt-Anchor" href="#列表完成度10569"></a> 列表（完成度：10.5/69）</h2><ul><li>语言设计中空引用(null reference)的存在有什么问题？将空引用从编程语言中移除可能导致什么结果？</li><li>什么是实时系统？它与普通系统有什么区别？</li><li>实时语言(real-time language)和堆内存分配(heap memory allocation)之间的关系是什么？</li><li>如果你需要使用缓存，你使用哪些原则来确定缓存大小？</li><li>在客户端渲染(client-side rendering)和服务端渲染(server-side rendering)之间，你如何权衡？</li><li>如何在一个不可靠的协议之上构建一个可靠的通信协议？</li><li>解释什么是流(streaming)和如何实现一个流？<ul><li><s>解释</s></li><li>实现</li></ul></li><li><s>在你当前的工作流中，什么事情是你计划下一步需要自动化的？</s></li><li>当你在浏览器输入google.com时发生了什么(age old question)？</li><li>当操作系统CPU处于空闲的时候，它可能在处理哪些事情？</li><li>如何向一个五岁的孩子解释什么是Unicode/数据库事务？</li><li>一个“专业的开发者”意味着什么？</li><li>“喜欢这个的人也喜欢……”，如何在一个电子商务店里实现这种功能？</li><li>假设你工作的系统不支持事务性，你会如何从头开始实现它？</li><li>Active-Record模式有什么限制和缺陷？</li><li><s>写一个线程安全的单例类</s></li><li>你是如何处理Dependency Hell的？</li><li>内聚和耦合的区别是什么？</li><li>在存储过程（Stored Procedures）中写业务逻辑有什么优缺点？</li><li><s>告诉我你的首选语言的三个最坏的缺陷</s></li><li>闭包是什么？它有什么用途？闭包和类有什么共同点？</li><li>用一个例子说明匿名函数是有用的</li><li>命名空间有什么用？有什么可以替代他的吗？</li><li>谈谈JAVA和C#的互操作性？（或者任选其他两门语言）</li><li>你认为好的语言好在哪里？坏的语言坏在哪里？</li><li><s>什么是栈？什么是堆？</s></li><li>为什么 SELECT * FROM table WHERE field = null 不能匹配空字段？</li><li>延迟加载（lazy loading）是如何实现的？什么场景下有用？他有什么缺陷</li><li>如何找出应用中开销最大的查询？</li><li>什么是N+1问题？</li><li>NoSQL是如何解决可伸缩性挑战的？</li><li>什么情况下你会使用类似于MongoDB的文档数据库而不是关系型数据库</li><li>分布式版本控制系统，相比集中式版本控制系统有哪些优势和劣势？</li><li><s>能描述下什么是GitHubFlow和GitFlow工作流吗？</s></li><li><s>什么是rebase？</s></li><li>为什么我们需要并发呢？解释一下</li><li>为什么测试多线程/并发代码这么困难？</li><li>什么是竞争条件（Race Condition）？用任何语言写一个例子？</li><li>什么是死锁？用代码解释一下？</li><li>什么是饿死？</li><li>什么是Wait-Free算法？</li><li>怎么测试一个分布式系统</li><li>什么场景下你会在两个系统中采用异步通信机制？</li><li>远程调用的通用缺点是什么？</li><li>Web应用中如何管理容错性？在桌面端呢？</li><li>让我们来谈谈网络分裂（network partitions）后的几种恢复手段吧？</li><li>你在什么时候会使用Request/Response模式，什么时候会使用Publish/Subscribe模式？</li><li>只用LIFO栈如何构造一个FIFO队列？只用FIFO队列如何构造一个LIFO栈？</li><li><s>写一段有栈溢出的代码</s></li><li>写一个生成随机迷宫的程序</li><li><s>写一段有内存泄漏的示例代码</s></li><li>写一个简单的垃圾回收系统</li><li>写一个基础的Web服务器，然后画一张线路图，展示你将来还想要实现的功能</li><li><s>如何对一个10GB的文件进行排序？如果是10TB的数据，你会采用什么方法？</s></li><li>请事先rnd()函数</li><li>什么情况下缓存是没用的，甚至是危险的？</li><li>横向扩展（scale out）vs 纵向扩展（scale up）:有什么区别？分别在什么场景下使用？</li><li>分布式系统中如何处理“故障切换（failover）”和“用户会话（user session）”？</li><li>如果让你来设计一个去中心化的P2P系统，你会如何设计？</li><li>为什么CGI的扩展性不好？</li><li>在可扩展性上，发布/订阅（Publish/Subscribe）模式有什么缺点？</li><li>除了恶意攻击造成的拒绝服务现象以外，哪些设计或者架构上的问题会导致拒绝服务？</li><li>一个系统要有什么特征才能适配云计算环境？</li><li>什么是双因素认证（Two Factor Authentication）？ 在一个已有的Web应用中，你如何实现这种机制？</li><li>这段JavaScript函数的输出是什么？</li><li>你能指出哪儿有内存泄漏吗？</li><li><s>如何重构这段代码？</s></li></ul><blockquote><p>Written with <a href="https://stackedit.io/" target="_blank" rel="external">StackEdit</a>.</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;这是啥&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#这是啥&quot;&gt;&lt;/a&gt; 这是啥&lt;/h2&gt;
&lt;p&gt;是一系列经典的、&lt;strong&gt;开放式&lt;/strong&gt;的后端开发题目，不是具体的问题，而是以点带面、适合抛砖引玉，再逐步深入考察，源于Github工程↓&lt;/p&gt;
    
    </summary>
    
      <category term="coding" scheme="http://blog.garenfeather.cn/categories/coding/"/>
    
    
      <category term="backend" scheme="http://blog.garenfeather.cn/tags/backend/"/>
    
      <category term="schedule" scheme="http://blog.garenfeather.cn/tags/schedule/"/>
    
  </entry>
  
  <entry>
    <title>非阻塞I/O详解——翻译（1.26更新未完）</title>
    <link href="http://blog.garenfeather.cn/2018/01/03/nonblocking-io-translation/"/>
    <id>http://blog.garenfeather.cn/2018/01/03/nonblocking-io-translation/</id>
    <published>2018-01-03T07:21:28.000Z</published>
    <updated>2018-03-22T14:09:35.923Z</updated>
    
    <content type="html"><![CDATA[<h1 id="非阻塞io详解翻译"><a class="markdownIt-Anchor" href="#非阻塞io详解翻译"></a> 非阻塞I/O详解——翻译</h1><p>标签（空格分隔）： 非阻塞 IO</p><hr><ul><li>Author: <a href="https://medium.com/@copyconstruct?source=post_header_lockup" target="_blank" rel="external">Cindy Sridharan</a></li><li>Time: Oct 25, 2017</li><li>Original: <a href="https://medium.com/@copyconstruct/nonblocking-i-o-99948ad7c957" target="_blank" rel="external">Nonblocking I/O</a></li></ul><a id="more"></a><h2 id="非阻塞io"><a class="markdownIt-Anchor" href="#非阻塞io"></a> 非阻塞I/O</h2><h3 id="描述符究竟是什么"><a class="markdownIt-Anchor" href="#描述符究竟是什么"></a> 描述符究竟是什么</h3><p>Unix中所有的I/O的基础构建模块都是一个字节序列。而大多数程序甚至运行在更简单的抽象层次————一个字节流或I/O流上。</p><p>进程通过<strong>描述符</strong>来引用若干个I/O流，描述符又被人们熟知为<strong>文件描述符</strong>。而管道、文件、FIFO队列、POSIX的IPC机制（消息队列、信号量、共享内存）以及事件队列等都是通过<strong>描述符</strong>引用I/O流的实例。</p><p>描述符或是由诸如<em>open、pipe、socket</em>等系统调用显式创建，或是从父进程处继承。在以下情形描述符会被释放：</p><ul><li>进程退出</li><li><strong>close</strong>系统函数被调用</li><li>被标记为<em>close on exec</em>的情况下，在函数exec调用后隐式释放</li></ul><p>这里注意<em>close on exec</em>————一个进程分叉时，它所有的描述符都会“复制”到子进程中去。如果描述符中有哪一个被标记为<em>close on exec</em>，那么在父进程调用fork之后而子进程执行exec之前，子进程中被标记为close on exec的描述符会被关闭，变为不可用状态</p><p>数据转换过程的发生实际上就是是read或write的系统函数被调用</p><p><img src="https://cdn-images-1.medium.com/max/1600/1*gfTRsvc5wJlEeAA1O3QD3g.png" alt="第七章. I/O 系统 概述, 来自《FreeBSD操作系统的设计与实现. 第315页"></p><p>每个描述符指向一个数据结构，称为内核中的文件条目（file entry），该结构以字节为单位维护一个文件偏移量（file offset），从文件条目对象的开头开始。open系统调用创建一个新的文件条目，其中包含了每单个描述符的文件偏移量。</p><p>编辑：fork系统调用致使描述符在父子进程间共享（引用语义上的）。所以父子进程实际上使用同一个描述符，在文件条目中引用同一个偏移量。dup/dup2也使用同样的语义来复制一个文件描述符</p><p>在Slack的<a href="https://dist-sys-slack.herokuapp.com/" target="_blank" rel="external">dist-sys</a>里可见的C示例代码确认了这一点</p><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="C"><figure class="iseeu highlight /c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/stat.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fcntl.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">char</span> *argv[])</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> fd = open(<span class="string">"abc.txt"</span>, O_WRONLY | O_CREAT | O_TRUNC, <span class="number">0666</span>);</div><div class="line">    fork();</div><div class="line">    write(fd, <span class="string">"xyz"</span>, <span class="number">3</span>);</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"%ld\n"</span>, lseek(fd, <span class="number">0</span>, SEEK_CUR));</div><div class="line">    close(fd);</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></div><p>运行结果：</p><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="C"><figure class="iseeu highlight /c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="number">3</span></div><div class="line"><span class="number">6</span></div></pre></td></tr></table></figure></div><p>更有趣的是在描述符被共享的情况下<em>close on exec</em>标志位所做的事。我的猜测是如果该标志位的设置会将这一描述符从子进程描述符表中移除，以至于父进程可以继续使用，而子进程在<em>exec</em>执行之后则无法使用该描述符</p><p>因为多个描述符可能会引用同一个文件条目，文件条目的数据结构中为每个描述符维护着相应的偏移量。<em>Read</em>和<em>Write</em>的调用操作从该偏移量处开始执行，偏移量本身也在每次数据转换后更新自身值。偏移量决定了下一个读或写操作从文件条目的什么位置开始。进程</p><h3 id="非阻塞描述符"><a class="markdownIt-Anchor" href="#非阻塞描述符"></a> 非阻塞描述符</h3><h4 id="条件触发"><a class="markdownIt-Anchor" href="#条件触发"></a> 条件触发</h4><h4 id="边缘触发"><a class="markdownIt-Anchor" href="#边缘触发"></a> 边缘触发</h4><h3 id="描述符的多路io"><a class="markdownIt-Anchor" href="#描述符的多路io"></a> 描述符的多路I/O</h3><ul><li>非阻塞型I/O</li><li>信号驱动型I/O</li><li>轮询型I/O</li><li>BSD专用内核事件轮询型I/O（kevent系统调用）</li></ul><h3 id="非阻塞型io"><a class="markdownIt-Anchor" href="#非阻塞型io"></a> 非阻塞型I/O</h3><h4 id="描述符发生了什么"><a class="markdownIt-Anchor" href="#描述符发生了什么"></a> 描述符发生了什么</h4><h4 id="进程发生了什么"><a class="markdownIt-Anchor" href="#进程发生了什么"></a> 进程发生了什么</h4><h4 id="内核发生了什么"><a class="markdownIt-Anchor" href="#内核发生了什么"></a> 内核发生了什么</h4><h4 id="缺陷是什么"><a class="markdownIt-Anchor" href="#缺陷是什么"></a> 缺陷是什么</h4><ul><li>频繁查询确认：</li><li>非频繁查询确认：</li></ul><h4 id="什么情况下适用"><a class="markdownIt-Anchor" href="#什么情况下适用"></a> 什么情况下适用？</h4><h3 id="信号驱动型io"><a class="markdownIt-Anchor" href="#信号驱动型io"></a> 信号驱动型I/O</h3><h4 id="描述符发生了什么-2"><a class="markdownIt-Anchor" href="#描述符发生了什么-2"></a> 描述符发生了什么</h4><h4 id="进程发生了什么-2"><a class="markdownIt-Anchor" href="#进程发生了什么-2"></a> 进程发生了什么</h4><h4 id="内核发生了什么-2"><a class="markdownIt-Anchor" href="#内核发生了什么-2"></a> 内核发生了什么</h4><h4 id="缺陷是什么-2"><a class="markdownIt-Anchor" href="#缺陷是什么-2"></a> 缺陷是什么</h4><h4 id="什么情况下适用-2"><a class="markdownIt-Anchor" href="#什么情况下适用-2"></a> 什么情况下适用？</h4><h3 id="轮询型io"><a class="markdownIt-Anchor" href="#轮询型io"></a> 轮询型I/O</h3><h4 id="描述符发生了什么-3"><a class="markdownIt-Anchor" href="#描述符发生了什么-3"></a> 描述符发生了什么</h4><h4 id="进程发生了什么-3"><a class="markdownIt-Anchor" href="#进程发生了什么-3"></a> 进程发生了什么</h4><h4 id="内核发生了什么-3"><a class="markdownIt-Anchor" href="#内核发生了什么-3"></a> 内核发生了什么</h4><h4 id="缺陷是什么-3"><a class="markdownIt-Anchor" href="#缺陷是什么-3"></a> 缺陷是什么</h4><h4 id="什么情况下适用-3"><a class="markdownIt-Anchor" href="#什么情况下适用-3"></a> 什么情况下适用？</h4><h3 id="bsd内核事件轮询型io"><a class="markdownIt-Anchor" href="#bsd内核事件轮询型io"></a> BSD内核事件轮询型I/O</h3><h4 id="描述符发生了什么-4"><a class="markdownIt-Anchor" href="#描述符发生了什么-4"></a> 描述符发生了什么</h4><h4 id="进程发生了什么-4"><a class="markdownIt-Anchor" href="#进程发生了什么-4"></a> 进程发生了什么</h4><h4 id="内核发生了什么-4"><a class="markdownIt-Anchor" href="#内核发生了什么-4"></a> 内核发生了什么</h4><h4 id="缺陷是什么-4"><a class="markdownIt-Anchor" href="#缺陷是什么-4"></a> 缺陷是什么</h4><h4 id="什么情况下适用-4"><a class="markdownIt-Anchor" href="#什么情况下适用-4"></a> 什么情况下适用？</h4><h3 id="posix异步io"><a class="markdownIt-Anchor" href="#posix异步io"></a> POSIX异步I/O</h3><p>在Linux上，执行并行I/O的另一种方法是使用依赖于<a href="https://www.gnu.org/software/libc/manual/html_node/Asynchronous-I_002fO.html" target="_blank" rel="external">glibc</a>的<a href="threads%20based%20implementation">基于多线程实现</a></p><blockquote><p><em>These functions are part of the library with realtime functions named librt. They are not actually part of the libc binary. The implementation of these functions can be done using support in the kernel (if available) or using an implementation based on threads at user level. In the latter case it might be necessary to link applications with the thread library libpthread in addition to librt.</em></p></blockquote><p>当然，这种方式也不是没有缺点的：</p><blockquote><p><em>This has a number of limitations, most notably that maintaining multiple threads to perform I/O operations is expensive and scales poorly. Work has been in progress for some time on a kernel state-machine-based implementation of asynchronous I/O (see <a href="https://linux.die.net/man/2/io_submit" target="_blank" rel="external">io_submit</a>, <a href="https://linux.die.net/man/2/io_setup" target="_blank" rel="external">io_setup</a>, <a href="https://linux.die.net/man/2/io_cancel" target="_blank" rel="external">io_cancel</a>, <a href="https://linux.die.net/man/2/io_destroy" target="_blank" rel="external">io_destroy</a>, <a href="https://linux.die.net/man/2/io_getevents" target="_blank" rel="external">io_getevents</a>), but this implementation hasn’t yet matured to the point where the POSIX AIO implementation can be completely reimplemented using the kernel system calls.</em></p></blockquote><p>在FreeBSD上，POSIX AIO 通过<a href="https://www.freebsd.org/cgi/man.cgi?query=aio&amp;sektion=4" target="_blank" rel="external">aio</a>系统调用实现。队列中的I/O操作会由一个异步的“内核进程”（又被称为“内核I/O守护进程”或“AIO守护进程”）来执行。多个AIO守护进程被分到一系列可配置池里。每个池子会根据负载情况增加或移除AIO守护进程。其中一个AIO守护进程池被用于为socket们的异步I/O请求提供服务，另一个则用于服务除对原始磁盘的异步I/O请求以外的全部异步I/O请求</p><p>执行一个异步I/O操作过程是这样的：</p><ul><li><p>内核创建一个异步I/O请求结构，结构内包含执行所需相关信息</p></li><li><p>如果内核缓冲区无法立即容纳请求的资源，该请求结构会进入队列中</p></li><li><p>如果请求创建时，AIO守护进程不可用，请求结构会进入队列等待进程和系统调用返回</p></li><li><p>下一个可用的AIO守护进程使用内核的同步路径来处理该请求</p></li><li><p>守护进程完成I/O后，请求结构被标记为完成，并返回相应结果或错误码</p></li><li><p>如果I/O操作完成，进程使用<a href="http://pubs.opengroup.org/onlinepubs/9699919799/functions/aio_error.html" target="_blank" rel="external">aio_error</a>系统调用来轮询，这个是调用通过检查之前内核创建的异步I/O请求结构状态来实现的</p></li><li><p>如果进程运行到了I/O不完成就无法继续的地方，它可以调用<a href="http://pubs.opengroup.org/onlinepubs/9699919799/functions/aio_suspend.html" target="_blank" rel="external">aio_suspend</a>等待直到I/O完成</p></li><li><p>进程会在AIO请求结构处被投入睡眠，当I/O操作完成时进程会被唤醒，或进程本身设置了当I/O操作完成时发送一个信号给自己中断唤醒</p></li><li><p>当标识I/O操作完成的<a href="http://pubs.opengroup.org/onlinepubs/9699919799/functions/aio_suspend.html" target="_blank" rel="external">aio_suspend</a>、<a href="http://pubs.opengroup.org/onlinepubs/9699919799/functions/aio_error.html" target="_blank" rel="external">aio_error</a>返回或中断信号到达时，使用<a href="http://pubs.opengroup.org/onlinepubs/9699919799/functions/aio_return.html" target="_blank" rel="external">aio_return</a>系统调用来获得其返回结果</p></li></ul><blockquote><p>Written with <a href="https://stackedit.io/" target="_blank" rel="external">StackEdit</a>.</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;非阻塞io详解翻译&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#非阻塞io详解翻译&quot;&gt;&lt;/a&gt; 非阻塞I/O详解——翻译&lt;/h1&gt;
&lt;p&gt;标签（空格分隔）： 非阻塞 IO&lt;/p&gt;
&lt;hr&gt;
&lt;ul&gt;
&lt;li&gt;Author: &lt;a href=&quot;https://medium.com/@copyconstruct?source=post_header_lockup&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Cindy Sridharan&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Time: Oct 25, 2017&lt;/li&gt;
&lt;li&gt;Original: &lt;a href=&quot;https://medium.com/@copyconstruct/nonblocking-i-o-99948ad7c957&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Nonblocking I/O&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="translation" scheme="http://blog.garenfeather.cn/categories/translation/"/>
    
    
      <category term="network" scheme="http://blog.garenfeather.cn/tags/network/"/>
    
      <category term="nonblocking" scheme="http://blog.garenfeather.cn/tags/nonblocking/"/>
    
      <category term="asynchrounous" scheme="http://blog.garenfeather.cn/tags/asynchrounous/"/>
    
      <category term="synchrounous" scheme="http://blog.garenfeather.cn/tags/synchrounous/"/>
    
  </entry>
  
  <entry>
    <title>分布式与高可用（2）——基本存储</title>
    <link href="http://blog.garenfeather.cn/2017/12/28/distributed-storage-ha-clusters-2/"/>
    <id>http://blog.garenfeather.cn/2017/12/28/distributed-storage-ha-clusters-2/</id>
    <published>2017-12-28T08:21:29.000Z</published>
    <updated>2018-04-06T07:07:13.422Z</updated>
    
    <content type="html"><![CDATA[<hr><h1 id="分布式存储系统"><a class="markdownIt-Anchor" href="#分布式存储系统"></a> 分布式存储系统</h1><h2 id="基本概念"><a class="markdownIt-Anchor" href="#基本概念"></a> 基本概念</h2><ul><li><p>三态：成功、失败、超时。</p></li><li><p>协议类型：租约协议、复制协议、一致性协议</p></li><li><p>目标</p><ul><li>可扩展性，最终目标是<strong>线性可扩展</strong></li><li>功能，最终目标是支持<strong>全功能SQL</strong></li></ul></li><li><p>RPC请求成功但超时</p></li></ul><a id="more"></a><div class="mermaid"><svg id="mermaid-svg-6310158b64038059" width="100%" xmlns="http://www.w3.org/2000/svg" height="100%" style="max-width:475px;" viewbox="-50 -10 475 296"><style>  .mermaid .label{font-family:trebuchet ms,verdana,arial;color:#333}.node circle,.node ellipse,.node polygon,.node rect{fill:#cde498;stroke:#13540c;stroke-width:1px}.node.clickable{cursor:pointer}.arrowheadPath{fill:green}.edgePath .path{stroke:green;stroke-width:1.5px}.edgeLabel{background-color:#e8e8e8}.cluster rect{fill:#cdffb2!important;rx:4!important;stroke:#6eaa49!important;stroke-width:1px!important}.cluster text{fill:#333}.actor{stroke:#13540c;fill:#cde498}text.actor{fill:#000;stroke:none}.actor-line{stroke:grey}.messageLine0{marker-end:"url(#arrowhead)"}.messageLine0,.messageLine1{stroke-width:1.5;stroke-dasharray:"2 2";stroke:#333}#arrowhead{fill:#333}#crosshead path{fill:#333!important;stroke:#333!important}.messageText{fill:#333;stroke:none}.labelBox{stroke:#326932;fill:#cde498}.labelText,.loopText{fill:#000;stroke:none}.loopLine{stroke-width:2;stroke-dasharray:"2 2";marker-end:"url(#arrowhead)";stroke:#326932}.note{stroke:#6eaa49;fill:#fff5ad}.noteText{fill:#000;stroke:none;font-family:trebuchet ms,verdana,arial;font-size:14px}.section{stroke:none;opacity:.2}.section0,.section2{fill:#6eaa49}.section1,.section3{fill:#fff;opacity:.2}.sectionTitle0,.sectionTitle1,.sectionTitle2,.sectionTitle3{fill:#333}.sectionTitle{text-anchor:start;font-size:11px;text-height:14px}.grid .tick{stroke:#d3d3d3;opacity:.3;shape-rendering:crispEdges}.grid path{stroke-width:0}.today{fill:none;stroke:red;stroke-width:2px}.task{stroke-width:2}.taskText{text-anchor:middle;font-size:11px}.taskTextOutsideRight{fill:#000;text-anchor:start;font-size:11px}.taskTextOutsideLeft{fill:#000;text-anchor:end;font-size:11px}.taskText0,.taskText1,.taskText2,.taskText3{fill:#fff}.task0,.task1,.task2,.task3{fill:#487e3a;stroke:#13540c}.taskTextOutside0,.taskTextOutside1,.taskTextOutside2,.taskTextOutside3{fill:#000}.active0,.active1,.active2,.active3{fill:#cde498;stroke:#13540c}.activeText0,.activeText1,.activeText2,.activeText3{fill:#000!important}.done0,.done1,.done2,.done3{stroke:grey;fill:#d3d3d3;stroke-width:2}.doneText0,.doneText1,.doneText2,.doneText3{fill:#000!important}.crit0,.crit1,.crit2,.crit3{stroke:#f88;fill:red;stroke-width:2}.activeCrit0,.activeCrit1,.activeCrit2,.activeCrit3{stroke:#f88;fill:#cde498;stroke-width:2}.doneCrit0,.doneCrit1,.doneCrit2,.doneCrit3{stroke:#f88;fill:#d3d3d3;stroke-width:2;cursor:pointer;shape-rendering:crispEdges}.activeCritText0,.activeCritText1,.activeCritText2,.activeCritText3,.doneCritText0,.doneCritText1,.doneCritText2,.doneCritText3{fill:#000!important}.titleText{text-anchor:middle;font-size:18px;fill:#000}g.classGroup text{fill:#13540c;stroke:none;font-family:trebuchet ms,verdana,arial;font-size:10px}g.classGroup rect{fill:#cde498;stroke:#13540c}g.classGroup line{stroke:#13540c;stroke-width:1}svg .classLabel .box{stroke:none;stroke-width:0;fill:#cde498;opacity:.5}svg .classLabel .label{fill:#13540c;font-size:10px}.relation{stroke:#13540c;stroke-width:1;fill:none}#compositionEnd,#compositionStart,.composition{fill:#13540c;stroke:#13540c;stroke-width:1}#aggregationEnd,#aggregationStart,.aggregation{fill:#cde498;stroke:#13540c;stroke-width:1}#dependencyEnd,#dependencyStart,#extensionEnd,#extensionStart{fill:#13540c;stroke:#13540c;stroke-width:1}.node text{font-size:14px}.node text,div.mermaidTooltip{font-family:trebuchet ms,verdana,arial}div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-size:12px;background:#cdffb2;border:1px solid #6eaa49;border-radius:2px;pointer-events:none;z-index:100}svg {  color: rgb(0, 0, 0);  font: normal normal 400 normal 16px / normal "Times New Roman";}  </style><g/><g><line id="actor0" x1="75" y1="5" x2="75" y2="285" class="actor-line" stroke-width="0.5px" stroke="#999"/><rect x="0" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"/><text x="75" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="75" dy="0">Client</tspan></text></g><g><line id="actor1" x1="275" y1="5" x2="275" y2="285" class="actor-line" stroke-width="0.5px" stroke="#999"/><rect x="200" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"/><text x="275" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="275" dy="0">Server</tspan></text></g><defs><marker id="arrowhead" refx="5" refy="2" markerwidth="6" markerheight="4" orient="auto"><path d="M 0,0 V 4 L6,2 Z"/></marker></defs><defs><marker id="crosshead" markerwidth="15" markerheight="8" orient="auto" refx="16" refy="4"><path fill="black" stroke="#000000" stroke-width="1px" d="M 9,2 V 6 L16,4 Z" style="stroke-dasharray: 0, 0;"/><path fill="none" stroke="#000000" stroke-width="1px" d="M 0,1 L 6,7 M 6,1 L 0,7" style="stroke-dasharray: 0, 0;"/></marker></defs><g><text x="175" y="93" class="messageText" style="text-anchor: middle;">请求</text><line x1="75" y1="100" x2="275" y2="100" class="messageLine0" stroke-width="2" stroke="black" style="fill: none;"/></g><g><text x="275" y="128" class="messageText" style="text-anchor: middle;">请求处理成功</text><path d="M 275,135 C 335,125 335,165 275,155" class="messageLine0" stroke-width="2" stroke="black" style="fill: none;"/></g><g><text x="175" y="193" class="messageText" style="text-anchor: middle;">网络异常</text><line x1="275" y1="200" x2="75" y2="200" class="messageLine1" stroke-width="2" stroke="black" style="stroke-dasharray: 3, 3; fill: none;"/></g><g><rect x="0" y="220" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"/><text x="75" y="252.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="75" dy="0">Client</tspan></text></g><g><rect x="200" y="220" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"/><text x="275" y="252.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="275" dy="0">Server</tspan></text></g></svg></div><div class="mermaid"><svg id="mermaid-svg-1bfcb7bfa0aa04f7" width="100%" xmlns="http://www.w3.org/2000/svg" height="100%" style="max-width:475px;" viewbox="-50 -10 475 307"><style>  .mermaid .label{font-family:trebuchet ms,verdana,arial;color:#333}.node circle,.node ellipse,.node polygon,.node rect{fill:#cde498;stroke:#13540c;stroke-width:1px}.node.clickable{cursor:pointer}.arrowheadPath{fill:green}.edgePath .path{stroke:green;stroke-width:1.5px}.edgeLabel{background-color:#e8e8e8}.cluster rect{fill:#cdffb2!important;rx:4!important;stroke:#6eaa49!important;stroke-width:1px!important}.cluster text{fill:#333}.actor{stroke:#13540c;fill:#cde498}text.actor{fill:#000;stroke:none}.actor-line{stroke:grey}.messageLine0{marker-end:"url(#arrowhead)"}.messageLine0,.messageLine1{stroke-width:1.5;stroke-dasharray:"2 2";stroke:#333}#arrowhead{fill:#333}#crosshead path{fill:#333!important;stroke:#333!important}.messageText{fill:#333;stroke:none}.labelBox{stroke:#326932;fill:#cde498}.labelText,.loopText{fill:#000;stroke:none}.loopLine{stroke-width:2;stroke-dasharray:"2 2";marker-end:"url(#arrowhead)";stroke:#326932}.note{stroke:#6eaa49;fill:#fff5ad}.noteText{fill:#000;stroke:none;font-family:trebuchet ms,verdana,arial;font-size:14px}.section{stroke:none;opacity:.2}.section0,.section2{fill:#6eaa49}.section1,.section3{fill:#fff;opacity:.2}.sectionTitle0,.sectionTitle1,.sectionTitle2,.sectionTitle3{fill:#333}.sectionTitle{text-anchor:start;font-size:11px;text-height:14px}.grid .tick{stroke:#d3d3d3;opacity:.3;shape-rendering:crispEdges}.grid path{stroke-width:0}.today{fill:none;stroke:red;stroke-width:2px}.task{stroke-width:2}.taskText{text-anchor:middle;font-size:11px}.taskTextOutsideRight{fill:#000;text-anchor:start;font-size:11px}.taskTextOutsideLeft{fill:#000;text-anchor:end;font-size:11px}.taskText0,.taskText1,.taskText2,.taskText3{fill:#fff}.task0,.task1,.task2,.task3{fill:#487e3a;stroke:#13540c}.taskTextOutside0,.taskTextOutside1,.taskTextOutside2,.taskTextOutside3{fill:#000}.active0,.active1,.active2,.active3{fill:#cde498;stroke:#13540c}.activeText0,.activeText1,.activeText2,.activeText3{fill:#000!important}.done0,.done1,.done2,.done3{stroke:grey;fill:#d3d3d3;stroke-width:2}.doneText0,.doneText1,.doneText2,.doneText3{fill:#000!important}.crit0,.crit1,.crit2,.crit3{stroke:#f88;fill:red;stroke-width:2}.activeCrit0,.activeCrit1,.activeCrit2,.activeCrit3{stroke:#f88;fill:#cde498;stroke-width:2}.doneCrit0,.doneCrit1,.doneCrit2,.doneCrit3{stroke:#f88;fill:#d3d3d3;stroke-width:2;cursor:pointer;shape-rendering:crispEdges}.activeCritText0,.activeCritText1,.activeCritText2,.activeCritText3,.doneCritText0,.doneCritText1,.doneCritText2,.doneCritText3{fill:#000!important}.titleText{text-anchor:middle;font-size:18px;fill:#000}g.classGroup text{fill:#13540c;stroke:none;font-family:trebuchet ms,verdana,arial;font-size:10px}g.classGroup rect{fill:#cde498;stroke:#13540c}g.classGroup line{stroke:#13540c;stroke-width:1}svg .classLabel .box{stroke:none;stroke-width:0;fill:#cde498;opacity:.5}svg .classLabel .label{fill:#13540c;font-size:10px}.relation{stroke:#13540c;stroke-width:1;fill:none}#compositionEnd,#compositionStart,.composition{fill:#13540c;stroke:#13540c;stroke-width:1}#aggregationEnd,#aggregationStart,.aggregation{fill:#cde498;stroke:#13540c;stroke-width:1}#dependencyEnd,#dependencyStart,#extensionEnd,#extensionStart{fill:#13540c;stroke:#13540c;stroke-width:1}.node text{font-size:14px}.node text,div.mermaidTooltip{font-family:trebuchet ms,verdana,arial}div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-size:12px;background:#cdffb2;border:1px solid #6eaa49;border-radius:2px;pointer-events:none;z-index:100}svg {  color: rgb(0, 0, 0);  font: normal normal 400 normal 16px / normal "Times New Roman";}  </style><g/><g><line id="actor0" x1="75" y1="5" x2="75" y2="296" class="actor-line" stroke-width="0.5px" stroke="#999"/><rect x="0" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"/><text x="75" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="75" dy="0">Client</tspan></text></g><g><line id="actor1" x1="275" y1="5" x2="275" y2="296" class="actor-line" stroke-width="0.5px" stroke="#999"/><rect x="200" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"/><text x="275" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="275" dy="0">Server</tspan></text></g><defs><marker id="arrowhead" refx="5" refy="2" markerwidth="6" markerheight="4" orient="auto"><path d="M 0,0 V 4 L6,2 Z"/></marker></defs><defs><marker id="crosshead" markerwidth="15" markerheight="8" orient="auto" refx="16" refy="4"><path fill="black" stroke="#000000" stroke-width="1px" d="M 9,2 V 6 L16,4 Z" style="stroke-dasharray: 0, 0;"/><path fill="none" stroke="#000000" stroke-width="1px" d="M 0,1 L 6,7 M 6,1 L 0,7" style="stroke-dasharray: 0, 0;"/></marker></defs><g><text x="175" y="93" class="messageText" style="text-anchor: middle;">请求</text><line x1="75" y1="100" x2="275" y2="100" class="messageLine0" stroke-width="2" stroke="black" style="fill: none;"/></g><g><text x="275" y="128" class="messageText" style="text-anchor: middle;">请求处理成功</text><path d="M 275,135 C 335,125 335,165 275,155" class="messageLine0" stroke-width="2" stroke="black" style="fill: none;"/></g><g><rect x="100" y="175" fill="#EDF2AE" stroke="#666" width="150" height="36" rx="0" ry="0" class="note"/><text x="116" y="198" fill="black" class="noteText"><tspan x="116" fill="black">服务器宕机</tspan></text></g><g><rect x="0" y="231" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"/><text x="75" y="263.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="75" dy="0">Client</tspan></text></g><g><rect x="200" y="231" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"/><text x="275" y="263.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle;"><tspan x="275" dy="0">Server</tspan></text></g></svg></div><ul><li>一致性：强（更新后的数据都一定能被看到）、弱（能容忍更新后部分访问不到）、最终</li></ul><h3 id="副本是分布式存储系统容错技术的唯一手段"><a class="markdownIt-Anchor" href="#副本是分布式存储系统容错技术的唯一手段"></a> 副本是分布式存储系统容错技术的唯一手段</h3><ul><li><p>理论核心：如何保证副本一致（，存储系统角度）</p></li><li><p>全局角度</p><ul><li>顺序一致性：<strong>进程自身</strong>看执行顺序与实际一致，不在进程间按照物理时间进行全局排序。</li><li>线性一致性：<strong>系统</strong>等价于是<strong>顺序执行</strong>，所有进程看到的所有操作的序列顺序都一致，并且跟实际发生顺序一致</li></ul></li><li><p>客户端角度（一般要求↓都要支持）</p><ul><li>读写一致性</li><li>会话一致性：会话期间保持读写一致性</li><li>单调读一致性：客户端已读取某个值，不会再读取更早的值</li><li>单调写一致性：写操作按顺序完成（意味着存储系统多个副本也按客户端顺序完成）</li></ul></li><li><p>存储系统</p><ul><li>副本一致性：不一致的时间窗口？</li><li>更新顺序一致性（FIFO一致性）：副本间更新顺序</li></ul></li></ul><hr><h2 id="技术选用优劣对比"><a class="markdownIt-Anchor" href="#技术选用优劣对比"></a> 技术选用优劣对比</h2><ul><li>性能对比程度标注</li></ul><p><img src="https://media.discordapp.net/attachments/420095259125743637/431691115666604032/81b78497jw1ej3xmerc23j20ss0cstd8.jpg" alt="各种常用技术优劣权衡性能对比"></p><h3 id="master-slave"><a class="markdownIt-Anchor" href="#master-slave"></a> Master-Slave</h3><ul><li><p>通常为异步操作，同步类型的实现困难</p><ul><li>吞吐量较高、延迟较低</li></ul></li><li><p>大部分 RDBMSes</p><ul><li>例：MySQL二进制日志</li></ul></li><li><p>弱/最终一致性</p><ul><li>粒度非常重要</li></ul></li><li><p>数据存储：当前</p></li></ul><h3 id="multi-master-replication"><a class="markdownIt-Anchor" href="#multi-master-replication"></a> Multi-Master Replication</h3><ul><li><p>Umbrella term for merging concurrent writes</p></li><li><p>异步，最终一致性</p><ul><li>例如，使用时间戳机制的Oracle：单调递增的时间戳</li><li>SPOF，Master节点选举</li><li>或分布式一致性协议</li></ul></li><li><p>不支持全局事务性</p></li><li><p>数据存储：非强一致性</p></li></ul><h3 id="二阶段提交"><a class="markdownIt-Anchor" href="#二阶段提交"></a> 二阶段提交</h3><ul><li><p>半分布式一致性协议</p></li><li><p>组成：参与者、协助者</p></li><li><p>1：提出提案（参与者在此处有<strong>资源上锁</strong>等操作）。2：投票。3：提交/废弃（只要有<strong>一个参与者拒绝</strong>提交，协助者向所有参与者发送abort）</p></li><li><p>笨重，同步</p></li><li><p>进阶：三阶段提交</p></li><li><p>数据存储：极差的吞吐量</p></li></ul><h3 id="三阶段提交"><a class="markdownIt-Anchor" href="#三阶段提交"></a> 三阶段提交</h3><ul><li><p>3PC以额外的一轮过程为代价换取<strong>异步性</strong></p></li><li><p>Cohert-i</p></li></ul><div class="mermaid"><svg id="mermaid-svg-daf85e322160ac95" xmlns="http://www.w3.org/2000/svg" height="100%" viewbox="0 0 622.5 482" style="max-width:622.5px;"><style>  .mermaid .label{font-family:trebuchet ms,verdana,arial;color:#333}.node circle,.node ellipse,.node polygon,.node rect{fill:#cde498;stroke:#13540c;stroke-width:1px}.node.clickable{cursor:pointer}.arrowheadPath{fill:green}.edgePath .path{stroke:green;stroke-width:1.5px}.edgeLabel{background-color:#e8e8e8}.cluster rect{fill:#cdffb2!important;rx:4!important;stroke:#6eaa49!important;stroke-width:1px!important}.cluster text{fill:#333}.actor{stroke:#13540c;fill:#cde498}text.actor{fill:#000;stroke:none}.actor-line{stroke:grey}.messageLine0{marker-end:"url(#arrowhead)"}.messageLine0,.messageLine1{stroke-width:1.5;stroke-dasharray:"2 2";stroke:#333}#arrowhead{fill:#333}#crosshead path{fill:#333!important;stroke:#333!important}.messageText{fill:#333;stroke:none}.labelBox{stroke:#326932;fill:#cde498}.labelText,.loopText{fill:#000;stroke:none}.loopLine{stroke-width:2;stroke-dasharray:"2 2";marker-end:"url(#arrowhead)";stroke:#326932}.note{stroke:#6eaa49;fill:#fff5ad}.noteText{fill:#000;stroke:none;font-family:trebuchet ms,verdana,arial;font-size:14px}.section{stroke:none;opacity:.2}.section0,.section2{fill:#6eaa49}.section1,.section3{fill:#fff;opacity:.2}.sectionTitle0,.sectionTitle1,.sectionTitle2,.sectionTitle3{fill:#333}.sectionTitle{text-anchor:start;font-size:11px;text-height:14px}.grid .tick{stroke:#d3d3d3;opacity:.3;shape-rendering:crispEdges}.grid path{stroke-width:0}.today{fill:none;stroke:red;stroke-width:2px}.task{stroke-width:2}.taskText{text-anchor:middle;font-size:11px}.taskTextOutsideRight{fill:#000;text-anchor:start;font-size:11px}.taskTextOutsideLeft{fill:#000;text-anchor:end;font-size:11px}.taskText0,.taskText1,.taskText2,.taskText3{fill:#fff}.task0,.task1,.task2,.task3{fill:#487e3a;stroke:#13540c}.taskTextOutside0,.taskTextOutside1,.taskTextOutside2,.taskTextOutside3{fill:#000}.active0,.active1,.active2,.active3{fill:#cde498;stroke:#13540c}.activeText0,.activeText1,.activeText2,.activeText3{fill:#000!important}.done0,.done1,.done2,.done3{stroke:grey;fill:#d3d3d3;stroke-width:2}.doneText0,.doneText1,.doneText2,.doneText3{fill:#000!important}.crit0,.crit1,.crit2,.crit3{stroke:#f88;fill:red;stroke-width:2}.activeCrit0,.activeCrit1,.activeCrit2,.activeCrit3{stroke:#f88;fill:#cde498;stroke-width:2}.doneCrit0,.doneCrit1,.doneCrit2,.doneCrit3{stroke:#f88;fill:#d3d3d3;stroke-width:2;cursor:pointer;shape-rendering:crispEdges}.activeCritText0,.activeCritText1,.activeCritText2,.activeCritText3,.doneCritText0,.doneCritText1,.doneCritText2,.doneCritText3{fill:#000!important}.titleText{text-anchor:middle;font-size:18px;fill:#000}g.classGroup text{fill:#13540c;stroke:none;font-family:trebuchet ms,verdana,arial;font-size:10px}g.classGroup rect{fill:#cde498;stroke:#13540c}g.classGroup line{stroke:#13540c;stroke-width:1}svg .classLabel .box{stroke:none;stroke-width:0;fill:#cde498;opacity:.5}svg .classLabel .label{fill:#13540c;font-size:10px}.relation{stroke:#13540c;stroke-width:1;fill:none}#compositionEnd,#compositionStart,.composition{fill:#13540c;stroke:#13540c;stroke-width:1}#aggregationEnd,#aggregationStart,.aggregation{fill:#cde498;stroke:#13540c;stroke-width:1}#dependencyEnd,#dependencyStart,#extensionEnd,#extensionStart{fill:#13540c;stroke:#13540c;stroke-width:1}.node text{font-size:14px}.node text,div.mermaidTooltip{font-family:trebuchet ms,verdana,arial}div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-size:12px;background:#cdffb2;border:1px solid #6eaa49;border-radius:2px;pointer-events:none;z-index:100}svg {  color: rgb(0, 0, 0);  font: normal normal 400 normal 16px / normal "Times New Roman";}  </style><g><g class="output"><g class="clusters"/><g class="edgePaths"><g class="edgePath" style="opacity: 1;"><path class="path" d="M301.45522388059703,56L260.5,105L260.5,154" marker-end="url(#arrowhead32)" style="fill:none"/><defs><marker id="arrowhead32" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M354.5,51.98901098901099L498.5,105L498.5,172L498.5,239L498.5,306L498.5,365L423.4491525423729,406" marker-end="url(#arrowhead33)" style="stroke: #333; fill:none;stroke-width:2px;stroke-dasharray:3;"/><defs><marker id="arrowhead33" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M238.87313432835822,190L180,239L180,288" marker-end="url(#arrowhead34)" style="fill:none"/><defs><marker id="arrowhead34" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M294.5,189.52307692307693L390.5,239L390.5,306L390.5,365L390.5,406" marker-end="url(#arrowhead35)" style="stroke: #333; fill:none;stroke-width:2px;stroke-dasharray:3;"/><defs><marker id="arrowhead35" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M154.3728813559322,324L96,365L96,406" marker-end="url(#arrowhead36)" style="fill:none"/><defs><marker id="arrowhead36" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M205.6271186440678,324L264,365L352.5,406.27667984189725" marker-end="url(#arrowhead37)" style="stroke: #333; fill:none;stroke-width:2px;stroke-dasharray:3;"/><defs><marker id="arrowhead37" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g></g><g class="edgeLabels"><g class="edgeLabel" transform="translate(260.5,105)" style="opacity: 1;"><g transform="translate(-92,-24)" class="label"><foreignobject width="184" height="48"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">commit request msg <br/>received,agreedmsg sent<br/> to coordinator</span></div></foreignobject></g></g><g class="edgeLabel" transform="translate(498.5,239)" style="opacity: 1;"><g transform="translate(-84,-24)" class="label"><foreignobject width="168" height="48"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">prepare msg received,<br/>abort msg sent <br/>to coordinator</span></div></foreignobject></g></g><g class="edgeLabel" transform="translate(180,239)" style="opacity: 1;"><g transform="translate(-108,-16)" class="label"><foreignobject width="216" height="32"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">prepare msg received,<br/>send ack msg to coordinator</span></div></foreignobject></g></g><g class="edgeLabel" transform="translate(390.5,306)" style="opacity: 1;"><g transform="translate(-72,-16)" class="label"><foreignobject width="144" height="32"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">abort msg received<br/>from coordinator</span></div></foreignobject></g></g><g class="edgeLabel" transform="translate(96,365)" style="opacity: 1;"><g transform="translate(-76,-16)" class="label"><foreignobject width="152" height="32"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">commit msg received<br/>from coordinator</span></div></foreignobject></g></g><g class="edgeLabel" transform="translate(264,365)" style="opacity: 1;"><g transform="translate(-72,-16)" class="label"><foreignobject width="144" height="32"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">abort msg received<br/>from coordinator</span></div></foreignobject></g></g></g><g class="nodes"><g class="node" id="qi" transform="translate(316.5,38)" style="opacity: 1;"><rect rx="5" ry="5" x="-38" y="-18" width="76" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-28,-8)"><foreignobject width="56" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">Query-i</div></foreignobject></g></g></g><g class="node" id="wi" transform="translate(260.5,172)" style="opacity: 1;"><rect rx="5" ry="5" x="-34" y="-18" width="68" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-24,-8)"><foreignobject width="48" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">Wait-i</div></foreignobject></g></g></g><g class="node" id="ai" transform="translate(390.5,424)" style="opacity: 1;"><rect rx="5" ry="5" x="-38" y="-18" width="76" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-28,-8)"><foreignobject width="56" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">Abort-i</div></foreignobject></g></g></g><g class="node" id="pi" transform="translate(180,306)" style="opacity: 1;"><rect rx="5" ry="5" x="-54" y="-18" width="108" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-44,-8)"><foreignobject width="88" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">PreCommit-i</div></foreignobject></g></g></g><g class="node" id="ci" transform="translate(96,424)" style="opacity: 1;"><rect rx="5" ry="5" x="-42" y="-18" width="84" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-32,-8)"><foreignobject width="64" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">Commit-i</div></foreignobject></g></g></g></g></g></g></svg></div><ul><li>Coordinator</li></ul><div class="mermaid"><svg id="mermaid-svg-4a8bbc9803bb037d" xmlns="http://www.w3.org/2000/svg" height="100%" viewbox="0 0 520 482" style="max-width:520px;"><style>  .mermaid .label{font-family:trebuchet ms,verdana,arial;color:#333}.node circle,.node ellipse,.node polygon,.node rect{fill:#cde498;stroke:#13540c;stroke-width:1px}.node.clickable{cursor:pointer}.arrowheadPath{fill:green}.edgePath .path{stroke:green;stroke-width:1.5px}.edgeLabel{background-color:#e8e8e8}.cluster rect{fill:#cdffb2!important;rx:4!important;stroke:#6eaa49!important;stroke-width:1px!important}.cluster text{fill:#333}.actor{stroke:#13540c;fill:#cde498}text.actor{fill:#000;stroke:none}.actor-line{stroke:grey}.messageLine0{marker-end:"url(#arrowhead)"}.messageLine0,.messageLine1{stroke-width:1.5;stroke-dasharray:"2 2";stroke:#333}#arrowhead{fill:#333}#crosshead path{fill:#333!important;stroke:#333!important}.messageText{fill:#333;stroke:none}.labelBox{stroke:#326932;fill:#cde498}.labelText,.loopText{fill:#000;stroke:none}.loopLine{stroke-width:2;stroke-dasharray:"2 2";marker-end:"url(#arrowhead)";stroke:#326932}.note{stroke:#6eaa49;fill:#fff5ad}.noteText{fill:#000;stroke:none;font-family:trebuchet ms,verdana,arial;font-size:14px}.section{stroke:none;opacity:.2}.section0,.section2{fill:#6eaa49}.section1,.section3{fill:#fff;opacity:.2}.sectionTitle0,.sectionTitle1,.sectionTitle2,.sectionTitle3{fill:#333}.sectionTitle{text-anchor:start;font-size:11px;text-height:14px}.grid .tick{stroke:#d3d3d3;opacity:.3;shape-rendering:crispEdges}.grid path{stroke-width:0}.today{fill:none;stroke:red;stroke-width:2px}.task{stroke-width:2}.taskText{text-anchor:middle;font-size:11px}.taskTextOutsideRight{fill:#000;text-anchor:start;font-size:11px}.taskTextOutsideLeft{fill:#000;text-anchor:end;font-size:11px}.taskText0,.taskText1,.taskText2,.taskText3{fill:#fff}.task0,.task1,.task2,.task3{fill:#487e3a;stroke:#13540c}.taskTextOutside0,.taskTextOutside1,.taskTextOutside2,.taskTextOutside3{fill:#000}.active0,.active1,.active2,.active3{fill:#cde498;stroke:#13540c}.activeText0,.activeText1,.activeText2,.activeText3{fill:#000!important}.done0,.done1,.done2,.done3{stroke:grey;fill:#d3d3d3;stroke-width:2}.doneText0,.doneText1,.doneText2,.doneText3{fill:#000!important}.crit0,.crit1,.crit2,.crit3{stroke:#f88;fill:red;stroke-width:2}.activeCrit0,.activeCrit1,.activeCrit2,.activeCrit3{stroke:#f88;fill:#cde498;stroke-width:2}.doneCrit0,.doneCrit1,.doneCrit2,.doneCrit3{stroke:#f88;fill:#d3d3d3;stroke-width:2;cursor:pointer;shape-rendering:crispEdges}.activeCritText0,.activeCritText1,.activeCritText2,.activeCritText3,.doneCritText0,.doneCritText1,.doneCritText2,.doneCritText3{fill:#000!important}.titleText{text-anchor:middle;font-size:18px;fill:#000}g.classGroup text{fill:#13540c;stroke:none;font-family:trebuchet ms,verdana,arial;font-size:10px}g.classGroup rect{fill:#cde498;stroke:#13540c}g.classGroup line{stroke:#13540c;stroke-width:1}svg .classLabel .box{stroke:none;stroke-width:0;fill:#cde498;opacity:.5}svg .classLabel .label{fill:#13540c;font-size:10px}.relation{stroke:#13540c;stroke-width:1;fill:none}#compositionEnd,#compositionStart,.composition{fill:#13540c;stroke:#13540c;stroke-width:1}#aggregationEnd,#aggregationStart,.aggregation{fill:#cde498;stroke:#13540c;stroke-width:1}#dependencyEnd,#dependencyStart,#extensionEnd,#extensionStart{fill:#13540c;stroke:#13540c;stroke-width:1}.node text{font-size:14px}.node text,div.mermaidTooltip{font-family:trebuchet ms,verdana,arial}div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-size:12px;background:#cdffb2;border:1px solid #6eaa49;border-radius:2px;pointer-events:none;z-index:100}svg {  color: rgb(0, 0, 0);  font: normal normal 400 normal 16px / normal "Times New Roman";}  </style><g><g class="output"><g class="clusters"/><g class="edgePaths"><g class="edgePath" style="opacity: 1;"><path class="path" d="M111.28813559322035,56L96,97L96,138" marker-end="url(#arrowhead31)" style="fill:none"/><defs><marker id="arrowhead31" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M96,174L96,223L96,290L96,357L161.82089552238807,406" marker-end="url(#arrowhead32)" style="stroke: #333; fill:none;stroke-width:2px;stroke-dasharray:3;"/><defs><marker id="arrowhead32" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M130,163.3961038961039L404,223L404,272" marker-end="url(#arrowhead33)" style="fill:none"/><defs><marker id="arrowhead33" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M394.32835820895525,308L368,357L414.8059701492537,406" marker-end="url(#arrowhead34)" style="fill:none"/><defs><marker id="arrowhead34" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M146.67796610169492,56L212,97L212,156L212,223L212,290L212,357L192.98507462686567,406" marker-end="url(#arrowhead35)" style="stroke: #333; fill:none;stroke-width:2px;stroke-dasharray:3;"/><defs><marker id="arrowhead35" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M367.46268656716416,308L268,357L208.02985074626866,406" marker-end="url(#arrowhead36)" style="stroke: #333; fill:none;stroke-width:2px;stroke-dasharray:3;"/><defs><marker id="arrowhead36" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M421.1940298507463,308L468,357L441.67164179104475,406" marker-end="url(#arrowhead37)" style="stroke: #333; fill:none;stroke-width:2px;stroke-dasharray:3;"/><defs><marker id="arrowhead37" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g></g><g class="edgeLabels"><g class="edgeLabel" transform="translate(96,97)" style="opacity: 1;"><g transform="translate(-76,-16)" class="label"><foreignobject width="152" height="32"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">commit request msg<br/>sent to all coherts</span></div></foreignobject></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"/></div></foreignobject></g></g><g class="edgeLabel" transform="translate(404,223)" style="opacity: 1;"><g transform="translate(-76,-24)" class="label"><foreignobject width="152" height="48"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">all coherts agreed,<br/>send prepare msg<br/>to all coherts</span></div></foreignobject></g></g><g class="edgeLabel" transform="translate(368,357)" style="opacity: 1;"><g transform="translate(-80,-24)" class="label"><foreignobject width="160" height="48"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">all coherts sent ack<br/>msg, sent commit msg<br/>to all coherts</span></div></foreignobject></g></g><g class="edgeLabel" transform="translate(212,223)" style="opacity: 1;"><g transform="translate(-96,-24)" class="label"><foreignobject width="192" height="48"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">one or more coherts<br/>replied abort, abort msg<br/>sent to all coherts</span></div></foreignobject></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"/></div></foreignobject></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"/></div></foreignobject></g></g></g><g class="nodes"><g class="node" id="q1" transform="translate(118,38)" style="opacity: 1;"><rect rx="5" ry="5" x="-38" y="-18" width="76" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-28,-8)"><foreignobject width="56" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">Query-1</div></foreignobject></g></g></g><g class="node" id="w1" transform="translate(96,156)" style="opacity: 1;"><rect rx="5" ry="5" x="-34" y="-18" width="68" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-24,-8)"><foreignobject width="48" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">Wait-1</div></foreignobject></g></g></g><g class="node" id="a1" transform="translate(186,424)" style="opacity: 1;"><rect rx="5" ry="5" x="-38" y="-18" width="76" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-28,-8)"><foreignobject width="56" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">Abort-1</div></foreignobject></g></g></g><g class="node" id="p1" transform="translate(404,290)" style="opacity: 1;"><rect rx="5" ry="5" x="-54" y="-18" width="108" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-44,-8)"><foreignobject width="88" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">PreCommit-1</div></foreignobject></g></g></g><g class="node" id="c1" transform="translate(432,424)" style="opacity: 1;"><rect rx="5" ry="5" x="-42" y="-18" width="84" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-32,-8)"><foreignobject width="64" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">Commit-1</div></foreignobject></g></g></g></g></g></g></svg></div><ul><li><p>预提交阶段</p><ul><li><a href="https://coolshell.cn/articles/10910.html" target="_blank" rel="external">陈浩大佬</a> 认为其意义在于确定coordinator的可用性，因为<strong>协调者Coordinator对于事务的完成非常重要，Coordinator的可用性是个关键</strong></li><li>个人认为在这里还有个确定网络环境良好的意义在，毕竟造成Fail和Timeout的原因除了传输实体是否正常工作的外，还有网络环境的波动</li></ul></li><li><p>核心：在询问的时候并不锁定资源，除非所有人都同意了，才开始锁资源。</p></li></ul><hr><h2 id="数据分布"><a class="markdownIt-Anchor" href="#数据分布"></a> 数据分布</h2><h3 id="哈希分布"><a class="markdownIt-Anchor" href="#哈希分布"></a> 哈希分布</h3><ul><li><p>传统问题：<strong>N值发生变化</strong></p><ul><li><p>一致性哈希算法（Distributed Hash Table），将服务器节点构成一个哈希环，数据存放时计算哈希值，<strong>存放到环的第一个<em>大于或等于</em>值的节点</strong>，算法最大特征是<strong>增删节点只影响相邻节点</strong></p></li><li><p>负载均衡问题：节点性能不一的情况下，可以调整节点在环上的位置做出非均衡比例；或者引入虚拟节点，每个虚拟节点处理能力一致（即一个能力单位），一个处理能力强的物理节点可以拥有多个虚拟节点，在此基础上可以实现将需要迁移的数据分散到整个集群的操作（调整虚拟节点/能力单位）</p></li></ul></li><li><p>散列特性</p></li></ul><div class="mermaid"><svg id="mermaid-svg-2f715b787d1424e5" xmlns="http://www.w3.org/2000/svg" height="100%" viewbox="0 0 964 245" style="max-width:964px;"><style>  .mermaid .label{font-family:trebuchet ms,verdana,arial;color:#333}.node circle,.node ellipse,.node polygon,.node rect{fill:#cde498;stroke:#13540c;stroke-width:1px}.node.clickable{cursor:pointer}.arrowheadPath{fill:green}.edgePath .path{stroke:green;stroke-width:1.5px}.edgeLabel{background-color:#e8e8e8}.cluster rect{fill:#cdffb2!important;rx:4!important;stroke:#6eaa49!important;stroke-width:1px!important}.cluster text{fill:#333}.actor{stroke:#13540c;fill:#cde498}text.actor{fill:#000;stroke:none}.actor-line{stroke:grey}.messageLine0{marker-end:"url(#arrowhead)"}.messageLine0,.messageLine1{stroke-width:1.5;stroke-dasharray:"2 2";stroke:#333}#arrowhead{fill:#333}#crosshead path{fill:#333!important;stroke:#333!important}.messageText{fill:#333;stroke:none}.labelBox{stroke:#326932;fill:#cde498}.labelText,.loopText{fill:#000;stroke:none}.loopLine{stroke-width:2;stroke-dasharray:"2 2";marker-end:"url(#arrowhead)";stroke:#326932}.note{stroke:#6eaa49;fill:#fff5ad}.noteText{fill:#000;stroke:none;font-family:trebuchet ms,verdana,arial;font-size:14px}.section{stroke:none;opacity:.2}.section0,.section2{fill:#6eaa49}.section1,.section3{fill:#fff;opacity:.2}.sectionTitle0,.sectionTitle1,.sectionTitle2,.sectionTitle3{fill:#333}.sectionTitle{text-anchor:start;font-size:11px;text-height:14px}.grid .tick{stroke:#d3d3d3;opacity:.3;shape-rendering:crispEdges}.grid path{stroke-width:0}.today{fill:none;stroke:red;stroke-width:2px}.task{stroke-width:2}.taskText{text-anchor:middle;font-size:11px}.taskTextOutsideRight{fill:#000;text-anchor:start;font-size:11px}.taskTextOutsideLeft{fill:#000;text-anchor:end;font-size:11px}.taskText0,.taskText1,.taskText2,.taskText3{fill:#fff}.task0,.task1,.task2,.task3{fill:#487e3a;stroke:#13540c}.taskTextOutside0,.taskTextOutside1,.taskTextOutside2,.taskTextOutside3{fill:#000}.active0,.active1,.active2,.active3{fill:#cde498;stroke:#13540c}.activeText0,.activeText1,.activeText2,.activeText3{fill:#000!important}.done0,.done1,.done2,.done3{stroke:grey;fill:#d3d3d3;stroke-width:2}.doneText0,.doneText1,.doneText2,.doneText3{fill:#000!important}.crit0,.crit1,.crit2,.crit3{stroke:#f88;fill:red;stroke-width:2}.activeCrit0,.activeCrit1,.activeCrit2,.activeCrit3{stroke:#f88;fill:#cde498;stroke-width:2}.doneCrit0,.doneCrit1,.doneCrit2,.doneCrit3{stroke:#f88;fill:#d3d3d3;stroke-width:2;cursor:pointer;shape-rendering:crispEdges}.activeCritText0,.activeCritText1,.activeCritText2,.activeCritText3,.doneCritText0,.doneCritText1,.doneCritText2,.doneCritText3{fill:#000!important}.titleText{text-anchor:middle;font-size:18px;fill:#000}g.classGroup text{fill:#13540c;stroke:none;font-family:trebuchet ms,verdana,arial;font-size:10px}g.classGroup rect{fill:#cde498;stroke:#13540c}g.classGroup line{stroke:#13540c;stroke-width:1}svg .classLabel .box{stroke:none;stroke-width:0;fill:#cde498;opacity:.5}svg .classLabel .label{fill:#13540c;font-size:10px}.relation{stroke:#13540c;stroke-width:1;fill:none}#compositionEnd,#compositionStart,.composition{fill:#13540c;stroke:#13540c;stroke-width:1}#aggregationEnd,#aggregationStart,.aggregation{fill:#cde498;stroke:#13540c;stroke-width:1}#dependencyEnd,#dependencyStart,#extensionEnd,#extensionStart{fill:#13540c;stroke:#13540c;stroke-width:1}.node text{font-size:14px}.node text,div.mermaidTooltip{font-family:trebuchet ms,verdana,arial}div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-size:12px;background:#cdffb2;border:1px solid #6eaa49;border-radius:2px;pointer-events:none;z-index:100}svg {  color: rgb(0, 0, 0);  font: normal normal 400 normal 16px / normal "Times New Roman";}  </style><g><g class="output"><g class="clusters"/><g class="edgePaths"><g class="edgePath" style="opacity: 1;"><path class="path" d="M104,91L129,91L154.5,91.5" marker-end="url(#arrowhead28)" style="fill:none"/><defs><marker id="arrowhead28" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M235.75714285714287,106.24285714285715L299,134L428,134" marker-end="url(#arrowhead29)" style="fill:none"/><defs><marker id="arrowhead29" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M233.54,74.54L299,38L348,38" marker-end="url(#arrowhead30)" style="fill:none"/><defs><marker id="arrowhead30" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M512,121.71428571428571L617,91L674.5581395348837,66" marker-end="url(#arrowhead31)" style="fill:none"/><defs><marker id="arrowhead31" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M592,38L617,38L642,40.525252525252526" marker-end="url(#arrowhead32)" style="fill:none"/><defs><marker id="arrowhead32" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M512,136.85714285714286L617,144L682,144" marker-end="url(#arrowhead33)" style="fill:none"/><defs><marker id="arrowhead33" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M750,129.23232323232324L815,101L840,101" marker-end="url(#arrowhead34)" style="fill:none"/><defs><marker id="arrowhead34" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M750,158.76767676767676L815,187L840,187" marker-end="url(#arrowhead35)" style="fill:none"/><defs><marker id="arrowhead35" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g></g><g class="edgeLabels"><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"/></div></foreignobject></g></g><g class="edgeLabel" transform="translate(299,134)" style="opacity: 1;"><g transform="translate(-24,-8)" class="label"><foreignobject width="48" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">用户id</span></div></foreignobject></g></g><g class="edgeLabel" transform="translate(299,38)" style="opacity: 1;"><g transform="translate(-16,-8)" class="label"><foreignobject width="32" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">主键</span></div></foreignobject></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"/></div></foreignobject></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"/></div></foreignobject></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"/></div></foreignobject></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"/></div></foreignobject></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"/></div></foreignobject></g></g></g><g class="nodes"><g class="node" id="B" transform="translate(62,91)" style="opacity: 1;"><rect rx="5" ry="5" x="-42" y="-18" width="84" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-32,-8)"><foreignobject width="64" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">散列特性</div></foreignobject></g></g></g><g class="node" id="C" transform="translate(202,91)" style="opacity: 1;"><polygon points="48,0 96,-48 48,-96 0,-48" rx="5" ry="5" transform="translate(-48,48)"/><g class="label" transform="translate(0,0)"><g transform="translate(-32,-8)"><foreignobject width="64" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">散列键值</div></foreignobject></g></g></g><g class="node" id="D" transform="translate(470,134)" style="opacity: 1;"><rect rx="5" ry="5" x="-42" y="-18" width="84" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-32,-8)"><foreignobject width="64" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">数据倾斜</div></foreignobject></g></g></g><g class="node" id="E" transform="translate(470,38)" style="opacity: 1;"><rect rx="5" ry="5" x="-122" y="-18" width="244" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-112,-8)"><foreignobject width="224" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">同用户数据被分散到多台服务器</div></foreignobject></g></g></g><g class="node" id="F" transform="translate(716,48)" style="opacity: 1;"><rect rx="5" ry="5" x="-74" y="-18" width="148" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-64,-8)"><foreignobject width="128" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">好的散列函数困难</div></foreignobject></g></g></g><g class="node" id="G" transform="translate(716,144)" style="opacity: 1;"><rect rx="5" ry="5" x="-34" y="-18" width="68" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-24,-8)"><foreignobject width="48" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">大用户</div></foreignobject></g></g></g><g class="node" id="H" transform="translate(882,101)" style="opacity: 1;"><rect rx="5" ry="5" x="-42" y="-18" width="84" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-32,-8)"><foreignobject width="64" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">自动拆分</div></foreignobject></g></g></g><g class="node" id="I" transform="translate(882,187)" style="opacity: 1;"><rect rx="5" ry="5" x="-42" y="-18" width="84" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-32,-8)"><foreignobject width="64" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">手动拆分</div></foreignobject></g></g></g></g></g></g></svg></div><h3 id="顺序分布"><a class="markdownIt-Anchor" href="#顺序分布"></a> 顺序分布</h3><ul><li>将大表划分为连续的范围，得到子表，B+树形式组织，B+树节点即子表的合并操作</li></ul><hr><h2 id="复制与故障"><a class="markdownIt-Anchor" href="#复制与故障"></a> 复制与故障</h2><ul><li>主副本（primary）、备副本（Backup）</li></ul><div class="mermaid"><svg id="mermaid-svg-b787f0fd806afba2" xmlns="http://www.w3.org/2000/svg" height="100%" viewbox="0 0 604 225" style="max-width:604px;"><style>  .mermaid .label{font-family:trebuchet ms,verdana,arial;color:#333}.node circle,.node ellipse,.node polygon,.node rect{fill:#cde498;stroke:#13540c;stroke-width:1px}.node.clickable{cursor:pointer}.arrowheadPath{fill:green}.edgePath .path{stroke:green;stroke-width:1.5px}.edgeLabel{background-color:#e8e8e8}.cluster rect{fill:#cdffb2!important;rx:4!important;stroke:#6eaa49!important;stroke-width:1px!important}.cluster text{fill:#333}.actor{stroke:#13540c;fill:#cde498}text.actor{fill:#000;stroke:none}.actor-line{stroke:grey}.messageLine0{marker-end:"url(#arrowhead)"}.messageLine0,.messageLine1{stroke-width:1.5;stroke-dasharray:"2 2";stroke:#333}#arrowhead{fill:#333}#crosshead path{fill:#333!important;stroke:#333!important}.messageText{fill:#333;stroke:none}.labelBox{stroke:#326932;fill:#cde498}.labelText,.loopText{fill:#000;stroke:none}.loopLine{stroke-width:2;stroke-dasharray:"2 2";marker-end:"url(#arrowhead)";stroke:#326932}.note{stroke:#6eaa49;fill:#fff5ad}.noteText{fill:#000;stroke:none;font-family:trebuchet ms,verdana,arial;font-size:14px}.section{stroke:none;opacity:.2}.section0,.section2{fill:#6eaa49}.section1,.section3{fill:#fff;opacity:.2}.sectionTitle0,.sectionTitle1,.sectionTitle2,.sectionTitle3{fill:#333}.sectionTitle{text-anchor:start;font-size:11px;text-height:14px}.grid .tick{stroke:#d3d3d3;opacity:.3;shape-rendering:crispEdges}.grid path{stroke-width:0}.today{fill:none;stroke:red;stroke-width:2px}.task{stroke-width:2}.taskText{text-anchor:middle;font-size:11px}.taskTextOutsideRight{fill:#000;text-anchor:start;font-size:11px}.taskTextOutsideLeft{fill:#000;text-anchor:end;font-size:11px}.taskText0,.taskText1,.taskText2,.taskText3{fill:#fff}.task0,.task1,.task2,.task3{fill:#487e3a;stroke:#13540c}.taskTextOutside0,.taskTextOutside1,.taskTextOutside2,.taskTextOutside3{fill:#000}.active0,.active1,.active2,.active3{fill:#cde498;stroke:#13540c}.activeText0,.activeText1,.activeText2,.activeText3{fill:#000!important}.done0,.done1,.done2,.done3{stroke:grey;fill:#d3d3d3;stroke-width:2}.doneText0,.doneText1,.doneText2,.doneText3{fill:#000!important}.crit0,.crit1,.crit2,.crit3{stroke:#f88;fill:red;stroke-width:2}.activeCrit0,.activeCrit1,.activeCrit2,.activeCrit3{stroke:#f88;fill:#cde498;stroke-width:2}.doneCrit0,.doneCrit1,.doneCrit2,.doneCrit3{stroke:#f88;fill:#d3d3d3;stroke-width:2;cursor:pointer;shape-rendering:crispEdges}.activeCritText0,.activeCritText1,.activeCritText2,.activeCritText3,.doneCritText0,.doneCritText1,.doneCritText2,.doneCritText3{fill:#000!important}.titleText{text-anchor:middle;font-size:18px;fill:#000}g.classGroup text{fill:#13540c;stroke:none;font-family:trebuchet ms,verdana,arial;font-size:10px}g.classGroup rect{fill:#cde498;stroke:#13540c}g.classGroup line{stroke:#13540c;stroke-width:1}svg .classLabel .box{stroke:none;stroke-width:0;fill:#cde498;opacity:.5}svg .classLabel .label{fill:#13540c;font-size:10px}.relation{stroke:#13540c;stroke-width:1;fill:none}#compositionEnd,#compositionStart,.composition{fill:#13540c;stroke:#13540c;stroke-width:1}#aggregationEnd,#aggregationStart,.aggregation{fill:#cde498;stroke:#13540c;stroke-width:1}#dependencyEnd,#dependencyStart,#extensionEnd,#extensionStart{fill:#13540c;stroke:#13540c;stroke-width:1}.node text{font-size:14px}.node text,div.mermaidTooltip{font-family:trebuchet ms,verdana,arial}div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-size:12px;background:#cdffb2;border:1px solid #6eaa49;border-radius:2px;pointer-events:none;z-index:100}svg {  color: rgb(0, 0, 0);  font: normal normal 400 normal 16px / normal "Times New Roman";}  </style><g><g class="output"><g class="clusters"/><g class="edgePaths"><g class="edgePath" style="opacity: 1;"><path class="path" d="M112.74418604651163,106L161,81L210,81" marker-end="url(#arrowhead14)" style="fill:none"/><defs><marker id="arrowhead14" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M358.1860465116279,63L439,38L464,38" marker-end="url(#arrowhead15)" style="fill:none"/><defs><marker id="arrowhead15" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M358.1860465116279,99L439,124L472,124" marker-end="url(#arrowhead16)" style="fill:none"/><defs><marker id="arrowhead16" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M112.74418604651163,142L161,167L186,167" marker-end="url(#arrowhead17)" style="fill:none"/><defs><marker id="arrowhead17" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g></g><g class="edgeLabels"><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"/></div></foreignobject></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"/></div></foreignobject></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"/></div></foreignobject></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"/></div></foreignobject></g></g></g><g class="nodes"><g class="node" id="O" transform="translate(78,124)" style="opacity: 1;"><rect rx="5" ry="5" x="-58" y="-18" width="116" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-48,-8)"><foreignobject width="96" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">主备复制协议</div></foreignobject></g></g></g><g class="node" id="A" transform="translate(300,81)" style="opacity: 1;"><rect rx="5" ry="5" x="-90" y="-18" width="180" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-80,-8)"><foreignobject width="160" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">基于主副本的复制协议</div></foreignobject></g></g></g><g class="node" id="B" transform="translate(514,38)" style="opacity: 1;"><rect rx="5" ry="5" x="-50" y="-18" width="100" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-40,-8)"><foreignobject width="80" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">强同步复制</div></foreignobject></g></g></g><g class="node" id="C" transform="translate(514,124)" style="opacity: 1;"><rect rx="5" ry="5" x="-42" y="-18" width="84" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-32,-8)"><foreignobject width="64" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">异步复制</div></foreignobject></g></g></g><g class="node" id="D" transform="translate(300,167)" style="opacity: 1;"><rect rx="5" ry="5" x="-114" y="-18" width="228" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-104,-8)"><foreignobject width="208" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">基于多个存储节点的复制协议</div></foreignobject></g></g></g></g></g></g></svg></div><ul><li>故障检测：租约机制，带超时机制的一种授权</li><li>分布式存储系统结果：单/双层结构</li></ul><hr><h2 id="可扩展性"><a class="markdownIt-Anchor" href="#可扩展性"></a> 可扩展性</h2><ul><li><p>总控节点的瓶颈问题？=&gt;P2P架构更有优势？</p><ul><li>目前主流的分布式系统大多带有总控节点</li></ul></li><li><p>数据库水平扩展：分库分表</p></li><li><p>系统</p><ul><li>同构系统：主备节点，存储节点分为若干组，同个组内节点服务<strong>完全相同</strong>的数据，增加副本时需要迁移的数据量太大，不利于自动化，不适合大规模分布式存储系统</li><li>异构系统：数据划分为大小接近的分片，每个分片的副本可以分布在集群内的任意一个存储节点，发生故障将由整个集群来恢复，<strong>而不是某几个固定的存储节点</strong></li></ul></li><li><p>两阶段提交协议（2PC协议）</p><ul><li>阻塞协议，执行过程中需要锁住其他更新，大部分分布式存储系统不适用</li><li>本质：分布式原子操作</li><li>组成：协调者、参与者（workers、coherts、participant）</li><li>过程：请求阶段（Prepare）、提交阶段（Commit）</li></ul></li><li><p>Paxos协议</p><ul><li>前提：在非拜占庭模型条件下</li><li>有单Paxos和多Paxos，多Paxos大多数单Paxos的重复协调操作</li><li>过程：- 准备（prepare）/预提案、批准（accept）/提案、确认（acknowledge）/接受提案<ul><li>本质：一个倡议被接受后很快会被通知到其他的proposer，扩散式提交从而更多的acceptor同意</li><li>正确性（只接受一个）、可终止性(最后一定有协议被接受)</li><li>相关实现要点问题：倡议编号全局唯一且递增增长，proposer或者acceptor崩溃</li><li>用法：全局锁或命名配置服务、数据复制到多个数据中心</li><li>待问：同时担当多个角色？</li></ul></li></ul></li></ul><div class="mermaid"><svg id="mermaid-svg-1e1ee418287432b3" xmlns="http://www.w3.org/2000/svg" height="100%" viewbox="0 0 1036 190.5" style="max-width:1036px;"><style>  .mermaid .label{font-family:trebuchet ms,verdana,arial;color:#333}.node circle,.node ellipse,.node polygon,.node rect{fill:#cde498;stroke:#13540c;stroke-width:1px}.node.clickable{cursor:pointer}.arrowheadPath{fill:green}.edgePath .path{stroke:green;stroke-width:1.5px}.edgeLabel{background-color:#e8e8e8}.cluster rect{fill:#cdffb2!important;rx:4!important;stroke:#6eaa49!important;stroke-width:1px!important}.cluster text{fill:#333}.actor{stroke:#13540c;fill:#cde498}text.actor{fill:#000;stroke:none}.actor-line{stroke:grey}.messageLine0{marker-end:"url(#arrowhead)"}.messageLine0,.messageLine1{stroke-width:1.5;stroke-dasharray:"2 2";stroke:#333}#arrowhead{fill:#333}#crosshead path{fill:#333!important;stroke:#333!important}.messageText{fill:#333;stroke:none}.labelBox{stroke:#326932;fill:#cde498}.labelText,.loopText{fill:#000;stroke:none}.loopLine{stroke-width:2;stroke-dasharray:"2 2";marker-end:"url(#arrowhead)";stroke:#326932}.note{stroke:#6eaa49;fill:#fff5ad}.noteText{fill:#000;stroke:none;font-family:trebuchet ms,verdana,arial;font-size:14px}.section{stroke:none;opacity:.2}.section0,.section2{fill:#6eaa49}.section1,.section3{fill:#fff;opacity:.2}.sectionTitle0,.sectionTitle1,.sectionTitle2,.sectionTitle3{fill:#333}.sectionTitle{text-anchor:start;font-size:11px;text-height:14px}.grid .tick{stroke:#d3d3d3;opacity:.3;shape-rendering:crispEdges}.grid path{stroke-width:0}.today{fill:none;stroke:red;stroke-width:2px}.task{stroke-width:2}.taskText{text-anchor:middle;font-size:11px}.taskTextOutsideRight{fill:#000;text-anchor:start;font-size:11px}.taskTextOutsideLeft{fill:#000;text-anchor:end;font-size:11px}.taskText0,.taskText1,.taskText2,.taskText3{fill:#fff}.task0,.task1,.task2,.task3{fill:#487e3a;stroke:#13540c}.taskTextOutside0,.taskTextOutside1,.taskTextOutside2,.taskTextOutside3{fill:#000}.active0,.active1,.active2,.active3{fill:#cde498;stroke:#13540c}.activeText0,.activeText1,.activeText2,.activeText3{fill:#000!important}.done0,.done1,.done2,.done3{stroke:grey;fill:#d3d3d3;stroke-width:2}.doneText0,.doneText1,.doneText2,.doneText3{fill:#000!important}.crit0,.crit1,.crit2,.crit3{stroke:#f88;fill:red;stroke-width:2}.activeCrit0,.activeCrit1,.activeCrit2,.activeCrit3{stroke:#f88;fill:#cde498;stroke-width:2}.doneCrit0,.doneCrit1,.doneCrit2,.doneCrit3{stroke:#f88;fill:#d3d3d3;stroke-width:2;cursor:pointer;shape-rendering:crispEdges}.activeCritText0,.activeCritText1,.activeCritText2,.activeCritText3,.doneCritText0,.doneCritText1,.doneCritText2,.doneCritText3{fill:#000!important}.titleText{text-anchor:middle;font-size:18px;fill:#000}g.classGroup text{fill:#13540c;stroke:none;font-family:trebuchet ms,verdana,arial;font-size:10px}g.classGroup rect{fill:#cde498;stroke:#13540c}g.classGroup line{stroke:#13540c;stroke-width:1}svg .classLabel .box{stroke:none;stroke-width:0;fill:#cde498;opacity:.5}svg .classLabel .label{fill:#13540c;font-size:10px}.relation{stroke:#13540c;stroke-width:1;fill:none}#compositionEnd,#compositionStart,.composition{fill:#13540c;stroke:#13540c;stroke-width:1}#aggregationEnd,#aggregationStart,.aggregation{fill:#cde498;stroke:#13540c;stroke-width:1}#dependencyEnd,#dependencyStart,#extensionEnd,#extensionStart{fill:#13540c;stroke:#13540c;stroke-width:1}.node text{font-size:14px}.node text,div.mermaidTooltip{font-family:trebuchet ms,verdana,arial}div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-size:12px;background:#cdffb2;border:1px solid #6eaa49;border-radius:2px;pointer-events:none;z-index:100}svg {  color: rgb(0, 0, 0);  font: normal normal 400 normal 16px / normal "Times New Roman";}  </style><g><g class="output"><g class="clusters"/><g class="edgePaths"><g class="edgePath" style="opacity: 1;"><path class="path" d="M104,94.66019417475728L165,114.5L226,114.5" marker-end="url(#arrowhead32)" style="fill:none"/><defs><marker id="arrowhead32" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M310,114.5L335,114.5L360.5,115" marker-end="url(#arrowhead33)" style="fill:none"/><defs><marker id="arrowhead33" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M415.9,106.4L509,71.5L594,55.939890710382514" marker-end="url(#arrowhead34)" style="fill:none"/><defs><marker id="arrowhead34" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M420.23333333333335,119.26666666666667L509,132.5L658,132.5" marker-end="url(#arrowhead35)" style="fill:none"/><defs><marker id="arrowhead35" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M594,30.502732240437158L509,24L392,24L335,24L268,24L165,24L94.52631578947368,63" marker-end="url(#arrowhead36)" style="fill:none"/><defs><marker id="arrowhead36" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M790,38L815,38L840,38" marker-end="url(#arrowhead37)" style="fill:none"/><defs><marker id="arrowhead37" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g></g><g class="edgeLabels"><g class="edgeLabel" transform="translate(165,114.5)" style="opacity: 1;"><g transform="translate(-36,-8)" class="label"><foreignobject width="72" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">提案编号n</span></div></foreignobject></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"/></div></foreignobject></g></g><g class="edgeLabel" transform="translate(509,71.5)" style="opacity: 1;"><g transform="translate(-60,-8)" class="label"><foreignobject width="120" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">n大于已回复编号</span></div></foreignobject></g></g><g class="edgeLabel" transform="translate(509,132.5)" style="opacity: 1;"><g transform="translate(-20,-8)" class="label"><foreignobject width="40" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">n值小</span></div></foreignobject></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"/></div></foreignobject></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"/></div></foreignobject></g></g></g><g class="nodes"><g class="node" id="A" transform="translate(62,81)" style="opacity: 1;"><rect rx="0" ry="0" x="-42" y="-18" width="84" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-32,-8)"><foreignobject width="64" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">proposer</div></foreignobject></g></g></g><g class="node" id="B" transform="translate(268,114.5)" style="opacity: 1;"><rect rx="0" ry="0" x="-42" y="-18" width="84" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-32,-8)"><foreignobject width="64" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">acceptor</div></foreignobject></g></g></g><g class="node" id="C" transform="translate(392,114.5)" style="opacity: 1;"><polygon points="32,0 64,-32 32,-64 0,-32" rx="5" ry="5" transform="translate(-32,32)"/><g class="label" transform="translate(0,0)"><g transform="translate(-12,-8)"><foreignobject width="24" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">n值</div></foreignobject></g></g></g><g class="node" id="D" transform="translate(692,38)" style="opacity: 1;"><rect rx="5" ry="5" x="-98" y="-18" width="196" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-88,-8)"><foreignobject width="176" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">回复接受过提案最大编号</div></foreignobject></g></g></g><g class="node" id="F" transform="translate(692,132.5)" style="opacity: 1;"><rect rx="5" ry="5" x="-34" y="-18" width="68" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-24,-8)"><foreignobject width="48" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">不回复</div></foreignobject></g></g></g><g class="node" id="E" transform="translate(918,38)" style="opacity: 1;"><rect rx="5" ry="5" x="-78" y="-18" width="156" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-68,-8)"><foreignobject width="136" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">不再回复小于n提案</div></foreignobject></g></g></g></g></g></g></svg></div><div class="mermaid"><svg id="mermaid-svg-b63958eb7536e781" xmlns="http://www.w3.org/2000/svg" height="100%" viewbox="0 0 1066 182" style="max-width:1066px;"><style>  .mermaid .label{font-family:trebuchet ms,verdana,arial;color:#333}.node circle,.node ellipse,.node polygon,.node rect{fill:#cde498;stroke:#13540c;stroke-width:1px}.node.clickable{cursor:pointer}.arrowheadPath{fill:green}.edgePath .path{stroke:green;stroke-width:1.5px}.edgeLabel{background-color:#e8e8e8}.cluster rect{fill:#cdffb2!important;rx:4!important;stroke:#6eaa49!important;stroke-width:1px!important}.cluster text{fill:#333}.actor{stroke:#13540c;fill:#cde498}text.actor{fill:#000;stroke:none}.actor-line{stroke:grey}.messageLine0{marker-end:"url(#arrowhead)"}.messageLine0,.messageLine1{stroke-width:1.5;stroke-dasharray:"2 2";stroke:#333}#arrowhead{fill:#333}#crosshead path{fill:#333!important;stroke:#333!important}.messageText{fill:#333;stroke:none}.labelBox{stroke:#326932;fill:#cde498}.labelText,.loopText{fill:#000;stroke:none}.loopLine{stroke-width:2;stroke-dasharray:"2 2";marker-end:"url(#arrowhead)";stroke:#326932}.note{stroke:#6eaa49;fill:#fff5ad}.noteText{fill:#000;stroke:none;font-family:trebuchet ms,verdana,arial;font-size:14px}.section{stroke:none;opacity:.2}.section0,.section2{fill:#6eaa49}.section1,.section3{fill:#fff;opacity:.2}.sectionTitle0,.sectionTitle1,.sectionTitle2,.sectionTitle3{fill:#333}.sectionTitle{text-anchor:start;font-size:11px;text-height:14px}.grid .tick{stroke:#d3d3d3;opacity:.3;shape-rendering:crispEdges}.grid path{stroke-width:0}.today{fill:none;stroke:red;stroke-width:2px}.task{stroke-width:2}.taskText{text-anchor:middle;font-size:11px}.taskTextOutsideRight{fill:#000;text-anchor:start;font-size:11px}.taskTextOutsideLeft{fill:#000;text-anchor:end;font-size:11px}.taskText0,.taskText1,.taskText2,.taskText3{fill:#fff}.task0,.task1,.task2,.task3{fill:#487e3a;stroke:#13540c}.taskTextOutside0,.taskTextOutside1,.taskTextOutside2,.taskTextOutside3{fill:#000}.active0,.active1,.active2,.active3{fill:#cde498;stroke:#13540c}.activeText0,.activeText1,.activeText2,.activeText3{fill:#000!important}.done0,.done1,.done2,.done3{stroke:grey;fill:#d3d3d3;stroke-width:2}.doneText0,.doneText1,.doneText2,.doneText3{fill:#000!important}.crit0,.crit1,.crit2,.crit3{stroke:#f88;fill:red;stroke-width:2}.activeCrit0,.activeCrit1,.activeCrit2,.activeCrit3{stroke:#f88;fill:#cde498;stroke-width:2}.doneCrit0,.doneCrit1,.doneCrit2,.doneCrit3{stroke:#f88;fill:#d3d3d3;stroke-width:2;cursor:pointer;shape-rendering:crispEdges}.activeCritText0,.activeCritText1,.activeCritText2,.activeCritText3,.doneCritText0,.doneCritText1,.doneCritText2,.doneCritText3{fill:#000!important}.titleText{text-anchor:middle;font-size:18px;fill:#000}g.classGroup text{fill:#13540c;stroke:none;font-family:trebuchet ms,verdana,arial;font-size:10px}g.classGroup rect{fill:#cde498;stroke:#13540c}g.classGroup line{stroke:#13540c;stroke-width:1}svg .classLabel .box{stroke:none;stroke-width:0;fill:#cde498;opacity:.5}svg .classLabel .label{fill:#13540c;font-size:10px}.relation{stroke:#13540c;stroke-width:1;fill:none}#compositionEnd,#compositionStart,.composition{fill:#13540c;stroke:#13540c;stroke-width:1}#aggregationEnd,#aggregationStart,.aggregation{fill:#cde498;stroke:#13540c;stroke-width:1}#dependencyEnd,#dependencyStart,#extensionEnd,#extensionStart{fill:#13540c;stroke:#13540c;stroke-width:1}.node text{font-size:14px}.node text,div.mermaidTooltip{font-family:trebuchet ms,verdana,arial}div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-size:12px;background:#cdffb2;border:1px solid #6eaa49;border-radius:2px;pointer-events:none;z-index:100}svg {  color: rgb(0, 0, 0);  font: normal normal 400 normal 16px / normal "Times New Roman";}  </style><g><g class="output"><g class="clusters"/><g class="edgePaths"><g class="edgePath" style="opacity: 1;"><path class="path" d="M398,38L423,38L448,38" marker-end="url(#arrowhead32)" style="fill:none"/><defs><marker id="arrowhead32" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M184,124L209,124L266,124" marker-end="url(#arrowhead33)" style="fill:none"/><defs><marker id="arrowhead33" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M366,124L423,124L448,124" marker-end="url(#arrowhead34)" style="fill:none"/><defs><marker id="arrowhead34" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M564,38L589,38L627.953488372093,63" marker-end="url(#arrowhead35)" style="fill:none"/><defs><marker id="arrowhead35" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M564,124L589,124L627.953488372093,99" marker-end="url(#arrowhead36)" style="fill:none"/><defs><marker id="arrowhead36" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M698,81L723,81L748.5,81.5" marker-end="url(#arrowhead37)" style="fill:none"/><defs><marker id="arrowhead37" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M803.2027027027027,72.20270270270271L885,38L958,38" marker-end="url(#arrowhead38)" style="fill:none"/><defs><marker id="arrowhead38" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M803.2027027027027,90.79729729729729L885,124L966,124" marker-end="url(#arrowhead39)" style="fill:none"/><defs><marker id="arrowhead39" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g></g><g class="edgeLabels"><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"/></div></foreignobject></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"/></div></foreignobject></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"/></div></foreignobject></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"/></div></foreignobject></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"/></div></foreignobject></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"/></div></foreignobject></g></g><g class="edgeLabel" transform="translate(885,38)" style="opacity: 1;"><g transform="translate(-48,-8)" class="label"><foreignobject width="96" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">小于响应过的</span></div></foreignobject></g></g><g class="edgeLabel" transform="translate(885,124)" style="opacity: 1;"><g transform="translate(-48,-8)" class="label"><foreignobject width="96" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">大于响应过的</span></div></foreignobject></g></g></g><g class="nodes"><g class="node" id="A" transform="translate(316,38)" style="opacity: 1;"><rect rx="5" ry="5" x="-82" y="-18" width="164" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-72,-8)"><foreignobject width="144" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">预提案回复集不为空</div></foreignobject></g></g></g><g class="node" id="B" transform="translate(506,38)" style="opacity: 1;"><rect rx="5" ry="5" x="-58" y="-18" width="116" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-48,-8)"><foreignobject width="96" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">选择最大序号</div></foreignobject></g></g></g><g class="node" id="C" transform="translate(102,124)" style="opacity: 1;"><rect rx="5" ry="5" x="-82" y="-18" width="164" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-72,-8)"><foreignobject width="144" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">预提案回复集不为空</div></foreignobject></g></g></g><g class="node" id="D" transform="translate(316,124)" style="opacity: 1;"><rect rx="5" ry="5" x="-50" y="-18" width="100" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-40,-8)"><foreignobject width="80" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">生成新序号</div></foreignobject></g></g></g><g class="node" id="DD" transform="translate(506,124)" style="opacity: 1;"><rect rx="5" ry="5" x="-58" y="-18" width="116" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-48,-8)"><foreignobject width="96" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">自定义提案值</div></foreignobject></g></g></g><g class="node" id="E" transform="translate(656,81)" style="opacity: 1;"><rect rx="0" ry="0" x="-42" y="-18" width="84" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-32,-8)"><foreignobject width="64" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">acceptor</div></foreignobject></g></g></g><g class="node" id="F" transform="translate(780,81)" style="opacity: 1;"><polygon points="32,0 64,-32 32,-64 0,-32" rx="5" ry="5" transform="translate(-32,32)"/><g class="label" transform="translate(0,0)"><g transform="translate(-12,-8)"><foreignobject width="24" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">n值</div></foreignobject></g></g></g><g class="node" id="G" transform="translate(992,38)" style="opacity: 1;"><rect rx="5" ry="5" x="-34" y="-18" width="68" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-24,-8)"><foreignobject width="48" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">不接受</div></foreignobject></g></g></g><g class="node" id="H" transform="translate(992,124)" style="opacity: 1;"><rect rx="5" ry="5" x="-26" y="-18" width="52" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-16,-8)"><foreignobject width="32" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">接受</div></foreignobject></g></g></g></g></g></g></svg></div><div class="mermaid"><svg id="mermaid-svg-1bdbacd1df864318" xmlns="http://www.w3.org/2000/svg" height="100%" viewbox="0 0 816 96" style="max-width:816px;"><style>  .mermaid .label{font-family:trebuchet ms,verdana,arial;color:#333}.node circle,.node ellipse,.node polygon,.node rect{fill:#cde498;stroke:#13540c;stroke-width:1px}.node.clickable{cursor:pointer}.arrowheadPath{fill:green}.edgePath .path{stroke:green;stroke-width:1.5px}.edgeLabel{background-color:#e8e8e8}.cluster rect{fill:#cdffb2!important;rx:4!important;stroke:#6eaa49!important;stroke-width:1px!important}.cluster text{fill:#333}.actor{stroke:#13540c;fill:#cde498}text.actor{fill:#000;stroke:none}.actor-line{stroke:grey}.messageLine0{marker-end:"url(#arrowhead)"}.messageLine0,.messageLine1{stroke-width:1.5;stroke-dasharray:"2 2";stroke:#333}#arrowhead{fill:#333}#crosshead path{fill:#333!important;stroke:#333!important}.messageText{fill:#333;stroke:none}.labelBox{stroke:#326932;fill:#cde498}.labelText,.loopText{fill:#000;stroke:none}.loopLine{stroke-width:2;stroke-dasharray:"2 2";marker-end:"url(#arrowhead)";stroke:#326932}.note{stroke:#6eaa49;fill:#fff5ad}.noteText{fill:#000;stroke:none;font-family:trebuchet ms,verdana,arial;font-size:14px}.section{stroke:none;opacity:.2}.section0,.section2{fill:#6eaa49}.section1,.section3{fill:#fff;opacity:.2}.sectionTitle0,.sectionTitle1,.sectionTitle2,.sectionTitle3{fill:#333}.sectionTitle{text-anchor:start;font-size:11px;text-height:14px}.grid .tick{stroke:#d3d3d3;opacity:.3;shape-rendering:crispEdges}.grid path{stroke-width:0}.today{fill:none;stroke:red;stroke-width:2px}.task{stroke-width:2}.taskText{text-anchor:middle;font-size:11px}.taskTextOutsideRight{fill:#000;text-anchor:start;font-size:11px}.taskTextOutsideLeft{fill:#000;text-anchor:end;font-size:11px}.taskText0,.taskText1,.taskText2,.taskText3{fill:#fff}.task0,.task1,.task2,.task3{fill:#487e3a;stroke:#13540c}.taskTextOutside0,.taskTextOutside1,.taskTextOutside2,.taskTextOutside3{fill:#000}.active0,.active1,.active2,.active3{fill:#cde498;stroke:#13540c}.activeText0,.activeText1,.activeText2,.activeText3{fill:#000!important}.done0,.done1,.done2,.done3{stroke:grey;fill:#d3d3d3;stroke-width:2}.doneText0,.doneText1,.doneText2,.doneText3{fill:#000!important}.crit0,.crit1,.crit2,.crit3{stroke:#f88;fill:red;stroke-width:2}.activeCrit0,.activeCrit1,.activeCrit2,.activeCrit3{stroke:#f88;fill:#cde498;stroke-width:2}.doneCrit0,.doneCrit1,.doneCrit2,.doneCrit3{stroke:#f88;fill:#d3d3d3;stroke-width:2;cursor:pointer;shape-rendering:crispEdges}.activeCritText0,.activeCritText1,.activeCritText2,.activeCritText3,.doneCritText0,.doneCritText1,.doneCritText2,.doneCritText3{fill:#000!important}.titleText{text-anchor:middle;font-size:18px;fill:#000}g.classGroup text{fill:#13540c;stroke:none;font-family:trebuchet ms,verdana,arial;font-size:10px}g.classGroup rect{fill:#cde498;stroke:#13540c}g.classGroup line{stroke:#13540c;stroke-width:1}svg .classLabel .box{stroke:none;stroke-width:0;fill:#cde498;opacity:.5}svg .classLabel .label{fill:#13540c;font-size:10px}.relation{stroke:#13540c;stroke-width:1;fill:none}#compositionEnd,#compositionStart,.composition{fill:#13540c;stroke:#13540c;stroke-width:1}#aggregationEnd,#aggregationStart,.aggregation{fill:#cde498;stroke:#13540c;stroke-width:1}#dependencyEnd,#dependencyStart,#extensionEnd,#extensionStart{fill:#13540c;stroke:#13540c;stroke-width:1}.node text{font-size:14px}.node text,div.mermaidTooltip{font-family:trebuchet ms,verdana,arial}div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-size:12px;background:#cdffb2;border:1px solid #6eaa49;border-radius:2px;pointer-events:none;z-index:100}svg {  color: rgb(0, 0, 0);  font: normal normal 400 normal 16px / normal "Times New Roman";}  </style><g><g class="output"><g class="clusters"/><g class="edgePaths"><g class="edgePath" style="opacity: 1;"><path class="path" d="M104,38L129,38L154,38" marker-end="url(#arrowhead22)" style="fill:none"/><defs><marker id="arrowhead22" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M334,38L359,38L384,38" marker-end="url(#arrowhead23)" style="fill:none"/><defs><marker id="arrowhead23" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M484,38L509,38L534,38" marker-end="url(#arrowhead24)" style="fill:none"/><defs><marker id="arrowhead24" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M642,38L667,38L692,38" marker-end="url(#arrowhead25)" style="fill:none"/><defs><marker id="arrowhead25" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g></g><g class="edgeLabels"><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"/></div></foreignobject></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"/></div></foreignobject></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"/></div></foreignobject></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"/></div></foreignobject></g></g></g><g class="nodes"><g class="node" id="O" transform="translate(62,38)" style="opacity: 1;"><rect rx="0" ry="0" x="-42" y="-18" width="84" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-32,-8)"><foreignobject width="64" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">proposer</div></foreignobject></g></g></g><g class="node" id="A" transform="translate(244,38)" style="opacity: 1;"><rect rx="5" ry="5" x="-90" y="-18" width="180" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-80,-8)"><foreignobject width="160" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">超过一半acceptor接受</div></foreignobject></g></g></g><g class="node" id="B" transform="translate(434,38)" style="opacity: 1;"><rect rx="5" ry="5" x="-50" y="-18" width="100" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-40,-8)"><foreignobject width="80" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">提议值生效</div></foreignobject></g></g></g><g class="node" id="C" transform="translate(588,38)" style="opacity: 1;"><rect rx="5" ry="5" x="-54" y="-18" width="108" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-44,-8)"><foreignobject width="88" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">acknowledge</div></foreignobject></g></g></g><g class="node" id="D" transform="translate(734,38)" style="opacity: 1;"><rect rx="0" ry="0" x="-42" y="-18" width="84" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-32,-8)"><foreignobject width="64" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">acceptor</div></foreignobject></g></g></g></g></g></g></svg></div><ul><li>2PC与Paxos的结合：2PC保证分布式原子性问题（如Paxos的全局递增变量），Paxos解决一致性（2PC的协调者宕机）</li></ul><hr><h2 id="文件系统"><a class="markdownIt-Anchor" href="#文件系统"></a> 文件系统</h2><h3 id="google-file-system系统架构"><a class="markdownIt-Anchor" href="#google-file-system系统架构"></a> Google File System系统架构</h3><ul><li>性质：底层支撑文件系统，扩展性高，支撑上层复杂的文件系统架构，本质上是***弱一致性***</li></ul><div class="mermaid"><svg id="mermaid-svg-065cb4b0f1dd9bbe" xmlns="http://www.w3.org/2000/svg" height="100%" viewbox="0 0 778 96" style="max-width:778px;"><style>  .mermaid .label{font-family:trebuchet ms,verdana,arial;color:#333}.node circle,.node ellipse,.node polygon,.node rect{fill:#cde498;stroke:#13540c;stroke-width:1px}.node.clickable{cursor:pointer}.arrowheadPath{fill:green}.edgePath .path{stroke:green;stroke-width:1.5px}.edgeLabel{background-color:#e8e8e8}.cluster rect{fill:#cdffb2!important;rx:4!important;stroke:#6eaa49!important;stroke-width:1px!important}.cluster text{fill:#333}.actor{stroke:#13540c;fill:#cde498}text.actor{fill:#000;stroke:none}.actor-line{stroke:grey}.messageLine0{marker-end:"url(#arrowhead)"}.messageLine0,.messageLine1{stroke-width:1.5;stroke-dasharray:"2 2";stroke:#333}#arrowhead{fill:#333}#crosshead path{fill:#333!important;stroke:#333!important}.messageText{fill:#333;stroke:none}.labelBox{stroke:#326932;fill:#cde498}.labelText,.loopText{fill:#000;stroke:none}.loopLine{stroke-width:2;stroke-dasharray:"2 2";marker-end:"url(#arrowhead)";stroke:#326932}.note{stroke:#6eaa49;fill:#fff5ad}.noteText{fill:#000;stroke:none;font-family:trebuchet ms,verdana,arial;font-size:14px}.section{stroke:none;opacity:.2}.section0,.section2{fill:#6eaa49}.section1,.section3{fill:#fff;opacity:.2}.sectionTitle0,.sectionTitle1,.sectionTitle2,.sectionTitle3{fill:#333}.sectionTitle{text-anchor:start;font-size:11px;text-height:14px}.grid .tick{stroke:#d3d3d3;opacity:.3;shape-rendering:crispEdges}.grid path{stroke-width:0}.today{fill:none;stroke:red;stroke-width:2px}.task{stroke-width:2}.taskText{text-anchor:middle;font-size:11px}.taskTextOutsideRight{fill:#000;text-anchor:start;font-size:11px}.taskTextOutsideLeft{fill:#000;text-anchor:end;font-size:11px}.taskText0,.taskText1,.taskText2,.taskText3{fill:#fff}.task0,.task1,.task2,.task3{fill:#487e3a;stroke:#13540c}.taskTextOutside0,.taskTextOutside1,.taskTextOutside2,.taskTextOutside3{fill:#000}.active0,.active1,.active2,.active3{fill:#cde498;stroke:#13540c}.activeText0,.activeText1,.activeText2,.activeText3{fill:#000!important}.done0,.done1,.done2,.done3{stroke:grey;fill:#d3d3d3;stroke-width:2}.doneText0,.doneText1,.doneText2,.doneText3{fill:#000!important}.crit0,.crit1,.crit2,.crit3{stroke:#f88;fill:red;stroke-width:2}.activeCrit0,.activeCrit1,.activeCrit2,.activeCrit3{stroke:#f88;fill:#cde498;stroke-width:2}.doneCrit0,.doneCrit1,.doneCrit2,.doneCrit3{stroke:#f88;fill:#d3d3d3;stroke-width:2;cursor:pointer;shape-rendering:crispEdges}.activeCritText0,.activeCritText1,.activeCritText2,.activeCritText3,.doneCritText0,.doneCritText1,.doneCritText2,.doneCritText3{fill:#000!important}.titleText{text-anchor:middle;font-size:18px;fill:#000}g.classGroup text{fill:#13540c;stroke:none;font-family:trebuchet ms,verdana,arial;font-size:10px}g.classGroup rect{fill:#cde498;stroke:#13540c}g.classGroup line{stroke:#13540c;stroke-width:1}svg .classLabel .box{stroke:none;stroke-width:0;fill:#cde498;opacity:.5}svg .classLabel .label{fill:#13540c;font-size:10px}.relation{stroke:#13540c;stroke-width:1;fill:none}#compositionEnd,#compositionStart,.composition{fill:#13540c;stroke:#13540c;stroke-width:1}#aggregationEnd,#aggregationStart,.aggregation{fill:#cde498;stroke:#13540c;stroke-width:1}#dependencyEnd,#dependencyStart,#extensionEnd,#extensionStart{fill:#13540c;stroke:#13540c;stroke-width:1}.node text{font-size:14px}.node text,div.mermaidTooltip{font-family:trebuchet ms,verdana,arial}div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-size:12px;background:#cdffb2;border:1px solid #6eaa49;border-radius:2px;pointer-events:none;z-index:100}svg {  color: rgb(0, 0, 0);  font: normal normal 400 normal 16px / normal "Times New Roman";}  </style><g><g class="output"><g class="clusters"/><g class="edgePaths"><g class="edgePath" style="opacity: 1;"><path class="path" d="M176,38L201,38L226,38" marker-end="url(#arrowhead17)" style="fill:none"/><defs><marker id="arrowhead17" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M390,38L415,38L440,38" marker-end="url(#arrowhead18)" style="fill:none"/><defs><marker id="arrowhead18" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M532,38L557,38L582,38" marker-end="url(#arrowhead19)" style="fill:none"/><defs><marker id="arrowhead19" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g></g><g class="edgeLabels"><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"/></div></foreignobject></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"/></div></foreignobject></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"/></div></foreignobject></g></g></g><g class="nodes"><g class="node" id="A" transform="translate(98,38)" style="opacity: 1;"><rect rx="5" ry="5" x="-78" y="-18" width="156" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-68,-8)"><foreignobject width="136" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">GFS分布式文件系统</div></foreignobject></g></g></g><g class="node" id="B" transform="translate(308,38)" style="opacity: 1;"><rect rx="5" ry="5" x="-82" y="-18" width="164" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-72,-8)"><foreignobject width="144" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">Bigtable表格型数据</div></foreignobject></g></g></g><g class="node" id="C" transform="translate(486,38)" style="opacity: 1;"><rect rx="5" ry="5" x="-46" y="-18" width="92" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-36,-8)"><foreignobject width="72" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">Megastore</div></foreignobject></g></g></g><g class="node" id="D" transform="translate(660,38)" style="opacity: 1;"><rect rx="5" ry="5" x="-78" y="-18" width="156" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-68,-8)"><foreignobject width="136" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">Spanner关系型数据</div></foreignobject></g></g></g></g></g></g></svg></div><ul><li>角色：GFS Master（主控服务器）、GFS ChunkServer（CS，数据块服务器）、GFS客户端（<strong>一组接口</strong>，不遵循POSIX标准，库文件形式，<strong>不缓存文件数据</strong>）</li></ul><div class="mermaid"><svg id="mermaid-svg-8e6d1f448e18a427" xmlns="http://www.w3.org/2000/svg" height="100%" viewbox="0 0 812 212.5" style="max-width:812px;"><style>  .mermaid .label{font-family:trebuchet ms,verdana,arial;color:#333}.node circle,.node ellipse,.node polygon,.node rect{fill:#cde498;stroke:#13540c;stroke-width:1px}.node.clickable{cursor:pointer}.arrowheadPath{fill:green}.edgePath .path{stroke:green;stroke-width:1.5px}.edgeLabel{background-color:#e8e8e8}.cluster rect{fill:#cdffb2!important;rx:4!important;stroke:#6eaa49!important;stroke-width:1px!important}.cluster text{fill:#333}.actor{stroke:#13540c;fill:#cde498}text.actor{fill:#000;stroke:none}.actor-line{stroke:grey}.messageLine0{marker-end:"url(#arrowhead)"}.messageLine0,.messageLine1{stroke-width:1.5;stroke-dasharray:"2 2";stroke:#333}#arrowhead{fill:#333}#crosshead path{fill:#333!important;stroke:#333!important}.messageText{fill:#333;stroke:none}.labelBox{stroke:#326932;fill:#cde498}.labelText,.loopText{fill:#000;stroke:none}.loopLine{stroke-width:2;stroke-dasharray:"2 2";marker-end:"url(#arrowhead)";stroke:#326932}.note{stroke:#6eaa49;fill:#fff5ad}.noteText{fill:#000;stroke:none;font-family:trebuchet ms,verdana,arial;font-size:14px}.section{stroke:none;opacity:.2}.section0,.section2{fill:#6eaa49}.section1,.section3{fill:#fff;opacity:.2}.sectionTitle0,.sectionTitle1,.sectionTitle2,.sectionTitle3{fill:#333}.sectionTitle{text-anchor:start;font-size:11px;text-height:14px}.grid .tick{stroke:#d3d3d3;opacity:.3;shape-rendering:crispEdges}.grid path{stroke-width:0}.today{fill:none;stroke:red;stroke-width:2px}.task{stroke-width:2}.taskText{text-anchor:middle;font-size:11px}.taskTextOutsideRight{fill:#000;text-anchor:start;font-size:11px}.taskTextOutsideLeft{fill:#000;text-anchor:end;font-size:11px}.taskText0,.taskText1,.taskText2,.taskText3{fill:#fff}.task0,.task1,.task2,.task3{fill:#487e3a;stroke:#13540c}.taskTextOutside0,.taskTextOutside1,.taskTextOutside2,.taskTextOutside3{fill:#000}.active0,.active1,.active2,.active3{fill:#cde498;stroke:#13540c}.activeText0,.activeText1,.activeText2,.activeText3{fill:#000!important}.done0,.done1,.done2,.done3{stroke:grey;fill:#d3d3d3;stroke-width:2}.doneText0,.doneText1,.doneText2,.doneText3{fill:#000!important}.crit0,.crit1,.crit2,.crit3{stroke:#f88;fill:red;stroke-width:2}.activeCrit0,.activeCrit1,.activeCrit2,.activeCrit3{stroke:#f88;fill:#cde498;stroke-width:2}.doneCrit0,.doneCrit1,.doneCrit2,.doneCrit3{stroke:#f88;fill:#d3d3d3;stroke-width:2;cursor:pointer;shape-rendering:crispEdges}.activeCritText0,.activeCritText1,.activeCritText2,.activeCritText3,.doneCritText0,.doneCritText1,.doneCritText2,.doneCritText3{fill:#000!important}.titleText{text-anchor:middle;font-size:18px;fill:#000}g.classGroup text{fill:#13540c;stroke:none;font-family:trebuchet ms,verdana,arial;font-size:10px}g.classGroup rect{fill:#cde498;stroke:#13540c}g.classGroup line{stroke:#13540c;stroke-width:1}svg .classLabel .box{stroke:none;stroke-width:0;fill:#cde498;opacity:.5}svg .classLabel .label{fill:#13540c;font-size:10px}.relation{stroke:#13540c;stroke-width:1;fill:none}#compositionEnd,#compositionStart,.composition{fill:#13540c;stroke:#13540c;stroke-width:1}#aggregationEnd,#aggregationStart,.aggregation{fill:#cde498;stroke:#13540c;stroke-width:1}#dependencyEnd,#dependencyStart,#extensionEnd,#extensionStart{fill:#13540c;stroke:#13540c;stroke-width:1}.node text{font-size:14px}.node text,div.mermaidTooltip{font-family:trebuchet ms,verdana,arial}div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-size:12px;background:#cdffb2;border:1px solid #6eaa49;border-radius:2px;pointer-events:none;z-index:100}svg {  color: rgb(0, 0, 0);  font: normal normal 400 normal 16px / normal "Times New Roman";}  </style><g><g class="output"><g class="clusters"/><g class="edgePaths"><g class="edgePath" style="opacity: 1;"><path class="path" d="M126.1203007518797,76.5L245,28L346,40.36734693877551" marker-end="url(#arrowhead29)" style="fill:none"/><defs><marker id="arrowhead29" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M346,51.63265306122449L245,64L144,82.89877300613497" marker-end="url(#arrowhead30)" style="fill:none"/><defs><marker id="arrowhead30" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M438,46L535,46L662.7058823529412,104.5" marker-end="url(#arrowhead31)" style="fill:none"/><defs><marker id="arrowhead31" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M632,128.3682634730539L535,136.5L420.44198895027625,64" marker-end="url(#arrowhead32)" style="fill:none"/><defs><marker id="arrowhead32" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M144,99.82515337423312L245,108.5L392,108.5L535,108.5L632,116.63173652694611" marker-end="url(#arrowhead33)" style="fill:none"/><defs><marker id="arrowhead33" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M632,140.10479041916167L535,164.5L392,164.5L245,164.5L123.91428571428571,112.5" marker-end="url(#arrowhead34)" style="fill:none"/><defs><marker id="arrowhead34" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g></g><g class="edgeLabels"><g class="edgeLabel" transform="translate(245,28)" style="opacity: 1;"><g transform="translate(-76,-8)" class="label"><foreignobject width="152" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">chunk句柄,chunk位置</span></div></foreignobject></g></g><g class="edgeLabel" transform="translate(245,64)" style="opacity: 1;"><g transform="translate(-64,-8)" class="label"><foreignobject width="128" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">文件名,chunk索引</span></div></foreignobject></g></g><g class="edgeLabel" transform="translate(535,46)" style="opacity: 1;"><g transform="translate(-72,-8)" class="label"><foreignobject width="144" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">chunk句柄,字节范围</span></div></foreignobject></g></g><g class="edgeLabel" transform="translate(535,136.5)" style="opacity: 1;"><g transform="translate(-36,-8)" class="label"><foreignobject width="72" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">chunk数据</span></div></foreignobject></g></g><g class="edgeLabel" transform="translate(392,108.5)" style="opacity: 1;"><g transform="translate(-32,-8)" class="label"><foreignobject width="64" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">控制消息</span></div></foreignobject></g></g><g class="edgeLabel" transform="translate(392,164.5)" style="opacity: 1;"><g transform="translate(-32,-8)" class="label"><foreignobject width="64" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">控制消息</span></div></foreignobject></g></g></g><g class="nodes"><g class="node" id="A" transform="translate(82,94.5)" style="opacity: 1;"><rect rx="5" ry="5" x="-62" y="-18" width="124" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-52,-8)"><foreignobject width="104" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">GFS主控服务器</div></foreignobject></g></g></g><g class="node" id="B" transform="translate(392,46)" style="opacity: 1;"><rect rx="5" ry="5" x="-46" y="-18" width="92" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-36,-8)"><foreignobject width="72" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">GFS客户端</div></foreignobject></g></g></g><g class="node" id="C" transform="translate(702,122.5)" style="opacity: 1;"><rect rx="5" ry="5" x="-70" y="-18" width="140" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-60,-8)"><foreignobject width="120" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">GFS数据块服务器</div></foreignobject></g></g></g></g></g></g></svg></div><p>（<em><strong>控制流和数据流分离，这是SDN的一种经典表现</strong></em>）</p><ul><li><p>应用：Google Bigtable、MapReduce</p></li><li><p>一致性模型：<strong>追加</strong>模型而非修改模型，追加模型更新没有落地到每一个副本上读到的只是过时数据，而修改则可能读到<strong>错误</strong>数据</p></li><li><p>GFS追加流程（核心）：数据流水线（减少时延）、分离数据流与控制流（优化数据传输，将数据流优先传达<strong>网络拓扑上最近</strong>的节点上，避免副本节点间跨机架、跨机房之类的消耗</p></li><li><p>负载均衡</p><ul><li>chunk副本创建位置<ul><li>磁盘利用率较低的节点</li><li>限制时间范围内创建的数量（重要，因为不加以限制，新的chunkserver上线时由于磁盘利用率低很可能被创建请求压垮）</li><li>所有副本不能同在一个机架</li></ul></li><li>主控Master会定期扫描挡墙副本的分布情况，分布不均会重新执行负载均衡</li></ul></li></ul><div class="mermaid"><svg id="mermaid-svg-406bf5f6a652ad6f" xmlns="http://www.w3.org/2000/svg" height="100%" viewbox="0 0 780 192.5" style="max-width:780px;"><style>  .mermaid .label{font-family:trebuchet ms,verdana,arial;color:#333}.node circle,.node ellipse,.node polygon,.node rect{fill:#cde498;stroke:#13540c;stroke-width:1px}.node.clickable{cursor:pointer}.arrowheadPath{fill:green}.edgePath .path{stroke:green;stroke-width:1.5px}.edgeLabel{background-color:#e8e8e8}.cluster rect{fill:#cdffb2!important;rx:4!important;stroke:#6eaa49!important;stroke-width:1px!important}.cluster text{fill:#333}.actor{stroke:#13540c;fill:#cde498}text.actor{fill:#000;stroke:none}.actor-line{stroke:grey}.messageLine0{marker-end:"url(#arrowhead)"}.messageLine0,.messageLine1{stroke-width:1.5;stroke-dasharray:"2 2";stroke:#333}#arrowhead{fill:#333}#crosshead path{fill:#333!important;stroke:#333!important}.messageText{fill:#333;stroke:none}.labelBox{stroke:#326932;fill:#cde498}.labelText,.loopText{fill:#000;stroke:none}.loopLine{stroke-width:2;stroke-dasharray:"2 2";marker-end:"url(#arrowhead)";stroke:#326932}.note{stroke:#6eaa49;fill:#fff5ad}.noteText{fill:#000;stroke:none;font-family:trebuchet ms,verdana,arial;font-size:14px}.section{stroke:none;opacity:.2}.section0,.section2{fill:#6eaa49}.section1,.section3{fill:#fff;opacity:.2}.sectionTitle0,.sectionTitle1,.sectionTitle2,.sectionTitle3{fill:#333}.sectionTitle{text-anchor:start;font-size:11px;text-height:14px}.grid .tick{stroke:#d3d3d3;opacity:.3;shape-rendering:crispEdges}.grid path{stroke-width:0}.today{fill:none;stroke:red;stroke-width:2px}.task{stroke-width:2}.taskText{text-anchor:middle;font-size:11px}.taskTextOutsideRight{fill:#000;text-anchor:start;font-size:11px}.taskTextOutsideLeft{fill:#000;text-anchor:end;font-size:11px}.taskText0,.taskText1,.taskText2,.taskText3{fill:#fff}.task0,.task1,.task2,.task3{fill:#487e3a;stroke:#13540c}.taskTextOutside0,.taskTextOutside1,.taskTextOutside2,.taskTextOutside3{fill:#000}.active0,.active1,.active2,.active3{fill:#cde498;stroke:#13540c}.activeText0,.activeText1,.activeText2,.activeText3{fill:#000!important}.done0,.done1,.done2,.done3{stroke:grey;fill:#d3d3d3;stroke-width:2}.doneText0,.doneText1,.doneText2,.doneText3{fill:#000!important}.crit0,.crit1,.crit2,.crit3{stroke:#f88;fill:red;stroke-width:2}.activeCrit0,.activeCrit1,.activeCrit2,.activeCrit3{stroke:#f88;fill:#cde498;stroke-width:2}.doneCrit0,.doneCrit1,.doneCrit2,.doneCrit3{stroke:#f88;fill:#d3d3d3;stroke-width:2;cursor:pointer;shape-rendering:crispEdges}.activeCritText0,.activeCritText1,.activeCritText2,.activeCritText3,.doneCritText0,.doneCritText1,.doneCritText2,.doneCritText3{fill:#000!important}.titleText{text-anchor:middle;font-size:18px;fill:#000}g.classGroup text{fill:#13540c;stroke:none;font-family:trebuchet ms,verdana,arial;font-size:10px}g.classGroup rect{fill:#cde498;stroke:#13540c}g.classGroup line{stroke:#13540c;stroke-width:1}svg .classLabel .box{stroke:none;stroke-width:0;fill:#cde498;opacity:.5}svg .classLabel .label{fill:#13540c;font-size:10px}.relation{stroke:#13540c;stroke-width:1;fill:none}#compositionEnd,#compositionStart,.composition{fill:#13540c;stroke:#13540c;stroke-width:1}#aggregationEnd,#aggregationStart,.aggregation{fill:#cde498;stroke:#13540c;stroke-width:1}#dependencyEnd,#dependencyStart,#extensionEnd,#extensionStart{fill:#13540c;stroke:#13540c;stroke-width:1}.node text{font-size:14px}.node text,div.mermaidTooltip{font-family:trebuchet ms,verdana,arial}div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-size:12px;background:#cdffb2;border:1px solid #6eaa49;border-radius:2px;pointer-events:none;z-index:100}svg {  color: rgb(0, 0, 0);  font: normal normal 400 normal 16px / normal "Times New Roman";}  </style><g><g class="output"><g class="clusters"/><g class="edgePaths"><g class="edgePath" style="opacity: 1;"><path class="path" d="M120,103.4090909090909L169,94.5L218,105.12650602409639" marker-end="url(#arrowhead43)" style="fill:none"/><defs><marker id="arrowhead43" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M218,119.87349397590361L169,130.5L120,121.5909090909091" marker-end="url(#arrowhead44)" style="fill:none"/><defs><marker id="arrowhead44" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M285.5730337078652,94.5L335,68L386,68" marker-end="url(#arrowhead45)" style="fill:none"/><defs><marker id="arrowhead45" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M430,55.945205479452056L481,28L536.3333333333334,64" marker-end="url(#arrowhead46)" style="fill:none"/><defs><marker id="arrowhead46" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M598,72.37349397590361L647,58.5L696,74.71830985915493" marker-end="url(#arrowhead47)" style="fill:none"/><defs><marker id="arrowhead47" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M286,125.60843373493975L335,144.5L408,144.5L481,144.5L540.096,100" marker-end="url(#arrowhead48)" style="fill:none"/><defs><marker id="arrowhead48" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M530,89.37349397590361L481,100L430,77.64383561643835" marker-end="url(#arrowhead49)" style="fill:none"/><defs><marker id="arrowhead49" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M598,87.12048192771084L647,94.5L696,85.87323943661971" marker-end="url(#arrowhead50)" style="fill:none"/><defs><marker id="arrowhead50" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M430,66.79452054794521L481,64L530,74.62650602409639" marker-end="url(#arrowhead51)" style="fill:none"/><defs><marker id="arrowhead51" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M696,97.02816901408451L647,130.5L594.8041237113403,100" marker-end="url(#arrowhead52)" style="fill:none"/><defs><marker id="arrowhead52" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g></g><g class="edgeLabels"><g class="edgeLabel" transform="translate(169,94.5)" style="opacity: 1;"><g transform="translate(-24,-8)" class="label"><foreignobject width="48" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">1,控制</span></div></foreignobject></g></g><g class="edgeLabel" transform="translate(169,130.5)" style="opacity: 1;"><g transform="translate(-24,-8)" class="label"><foreignobject width="48" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">2,控制</span></div></foreignobject></g></g><g class="edgeLabel" transform="translate(335,68)" style="opacity: 1;"><g transform="translate(-24,-8)" class="label"><foreignobject width="48" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">3,数据</span></div></foreignobject></g></g><g class="edgeLabel" transform="translate(481,28)" style="opacity: 1;"><g transform="translate(-24,-8)" class="label"><foreignobject width="48" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">3,数据</span></div></foreignobject></g></g><g class="edgeLabel" transform="translate(647,58.5)" style="opacity: 1;"><g transform="translate(-24,-8)" class="label"><foreignobject width="48" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">3,数据</span></div></foreignobject></g></g><g class="edgeLabel" transform="translate(408,144.5)" style="opacity: 1;"><g transform="translate(-24,-8)" class="label"><foreignobject width="48" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">4,控制</span></div></foreignobject></g></g><g class="edgeLabel" transform="translate(481,100)" style="opacity: 1;"><g transform="translate(-24,-8)" class="label"><foreignobject width="48" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">5,控制</span></div></foreignobject></g></g><g class="edgeLabel" transform="translate(647,94.5)" style="opacity: 1;"><g transform="translate(-24,-8)" class="label"><foreignobject width="48" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">5,控制</span></div></foreignobject></g></g><g class="edgeLabel" transform="translate(481,64)" style="opacity: 1;"><g transform="translate(-24,-8)" class="label"><foreignobject width="48" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">6,控制</span></div></foreignobject></g></g><g class="edgeLabel" transform="translate(647,130.5)" style="opacity: 1;"><g transform="translate(-24,-8)" class="label"><foreignobject width="48" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">6,控制</span></div></foreignobject></g></g></g><g class="nodes"><g class="node" id="A" transform="translate(70,112.5)" style="opacity: 1;"><rect rx="5" ry="5" x="-50" y="-18" width="100" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-40,-8)"><foreignobject width="80" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">主控服务器</div></foreignobject></g></g></g><g class="node" id="B" transform="translate(252,112.5)" style="opacity: 1;"><rect rx="5" ry="5" x="-34" y="-18" width="68" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-24,-8)"><foreignobject width="48" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">客户端</div></foreignobject></g></g></g><g class="node" id="C" transform="translate(408,68)" style="opacity: 1;"><rect rx="5" ry="5" x="-22" y="-18" width="44" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-12,-8)"><foreignobject width="24" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">备A</div></foreignobject></g></g></g><g class="node" id="D" transform="translate(564,82)" style="opacity: 1;"><rect rx="5" ry="5" x="-34" y="-18" width="68" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-24,-8)"><foreignobject width="48" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">主副本</div></foreignobject></g></g></g><g class="node" id="E" transform="translate(718,82)" style="opacity: 1;"><rect rx="5" ry="5" x="-22" y="-18" width="44" height="36"/><g class="label" transform="translate(0,0)"><g transform="translate(-12,-8)"><foreignobject width="24" height="16"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">备B</div></foreignobject></g></g></g></g></g></g></svg></div><ul><li>延续/下一代：Colossus<ul><li>实时性</li><li>海量小文件</li></ul></li></ul><h3 id="taobao-file-system对比gfs"><a class="markdownIt-Anchor" href="#taobao-file-system对比gfs"></a> Taobao File System对比GFS</h3><ul><li><p>NameServer有一主一备，GFS只有一个Master</p></li><li><p>读写比较高，没有针对写操作的优化，每次写操作都要请求NameServer（即GFS的主控）；而GFS有租约机制，将写权限下放到ChunkServer，客户端请求一次获得ChunkServer相关信息后会缓存起来，后面读写该chunk都不会重复请求Master</p></li><li><p>没有分离数据流与控制流</p></li><li><p>NameServer不需要维护目录树，也不需要维持文件与Block结构的映射关系</p></li></ul><h3 id="blob文件系统"><a class="markdownIt-Anchor" href="#blob文件系统"></a> Blob文件系统</h3><ul><li>特征：较大，文件间没什么联系，基本只读（如图片存储）</li></ul><hr><h2 id="内容分发网络"><a class="markdownIt-Anchor" href="#内容分发网络"></a> 内容分发网络</h2><ul><li>分布式缓存系统比分布式存储系统构建容易，因为<strong>缓存故障节点可以直接踢掉</strong></li></ul><h3 id="架构"><a class="markdownIt-Anchor" href="#架构"></a> 架构</h3><ul><li>CDN（Content Distribution Network）</li><li>P2P（Peer-to-Peer）</li></ul><h4 id="cdn"><a class="markdownIt-Anchor" href="#cdn"></a> CDN</h4><ul><li>CDN通过将网络内容分发到靠近用户的边缘节点，使得不同地域用户访问时能就近获取内容，不需要通过多个路由器中转<ul><li>边缘节点：与用户&quot;一跳之遥&quot;（Single Hop）的节点</li></ul></li></ul><hr><blockquote><p>Written with <a href="https://stackedit.io/" target="_blank" rel="external">StackEdit</a>.</p></blockquote><!--stackedit_data:eyJoaXN0b3J5IjpbLTE2MDMyMTkxNDBdfQ==--> ]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
&lt;h1 id=&quot;分布式存储系统&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#分布式存储系统&quot;&gt;&lt;/a&gt; 分布式存储系统&lt;/h1&gt;
&lt;h2 id=&quot;基本概念&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#基本概念&quot;&gt;&lt;/a&gt; 基本概念&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;三态：成功、失败、超时。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;协议类型：租约协议、复制协议、一致性协议&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;目标&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;可扩展性，最终目标是&lt;strong&gt;线性可扩展&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;功能，最终目标是支持&lt;strong&gt;全功能SQL&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;RPC请求成功但超时&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="coding" scheme="http://blog.garenfeather.cn/categories/coding/"/>
    
    
      <category term="cdn" scheme="http://blog.garenfeather.cn/tags/cdn/"/>
    
      <category term="distributed" scheme="http://blog.garenfeather.cn/tags/distributed/"/>
    
      <category term="gfs" scheme="http://blog.garenfeather.cn/tags/gfs/"/>
    
      <category term="storage" scheme="http://blog.garenfeather.cn/tags/storage/"/>
    
      <category term="2pc" scheme="http://blog.garenfeather.cn/tags/2pc/"/>
    
      <category term="3pc" scheme="http://blog.garenfeather.cn/tags/3pc/"/>
    
      <category term="log" scheme="http://blog.garenfeather.cn/tags/log/"/>
    
      <category term="paxos" scheme="http://blog.garenfeather.cn/tags/paxos/"/>
    
      <category term="hash" scheme="http://blog.garenfeather.cn/tags/hash/"/>
    
  </entry>
  
</feed>
